{"version":3,"sources":["app/Config.js","app/access/LoginView.js","app/access/UserRepository.js","app/base/Bindable.js","app/base/Cache.js","app/base/Cookie.js","app/base/Dom.js","app/base/Repository.js","app/base/Router.js","app/base/Tag.js","app/base/Theme.js","app/base/View.js","app/base/ViewList.js","app/form/ButtonField.js","app/form/Field.js","app/form/FieldSet.js","app/form/FileField.js","app/form/Form.js","app/form/HiddenField.js","app/form/HtmlField.js","app/form/SelectField.js","app/tag/PopOutTag.js","app/tag/ScrollTag.js","app/toast/Toast.js","app/toast/ToastAlert.js"],"names":["Config","View","LoginView","template","event","console","log","preventDefault","fbWindow","window","open","backend","userCheck","clearInterval","onInterval","UserRepository","getCurrentUser","then","response","user","body","id","Router","clearCache","Repository","Toast","instance","pop","ToastAlert","title","username","publicId","time","logoutWindow","refresh","request","uri","Bindable","object","isBindable","Node","Object","defineProperty","enumerable","writable","binding","bindingAll","bindTo","property","callback","push","i","stack","stackTime","before","after","setCount","toString","JSON","stringify","makeBindable","set","target","key","value","stop","warnOn","del","undefined","Array","isArray","splice","get","newFunc","executing","unshift","Date","getTime","ret","apply","arguments","execTime","shift","ref","Proxy","deleteProperty","Cache","expiry","bucket","expiration","defaultvalue","Cookie","name","jar","location","href","substr","document","cookie","split","map","c","parse","error","decodeURIComponent","v","k","t","d","cookieString","encodeURIComponent","Dom","doc","selector","startNode","endNode","result","started","ended","treeWalker","createTreeWalker","NodeFilter","SHOW_ALL","acceptNode","node","FILTER_SKIP","Element","matches","FILTER_ACCEPT","nextNode","currentNode","dispatchEvent","mapTags","objects","args","content","Promise","resolve","skeleton","post","cache","type","queryString","formData","queryArgs","api","keys","arg","join","fullUri","postString","FormData","append","xhr","XMLHttpRequest","tagCacheSelector","tagCache","querySelector","tagCacheContent","innerText","withCredentials","timeout","xhrId","xhrs","length","reject","onreadystatechange","DONE","OK","readyState","status","responseText","code","prerendering","createElement","appendChild","setAttribute","setRequestHeader","send","abort","xhrList","mainView","addEventListener","match","pathname","go","route","silent","history","pushState","Event","path","view","forceRefresh","current","routes","query","URLSearchParams","search","pair","load","pause","update","L1","L2","j","argName","groups","exec","Error","store","parts","finalArgs","fresh","queryOver","queryToString","Tag","element","parent","index","proxy","cleanup","clearBindings","firstChild","removeChild","Theme","views","single","list","model","modelClass","_modelClass","class","content_type","_id","uuid","firstNode","lastNode","nodes","frames","timeouts","intervals","attach","detach","eventCleanup","viewList","viewLists","tags","timestamp","requestAnimationFrame","wrappedCallback","fired","setTimeout","created","paused","setInterval","clearTimeout","parentNode","insertPoint","detachEvent","bubbles","attachEvent","insertBefore","subDoc","createRange","createContextualFragment","tag","prerenderAttr","getAttribute","eachAttr","carryAttr","removeAttribute","subTemplate","innerHTML","carryProps","eachProp","asProp","keyProp","remove","ViewList","render","subArgs","withAttr","LinkAttr","linkClick","eventListener","removeEventListener","action","String","a","eventName","replace","callbackName","argList","s","trim","eventMethod","argRefs","outerHTML","bindArg","tagName","toLowerCase","checked","inputListener","regex","nodeType","TEXT_NODE","original","nodeValue","interpolatable","header","bindProperty","unsafeHtml","staticPrefix","substring","staticNode","createTextNode","dynamicNode","staticSuffix","ELEMENT_NODE","attributes","attribute","bindProperties","segments","refAttr","refProp","refClassname","refKey","refClass","stringToClass","refKeyVal","mapIfTags","bind","createComment","newNode","postRender","ifProperty","inverted","ifDoc","moveTag","prepend","str","crypto","getRandomValues","Uint8Array","refClassSplit","refShortClassname","require","subProperty","keyProperty","reRender","finalViews","found","viewArgs","appendOnly","ButtonField","values","form","attrs","buttonClick","Field","valueString","ignore","setting","FieldSet","fields","Form","renderFields","children","FileField","flatValue","method","_method","classes","_classes","_onSubmit","field","SelectField","HtmlField","HiddenField","contentEditable","contenteditable","options","PopOutTag","poppedOut","style","moving","leftDuration","unpoppedStyle","previousScroll","classList","add","scrollStyle","rect","clickListener","getBoundingClientRect","contains","stopPropagation","scrollY","x","y","width","height","overflow","overflowY","popLevel","scrollTo","unpopLevel","level","ScrollTag","topEdge","resizeListening","visible","offsetTop","offsetBottom","threshold","subscribedTo","scrollListener","scrollSubTags","scrolled","resizeListenr","resizeTags","attachListener","e","addScrollListener","addResizeListener","scrolledEvent","CustomEvent","detail","offset","scroller","subOffsetTop","subOffsetBottom","scrollTop","clientHeight","offsetParent","bottomEdge","resizeListener","inst","alerts","alert","decay","init","opacity","complete","decayInterval"],"mappings":"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","file":".dist/curvature.js","sourcesContent":["export class Config extends View{}\n","import { Config         } from 'Config';\r\n\r\nimport { View           } from '../base/View';\r\nimport { Router         } from '../base/Router';\r\nimport { Repository     } from '../base/Repository';\r\n\r\nimport { UserRepository } from './UserRepository';\r\n\r\nimport { Toast      } from '../toast/Toast';\r\nimport { ToastAlert } from '../toast/ToastAlert';\r\n\r\nexport class LoginView extends View{\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.template = `\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t\r\n\t\t\t<a cv-link = \"user\">User</a>\r\n\t\t\t<br />\r\n\t\t\t\r\n\t\t\t<a cv-link = \"user/login\">Login</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<a cv-link = \"user/register\">Register</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<a cv-link = \"user/logout\">Logout</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<input\r\n\t\t\t\ttype  = \"button\"\r\n\t\t\t\tvalue = \"Login via FaceBook\"\r\n\t\t\t \tcv-on = \"click:facebookLogin(event)\"\r\n\t\t\t />\r\n\t\t\t <input\r\n\t\t\t\ttype  = \"button\"\r\n\t\t\t\tvalue = \"Log Out\"\r\n\t\t\t \tcv-on = \"click:logout(event)\"\r\n\t\t\t />\r\n\t\t`;\r\n\t}\r\n\tfacebookLogin(event) {\r\n\t\tconsole.log('fb!')\r\n\t\tevent.preventDefault();\r\n\t\tlet fbWindow = window.open(\r\n\t\t\tConfig.backend\r\n\t\t\t\t+ '/facebookLogin'\r\n\t\t);\r\n\r\n\t\tif(this.userCheck)\r\n\t\t{\r\n\t\t\tthis.clearInterval(this.userCheck);\r\n\t\t}\r\n\r\n\t\tthis.userCheck = this.onInterval(333, () => {\r\n\t\t\tUserRepository.getCurrentUser(true).then((response) => {\r\n\t\t\t\tlet user = response.body;\r\n\t\t\t\tif(!user.id || !user)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.clearInterval(this.userCheck);\r\n\r\n\t\t\t\tRouter.clearCache();\r\n\t\t\t\tRepository.clearCache();\r\n\r\n\t\t\t\tToast.instance().pop(new ToastAlert({\r\n\t\t\t\t\ttitle: 'Logged in as ' + user.username\r\n\t\t\t\t\t, body: 'ID: '  + user.publicId\r\n\t\t\t\t\t, time: 2400\r\n\t\t\t\t}));\r\n\r\n\t\t\t\t// history.go(-1);\r\n\r\n\t\t\t\t// Router.instance().updateView(this, this.routes, true);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tlogout(event) {\r\n\t\tlet logoutWindow = window.open(\r\n\t\t\tConfig.backend\r\n\t\t\t\t+ '/user/logout?page=app%3Fclose%3D1'\r\n\t\t);\r\n\t}\r\n}\r\n\r\n","import { Config     } from 'Config';\r\nimport { Repository } from '../base/Repository';\r\n\r\nexport class UserRepository extends Repository {\r\n\tstatic get uri() { return Config.backend + '/user/'; }\r\n\tstatic getCurrentUser(refresh) {\r\n\t\treturn this.request(\r\n\t\t\tthis.uri + 'current'\r\n\t\t\t, false, false, false\r\n\t\t).then((user) => {\r\n\t\t\treturn user;\r\n\t\t});\r\n\t}\r\n\tstatic logout() {\r\n\t\treturn this.request(\r\n\t\t\tthis.uri + 'logout'\r\n\t\t\t, false, {}, false\r\n\t\t).then((user) => {\r\n\t\t\treturn user;\r\n\t\t});\r\n\t}\r\n}","export class Bindable {\r\n\tstatic isBindable(object)\r\n\t{\r\n\t\tif(!object.isBindable)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn object.isBindable === Bindable;\r\n\t}\r\n\tstatic makeBindable(object) {\r\n\r\n\t\tif(!object\r\n\t\t\t|| object.isBindable\r\n\t\t\t|| typeof object !== 'object'\r\n\t\t\t|| object instanceof Node\r\n\t\t) {\r\n\t\t\treturn object;\r\n\t\t}\r\n\r\n\t\tObject.defineProperty(object, 'ref', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'bindTo', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'binding', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'bindingAll', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'isBindable', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'executing', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'stack', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'stackTime', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'before', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'after', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'toString', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'setCount', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tobject.isBindable = Bindable;\r\n\t\tobject.binding    = {};\r\n\t\tobject.bindingAll = [];\r\n\t\tobject.bindTo     = ((object) => (property, callback = null) => {\r\n\t\t\tif(callback == null) {\r\n\t\t\t\tcallback = property;\r\n\t\t\t\tobject.bindingAll.push(callback);\r\n\t\t\t\tfor(let i in object) {\r\n\t\t\t\t\tcallback(object[i], i, object, false);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!object.binding[property]) {\r\n\t\t\t\tobject.binding[property] = [];\r\n\t\t\t}\r\n\r\n\t\t\tobject.binding[property].push(callback);\r\n\r\n\t\t\tcallback(object[property], property, object, false);\r\n\r\n\t\t})(object);\r\n\r\n\t\tobject.stack      = [];\r\n\t\tobject.stackTime  = [];\r\n\t\tobject.before     = [];\r\n\t\tobject.after      = [];\r\n\t\tobject.setCount   = {};\r\n\r\n\t\tobject.toString = ((object) => () => {\r\n\t\t\tif(typeof object == 'object')\r\n\t\t\t{\r\n\t\t\t\treturn JSON.stringify(object);\r\n\t\t\t\treturn '[object]'\r\n\t\t\t}\r\n\r\n\t\t\treturn object;\r\n\t\t})(object);\r\n\r\n\t\tfor(let i in object)\r\n\t\t{\r\n\t\t\tif(object[i]\r\n\t\t\t\t&& typeof object[i] == 'object'\r\n\t\t\t\t&& !object[i] instanceof Node\r\n\t\t\t){\r\n\t\t\t\tobject[i] = Bindable.makeBindable(object[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet set = ((object) => (target, key, value) =>\r\n\t\t{\r\n\t\t\tif(target[key] === value && typeof value !== object)\r\n\t\t\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(`Setting ${key}`, value);\r\n\r\n\t\t\tif(value && typeof value == 'object' && !(value instanceof Node))\r\n\t\t\t{\r\n\t\t\t\tif(value.isBindable !== Bindable)\r\n\t\t\t\t{\r\n\t\t\t\t\tvalue = Bindable.makeBindable(value);\r\n\r\n\t\t\t\t\tfor(let i in value)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(value[i] && typeof value[i] == 'object')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue[i] = Bindable.makeBindable(value[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in object.bindingAll)\r\n\t\t\t{\r\n\t\t\t\tobject.bindingAll[i](value, key, target, false);\r\n\t\t\t}\r\n\r\n\t\t\tlet stop = false;\r\n\r\n\t\t\tif(key in object.binding) {\r\n\t\t\t\tfor(let i in object.binding[key])\r\n\t\t\t\t{\r\n\t\t\t\t\tif(object.binding[key][i](value, key, target, false) === false)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstop = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!stop)\r\n\t\t\t{\r\n\t\t\t\ttarget[key] = value;\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif(!target.setCount[key])\r\n\t\t\t{\r\n\t\t\t\ttarget.setCount[key] = 0;\r\n\t\t\t}\r\n\r\n\t\t\ttarget.setCount[key]++;\r\n\r\n\t\t\tconst warnOn = 10;\r\n\r\n\t\t\tif(target.setCount[key] > warnOn && value instanceof Object)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t'Warning: Resetting bindable reference \"'\r\n\t\t\t\t\t\t+ key\r\n\t\t\t\t\t\t+ '\" to object '\r\n\t\t\t\t\t\t+ target.setCount[key]\r\n\t\t\t\t\t\t+ ' times.'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t})(object);\r\n\r\n\t\tlet del = ((object) => (target, key) => {\r\n\t\t\t// console.log(key, 'DEL');\r\n\r\n\t\t\tif(!(key in target)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in object.bindingAll) {\r\n\t\t\t\tobject.bindingAll[i](undefined, key, target, true);\r\n\t\t\t}\r\n\r\n\t\t\tif(key in object.binding) {\r\n\t\t\t\tfor(let i in object.binding[key]) {\r\n\t\t\t\t\tobject.binding[key][i](undefined, key, target, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(Array.isArray(target)) {\r\n\t\t\t\ttarget.splice(key, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdelete target[key];\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t})(object);\r\n\r\n\t\tlet get = ((object) => (target, key) =>\r\n\t\t{\r\n\t\t\tif(typeof target[key] == 'function')\r\n\t\t\t{\r\n\t\t\t\tlet newFunc = function() {\r\n\t\t\t\t\ttarget.executing = key;\r\n\r\n\t\t\t\t\ttarget.stack.unshift(key);\r\n\t\t\t\t\ttarget.stackTime.unshift((new Date).getTime());\r\n\r\n\t\t\t\t\t// console.log(`Start ${key}()`);\r\n\r\n\t\t\t\t\tfor(let i in target.before)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttarget.before[i](target, key, object);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet ret = target[key].apply(target, arguments);\r\n\r\n\t\t\t\t\tfor(let i in target.after)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttarget.after[i](target, key, object);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttarget.executing = null;\r\n\r\n\t\t\t\t\tlet execTime = (new Date).getTime() - target.stackTime[0];\r\n\r\n\t\t\t\t\tif(execTime > 150)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// console.log(`End ${key}(), took ${execTime} ms`);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttarget.stack.shift();\r\n\t\t\t\t\ttarget.stackTime.shift();\r\n\r\n\t\t\t\t\treturn ret;\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn newFunc;\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(`Getting ${key}`);\r\n\r\n\t\t\treturn target[key];\r\n\t\t})(object);\r\n\r\n\t\tobject.ref = new Proxy(object, {\r\n\t\t\tdeleteProperty: del\r\n\t\t\t, get:          get\r\n\t\t\t, set:          set\r\n\t\t});\r\n\r\n\t\treturn object.ref;\r\n\t}\r\n\tstatic clearBindings(object)\r\n\t{\r\n\t\tobject.binding = {};\r\n\t}\r\n}","export class Cache\r\n{\r\n\tstatic store(key, value, expiry, bucket = 'standard')\r\n\t{\r\n\t\tlet expiration = (expiry * 1000) + (new Date).getTime();\r\n\r\n\t\t// console.log(\r\n\t\t// \t`Caching ${key} until ${expiration} in ${bucket}.`\r\n\t\t// \t, value\r\n\t\t// \t, this.bucket\r\n\t\t// );\r\n\r\n\t\tif(!this.bucket)\r\n\t\t{\r\n\t\t\tthis.bucket = {};\r\n\t\t}\r\n\r\n\t\tif(!this.bucket[bucket])\r\n\t\t{\r\n\t\t\tthis.bucket[bucket]\t= {};\r\n\t\t}\r\n\r\n\t\tthis.bucket[bucket][key] = {expiration, value};\r\n\t}\r\n\r\n\tstatic load(key, defaultvalue = false, bucket = 'standard')\r\n\t{\r\n\t\t// console.log(\r\n\t\t// \t`Checking cache for ${key} in ${bucket}.`\r\n\t\t// \t, this.bucket\r\n\t\t// );\r\n\r\n\t\tif(this.bucket && this.bucket[bucket] && this.bucket[bucket][key])\r\n\t\t{\r\n\t\t\t// console.log(this.bucket[bucket][key].expiration, (new Date).getTime());\r\n\t\t\tif(this.bucket[bucket][key].expiration > (new Date).getTime())\r\n\t\t\t{\r\n\t\t\t\treturn this.bucket[bucket][key].value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn defaultvalue;\r\n\t}\r\n}","import { Bindable } from './Bindable';\n\nexport class Cookie\n{\n\tstatic set(name, value)\n\t{\n\t\tCookie.jar[name] = value;\n\t}\n\n\tstatic get(name)\n\t{\n\t\treturn Cookie.jar[name];\n\t}\n\n\tstatic delete(name)\n\t{\n\t\tdelete Cookie.jar[name];\n\t}\n};\n\nCookie.jar = Cookie.jar || Bindable.makeBindable({});\n\nif(window.location.href.substr(0,4) !== 'data')\n{\n\tdocument.cookie.split(';').map(c => {\n\t\tlet [key, value] = c.split('=');\n\n\t\ttry\n\t\t{\n\t\t\tvalue = JSON.parse(value);\n\t\t}\n\t\tcatch(error)\n\t\t{\n\t\t\tvalue = value;\n\t\t}\n\n\t\tCookie.jar[decodeURIComponent(key)] = value;\n\t});\n\n\tCookie.jar.bindTo((v,k,t,d) => {\n\t\tt[k] = v;\n\n\t\tif(d)\n\t\t{\n\t\t\tt[k] = null;\n\t\t}\n\t\t\n\t\tconst cookieString = `${encodeURIComponent(k)}=${JSON.stringify(t[k])}`;\n\t\tdocument.cookie = cookieString;\n\t});\n}\n","export class Dom\r\n{\r\n\tstatic mapTags(doc, selector, callback, startNode, endNode)\r\n\t{\r\n\t\tlet result = [];\r\n\r\n\t\tlet started = true;\r\n\r\n\t\tif(startNode)\r\n\t\t{\r\n\t\t\tstarted = false;\r\n\t\t}\r\n\r\n\t\tlet ended = false;\r\n\r\n\t\tvar treeWalker = document.createTreeWalker(\r\n\t\t\tdoc,\r\n\t\t\tNodeFilter.SHOW_ALL,\r\n\t\t\t{\r\n\t\t\t\tacceptNode: (node) => {\r\n\t\t\t\t\tif(!started)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(node === startNode)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tstarted = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(endNode && node === endNode)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tended = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(ended)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(selector)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// console.log(selector, node, !!(node instanceof Element));\r\n\t\t\t\t\t\tif(node instanceof Element)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(node.matches(selector))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfalse\r\n\t\t);\r\n\r\n\t\twhile(treeWalker.nextNode())\r\n\t\t{\r\n\t\t\tresult.push(callback(treeWalker.currentNode));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\tstatic dispatchEvent(doc, event)\r\n\t{\r\n\t\tdoc.dispatchEvent(event);\r\n\r\n\t\tDom.mapTags(doc, false, (node) => {\r\n\t\t\tnode.dispatchEvent(event);\r\n\t\t});\r\n\t}\r\n}","import { Cookie } from './Cookie';\r\n\r\nvar objects = {};\r\n\r\nexport class Repository\r\n{\r\n\tstatic get xhrs() { return this.xhrList = this.xhrList || [];   }\r\n\r\n\tstatic loadPage(args = {}, refresh = false) {\r\n\t\treturn this.request(this.uri, args).then((response) => {\r\n\t\t\treturn response;\r\n\t\t\t// return response.map((skeleton) => new Model(skeleton));\r\n\t\t});\r\n\t}\r\n\tstatic domCache(uri, content)\r\n\t{\r\n\t\tconsole.log(uri, content);\r\n\r\n\r\n\t}\r\n\tstatic load(id, refresh = false) {\r\n\t\tthis.objects           = this.objects           || {};\r\n\t\tthis.objects[this.uri] = this.objects[this.uri] || {};\r\n\r\n\t\tif(this.objects[this.uri][id]) {\r\n\t\t\treturn Promise.resolve(this.objects[this.uri][id]);\r\n\t\t}\r\n\r\n\t\treturn this.request(this.uri + '/' + id).then((response) => {\r\n\t\t\t// let model = new Model(response);\r\n\t\t\t// return this.objects[this.uri][id] = model;\r\n\t\t});\r\n\t}\r\n\tstatic form(id = null) {\r\n\t\tlet uri = this.uri + '/' + 'create';\r\n\t\tif(id) {\r\n\t\t\turi = this.uri + '/' + id + '/edit';\r\n\t\t}\r\n\t\treturn this.request(uri).then((skeleton) => {\r\n\t\t\treturn skeleton;\r\n\t\t});\r\n\t}\r\n\tstatic clearCache() {\r\n\t\tif(this.objects && this.objects[this.uri]) {\r\n\t\t\tthis.objects[this.uri] = {};\r\n\t\t}\r\n\t}\r\n\tstatic request(uri, args = null, post = null, cache = true) {\r\n\t\tlet type = 'GET';\r\n\t\tlet queryString = '';\r\n\t\tlet formData = null;\r\n\t\tlet queryArgs   = {};\r\n\r\n\t\tif(args) {\r\n\t\t\tqueryArgs   = args;\r\n\t\t}\r\n\r\n\t\tqueryArgs.api   = queryArgs.api || 'json';\r\n\r\n\t\tqueryString = Object.keys(queryArgs).map((arg) => {\r\n\t\t\treturn encodeURIComponent(arg)\r\n\t\t\t+ '='\r\n\t\t\t+ encodeURIComponent(queryArgs[arg])\r\n\t\t}).join('&');\r\n\r\n\t\tlet fullUri    = uri;\r\n\t\tlet postString = '';\r\n\r\n\t\tif(post) {\r\n\t\t\tcache = false;\r\n\t\t\ttype = 'POST';\r\n\t\t\tformData = new FormData();\r\n\t\t\tfor(let i in post) {\r\n\t\t\t\tformData.append(i, post[i]);\r\n\t\t\t}\r\n\t\t\tpostString = Object.keys(post).map((arg) => {\r\n\t\t\t\treturn encodeURIComponent(arg)\r\n\t\t\t\t+ '='\r\n\t\t\t\t+ encodeURIComponent(post[arg])\r\n\t\t\t}).join('&');\r\n\t\t}\r\n\r\n\t\tfullUri = uri + '?' + queryString;\r\n\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\r\n\t\tif(!post && cache && this.cache && this.cache[fullUri]) {\r\n\t\t\treturn Promise.resolve(this.cache[fullUri]);\r\n\t\t}\r\n\r\n\t\tlet tagCacheSelector = 'script[data-uri=\"'\r\n\t\t\t+ fullUri\r\n\t\t\t+ '\"]';\r\n\r\n\t\tlet tagCache = document.querySelector(tagCacheSelector);\r\n\r\n\t\tif(!post && cache && tagCache) {\r\n\t\t\tlet tagCacheContent = JSON.parse(tagCache.innerText);\r\n\t\t\t\r\n\t\t\treturn Promise.resolve(tagCacheContent);\r\n\t\t}\r\n\r\n\t\txhr.withCredentials = true;\r\n\t\txhr.timeout         = 15000;\r\n\r\n\t\tlet xhrId = this.xhrs.length;\r\n\r\n\t\tif(!post) {\r\n\t\t\tthis.xhrs.push(xhr);\r\n\t\t}\r\n\r\n\t\treturn new Promise(((xhrId) => (resolve, reject) => {\r\n\t\t\txhr.onreadystatechange = () => {\r\n\t\t\t\tlet DONE = 4;\r\n\t\t\t\tlet OK = 200;\r\n\r\n\t\t\t\tlet response;\r\n\r\n\t\t\t\tif (xhr.readyState === DONE) {\r\n\r\n\t\t\t\t\tif(!this.cache) {\r\n\t\t\t\t\t\tthis.cache = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (xhr.status === OK) {\r\n\r\n\t\t\t\t\t\tif(response = JSON.parse(xhr.responseText)) {\r\n\t\t\t\t\t\t\tif(response.code == 0) {\r\n\t\t\t\t\t\t\t\t// Repository.lastResponse = response;\r\n\r\n\t\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\t\tthis.cache[fullUri] = response;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet tagCache = document.querySelector(\r\n\t\t\t\t\t\t\t\t\t'script[data-uri=\"'\r\n\t\t\t\t\t\t\t\t\t+ fullUri\r\n\t\t\t\t\t\t\t\t\t+ '\"]'\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\tlet prerendering  = Cookie.get('prerenderer');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconsole.log(prerendering);\r\n\r\n\t\t\t\t\t\t\t\tif(prerendering)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tif(!tagCache)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttagCache  = document.createElement('script');\r\n\t\t\t\t\t\t\t\t\t\tdocument.querySelector('head').appendChild(tagCache);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\ttagCache.type = 'text/json';\r\n\t\t\t\t\t\t\t\t\ttagCache.setAttribute('data-uri', fullUri);\r\n\t\t\t\t\t\t\t\t\ttagCache.innerText = JSON.stringify(response);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tresolve(response);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\t\tthis.cache[fullUri] = response;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\treject(response);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Repository.lastResponse = xhr.responseText;\r\n\r\n\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\tthis.cache[fullUri] = xhr.responseText;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tresolve(xhr.responseText);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treject('HTTP' + xhr.status);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.xhrs[xhrId] = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(type, fullUri);\r\n\r\n\t\t\tif(post)\r\n\t\t\t{\r\n\t\t\t\txhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n\t\t\t}\r\n\t\t\txhr.send(postString);\r\n\t\t})(xhrId));\r\n\t}\r\n\tstatic cancel() {\r\n\t\tfor(var i in this.xhrs) {\r\n\t\t\tif(!this.xhrs[i]) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.xhrs[i].abort();\r\n\t\t}\r\n\t\tthis.xhrList = [];\r\n\t}\r\n}\r\n\r\n// Repository.lastResponse = null;","import { View  }   from './View';\r\nimport { Cache }   from './Cache';\r\n\r\nexport class Router {\r\n\tstatic listen(mainView)\r\n\t{\r\n\t\twindow.addEventListener(\r\n\t\t\t'popstate'\r\n\t\t\t, (event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\t//this.route(location.pathname);\r\n\t\t\t\t// console.log(location.pathname);\r\n\r\n\t\t\t\tthis.match(location.pathname, mainView);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.go(location.pathname);\r\n\t}\r\n\tstatic go(route, silent)\r\n\t{\r\n\t\tif(location.pathname !== route) {\r\n\t\t\thistory.pushState(null, null, route);\r\n\t\t}\r\n\t\tif(!silent)\r\n\t\t{\r\n\t\t\twindow.dispatchEvent(new Event('popstate'));\t\t\t\r\n\t\t}\r\n\t}\r\n\tstatic match(path, view, forceRefresh = false)\r\n\t{\r\n\t\tlet current = view.args.content;\r\n\t\tlet routes  = view.routes;\r\n\r\n\t\tthis.path   = path;\r\n\t\tthis.query  = {};\r\n\r\n\t\tlet query   = new URLSearchParams(window.location.search);\r\n\r\n\t\tthis.queryString = window.location.search;\r\n\r\n\t\tfor(let pair of query) { \r\n\t\t\tthis.query[ pair[0] ] = pair[1]; \r\n\t\t}\r\n\r\n\t\tforceRefresh = true;\r\n\r\n\t\tlet result;\r\n\r\n\t\tif(!forceRefresh && (result = Cache.load(this.path, false, 'page')))\r\n\t\t{\r\n\t\t\t// console.log('Using cache!');\r\n\r\n\t\t\tview.args.content.pause(true);\r\n\r\n\t\t\tview.args.content = result;\r\n\r\n\t\t\tresult.pause(false);\r\n\r\n\t\t\tresult.update(this.query);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tpath = path.substr(1).split('/');\r\n\r\n\t\t// console.log(path, routes);\r\n\r\n\t\tlet args = {};\r\n\t\tfor(let i in this.query)\r\n\t\t{\r\n\t\t\targs[i] = this.query[i];\r\n\t\t}\r\n\r\n\t\tL1: for(let i in routes) {\r\n\t\t\tlet route = i.split('/');\r\n\t\t\tif(route.length < path.length)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tL2: for(let j in route)\r\n\t\t\t{\r\n\t\t\t\tif(route[j].substr(0, 1) == '%') {\r\n\t\t\t\t\tlet argName = null;\r\n\t\t\t\t\tlet groups  = /^%(\\w+)\\??/.exec(route[j]);\r\n\t\t\t\t\tif(groups && groups[1]) {\r\n\t\t\t\t\t\targName = groups[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!argName) {\r\n\t\t\t\t\t\tthrow new Error(`${route[j]} is not a valid argument segment in route \"${i}\"`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!path[j]) {\r\n\t\t\t\t\t\tif(route[j].substr(route[j].length - 1, 1) == '?') {\r\n\t\t\t\t\t\t\targs[ argName ] = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tcontinue L1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\targs[ argName ] = path[j];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if(path[j] !== route[j]) {\r\n\t\t\t\t\tcontinue L1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof routes[i] !== 'function') {\r\n\t\t\t\treturn routes[i];\r\n\t\t\t}\r\n\r\n\t\t\tif(!forceRefresh\r\n\t\t\t\t&& current\r\n\t\t\t\t&& current instanceof routes[i]\r\n\t\t\t\t&& current.update(args)\r\n\t\t\t) {\r\n\t\t\t\tview.args.content = current;\r\n\t\t\t}\r\n\r\n\t\t\tlet result = routes[i];\r\n\r\n\t\t\tif(routes[i] instanceof Object)\r\n\t\t\t{\r\n\t\t\t\tresult = new routes[i](args);\r\n\t\t\t}\r\n\r\n\t\t\tif(result instanceof View)\r\n\t\t\t{\r\n\t\t\t\tresult.pause(false);\r\n\t\t\t}\r\n\r\n\t\t\tresult.update(args, forceRefresh);\r\n\r\n\t\t\tif(view.args.content instanceof View)\r\n\t\t\t{\r\n\t\t\t\tview.args.content.pause(true);\r\n\t\t\t}\t\t\t\r\n\r\n\t\t\tCache.store(this.path, result, 3600, 'page');\r\n\r\n\t\t\tview.args.content = result;\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif(routes && routes[false])\r\n\t\t{\r\n\t\t\tif(!forceRefresh\r\n\t\t\t\t&& current\r\n\t\t\t\t&& current instanceof routes[false]\r\n\t\t\t\t// && current.update(args)\r\n\t\t\t) {\r\n\t\t\t\tview.args.content = current;\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof routes[false] !== 'function') {\r\n\t\t\t\tview.args.content = routes[false];\r\n\t\t\t}\r\n\r\n\t\t\tlet result = routes[false];\r\n\r\n\t\t\tif(routes[false] instanceof Object)\r\n\t\t\t{\r\n\t\t\t\tresult = new routes[false](args);\r\n\t\t\t}\r\n\r\n\t\t\t// result.update(args, forceRefresh);\r\n\r\n\t\t\tif(view.args.content instanceof View)\r\n\t\t\t{\r\n\t\t\t\tview.args.content.pause(true);\r\n\r\n\t\t\t\tview.args.content = result;\r\n\r\n\t\t\t\tview.args.content.pause(false);\r\n\t\t\t}\r\n\r\n\t\t\tCache.store(this.path, result, 3600, 'page');\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\tstatic clearCache() {\r\n\t\t// this.cache = {};\r\n\t}\r\n\tstatic queryOver(args = {})\r\n\t{\r\n\t\tlet parts = [], finalArgs = {};\r\n\r\n\t\tfor(let i in this.query)\r\n\t\t{\r\n\t\t\tfinalArgs[i] = this.query[i];\r\n\t\t}\r\n\r\n\t\tfor(let i in args)\r\n\t\t{\r\n\t\t\tfinalArgs[i] = args[i];\r\n\t\t}\r\n\r\n\t\tdelete finalArgs['api'];\r\n\r\n\t\treturn finalArgs;\r\n\t}\r\n\tstatic queryToString(args = {}, fresh = false)\r\n\t{\r\n\t\tlet parts = [], finalArgs = args;\r\n\r\n\t\tif(!fresh)\r\n\t\t{\r\n\t\t\tfinalArgs = this.queryOver(args);\r\n\t\t}\r\n\t\t\r\n\t\tfor(let i in finalArgs)\r\n\t\t{\r\n\t\t\tif(finalArgs[i] === '')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tparts.push(i + '=' + encodeURIComponent(finalArgs[i]));\r\n\t\t}\r\n\r\n\t\treturn parts.join('&');\r\n\t}\r\n\tstatic setQuery(name, value, silent)\r\n\t{\r\n\t\tlet args = {};\r\n\r\n\t\targs[name] = value;\r\n\t\t\r\n\t\tthis.go(\r\n\t\t\tthis.path\r\n\t\t\t\t+ '?'\r\n\t\t\t\t+ this.queryToString(args)\r\n\t\t\t, silent\r\n\t\t);\r\n\t}\r\n}\r\n","import { Bindable } from './Bindable';\r\nexport class Tag\r\n{\r\n\tconstructor(element, parent, ref, index)\r\n\t{\r\n\t\tthis.element = Bindable.makeBindable(element);\r\n\t\tthis.parent  = parent;\r\n\t\tthis.ref     = ref;\r\n\t\tthis.index   = index;\r\n\r\n\t\tthis.proxy   = Bindable.makeBindable(this)\r\n\t\tthis.cleanup = [];\r\n\r\n\t\treturn this.proxy;\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tlet cleanup;\r\n\r\n\t\twhile(cleanup = this.cleanup.shift())\r\n\t\t{\r\n\t\t\tcleanup();\r\n\t\t}\r\n\r\n\t\tBindable.clearBindings(this);\r\n\t}\r\n\tclear()\r\n\t{\r\n\t\twhile(this.element.firstChild)\r\n\t\t{\r\n\t\t\tthis.element.removeChild(this.element.firstChild);\r\n\t\t}\r\n\t}\r\n}","export class Theme\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.views = {\r\n\t\t\t'SeanMorris\\\\TheWhtRbt\\\\Location' : {\r\n\t\t\t\tsingle: 'twr9/LocationPreview'\r\n\t\t\t\t, list: 'twr9/LocationList'\r\n\t\t\t}\r\n\t\t\t, 'SeanMorris\\\\TheWhtRbt\\\\Image' : {\r\n\t\t\t\tsingle: 'DetailView'\r\n\t\t\t\t, list: 'DetailListView'\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tresolve(model)\r\n\t{\r\n\t\tlet modelClass;\r\n\r\n\t\tif(Array.isArray(model))\r\n\t\t{\r\n\t\t\tfor(let i in model)\r\n\t\t\t{\r\n\t\t\t\tlet _modelClass = model[i].class || model[i].content_type;\r\n\r\n\t\t\t\tif(modelClass && modelClass !== _modelClass)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Model list mismatch!');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmodelClass = _modelClass;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.views[modelClass])\r\n\t\t\t{\r\n\t\t\t\tif(this.views[modelClass].list)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.views[modelClass].list;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.views[modelClass];\r\n\t\t\t}\r\n\r\n\t\t\treturn 'DetailListView';\r\n\t\t}\r\n\t\telse if(model)\r\n\t\t{\r\n\t\t\tmodelClass = model.class || model.content_type;\r\n\r\n\t\t\tif(this.views[modelClass])\r\n\t\t\t{\r\n\t\t\t\tif(this.views[modelClass].single)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.views[modelClass].single;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.views[modelClass];\r\n\t\t\t}\r\n\r\n\t\t\treturn 'DetailView';\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n","import { Bindable } from './Bindable';\r\nimport { ViewList } from './ViewList';\r\nimport { Router   } from './Router';\r\nimport { Cookie   } from './Cookie';\r\nimport { Dom      } from './Dom';\r\nimport { Tag      } from './Tag';\r\n\r\nexport class View\r\n{\r\n\tconstructor(args = {})\r\n\t{\r\n\t\tthis.args      = Bindable.makeBindable(args);\r\n\t\tthis._id       = this.uuid();\r\n\t\tthis.args._id  = this._id;\r\n\t\tthis.template  = ``;\r\n\t\tthis.parent    = null;\r\n\r\n\t\tthis.firstNode = null;\r\n\t\tthis.lastNode  = null;\r\n\t\tthis.nodes     = null;\r\n\r\n\t\tthis.frames    = [];\r\n\t\tthis.timeouts  = [];\r\n\t\tthis.intervals = [];\r\n\r\n\t\tthis.cleanup   = [];\r\n\r\n\t\tthis.attach    = [];\r\n\t\tthis.detach    = [];\r\n\r\n\t\tthis.eventCleanup = [];\r\n\r\n\t\tthis.parent    = null;\r\n\t\tthis.viewList  = null;\r\n\t\tthis.viewLists = {};\r\n\r\n\t\tthis.tags      = {};\r\n\r\n\t\tthis.intervals = [];\r\n\t\tthis.timeouts  = [];\r\n\t\tthis.frames    = [];\r\n\t}\r\n\r\n\tonFrame(callback) {\r\n\t\tlet c = (timestamp) => {\r\n\t\t\tcallback(timestamp);\r\n\t\t\twindow.requestAnimationFrame(c);\r\n\t\t};\r\n\r\n\t\tc();\r\n\t}\r\n\r\n\tonTimeout(time, callback) {\r\n\t\tlet wrappedCallback = () => {\r\n\t\t\tthis.timeouts[index].fired = true;\r\n\t\t\tcallback();\r\n\t\t};\r\n\t\tlet timeout = setTimeout(wrappedCallback, time)\r\n\t\tlet index   = this.timeouts.length;\r\n\r\n\t\tthis.timeouts.push({\r\n\t\t\ttimeout:    timeout\r\n\t\t\t, callback: wrappedCallback\r\n\t\t\t, time:     time\r\n\t\t\t, fired:    false\r\n\t\t\t, created:  (new Date).getTime()\r\n\t\t\t, paused:   false\r\n\t\t});\r\n\r\n\t\treturn timeout;\r\n\t}\r\n\r\n\tclearTimeout(timeout) {\r\n\t\tfor(var i in this.timeouts) {\r\n\t\t\tif(timeout === this.timeouts[i].timeout) {\r\n\t\t\t\tclearInterval(this.timeouts[i].timeout);\r\n\r\n\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonInterval(time, callback) {\r\n\t\tlet timeout = setInterval(callback, time);\r\n\r\n\t\tthis.intervals.push({\r\n\t\t\ttimeout:    timeout\r\n\t\t\t, callback: callback\r\n\t\t\t, time:     time\r\n\t\t\t, paused:   false\r\n\t\t});\r\n\r\n\t\treturn timeout;\r\n\t}\r\n\r\n\tclearInterval(timeout) {\r\n\t\tfor(var i in this.intervals) {\r\n\t\t\tif(timeout === this.intervals[i].timeout) {\r\n\t\t\t\tclearInterval(this.intervals[i].timeout);\r\n\r\n\t\t\t\tdelete this.intervals[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpause(paused = undefined)\r\n\t{\r\n\t\tif(paused === undefined)\r\n\t\t{\r\n\t\t\tthis.paused = !this.paused;\r\n\t\t}\r\n\r\n\t\tthis.paused = paused;\r\n\r\n\t\tif(this.paused)\r\n\t\t{\r\n\t\t\tfor(let i in this.timeouts)\r\n\t\t\t{\r\n\t\t\t\tif(this.timeouts[i].fired)\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclearTimeout(this.timeouts[i].timeout);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.intervals)\r\n\t\t\t{\r\n\t\t\t\tclearInterval(this.intervals[i].timeout);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor(let i in this.timeouts)\r\n\t\t\t{\r\n\t\t\t\tif(!this.timeouts[i].timeout.paused)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.timeouts[i].fired)\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.timeouts[i].timeout = setTimeout(\r\n\t\t\t\t\tthis.timeouts[i].callback\r\n\t\t\t\t\t, this.timeouts[i].time\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.intervals)\r\n\t\t\t{\r\n\t\t\t\tif(!this.intervals[i].timeout.paused)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.intervals[i].timeout.paused = false;\r\n\r\n\t\t\t\tthis.intervals[i].timeout = setInterval(\r\n\t\t\t\t\tthis.intervals[i].callback\r\n\t\t\t\t\t, this.intervals[i].time\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trender(parentNode = null, insertPoint = null)\r\n\t{\r\n\t\tif(this.nodes)\r\n\t\t{\r\n\t\t\tfor(let i in this.detach)\r\n\t\t\t{\r\n\t\t\t\tthis.detach[i]();\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.nodes)\r\n\t\t\t{\r\n\t\t\t\tlet detachEvent = new Event('cvDomDetached', {bubbles: true, target: this.nodes[i]});\r\n\t\t\t\tlet attachEvent = new Event('cvDomAttached', {bubbles: true, target: this.nodes[i]});\r\n\r\n\t\t\t\tthis.nodes[i].dispatchEvent(detachEvent);\r\n\r\n\t\t\t\tDom.mapTags(this.nodes[i], false, (node) => {\r\n\t\t\t\t\tnode.dispatchEvent(detachEvent);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(parentNode)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(insertPoint)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparentNode.insertBefore(this.nodes[i], insertPoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparentNode.appendChild(this.nodes[i]);\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tDom.mapTags(this.nodes[i], false, (node) => {\r\n\t\t\t\t\tnode.dispatchEvent(attachEvent);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.nodes[i].dispatchEvent(attachEvent);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.attach)\r\n\t\t\t{\r\n\t\t\t\tthis.attach[i]();\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet subDoc;\r\n\r\n\t\tif(this.template == document)\r\n\t\t{\r\n\t\t\tsubDoc = this.template;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tsubDoc = document.createRange().createContextualFragment(this.template);\r\n\t\t}\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-prerender]', (tag) => {\r\n\t\t\tlet prerenderAttr = tag.getAttribute('cv-prerender');\r\n\t\t\tlet prerendering  = Cookie.get('prerenderer');\r\n\r\n\t\t\tif(prerenderAttr == 'never' && prerendering\r\n\t\t\t\t|| prerenderAttr == 'only' && !prerendering\r\n\t\t\t){\r\n\t\t\t\ttag.parentNode.removeChild(tag);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-each]', (tag) => {\r\n\t\t\tlet eachAttr = tag.getAttribute('cv-each');\r\n\t\t\tlet carryAttr = tag.getAttribute('cv-carry');\r\n\t\t\ttag.removeAttribute('cv-each');\r\n\t\t\ttag.removeAttribute('cv-carry');\r\n\r\n\t\t\tlet subTemplate = tag.innerHTML;\r\n\r\n\t\t\twhile(tag.firstChild)\r\n\t\t\t{\r\n\t\t\t\ttag.removeChild(tag.firstChild);\r\n\t\t\t}\r\n\r\n\t\t\tlet carryProps = [];\r\n\r\n\t\t\tif(carryAttr)\r\n\t\t\t{\r\n\t\t\t\tcarryProps = carryAttr.split(',');\r\n\t\t\t}\r\n\r\n\t\t\tlet [eachProp, asProp, keyProp] = eachAttr.split(':');\r\n\r\n\t\t\t// console.log(this, eachProp);\r\n\r\n\t\t\tlet viewList;\r\n\r\n\t\t\tthis.args.bindTo(eachProp, (v, k, t)=>{\r\n\t\t\t\tif(viewList)\r\n\t\t\t\t{\r\n\t\t\t\t\tviewList.remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tviewList = new ViewList(subTemplate, asProp, v, keyProp);\r\n\r\n\t\t\t\tthis.cleanup.push(((viewList)=>()=>{\r\n\t\t\t\t\tviewList.remove();\r\n\t\t\t\t})(viewList));\r\n\r\n\t\t\t\tviewList.parent = this;\r\n\r\n\t\t\t\tviewList.render(tag);\r\n\r\n\t\t\t\tfor(let i in carryProps)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.args.bindTo(carryProps[i], (v, k) => {\r\n\t\t\t\t\t\tviewList.args.subArgs[k] = v;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.viewLists[eachProp] = viewList;\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-with]', (tag) => {\r\n\t\t\tlet withAttr = tag.getAttribute('cv-with');\r\n\t\t\tlet carryAttr = tag.getAttribute('cv-carry');\r\n\t\t\ttag.removeAttribute('cv-with');\r\n\t\t\ttag.removeAttribute('cv-carry');\r\n\r\n\t\t\tlet subTemplate = tag.innerHTML;\r\n\r\n\t\t\tlet carryProps = [];\r\n\r\n\t\t\tif(carryAttr)\r\n\t\t\t{\r\n\t\t\t\tcarryProps = carryAttr.split(',');\r\n\t\t\t}\r\n\r\n\t\t\twhile(tag.firstChild)\r\n\t\t\t{\r\n\t\t\t\ttag.removeChild(tag.firstChild);\r\n\t\t\t}\r\n\r\n\t\t\tlet view = new View();\r\n\r\n\t\t\tthis.cleanup.push(((view)=>()=>{\r\n\t\t\t\t// view.remove();\r\n\t\t\t})(view));\r\n\r\n\t\t\tview.template = subTemplate;\r\n\t\t\tview.parent   = this;\r\n\r\n\t\t\t// console.log(carryProps);\r\n\r\n\t\t\tfor(let i in carryProps)\r\n\t\t\t{\r\n\t\t\t\tthis.args.bindTo(carryProps[i], (v, k) => {\r\n\t\t\t\t\tview.args[k] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.args[withAttr])\r\n\t\t\t{\r\n\t\t\t\tthis.args[withAttr].bindTo(i, (v, k) => {\r\n\t\t\t\t\tview.args[k] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(view);\r\n\r\n\t\t\tview.render(tag);\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-link]', (tag) => {\r\n\t\t\tlet LinkAttr = tag.getAttribute('cv-link');\r\n\r\n\t\t\ttag.setAttribute('href', LinkAttr);\r\n\r\n\t\t\tlet linkClick = (event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\tRouter.go(tag.getAttribute('href'));\r\n\t\t\t};\r\n\r\n\t\t\ttag.addEventListener('click', linkClick);\r\n\r\n\t\t\tthis.cleanup.push( ((tag, eventListener) => ()=>{\r\n\t\t\t\ttag.removeEventListener('click', eventListener);\r\n\t\t\t\ttag           = undefined;\r\n\t\t\t\teventListener = undefined;\r\n\t\t\t})(tag, linkClick));\r\n\r\n\t\t\ttag.removeAttribute('cv-link');\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-on]', (tag)=>{\r\n\t\t\tlet action = String(tag.getAttribute('cv-on'))\r\n\t\t\t\t.split(/;/)\r\n\t\t\t\t.map((a) => a.split(':'))\r\n\t\t\t\t.map(((object, tag) => (a) => {\r\n\t\t\t\t\tvar eventName    = a[0].replace(/(^[\\s\\n]+|[\\s\\n]+$)/, '');\r\n\t\t\t\t\tvar callbackName = a[1];\r\n\t\t\t\t\tvar argList      = [];\r\n\t\t\t\t\tvar groups = /(\\w+)(?:\\(([\\w\\s,]+)\\))?/.exec(callbackName);\r\n\t\t\t\t\tif(groups.length) {\r\n\t\t\t\t\t\tcallbackName = groups[1].replace(/(^[\\s\\n]+|[\\s\\n]+$)/, '');\r\n\t\t\t\t\t\tif(groups[2]) {\r\n\t\t\t\t\t\t\targList = groups[2].split(',').map(s => s.trim());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet eventMethod;\r\n\t\t\t\t\tlet parent = this;\r\n\r\n\t\t\t\t\twhile(parent)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(parent[ callbackName ])\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\teventMethod = (...args) => {\r\n\t\t\t\t\t\t\t\tparent[ callbackName ](...args);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(parent.viewList && parent.viewList.parent)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tparent = parent.viewList.parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(parent.parent)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tparent = parent.parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet eventListener = ((object) => (event) => {\r\n\t\t\t\t\t\tlet argRefs = argList.map((arg) => {\r\n\t\t\t\t\t\t\tif(arg === 'event') {\r\n\t\t\t\t\t\t\t\treturn event;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(arg in object.args) {\r\n\t\t\t\t\t\t\t\treturn object.args[arg];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// console.log(argList, argRefs);\r\n\t\t\t\t\t\tif(!(typeof eventMethod == 'function')) {\r\n\t\t\t\t\t\t\t// console.log(object);\r\n\t\t\t\t\t\t\t// console.trace();\r\n\t\t\t\t\t\t\t// console.log(this);\r\n\t\t\t\t\t\t\tthrow new Error(\r\n\t\t\t\t\t\t\t\t`${callbackName} is not defined on View object.\r\n\r\nTag:\r\n\r\n${tag.outerHTML}`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\teventMethod(...argRefs);\r\n\t\t\t\t\t})(object);\r\n\r\n\r\n\t\t\t\t\tswitch(eventName)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase '_init':\r\n\t\t\t\t\t\t\teventListener();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase '_attach':\r\n\t\t\t\t\t\t\tthis.attach.push(eventListener);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase '_detach':\r\n\t\t\t\t\t\t\tthis.detach.push(eventListener);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\ttag.addEventListener(eventName, eventListener);\r\n\r\n\t\t\t\t\t\t\tthis.cleanup.push(\r\n\t\t\t\t\t\t\t\t((tag, eventName, eventListener) => ()=>{\r\n\t\t\t\t\t\t\t\t\ttag.removeEventListener(eventName, eventListener);\r\n\t\t\t\t\t\t\t\t\ttag           = undefined;\r\n\t\t\t\t\t\t\t\t\teventListener = undefined;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t)(tag, eventName, eventListener));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn [eventName, callbackName, argList];\r\n\t\t\t\t})(this, tag));\r\n\r\n\t\t\ttag.removeAttribute('cv-on');\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-bind]', (tag) => {\r\n\t\t\tlet bindArg = tag.getAttribute('cv-bind');\r\n\t\t\tthis.args.bindTo(bindArg, (v,k,t) => {\r\n\t\t\t\tif(t[k] === v)\r\n\t\t\t\t{\r\n\t\t\t\t\t// return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(t[k] instanceof View)\r\n\t\t\t\t{\r\n\t\t\t\t\tt[k].remove();\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif(tag.tagName == 'INPUT' || tag.tagName == 'SELECT') {\r\n\t\t\t\t\tlet type = tag.getAttribute('type');\r\n\t\t\t\t\tif(type && type.toLowerCase() == 'checkbox') {\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\ttag.checked = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\ttag.checked = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(type !== 'file') {\r\n\t\t\t\t\t\ttag.value = v || '';\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(v instanceof View)\r\n\t\t\t\t{\r\n\t\t\t\t\tv.render(tag);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\ttag.innerText = v;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlet inputListener = (event) => {\r\n\t\t\t\tif(event.target.getAttribute('type') !== 'password')\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.log(event.target.value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(event.target !== tag) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// console.log(event.target.value);\r\n\r\n\t\t\t\tthis.args[bindArg] = event.target.value;\r\n\t\t\t};\r\n\r\n\t\t\ttag.addEventListener('input',         inputListener);\r\n\t\t\ttag.addEventListener('change',        inputListener);\r\n\t\t\ttag.addEventListener('value-changed', inputListener);\r\n\r\n\t\t\tthis.cleanup.push( ((tag, eventListener) => ()=>{\r\n\t\t\t\ttag.removeEventListener('input',         inputListener);\r\n\t\t\t\ttag.removeEventListener('change',        inputListener);\r\n\t\t\t\ttag.removeEventListener('value-changed', inputListener);\r\n\t\t\t\ttag           = undefined;\r\n\t\t\t\teventListener = undefined;\r\n\t\t\t})(tag, inputListener));\r\n\r\n\t\t\ttag.removeAttribute('cv-bind');\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, false, (tag) => {\r\n\t\t\tlet regex    = /(\\[\\[(\\$?\\w+)\\]\\])/g;\r\n\r\n\t\t\tif(tag.nodeType == Node.TEXT_NODE)\r\n\t\t\t{\r\n\t\t\t\tlet original = tag.nodeValue;\r\n\r\n\t\t\t\tif(!this.interpolatable(original))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet header   = 0;\r\n\t\t\t\tlet match;\r\n\r\n\t\t\t\twhile(match = regex.exec(original))\r\n\t\t\t\t{\r\n\t\t\t\t\tlet bindProperty = match[2];\r\n\r\n\t\t\t\t\tlet unsafeHtml = false;\r\n\r\n\t\t\t\t\tif(bindProperty.substr(0, 1) === '$')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tunsafeHtml   = true;\r\n\t\t\t\t\t\tbindProperty = bindProperty.substr(1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet staticPrefix = original.substring(header, match.index);\r\n\r\n\t\t\t\t\theader = match.index + match[1].length;\r\n\r\n\t\t\t\t\tlet staticNode = document.createTextNode(staticPrefix);\r\n\r\n\t\t\t\t\ttag.parentNode.insertBefore(staticNode, tag);\r\n\r\n\t\t\t\t\tlet dynamicNode;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(unsafeHtml)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdynamicNode = document.createElement('div');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdynamicNode = document.createTextNode('');\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\ttag.parentNode.insertBefore(dynamicNode, tag);\r\n\r\n\t\t\t\t\tthis.args.bindTo(bindProperty, ((dynamicNode,unsafeHtml) => (v,k,t) => {\r\n\t\t\t\t\t\t// console.log(`Setting ${k} to ${v}`, dynamicNode);\r\n\t\t\t\t\t\tif(t[k] instanceof View)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tt[k].remove();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdynamicNode.nodeValue = '';\r\n\r\n\t\t\t\t\t\tif(v instanceof View)\r\n\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\tv.render(tag.parentNode, dynamicNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// console.log(dynamicNode);\r\n\t\t\t\t\t\t\tif(unsafeHtml)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdynamicNode.innerHTML = v;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdynamicNode.nodeValue = v;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})(dynamicNode,unsafeHtml));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet staticSuffix = original.substring(header)\r\n\r\n\t\t\t\tlet staticNode = document.createTextNode(staticSuffix);\r\n\r\n\t\t\t\ttag.parentNode.insertBefore(staticNode, tag);\r\n\r\n\t\t\t\ttag.nodeValue = '';\r\n\t\t\t}\r\n\r\n\t\t\tif(tag.nodeType == Node.ELEMENT_NODE)\r\n\t\t\t{\r\n\t\t\t\tfor (let i = 0; i < tag.attributes.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(!this.interpolatable(tag.attributes[i].value))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet header    = 0;\r\n\t\t\t\t\tlet match;\r\n\t\t\t\t\tlet original  = tag.attributes[i].value;\r\n\t\t\t\t\tlet attribute = tag.attributes[i];\r\n\r\n\t\t\t\t\tlet bindProperties = {};\r\n\t\t\t\t\tlet segments       = [];\r\n\r\n\t\t\t\t\twhile(match = regex.exec(original))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsegments.push(original.substring(header, match.index));\r\n\r\n\t\t\t\t\t\tif(!bindProperties[match[2]])\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tbindProperties[match[2]] = [];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbindProperties[match[2]].push(segments.length);\r\n\r\n\t\t\t\t\t\tsegments.push(match[1]);\r\n\r\n\t\t\t\t\t\theader = match.index + match[1].length;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsegments.push(original.substring(header));\r\n\r\n\t\t\t\t\tfor(let j in bindProperties)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.args.bindTo(j, (v, k, t, d) => {\r\n\t\t\t\t\t\t\tfor(let i in bindProperties)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfor(let j in bindProperties[i])\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tsegments[ bindProperties[i][j] ] = t[i];\r\n\r\n\t\t\t\t\t\t\t\t\tif(k === i)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tsegments[ bindProperties[i][j] ] = v;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttag.setAttribute(attribute.name, segments.join(''));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// console.log(bindProperties, segments);\r\n\r\n\t\t\t\t\t// console.log(tag.attributes[i].name, tag.attributes[i].value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-ref]', (tag) => {\r\n\t\t\tlet refAttr                         = tag.getAttribute('cv-ref');\r\n\t\t\tlet [refProp, refClassname, refKey] = refAttr.split(':');\r\n\r\n\t\t\tlet refClass = this.stringToClass(refClassname);\r\n\r\n\t\t\ttag.removeAttribute('cv-ref');\r\n\r\n\t\t\tif(this.viewList)\r\n\t\t\t{\r\n\t\t\t\tif(!this.viewList.parent.tags[refProp])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.viewList.parent.tags[refProp] = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet refKeyVal = this.args[refKey];\r\n\r\n\t\t\t\tthis.viewList.parent.tags[refProp][refKeyVal] = new refClass(\r\n\t\t\t\t\ttag, this, refProp, refKeyVal\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.tags[refProp] = new refClass(\r\n\t\t\t\t\ttag, this, refProp\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-if]', this.mapIfTags.bind(this));\r\n\r\n\t\tthis.nodes = [];\r\n\r\n\t\tthis.firstNode = document.createComment(`Template ${this._id} Start`);\r\n\r\n\t\tthis.nodes.push(this.firstNode);\r\n\r\n\t\tif(parentNode)\r\n\t\t{\r\n\t\t\tif(insertPoint)\r\n\t\t\t{\r\n\t\t\t\tparentNode.insertBefore(this.firstNode, insertPoint);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tparentNode.appendChild(this.firstNode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twhile(subDoc.firstChild)\r\n\t\t{\r\n\t\t\tlet newNode = subDoc.firstChild;\r\n\t\t\tlet attachEvent = new Event('cvDomAttached', {bubbles: true, target: newNode});\r\n\r\n\t\t\tthis.nodes.push(subDoc.firstChild);\r\n\r\n\t\t\tif(parentNode)\r\n\t\t\t{\r\n\t\t\t\tif(insertPoint)\r\n\t\t\t\t{\r\n\t\t\t\t\tparentNode.insertBefore(subDoc.firstChild, insertPoint);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tparentNode.appendChild(subDoc.firstChild);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tDom.mapTags(newNode, false, (node) => {\r\n\t\t\t\t// node.dispatchEvent(attachEvent);\r\n\t\t\t});\r\n\r\n\t\t\tnewNode.dispatchEvent(attachEvent);\r\n\t\t}\r\n\r\n\t\tthis.lastNode = document.createComment(`Template ${this._id} End`);\r\n\r\n\t\tthis.nodes.push(this.lastNode);\r\n\r\n\t\tif(parentNode)\r\n\t\t{\r\n\t\t\tif(insertPoint)\r\n\t\t\t{\r\n\t\t\t\tparentNode.insertBefore(this.lastNode, insertPoint);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tparentNode.appendChild(this.lastNode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i in this.attach)\r\n\t\t{\r\n\t\t\tthis.attach[i]();\r\n\t\t}\r\n\r\n\t\tthis.postRender(parentNode);\r\n\r\n\t\t// return this.nodes;\r\n\t}\r\n\t\r\n\tmapIfTags(tag)\r\n\t{\r\n\t\tlet ifProperty = tag.getAttribute('cv-if');\r\n\r\n\t\tlet inverted = false;\r\n\r\n\t\tif(ifProperty.substr(0, 1) === '!')\r\n\t\t{\r\n\t\t\tinverted   = true;\r\n\t\t\tifProperty = ifProperty.substr(1);\r\n\t\t}\r\n\r\n\t\tlet ifDoc = document.createRange().createContextualFragment('');\r\n\r\n\t\tthis.args.bindTo(\r\n\t\t\tifProperty\r\n\t\t\t, ((tag, ifDoc) => (v) => {\r\n\t\t\t\tlet detachEvent = new Event('cvDomDetached');\r\n\t\t\t\tlet attachEvent = new Event('cvDomAttached');\r\n\r\n\t\t\t\tif(inverted)\r\n\t\t\t\t{\r\n\t\t\t\t\tv = !v;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDom.mapTags(tag, '[cv-if]', this.mapIfTags.bind(this));\r\n\r\n\t\t\t\tif(v)\r\n\t\t\t\t{\r\n\t\t\t\t\twhile(ifDoc.firstChild)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet moveTag = ifDoc.firstChild;\r\n\r\n\t\t\t\t\t\ttag.prepend(moveTag);\r\n\r\n\t\t\t\t\t\tmoveTag.dispatchEvent(detachEvent);\r\n\r\n\t\t\t\t\t\tDom.mapTags(moveTag, false, (node) => {\r\n\t\t\t\t\t\t\tnode.dispatchEvent(detachEvent);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\twhile(tag.firstChild)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet moveTag = tag.firstChild;\r\n\r\n\t\t\t\t\t\tifDoc.prepend(moveTag);\r\n\r\n\t\t\t\t\t\tmoveTag.dispatchEvent(attachEvent);\r\n\r\n\t\t\t\t\t\tDom.mapTags(moveTag, false, (node) => {\r\n\t\t\t\t\t\t\tnode.dispatchEvent(attachEvent);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})(tag, ifDoc)\r\n\t\t);\r\n\r\n\t\ttag.removeAttribute('cv-if');\r\n\t}\r\n\r\n\tpostRender(parentNode)\r\n\t{\r\n\r\n\t}\r\n\r\n\tinterpolatable(str)\r\n\t{\r\n\t\treturn !!(String(str).match(/\\[\\[\\$?\\w+\\??\\]\\]/));\r\n\t}\r\n\r\n\tuuid() {\r\n\t\treturn ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(\r\n\t\t\t/[018]/g\r\n\t\t\t, c => (\r\n\t\t\t\tc ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4\r\n\t\t\t).toString(16)\r\n\t\t);\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tfor(let i in this.nodes)\r\n\t\t{\r\n\t\t\tthis.nodes[i].remove();\r\n\t\t}\r\n\r\n\t\tlet cleanup;\r\n\r\n\t\twhile(cleanup = this.cleanup.shift())\r\n\t\t{\r\n\t\t\tcleanup();\r\n\t\t}\r\n\r\n\t\tfor(let i in this.tags)\r\n\t\t{\r\n\t\t\tif(Array.isArray(this.tags[i]))\r\n\t\t\t{\r\n\t\t\t\tfor(var j in this.tags[i])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.tags[i][j].remove();\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.tags[i].remove();\r\n\t\t}\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\r\n\t}\r\n\r\n\tbeforeUpdate(args)\r\n\t{\r\n\r\n\t}\r\n\r\n\tafterUpdate(args)\r\n\t{\r\n\r\n\t}\r\n\r\n\tstringToClass(refClassname)\r\n\t{\r\n\t\tlet refClassSplit           = refClassname.split('/');\r\n\t\tlet refShortClassname       = refClassSplit[ refClassSplit.length - 1 ];\r\n\t\tlet refClass                = require(refClassname);\r\n\r\n\t\treturn refClass[refShortClassname];\r\n\t}\r\n}\r\n","import { Bindable } from './Bindable';\r\nimport { View     } from './View';\r\n\r\nexport class ViewList\r\n{\r\n\tconstructor(template, subProperty, list, keyProperty = null)\r\n\t{\r\n\t\tthis.args         = Bindable.makeBindable({});\r\n\t\tthis.args.value   = Bindable.makeBindable(list || {});\r\n\t\tthis.args.subArgs = Bindable.makeBindable({});\r\n\t\tthis.views        = {};\r\n\t\tthis.template     = template;\r\n\t\tthis.subProperty  = subProperty;\r\n\t\tthis.keyProperty  = keyProperty;\r\n\t\tthis.tag          = null;\r\n\t\tthis.paused       = false;\r\n\r\n\t\tthis.args.value.before.push((t)=>{\r\n\t\t\t// console.log(t.executing);\r\n\t\t\tif(t.executing == 'bindTo')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.paused = true;\r\n\t\t});\r\n\r\n\t\tthis.args.value.after.push((t)=>{\r\n\t\t\tif(this.paused)\r\n\t\t\t{\r\n\t\t\t\t// console.log(t.executing);\r\n\t\t\t\tthis.reRender();\r\n\t\t\t}\r\n\t\t\tthis.paused = false;\r\n\t\t});\r\n\r\n\t\t// console.log(this.args);\r\n\r\n\t\tthis.args.value.bindTo((v, k, t, d) => {\r\n\r\n\t\t\tif(this.paused)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(d)\r\n\t\t\t{\r\n\t\t\t\tthis.views[k].remove();\r\n\r\n\t\t\t\tdelete this.views[k];\r\n\t\t\t\t// console.log(`Deleting ${k}`, v, this.views);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(`Setting ${k}`, v, this.views);\r\n\r\n\t\t\tif(!this.views[k])\r\n\t\t\t{\r\n\t\t\t\tlet view = new View();\r\n\r\n\t\t\t\tthis.views[k] = view;\r\n\t\t\t\t\r\n\t\t\t\tthis.views[k].template = this.template;\r\n\t\t\t\t\r\n\t\t\t\tthis.views[k].parent   = this.parent;\r\n\t\t\t\tthis.views[k].viewList = this;\r\n\r\n\t\t\t\tthis.args.subArgs.bindTo((v, k, t, d) => {\r\n\t\t\t\t\tview.args[k] = v;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.views[k].args[ this.subProperty ] = v;\r\n\r\n\t\t\t\tif(this.keyProperty)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.views[k].args[ this.keyProperty ] = k;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt[k] = v;\r\n\r\n\t\t\t\tthis.reRender();\r\n\t\t\t}\r\n\r\n\t\t\tthis.views[k].args[ this.subProperty ] = v;\r\n\t\t});\r\n\t}\r\n\r\n\trender(tag)\r\n\t{\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tthis.views[i].render(tag);\r\n\t\t}\r\n\r\n\t\tthis.tag = tag;\r\n\r\n\t\t// console.log(tag);\r\n\t}\r\n\r\n\treRender()\r\n\t{\r\n\t\t// console.log('rerender');\r\n\t\tif(!this.tag)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet views = [];\r\n\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tviews[i] = this.views[i];\r\n\t\t}\r\n\r\n\t\tlet finalViews = [];\r\n\r\n\t\tfor(let i in this.args.value)\r\n\t\t{\r\n\t\t\tlet found = false;\r\n\t\t\tfor(let j in views)\r\n\t\t\t{\r\n\t\t\t\tif(views[j] && this.args.value[i] === views[j].args[ this.subProperty ])\r\n\t\t\t\t{\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tfinalViews[i] = views[j];\r\n\t\t\t\t\tdelete views[j];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!found)\r\n\t\t\t{\r\n\t\t\t\tlet viewArgs = {};\r\n\t\t\t\tviewArgs[this.subProperty] = this.args.value[i];\r\n\t\t\t\tfinalViews[i] = new View(viewArgs);\r\n\r\n\t\t\t\tfinalViews[i].template = this.template;\r\n\t\t\t\tfinalViews[i].parent   = this.parent;\r\n\t\t\t\tfinalViews[i].viewList = this;\r\n\r\n\t\t\t\tfinalViews[i].args[ this.keyProperty ] = i;\r\n\r\n\t\t\t\tthis.args.subArgs.bindTo((v, k, t, d) => {\r\n\t\t\t\t\tfinalViews[i].args[k] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet appendOnly = true;\r\n\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tif(this.views[i] !== finalViews[i])\r\n\t\t\t{\r\n\t\t\t\tappendOnly = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!appendOnly)\r\n\t\t{\r\n\t\t\twhile(this.tag.firstChild)\r\n\t\t\t{\r\n\t\t\t\tthis.tag.removeChild(this.tag.firstChild);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in finalViews)\r\n\t\t\t{\r\n\t\t\t\tfinalViews[i].render(this.tag);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tlet i = this.views.length || 0\r\n\r\n\t\t\twhile(finalViews[i])\r\n\t\t\t{\r\n\t\t\t\tfinalViews[i].render(this.tag);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\r\n\t\tthis.views = finalViews;\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tthis.views[i].remove();\r\n\t\t}\r\n\r\n\t\tthis.views = [];\r\n\r\n\t\twhile(this.tag.firstChild)\r\n\t\t{\r\n\t\t\tthis.tag.removeChild(this.tag.firstChild);\r\n\t\t}\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class ButtonField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.args.title = this.args.title || this.args.value;\r\n\t\tthis.template = `\r\n\t\t\t<label cv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tname  = \"${this.args.name}\"\r\n\t\t\t\t\ttype  = \"${this.args.attrs.type}\"\r\n\t\t\t\t\tvalue = \"[[title]]\"\r\n\t\t\t\t\ton    = \"click:clicked(event)\"\r\n\t\t\t\t/>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n\tclicked(event) {\r\n\t\tthis.form.buttonClick(this.args.name);\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nexport class Field extends View {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values);\r\n\t\tthis.args.title = this.args.title || '';\r\n\t\tthis.args.value = this.args.value || '';\r\n\r\n\t\tthis.args.valueString = '';\r\n\r\n\t\tthis.form   = form;\r\n\t\tthis.parent = parent;\r\n\t\tthis.key    = key;\r\n\r\n\t\tthis.ignore = this.args.attrs['data-cv-ignore'] || false;\r\n\r\n\t\tlet setting = null;\r\n\r\n\t\tthis.args.bindTo(\r\n\t\t\t'value'\r\n\t\t\t, (v, k) => {\r\n\t\t\t\t// console.trace();\r\n\t\t\t\t// console.log(this.args.name, v, k);\r\n\r\n\t\t\t\tif(setting == key)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// console.log(this.args.name, v, k);\r\n\r\n\t\t\t\tthis.args.valueString = JSON.stringify(v||'', null, 4);\r\n\r\n\t\t\t\tsetting = key;\r\n\r\n\t\t\t\tthis.parent.args.value[key] = v;\r\n\t\t\t\tsetting = null;\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.parent.args.value.bindTo(key, (v, k)=>{\r\n\t\t\tif(setting == k)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsetting = k;\r\n\r\n\t\t\tthis.args.value = v;\r\n\r\n\t\t\tsetting = null;\r\n\t\t});\r\n\r\n\t\tthis.template = `\r\n\t\t\t<label cv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<span cv-if = \"title\" cv-ref = \"title:curvature/base/Tag\">[[title]]:</span>\r\n\t\t\t\t<input\r\n\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\ttype    = \"${this.args.attrs.type||'text'}\"\r\n\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t\t//type    = \"${this.args.attrs.type||'text'}\"\r\n\t}\t\r\n}\r\n","import { Field } from './Field';\r\nimport { Form  } from './Form';\r\n\r\nexport class FieldSet extends Field\r\n{\r\n\tconstructor(values, form, parent, key)\r\n\t{\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.args.value  = {};\r\n\t\tthis.args.fields = Form.renderFields(values.children, this);\r\n\t\tthis.template    = `\r\n\t\t\t<label>\r\n\t\t\t\t<span cv-if = \"title\">[[title]]:</span>\r\n\t\t\t\t<fieldset name = \"${this.args.name}\">\r\n\t\t\t\t\t<div cv-each = \"fields:field\">\r\n\t\t\t\t\t\t<div cv-bind = \"field\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</fieldset>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class FileField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label>\r\n\t\t\t\t<input\r\n\t\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\t\ttype    = \"${this.args.attrs.type}\"\r\n\t\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t/>\r\n\t\t\t\t<span style = \"display:none\" cv-if = \"value\">[[[value]]]</span>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nimport { Field       } from './Field';\r\nimport { FieldSet    } from './FieldSet';\r\nimport { SelectField } from './SelectField';\r\nimport { HtmlField   } from './HtmlField';\r\nimport { HiddenField } from './HiddenField';\r\nimport { ButtonField } from './ButtonField';\r\n\r\n// import { Router           } from 'Router';\r\n\r\n// import { Repository       } from '../Repository';\r\n\r\n// import { FieldSet         } from './FieldSet';\r\n\r\n// import { ToastView        } from '../ToastView';\r\n// import { ToastAlertView   } from '../ToastAlertView';\r\n\r\nexport class Form extends View\r\n{\r\n\tconstructor(skeleton)\r\n\t{\r\n\t\tsuper({});\r\n\t\tthis.args.flatValue = this.args.flatValue || {};\r\n\t\tthis.args.value     = this.args.value     || {};\r\n\r\n\t\tthis.args.method    = skeleton._method || 'GET';\r\n\r\n\t\tthis.args.classes   = this.args.classes || [];\r\n\r\n\t\tthis.args.bindTo('classes', (v)=>{\r\n\t\t\tthis.args._classes = v.join(' ');\r\n\t\t});\r\n\r\n\t\tthis._onSubmit  = [];\r\n\t\tthis.action     = '';\r\n\t\tthis.template   = `\r\n\t\t\t<form\r\n\t\t\t\tclass   = \"[[_classes]]\"\r\n\t\t\t\tmethod  = \"[[method]]\"\r\n\t\t\t\tcv-each = \"fields:field\"\r\n\t\t\t\tcv-on   = \"submit:submit(event)\"\r\n\t\t\t\tcv-ref  = \"formTag:curvature/base/Tag\"\r\n\t\t\t>\r\n\t\t\t\t[[field]]\r\n\t\t\t</form>\r\n\t\t`;\r\n\r\n\t\tthis.args.fields    = Form.renderFields(skeleton, this);\r\n\r\n\t\tthis.args.bindTo(\r\n\t\t\t'value'\r\n\t\t\t, (v) => {\r\n\t\t\t\tthis.args.valueString = JSON.stringify(v, null, 4);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\tsubmit(event)\r\n\t{\r\n\t\tevent.preventDefault();\r\n\r\n\t\tthis.args.valueString = JSON.stringify(\r\n\t\t\tthis.args.value\r\n\t\t\t, null\r\n\t\t\t, 4\r\n\t\t);\r\n\r\n\t\tfor(let i in this._onSubmit)\r\n\t\t{\r\n\t\t\tthis._onSubmit[i](this, event);\r\n\t\t}\r\n\t}\r\n\tbuttonClick(event)\r\n\t{\r\n\t\t// console.log(event);\r\n\t}\r\n\tonSubmit(callback)\r\n\t{\r\n\t\tthis._onSubmit.push(callback);\r\n\t}\r\n\tstatic renderFields(skeleton, parent = null)\r\n\t{\r\n\t\tlet fields = {};\r\n\t\tfor(let i in skeleton)\r\n\t\t{\r\n\t\t\tif(fields[i])\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(i.substr(0,1) == '_')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet field = null;\r\n\t\t\tlet form  = null;\r\n\t\t\tif(parent instanceof Form)\r\n\t\t\t{\r\n\t\t\t\tform = parent;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tform = parent.form;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(skeleton[i].type)\r\n\t\t\t{\r\n\t\t\t\tcase 'fieldset':\r\n\t\t\t\t\tfield = new FieldSet(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\tfield = new SelectField(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'html':\r\n\t\t\t\t\tfield = new HtmlField(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'submit':\r\n\t\t\t\tcase 'button':\r\n\t\t\t\t\tfield = new ButtonField(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'hidden':\r\n\t\t\t\t\tfield = new HiddenField(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault :\r\n\t\t\t\t\tfield = new Field(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tfields[i] = field;\r\n\r\n\t\t\tfield.args.bindTo(\r\n\t\t\t\t'value'\r\n\t\t\t\t, (v, k ,t, d) => {\r\n\t\t\t\t\t// console.log(t,v);\r\n\t\t\t\t\tif(t.type == 'html' && !t.contentEditable)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tform.args.flatValue[ field.args.name ] = v;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn fields;\r\n\t}\r\n\tqueryString(args = {})\r\n\t{\r\n\t\tlet parts = [];\r\n\t\t\r\n\t\tfor(let i in this.args.flatValue)\r\n\t\t{\r\n\t\t\targs[i] = args[i] || this.args.flatValue[i];\r\n\t\t}\r\n\r\n\t\tfor(let i in args)\r\n\t\t{\r\n\t\t\tparts.push(i + '=' + encodeURIComponent(args[i]));\r\n\t\t}\r\n\r\n\t\treturn parts.join('&');\r\n\t}\r\n\tpopulate(values)\r\n\t{\r\n\t\t// console.log(values);\r\n\r\n\t\tfor(let i in values)\r\n\t\t{\r\n\t\t\tthis.args.value[i] = values[i];\r\n\t\t}\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class HiddenField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label style = \"display:none\" cv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<input\r\n\t\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\t\ttype    = \"${this.args.attrs.type}\"\r\n\t\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t\t<span style = \"display:none\" cv-if = \"value\">[[[value]]]</span>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nexport class HtmlField extends View {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.ignore = this.args.attrs['data-cv-ignore'] || false;\r\n\t\tthis.args.contentEditable = this.args.attrs.contenteditable || false;\r\n\t\tthis.template = `<div contenteditable = \"[[contentEditable]]\">[[$value]]</div>`;\r\n\t}\t\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class SelectField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label cv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<span cv-if = \"title\" cv-ref = \"title:curvature/base/Tag\">[[title]]:</span>\r\n\t\t\t\t<select\r\n\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\tcv-each = \"options:option:optionText\"\r\n\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t\t\t<option value = \"[[option]]\">[[optionText]]</option>\r\n\t\t\t\t</select>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n\tgetLabel(value)\r\n\t{\r\n\t\tfor(let i in this.args.options)\r\n\t\t{\r\n\t\t\tif(this.args.options[i] == value)\r\n\t\t\t{\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { Dom } from '../base/Dom';\r\nimport { Tag } from '../base/Tag';\r\n\r\nexport class PopOutTag extends Tag\r\n{\r\n\tconstructor(element, parent, ref, index)\r\n\t{\r\n\t\tsuper(element, parent, ref, index);\r\n\r\n\t\tthis.poppedOut = false;\r\n\t\tthis.style     = element.getAttribute('style');\r\n\t\tthis.moving    = false;\r\n\r\n\t\tthis.leftDuration   = 0;\r\n\t\tthis.unpoppedStyle  = '';\r\n\t\tthis.previousScroll = 0;\r\n\r\n\t\telement.classList.add('unpopped');\r\n\r\n\t\tthis.scrollStyle;\r\n\r\n\t\t//this.ps = new PerfectScrollbar(element, {wheelPropagation: true});\r\n\t\tthis.rect;\r\n\t\tthis.clickListener  = (event) => {\r\n\t\t\tif(!this.poppedOut || ! this.rect)\r\n\t\t\t{\r\n\t\t\t\tthis.rect = element.getBoundingClientRect();\r\n\t\t\t}\t\t\t\r\n\r\n\t\t\tif(!this.element.contains(event.target))\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopPropagation();\r\n\r\n\t\t\tlet leftDuration = 0.333;\r\n\r\n\t\t\tif(this.moving)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.poppedOut)\r\n\t\t\t{\r\n\t\t\t\tthis.previousScroll = window.scrollY;\r\n\r\n\t\t\t\tif(leftDuration)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.leftDuration = leftDuration;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.unpoppedStyle = `\r\n\t\t\t\t\t;position:  fixed;\r\n\t\t\t\t\tleft:       ${this.rect.x}px;\r\n\t\t\t\t\ttop:        ${this.rect.y}px;\r\n\t\t\t\t\twidth:      ${this.rect.width}px;\r\n\t\t\t\t\theight:     ${this.rect.height}px;\r\n\t\t\t\t\tz-index:    99999;\r\n\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tlet style = this.style + this.unpoppedStyle;\r\n\r\n\t\t\t\telement.setAttribute('style', style);\r\n\r\n\t\t\t\tdocument.body.style.overflow = 'hidden';\r\n\t\t\t\tdocument.body.style.overflowY = 'hidden';\r\n\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tstyle += `\r\n\t\t\t\t\t\t;top:   0px;\r\n\t\t\t\t\t\tleft:   0px;\r\n\t\t\t\t\t\twidth:  100%;\r\n\t\t\t\t\t\theight: 100%;\r\n\t\t\t\t\t\toverflow-y: auto;\r\n\t\t\t\t\t`;\r\n\r\n\t\t\t\t\tthis.moving = true;\r\n\r\n\t\t\t\t\telement.classList.add('unpopped');\r\n\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\telement.classList.add('popped');\r\n\t\t\t\t\t\telement.classList.remove('unpopped');\r\n\t\t\t\t\t}, this.leftDuration*333);\r\n\r\n\t\t\t\t\t// element.setAttribute('style', style + ';position:absolute');\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\telement.setAttribute(\r\n\t\t\t\t\t\t\t'style'\r\n\t\t\t\t\t\t\t, style + `;transition: ${this.leftDuration}s;`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\tPopOutTag.popLevel();\r\n\t\t\t\t\t\tdocument.body.setAttribute('style', 'height:0px;overflow:hidden;');\r\n\t\t\t\t\t\twindow.scrollTo(0,0);\r\n\t\t\t\t\t\tthis.moving = false;\r\n\t\t\t\t\t\tDom.mapTags(element, false, (tag)=>{\r\n\t\t\t\t\t\t\tlet event = new Event('cvPopped');\r\n\r\n\t\t\t\t\t\t\ttag.dispatchEvent(event);\r\n\r\n\t\t\t\t\t\t\tthis.scrollStyle = element.getAttribute('style');\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, this.leftDuration*1000);\r\n\t\t\t\t}, 1);\r\n\r\n\t\t\t\tthis.poppedOut = !this.poppedOut;\r\n\t\t\t}\r\n\t\t\telse if(event.target.matches('.closeButton') && this.poppedOut)\r\n\t\t\t{\r\n\t\t\t\twindow.scrollTo(0,this.previousScroll);\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\r\n\t\t\t\t}, 1);\r\n\r\n\t\t\t\tlet style = this.style\r\n\t\t\t\t\t+ this.unpoppedStyle\r\n\t\t\t\t\t+ `;transition: ${this.leftDuration}s;`;\r\n\r\n\t\t\t\tif(0 === PopOutTag.unpopLevel())\r\n\t\t\t\t{\r\n\t\t\t\t\tdocument.body.setAttribute('style', '');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\r\n\t\t\t\telement.classList.add('unpopped');\r\n\t\t\t\t\r\n\t\t\t\telement.setAttribute('style', style);\r\n\r\n\t\t\t\tthis.moving = true;\r\n\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\telement.setAttribute('style', this.style);\r\n\t\t\t\t\telement.classList.remove('popped');\r\n\t\t\t\t}, this.leftDuration*500);\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\telement.setAttribute('style', this.style);\r\n\t\t\t\t\tthis.moving = false;\r\n\t\t\t\t\tDom.mapTags(element, false, (tag)=>{\r\n\t\t\t\t\t\tlet event = new Event('cvUnpopped');\r\n\r\n\t\t\t\t\t\ttag.dispatchEvent(event);\r\n\t\t\t\t\t});\r\n\t\t\t\t}, this.leftDuration*1000);\r\n\r\n\t\t\t\tthis.poppedOut = !this.poppedOut;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\telement.addEventListener('click',  this.clickListener);\r\n\r\n\t\tthis.cleanup.push(((element)=>()=>{\r\n\t\t\telement.removeEventListener('click',  this.clickListener);\r\n\t\t})(element));\r\n\t}\r\n\r\n\r\n\tstatic popLevel()\r\n\t{\r\n\t\tif(!this.level)\r\n\t\t{\r\n\t\t\tthis.level = 0;\r\n\t\t}\r\n\r\n\t\tthis.level++;\r\n\r\n\t\treturn this.level;\r\n\t}\r\n\r\n\tstatic unpopLevel()\r\n\t{\r\n\t\tif(!this.level)\r\n\t\t{\r\n\t\t\tthis.level = 0;\r\n\t\t}\r\n\r\n\t\tthis.level--;\r\n\r\n\t\treturn this.level;\r\n\t}\r\n\r\n\tpause()\r\n\t{\r\n\t\tsuper.pause();\r\n\t\tdocument.body.setAttribute('style', '');\r\n\r\n\t\tconsole.log('!!!');\r\n\t}\r\n}","import { Tag      } from '../base/Tag';\r\nimport { Dom      } from '../base/Dom';\r\nimport { Bindable } from '../base/Bindable';\r\n\r\nexport class ScrollTag extends Tag\r\n{\r\n\tconstructor(element, parent, ref, index)\r\n\t{\r\n\t\tsuper(element, parent, ref, index);\r\n\r\n\t\tthis.topEdge         = false;\r\n\t\tthis.resizeListening = false;\r\n\t\tthis.visible         = false;\r\n\t\tthis.offsetTop       = false;\r\n\t\tthis.offsetBottom    = false;\r\n\r\n\t\tthis.threshold       = 0;\r\n\r\n\t\tthis.subscribedTo    = [];\r\n\r\n\t\tthis.scrollListener = (event) => {\r\n\t\t\tlet tag = event.target;\r\n\t\t\tfor(let i in tag.scrollSubTags)\r\n\t\t\t{\r\n\t\t\t\ttag.scrollSubTags[i].scrolled(tag);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.resizeListenr = (event)=>{\r\n\t\t\tfor(let i in this.resizeTags)\r\n\t\t\t{\r\n\t\t\t\tthis.resizeTags[i].scrolled(event.target);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.attachListener = (e) => {\r\n\t\t\tif(e.path[e.path.length-1]!==window)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet current = e.target;\r\n\t\t\twhile(current)\r\n\t\t\t{\r\n\t\t\t\tcurrent = Bindable.makeBindable(current);\r\n\r\n\t\t\t\tthis.addScrollListener(current);\r\n\r\n\t\t\t\tthis.scrolled(current);\r\n\r\n\t\t\t\tcurrent = current.parentNode;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.element.addEventListener('cvDomAttached', this.attachListener);\r\n\r\n\t\tthis.cleanup.push(((element)=>()=>{\r\n\t\t\telement.removeEventListener('cvDomAttached', this.attachListener);\r\n\t\t})(this.element));\r\n\r\n\t\tScrollTag.addResizeListener(this);\r\n\r\n\t\tthis.bindTo('visible', (v)=>{\r\n\t\t\tlet scrolledEvent;\r\n\t\t\tif(v)\r\n\t\t\t{\r\n\t\t\t\tscrolledEvent = new Event('cvScrolledIn');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tscrolledEvent = new Event('cvScrolledOut');\r\n\t\t\t}\r\n\r\n\t\t\tDom.mapTags(this.element, false, (node) => {\r\n\t\t\t\tnode.dispatchEvent(scrolledEvent);\r\n\t\t\t});\r\n\r\n\t\t\tthis.element.dispatchEvent(scrolledEvent);\r\n\t\t});\r\n\r\n\t\tthis.bindTo('offsetTop', (v) => {\r\n\t\t\tlet scrolledEvent = new CustomEvent('cvScrolled', {\r\n\t\t\t\tdetail: {offset: v}\r\n\t\t\t});\r\n\t\t\tDom.mapTags(this.element, false, (node) => {\r\n\t\t\t\tnode.dispatchEvent(scrolledEvent);\r\n\t\t\t});\r\n\r\n\t\t\tthis.element.dispatchEvent(scrolledEvent);\r\n\t\t});\r\n\t}\r\n\tscrolled(scroller)\r\n\t{\r\n\t\tlet current = this.element;\r\n\r\n\t\tlet offsetTop         = 0\r\n\t\t\t, subOffsetTop    = 0\r\n\t\t\t, offsetBottom    = 0\r\n\t\t\t, subOffsetBottom = 0;\r\n\r\n\t\twhile(current)\r\n\t\t{\r\n\t\t\tif(offsetTop - current.scrollTop < subOffsetTop\r\n\t\t\t){\r\n\t\t\t\tsubOffsetTop = offsetTop - current.scrollTop;\r\n\t\t\t}\r\n\r\n\t\t\tif(current.offsetTop)\r\n\t\t\t{\r\n\t\t\t\toffsetTop += current.offsetTop;\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof current.scrollTop !== 'undefined')\r\n\t\t\t{\r\n\t\t\t\toffsetTop -= current.scrollTop;\r\n\t\t\t\toffsetBottom = offsetTop + this.element.clientHeight - current.clientHeight;\r\n\t\t\t}\r\n\r\n\t\t\tif(current.parentNode\r\n\t\t\t\t&& current.parentNode.offsetTop\r\n\t\t\t\t&& current.parentNode !== current.offsetParent\r\n\t\t\t){\r\n\t\t\t\toffsetTop -= current.parentNode.offsetTop;\r\n\t\t\t}\r\n\r\n\t\t\tif(offsetBottom > subOffsetBottom)\r\n\t\t\t{\r\n\t\t\t\tsubOffsetBottom = offsetBottom;\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = current.parentNode;\r\n\t\t}\r\n\r\n\t\tif(offsetTop < -this.threshold || subOffsetTop < -this.threshold)\r\n\t\t{\r\n\t\t\tthis.topEdge = false;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.topEdge = true;\r\n\r\n\t\t\tif(offsetBottom - this.element.clientHeight > this.threshold)\r\n\t\t\t{\r\n\t\t\t\tthis.topEdge = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.bottomEdge = false;\r\n\r\n\t\tif(offsetBottom <= this.threshold)\r\n\t\t{\r\n\t\t\tthis.bottomEdge = true;\r\n\r\n\t\t\tif(offsetTop + this.element.clientHeight < -this.threshold)\r\n\t\t\t{\r\n\t\t\t\tthis.bottomEdge = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// this.offsetTop    = offsetTop;\r\n\t\t// this.offsetBottom = this.offsetBottom\r\n\r\n\t\tlet visible = false;\r\n\r\n\t\tif(offsetBottom <=this.element.clientHeight && offsetTop > -this.element.clientHeight)\r\n\t\t{\r\n\t\t\tvisible = true;\r\n\t\t}\r\n\r\n\t\tthis.proxy.visible      = visible;\r\n\t\tthis.proxy.offsetTop    = offsetTop;\r\n\t\tthis.proxy.offsetBottom = offsetBottom;\r\n\t}\r\n\taddScrollListener(tag)\r\n\t{\r\n\t\tif(!tag.scrollListener)\r\n\t\t{\r\n\t\t\tObject.defineProperty(tag, 'scrollListener', {\r\n\t\t\t\tenumerable: false\r\n\t\t\t\t, writable: true\r\n\t\t\t});\r\n\r\n\t\t\tObject.defineProperty(tag, 'scrollSubTags', {\r\n\t\t\t\tenumerable: false\r\n\t\t\t\t, writable: true\r\n\t\t\t});\r\n\r\n\t\t\ttag.scrollListener = true;\r\n\t\t\ttag.scrollSubTags  = [];\r\n\r\n\t\t\ttag.addEventListener('scroll', this.scrollListener);\r\n\r\n\t\t\tthis.cleanup.push(((element)=>()=>{\r\n\t\t\t\telement.removeEventListener('scroll', this.scrollListener);\r\n\t\t\t\telement.scrollSubTags = undefined;\r\n\t\t\t})(tag));\r\n\t\t}\r\n\r\n\t\tfor(let i in this.subscribedTo)\r\n\t\t{\r\n\t\t\tif(this.subscribedTo[i] === tag)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(tag.scrollSubTags)\r\n\t\t{\r\n\t\t\ttag.scrollSubTags.push(this);\r\n\t\t}\r\n\t}\r\n\tstatic addResizeListener(tag)\r\n\t{\r\n\t\tthis.resizeTags = [];\r\n\r\n\t\tif(!this.resizeListener)\r\n\t\t{\r\n\t\t\t// window.addEventListener('resize', this.resizeListener);\r\n\r\n\t\t\t// this.cleanup.push(()=>{\r\n\t\t\t// \twindow.removeEventListener('resize', this.resizeListener);\r\n\t\t\t// });\r\n\t\t}\r\n\r\n\t\tthis.resizeListener = true;\r\n\r\n\t\tthis.resizeTags.push(tag);\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nimport { ToastAlert } from './ToastAlert';\r\n\r\nexport class Toast extends View {\r\n\tstatic instance() {\r\n\t\tif(!this.inst) {\r\n\t\t\tthis.inst = new this();\r\n\t\t}\r\n\t\treturn this.inst;\r\n\t}\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.template = `\r\n\t\t\t<div id = \"[[_id]]\" cv-each = \"alerts:alert\" class = \"toast\">\r\n\t\t\t\t[[alert]]\r\n\t\t\t</div>\r\n\t\t`;\r\n\t\t// this.style = {\r\n\t\t// \t'': {\r\n\t\t// \t\tposition:   'fixed'\r\n\t\t// \t\t, top:      '0px'\r\n\t\t// \t\t, right:    '0px'\r\n\t\t// \t\t, padding:  '8px'\r\n\t\t// \t\t, 'z-index':'999999'\r\n\t\t// \t\t, display:  'flex'\r\n\t\t// \t\t, 'flex-direction': 'column-reverse'\r\n\t\t// \t}\r\n\t\t// };\r\n\t\t\r\n\t\tthis.args.alerts = [];\r\n\r\n\t\tthis.args.alerts.bindTo((v) => { console.log(v) });\r\n\t}\r\n\tpop(alert) {\r\n\t\tlet index = this.args.alerts.length;\r\n\r\n\t\tthis.args.alerts.push(alert);\r\n\r\n\t\talert.decay(((alert)=>()=>{\r\n\t\t\tfor(let i in this.args.alerts)\r\n\t\t\t{\r\n\t\t\t\tif(this.args.alerts)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.args.alerts[i] === alert;\r\n\r\n\t\t\t\t\tthis.args.alerts.splice(i, 1);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})(alert));\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nexport class ToastAlert extends View {\r\n\tconstructor(args) {\r\n\t\tsuper(args);\r\n\t\tthis.args.time    = this.args.time || 10000;\r\n\t\tthis.init         = this.args.time;\r\n\t\tthis.args.opacity = 1;\r\n\t\tthis.args.title   = this.args.title || 'Standard alert';\r\n\t\tthis.args.body    = this.args.body  || 'This is a standard alert.';\r\n\t\tthis.template     = `\r\n\t\t\t<div id = \"[[_id]]\" style = \"opacity:[[opacity]]\" class = \"alert\">\r\n\t\t\t\t<h3>[[title]]</h3>\r\n\t\t\t\t<p>[[body]]</p>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\tdecay(complete) {\r\n\t\tlet decayInterval = 16;\r\n\t\tlet decay = setInterval(\r\n\t\t\t()=>{\r\n\t\t\t\tif(this.args.time > 0) {\r\n\t\t\t\t\tthis.args.time -= decayInterval;\r\n\t\t\t\t\tthis.args.opacity = this.args.time / this.init;\r\n\r\n\t\t\t\t\tif(this.args.time <= 0) {\r\n\t\t\t\t\t\tif(complete) {\r\n\t\t\t\t\t\t\tcomplete();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tclearInterval(decay);\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t, decayInterval\r\n\t\t);\r\n\t}\r\n}\r\n"]}