{"version":3,"sources":["app/Config.js","app/access/LoginView.js","app/access/UserRepository.js","app/base/Bag.js","app/base/Bindable.js","app/base/Cache.js","app/base/Cookie.js","app/base/Dom.js","app/base/Model.js","app/base/Persist.js","app/base/Repository.js","app/base/Router.js","app/base/RuleSet.js","app/base/Tag.js","app/base/Theme.js","app/base/View.js","app/base/ViewList.js","app/form/ButtonField.js","app/form/Field.js","app/form/FieldSet.js","app/form/FileField.js","app/form/Form.js","app/form/HiddenField.js","app/form/HtmlField.js","app/form/RadioField.js","app/form/SelectField.js","app/form/TextareaField.js","app/form/multiField/CreateForm.js","app/form/multiField/Form.js","app/form/multiField/FormWrapper.js","app/form/multiField/SearchForm.js","app/form/multiField/View.js","app/form/multiField/Wrapper.js","app/input/Keyboard.js","app/tag/LazyTag.js","app/tag/PopOutTag.js","app/tag/ScrollTag.js","app/toast/Toast.js","app/toast/ToastAlert.js"],"names":["Config","backend","LoginView","template","event","console","log","preventDefault","fbWindow","window","open","userCheck","clearInterval","onInterval","UserRepository","getCurrentUser","then","response","user","body","id","Router","clearCache","Repository","Toast","instance","pop","ToastAlert","title","username","publicId","time","logoutWindow","View","refresh","args","Bindable","makeBindable","prerenderer","Promise","resolve","request","uri","roles","i","class","isAdmin","current","callback","bindTo","onResponse","meta","currentUser","wait","Bag","changeCallback","Symbol","content","_items","item","Object","Error","undefined","removed","key","getOwnPropertySymbols","slice","keys","map","get","newItems","add","remove","items","indexOf","push","sort","reverse","splice","object","___binding___","Node","defineProperty","enumerable","writable","value","___isBindable___","___wrapped___","___bindingAll___","___stack___","___stackTime___","___before___","___after___","___setCount___","property","options","bindToAll","Function","throttle","delay","v","k","t","d","p","setTimeout","waiter","clearTimeout","bindIndex","length","isBound","j","set","target","substring","stop","descriptor","getOwnPropertyDescriptor","excluded","File","warnOn","del","Array","isArray","___executing___","unshift","ret","apply","___ref___","arguments","shift","Proxy","deleteProperty","path","owner","node","pathParts","split","top","obj","Cache","expiry","bucket","expiration","Date","getTime","defaultvalue","Cookie","name","jar","location","href","substr","document","cookie","c","JSON","parse","error","trim","decodeURIComponent","cookieString","encodeURIComponent","Dom","doc","selector","startNode","endNode","result","started","ended","treeWalker","createTreeWalker","NodeFilter","SHOW_ALL","acceptNode","FILTER_SKIP","Element","matches","FILTER_ACCEPT","nextNode","currentNode","dispatchEvent","mapTags","Model","repository","values","cacheKey","publidId","cached","load","consume","store","Persist","subBinding","_source","localStorage","getItem","source","debind","watch","setItem","stringify","removeItem","objects","resourceUri","queryToString","queryOver","extractModel","page","records","record","data","customFields","form","Form","FormWrapper","api","rawData","model","skeleton","namespace","formData","FormData","ns","append","encode","_onResponse","post","cache","type","queryString","queryArgs","arg","join","fullUri","xhr","XMLHttpRequest","responseType","tagCacheSelector","tagCache","querySelector","tagCacheContent","innerText","withCredentials","timeout","xhrId","xhrs","reject","onreadystatechange","DONE","OK","readyState","status","getResponseHeader","responseText","code","prerendering","createElement","setAttribute","head","appendChild","send","abort","xhrList","view","addEventListener","listen","mainView","routeHistory","toString","prevHistoryLength","history","route","pathname","search","hash","match","go","silent","pushState","Event","HashChangeEvent","forceRefresh","eventStart","CustomEvent","cancelable","detail","routes","query","URLSearchParams","pair","selected","L1","L2","argName","groups","exec","update","isView","root","_result","x","catch","pause","eventEnd","params","finalArgs","fresh","parts","RuleSet","rules","wrapped","wrap","nodes","querySelectorAll","globalRules","listener","removeEventListener","prototype","element","___cvApplied___","direct","parentView","viewList","parent","tag","Tag","parentNode","sibling","nextSibling","HTMLElement","contains","firstChild","insertBefore","cleanup","r","clear","render","ref","index","proxy","clearBindings","detachEvent","removeChild","paused","Theme","views","single","list","modelClass","_modelClass","content_type","___VIEW___","_id","uuid","firstNode","lastNode","attach","detach","eventCleanup","viewLists","withViews","tags","intervals","timeouts","frames","ruleSet","preRuleSet","subBindings","preserve","interpolateRegex","timestamp","requestAnimationFrame","wrappedCallback","fired","created","setInterval","insertPoint","bubbles","attachEvent","subDoc","createRange","createContextualFragment","mapEachTags","mapWithTags","mapPrendererTags","mapLinkTags","mapBindTags","mapAttrTags","mapInterpolatableTags","mapExpandableTags","mapIfTags","mapRefTags","mapOnTags","createComment","createTextNode","newNode","postRender","expandProperty","getAttribute","expandArg","removeAttribute","attrProperty","pairs","attrs","bindProperty","attrib","regex","nodeType","TEXT_NODE","original","nodeValue","interpolatable","header","unsafeHtml","expand","staticPrefix","staticNode","dynamicNode","__toString","innerHTML","staticSuffix","ELEMENT_NODE","attributes","attribute","bindProperties","segments","longProperty","refAttr","refProp","refClassname","refKey","refClass","stringToClass","___tag___","tagObject","refKeyVal","bindArg","tagName","toLowerCase","checked","option","selectedIndex","inputListener","multi","from","files","eventListener","action","String","a","eventName","replace","callbackName","argList","s","eventMethod","_parent","_callBackName","argRefs","parseInt","outerHTML","linkAttr","linkClick","prerenderAttr","withAttr","carryAttr","subTemplate","carryProps","eachAttr","eachProp","asProp","keyProp","ViewList","debindA","subArgs","debindB","newRef","oldRef","ifProperty","inverted","ifDoc","cleaner","str","crypto","getRandomValues","Uint8Array","refClassSplit","refShortClassname","require","subProperty","keyProperty","reRender","finalViews","found","viewArgs","appendOnly","ButtonField","stopPropagation","formTag","Field","assign","disabled","valueString","ignore","extra","setting","input","multiple","hasChildren","FieldSet","fields","renderFields","children","field","FileField","flatValue","method","_method","classes","_classes","_onSubmit","chain","subchain","fieldName","getName","MultiField","SelectField","RadioField","HtmlField","HiddenField","TextareaField","contentEditable","contenteditable","onTimeout","CreateForm","creating","focus","loading","wrapper","addRecord","addButtonClicked","_onLoad","_onRender","_onRequest","loadForm","resp","onLoad","onSubmit","formElement","toUpperCase","_query","promises","onRequest","onRequestError","entries","requestData","onReq","all","messages","alert","SearchForm","superTemplate","keyword","_fields","dragging","dropping","wrapSubfield","disable","fieldType","loader","createForm","searchForm","setCreateForm","createFormReady","Wrapper","fieldClass","constructor","cloneSkeleton","correctNames","superSkeleton","newField","newWrap","enable","level","_object","dragLabel","dropLabel","dragName","dropName","dragIndex","extractIndex","dropIndex","dragFields","dragLabels","dropFields","dropLabels","dropBefore","offset","dragField","dropField","currentFieldSet","currentLabel","label","currentName","currentIndex","newName","changeIndex","changeAttributePrefix","currentFields","currentLabels","oldPrefix","newPrefix","oldName","icon","deleted","backendPath","editRecord","deleteImage","undeleteImage","_titleField","getRecordTitle","Keyboard","maxDecay","listening","codes","LazyTag","classList","afterScroll","lazyStyle","style","offsetTop","offsetLeft","ScrollTag","PopOutTag","poppedOut","moving","hostSelector","leftDuration","topDuration","rightDuration","bottomDuration","verticalDuration","horizontalDuration","unpoppedStyle","previousScroll","bodyStyle","bodyScroll","scrollStyle","popTimeout","rect","clickListener","getBoundingClientRect","distance","Math","sqrt","left","cut","fromRight","innerWidth","right","fromBottom","innerHeight","bottom","horizontalAverage","vericalAverage","unpop","escapeListener","___clickListener___","___escapeListener___","popLevel","scrollY","hostTag","hostRect","y","width","height","unpopLevel","scrollTo","visible","offsetBottom","attachListener","e","rootNode","addScrollListener","addResizeListener","scrolled","scrolledEvent","scroller","___scrollListener___","passive","capture","___resizeListener___","resizeListener","inst","alerts","decay","init","opacity","complete","decayInterval"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAaA,M,WAAAA,M;;;;AAEbA,OAAOC,OAAP,GAAiB,IAAjB;;;;;;;;;;;;;ACFA;;AAEA;;AACA;;AACA;;AAEA;;AAEA;;AACA;;;;;;;;IAEaC,S,WAAAA,S;;;AACZ,sBAAc;AAAA;;AAAA;;AAEb,QAAKC,QAAL;AAFa;AA0Bb;;;;gCACaC,K,EAAO;AAAA;;AACpBC,WAAQC,GAAR,CAAY,KAAZ;AACAF,SAAMG,cAAN;AACA,OAAIC,WAAWC,OAAOC,IAAP,CACdV,eAAOC,OAAP,GACG,gBAFW,CAAf;;AAKA,OAAG,KAAKU,SAAR,EACA;AACC,SAAKC,aAAL,CAAmB,KAAKD,SAAxB;AACA;;AAED,QAAKA,SAAL,GAAiB,KAAKE,UAAL,CAAgB,GAAhB,EAAqB,YAAM;AAC3CC,mCAAeC,cAAf,CAA8B,IAA9B,EAAoCC,IAApC,CAAyC,UAACC,QAAD,EAAc;AACtD,SAAIC,OAAOD,SAASE,IAApB;AACA,SAAG,CAACD,KAAKE,EAAN,IAAY,CAACF,IAAhB,EACA;AACC;AACA;;AAED,YAAKN,aAAL,CAAmB,OAAKD,SAAxB;;AAEAU,oBAAOC,UAAP;AACAC,4BAAWD,UAAX;;AAEAE,kBAAMC,QAAN,GAAiBC,GAAjB,CAAqB,IAAIC,sBAAJ,CAAe;AACnCC,aAAO,kBAAkBV,KAAKW,QADK;AAEjCV,YAAM,SAAUD,KAAKY,QAFY;AAGjCC,YAAM;AAH2B,MAAf,CAArB;;AAMA;;AAEA;AACA,KArBD;AAsBA,IAvBgB,CAAjB;AAwBA;;;yBACM3B,K,EAAO;AACb,OAAI4B,eAAevB,OAAOC,IAAP,CAClBV,eAAOC,OAAP,GACG,mCAFe,CAAnB;AAIA;;;;EAvE6BgC,W;;;;;;;;;;;;;ACX/B;;AACA;;AACA;;;;;;;;IAEanB,c,WAAAA,c;;;;;;;;;;;mCAE2B;AAAA;;AAAA,OAAjBoB,OAAiB,uEAAP,KAAO;;AACtC,QAAKC,IAAL,GAAY,KAAKA,IAAL,IAAaC,mBAASC,YAAT,CAAsB,EAAtB,CAAzB;AACA,OAAG5B,OAAO6B,WAAV,EACA;AACC;AACA;AACD,OAAG,CAACJ,OAAD,IAAY,KAAKC,IAAL,CAAUlB,QAAzB,EACA;AACCZ,YAAQC,GAAR,CAAY,KAAK6B,IAAL,CAAUlB,QAAtB;AACA,WAAOsB,QAAQC,OAAR,CAAgB,KAAKL,IAAL,CAAUlB,QAA1B,CAAP;AACA;AACD,UAAO,KAAKwB,OAAL,CACN,KAAKC,GAAL,GAAW,SADL,EAEJ,KAFI,EAGJ,KAHI,EAIJ,KAJI,EAKL1B,IALK,CAKA,UAACC,QAAD,EAAc;AACpB,QAAGA,SAASE,IAAT,CAAcwB,KAAjB,EACA;AACC,UAAI,IAAIC,CAAR,IAAa3B,SAASE,IAAT,CAAcwB,KAA3B,EACA;AACC,UAAG1B,SAASE,IAAT,CAAcwB,KAAd,CAAoBC,CAApB,EAAuBC,KAAvB,IAAgC,yCAAnC,EACA;AACC5B,gBAASE,IAAT,CAAc2B,OAAd,GAAwB,IAAxB;AACA;AACD;AACD;AACD,QAAG,OAAKX,IAAL,CAAUlB,QAAV,IAAsB,OAAKkB,IAAL,CAAUlB,QAAV,CAAmBG,EAA5C,EACA;AACC,YAAKe,IAAL,CAAUlB,QAAV,GAAqBA,QAArB;AACA,YAAKkB,IAAL,CAAUY,OAAV,GAAqB9B,SAASE,IAA9B;AACA;AACD,WAAOF,QAAP;AACA,IAtBM,CAAP;AAuBA;;;0BACc;AACd,UAAO,KAAKwB,OAAL,CAAa,KAAKC,GAAL,GAAW,QAAxB,CAAP;AACA;;;2BACe;AAAA;;AACf,QAAKP,IAAL,GAAY,KAAKA,IAAL,IAAaC,mBAASC,YAAT,CAAsB,EAAtB,CAAzB;AACA,QAAKF,IAAL,CAAUY,OAAV,GAAoB,IAApB;AACA,UAAO,KAAKN,OAAL,CACN,KAAKC,GAAL,GAAW,SADL,EAEJ,KAFI,EAGJ,EAHI,EAIJ,KAJI,EAKL1B,IALK,CAKA,UAACE,IAAD,EAAU;AAChB,WAAKuB,OAAL,CACC,OAAKC,GAAL,GAAW,QADZ,EAEG,KAFH,EAGG,EAHH,EAIG,KAJH,EAKE1B,IALF,CAKO,YAAM;AACZ,YAAOE,IAAP;AACA,KAPD;AAQA,WAAOA,IAAP;AACA,IAfM,CAAP;AAgBA;;;2BACe8B,Q,EAAU;AACzB,QAAKb,IAAL,GAAY,KAAKA,IAAL,IAAaC,mBAASC,YAAT,CAAsB,EAAtB,CAAzB;AACA,UAAO,KAAKF,IAAL,CAAUc,MAAV,CAAiB,SAAjB,EAA4BD,QAA5B,CAAP;AACA;;;sBA9DgB;AAAE,UAAOhD,eAAOC,OAAP,GAAiB,QAAxB;AAAmC;;;;EADnBsB,uB;;AAkEpCA,wBAAW2B,UAAX,CAAsB,UAACjC,QAAD,EAAY;AACjCH,gBAAeqB,IAAf,GAAsBrB,eAAeqB,IAAf,IAAuBC,mBAASC,YAAT,CAAsB,EAAtB,CAA7C;AACA,KAAGpB,YACCA,SAASkC,IADV,IAEClC,SAASkC,IAAT,CAAcC,WAFf,KAGE,CAACtC,eAAeqB,IAAf,CAAoBY,OAArB,IACA9B,SAASkC,IAAT,CAAcC,WAAd,CAA0BhC,EAA1B,KAAiCN,eAAeqB,IAAf,CAAoBY,OAApB,CAA4B3B,EAJ/D,CAAH,EAMC;AACAN,iBAAeqB,IAAf,CAAoBY,OAApB,GAA8B9B,SAASkC,IAAT,CAAcC,WAA5C;AACA;AACD,CAXD,EAWG,EAACC,MAAK,CAAN,EAXH;;AAaA;AACA;AACA;AACA;;;;;;;;;;;;;;;;ICtFaC,G,WAAAA,G;AAEZ,cAAYC,cAAZ,EACA;AAAA;;AACC,OAAKJ,IAAL,GAAeK,OAAO,MAAP,CAAf;AACA,OAAKC,OAAL,GAAe,EAAf;AACA,OAAKC,MAAL,GAAe,KAAf;;AAEA,OAAKH,cAAL,GAAsBA,cAAtB;AACA;;;;sBAEGI,I,EACJ;AACC,OAAG,QAAOA,IAAP,yCAAOA,IAAP,cAAuBC,MAA1B,EACA;AACC,UAAM,IAAIC,KAAJ,CAAU,8CAAV,CAAN;AACA;;AAED,OAAG,CAACF,KAAK,KAAKR,IAAV,CAAJ,EACA;AACCQ,SAAK,KAAKR,IAAV,IAAkBK,OAAO,OAAP,CAAlB;AACA;;AAED,QAAKC,OAAL,CAAcE,KAAK,KAAKR,IAAV,CAAd,IAAkCQ,IAAlC;;AAEA,OAAG,KAAKJ,cAAR,EACA;AACC,SAAKA,cAAL,CACC,KAAKE,OAAL,CAAcE,KAAK,KAAKR,IAAV,CAAd,CADD,EAEG,KAAKA,IAFR,EAGG,CAHH;AAKA;AACD;;;yBAEMQ,I,EACP;AACC,OAAG,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAAnB,EACA;AACC,UAAM,IAAIE,KAAJ,CAAU,8CAAV,CAAN;AACA;;AAED,OAAG,CAACF,KAAK,KAAKR,IAAV,CAAD,IAAoB,CAAC,KAAKM,OAAL,CAAcE,KAAK,KAAKR,IAAV,CAAd,CAAxB,EACA;AACC,QAAG,KAAKI,cAAR,EACA;AACC,UAAKA,cAAL,CACCO,SADD,EAEG,KAAKX,IAFR,EAGG,CAHH;AAKA;AACD,WAAO,KAAP;AACA;;AAED,OAAIY,UAAU,KAAKN,OAAL,CAAcE,KAAK,KAAKR,IAAV,CAAd,CAAd;;AAEA,UAAO,KAAKM,OAAL,CAAcE,KAAK,KAAKR,IAAV,CAAd,CAAP;;AAEA,OAAG,KAAKI,cAAR,EACA;AACC,SAAKA,cAAL,CACCQ,OADD,EAEG,KAAKZ,IAFR,EAGG,CAAC,CAHJ;AAKA;AACD;;;qBAEEQ,I,EACH;AACC,UAAOA,KAAM,KAAKR,IAAX,CAAP;AACA;;;sBAEGa,G,EACJ;AACC,UAAO,KAAKP,OAAL,CAAcO,GAAd,CAAP;AACA;;;yBAGD;AACC,UAAOJ,OAAOK,qBAAP,CACN,KAAKR,OADC,EAELS,KAFK,EAAP;AAGA;;;0BAGD;AAAA;;AACC,UAAO,KAAKC,IAAL,GAAYC,GAAZ,CAAgB,UAACJ,GAAD;AAAA,WAAO,MAAKK,GAAL,CAASL,GAAT,CAAP;AAAA,IAAhB,EAAsCE,KAAtC,EAAP;;AAEA,OAAII,WAAW,KAAKH,IAAL,GAAYC,GAAZ,CAAgB,UAACJ,GAAD;AAAA,WAAO,MAAKK,GAAL,CAASL,GAAT,CAAP;AAAA,IAAhB,EAAsCE,KAAtC,EAAf;;AAEA,OAAG,CAAC,KAAKR,MAAT,EACA;AACC,SAAKA,MAAL,GAAc,EAAd;AACA;;AAED,OAAIa,MAAS,EAAb;AACA,OAAIC,SAAS,EAAb;;AAEA,QAAI,IAAI5B,CAAR,IAAa,KAAK6B,KAAlB,EACA;AACCpE,YAAQC,GAAR,CAAY,GAAZ,EAAiBgE,SAASI,OAAT,CAAiB,KAAKD,KAAL,CAAW7B,CAAX,CAAjB,CAAjB;;AAEA,QAAG0B,SAASI,OAAT,CAAiB,KAAKD,KAAL,CAAW7B,CAAX,CAAjB,IAAkC,CAArC,EACA;AACC4B,YAAOG,IAAP,CAAY/B,CAAZ;AACA;AACD;;AAED4B,UAAOI,IAAP;AACAJ,UAAOK,OAAP;;AAEA,QAAI,IAAIjC,EAAR,IAAa0B,QAAb,EACA;AACCjE,YAAQC,GAAR,CAAY,GAAZ,EAAiB,KAAKoD,MAAL,CAAYgB,OAAZ,CAAoBJ,SAAS1B,EAAT,CAApB,CAAjB;;AAEA,QAAG,KAAKc,MAAL,CAAYgB,OAAZ,CAAoBJ,SAAS1B,EAAT,CAApB,IAAmC,CAAtC,EACA;AACC2B,SAAII,IAAJ,CAAS/B,EAAT;AACA;AACD;;AAEDvC,WAAQC,GAAR,CAAYiE,GAAZ,EAAiBC,MAAjB;;AAEA,QAAI,IAAI5B,GAAR,IAAa4B,MAAb,EACA;AACC,SAAKd,MAAL,CAAYoB,MAAZ,CAAmBN,OAAO5B,GAAP,CAAnB,EAA8B,CAA9B;AACA;;AAED,QAAI,IAAIA,GAAR,IAAa2B,GAAb,EACA;AACC,SAAKb,MAAL,CAAYiB,IAAZ,CAAiBL,SAASC,IAAI3B,GAAJ,CAAT,CAAjB;AACA;;AAEDvC,WAAQC,GAAR,CAAYgE,QAAZ,EAAsB,KAAKZ,MAA3B;;AAEA,UAAO,KAAKA,MAAZ;AACA;;;;;;;;;;;;;;;;;;;;IC1IWtB,Q,WAAAA,Q;;;;;;;mCACS2C,M,EAAQ;AACtB,gBAAI,CAACA,OAAOC,aAAZ,EAA2B;AACvB,uBAAO,KAAP;AACH;;AAED,mBAAOD,OAAOC,aAAP,KAAyB5C,QAAhC;AACH;;;qCACmB2C,M,EAAQ;;AAExB,gBAAI,CAACA,MAAD,IACGA,OAAOC,aADV,IAEG,QAAOD,MAAP,yCAAOA,MAAP,OAAkB,QAFrB,IAGGA,kBAAkBE,IAHzB,EAIE;AACE,uBAAOF,MAAP;AACH;;AAEDnB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,WAA9B,EAA2C;AACvCI,4BAAY,KAD2B;AAEvCC,0BAAU;AAF6B,aAA3C;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,QAA9B,EAAwC;AACpCI,4BAAY,KADwB;AAEpCC,0BAAU;AAF0B,aAAxC;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,SAA9B,EAAyC;AACrCI,4BAAY,KADyB;AAErCC,0BAAU;AAF2B,aAAzC;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,eAA9B,EAA+C;AAC3CI,4BAAY,KAD+B;AAE3CC,0BAAU;AAFiC,aAA/C;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,kBAA9B,EAAkD;AAC9CI,4BAAY,KADkC;AAE9CC,0BAAU;AAFoC,aAAlD;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,kBAA9B,EAAkD;AAC9CI,4BAAY,KADkC;AAE9CC,0BAAU;AAFoC,aAAlD;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,iBAA9B,EAAiD;AAC7CI,4BAAY,KADiC;AAE7CC,0BAAU;AAFmC,aAAjD;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,aAA9B,EAA6C;AACzCI,4BAAY,KAD6B;AAEzCC,0BAAU;AAF+B,aAA7C;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,iBAA9B,EAAiD;AAC7CI,4BAAY,KADiC;AAE7CC,0BAAU;AAFmC,aAAjD;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,cAA9B,EAA8C;AAC1CI,4BAAY,KAD8B;AAE1CC,0BAAU;AAFgC,aAA9C;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,aAA9B,EAA6C;AACzCI,4BAAY,KAD6B;AAEzCC,0BAAU;AAF+B,aAA7C;;AAKA;AACA;AACA;AACA;;AAEAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,gBAA9B,EAAgD;AAC5CI,4BAAY,KADgC;AAE5CC,0BAAU;AAFkC,aAAhD;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,eAA9B,EAA+C;AAC3CI,4BAAY,KAD+B;AAE3CC,0BAAU;AAFiC,aAA/C;;AAKAxB,mBAAOsB,cAAP,CAAsBH,MAAtB,EAA8B,cAA9B,EAA8C;AAC1CI,4BAAY,KAD8B;AAE1CC,0BAAU,KAFgC;AAG1CC,uBAAON;AAHmC,aAA9C;AAKAA,mBAAOO,gBAAP,GAA0BlD,QAA1B;AACA2C,mBAAOQ,aAAP,GAA0B,EAA1B;AACAR,mBAAOC,aAAP,GAA0B,EAA1B;AACAD,mBAAOS,gBAAP,GAA0B,EAA1B;AACAT,mBAAOU,WAAP,GAA0B,EAA1B;AACAV,mBAAOW,eAAP,GAA0B,EAA1B;AACAX,mBAAOY,YAAP,GAA0B,EAA1B;AACAZ,mBAAOa,WAAP,GAA0B,EAA1B;AACAb,mBAAOc,cAAP,GAAwB,EAAxB;AACAd,mBAAO9B,MAAP,GAAgB,UAAC6C,QAAD,EAA6C;AAAA,oBAAlC9C,QAAkC,uEAAvB,IAAuB;AAAA,oBAAjB+C,OAAiB,uEAAP,EAAO;;AACzD,oBAAIC,YAAY,KAAhB;;AAEA,oBAAIF,oBAAoBG,QAAxB,EAAkC;AAC9BF,8BAAY/C,YAAY,EAAxB;AACAA,+BAAY8C,QAAZ;AACAE,gCAAY,IAAZ;AACH;;AAED,oBAAIE,WAAW,KAAf;;AAEA,oBAAIH,QAAQI,KAAR,IAAiB,CAArB,EAAwB;AACpBnD,+BAAY,UAACA,QAAD;AAAA,+BAAc,UAACoD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAAa;AACnC,gCAAIC,IAAIF,EAAED,CAAF,CAAR;AACAI,uCAAW;AAAA,uCAAIzD,SAASoD,CAAT,EAAWC,CAAX,EAAaC,CAAb,EAAeC,CAAf,EAAiBC,CAAjB,CAAJ;AAAA,6BAAX,EAAoCT,QAAQI,KAA5C;AACH,yBAHW;AAAA,qBAAD,CAGRnD,QAHQ,CAAX;AAIH;;AAED,oBAAI+C,QAAQG,QAAR,IAAoB,CAAxB,EAA2B;AACvBlD,+BAAY,UAACA,QAAD;AAAA,+BAAc,UAACoD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAAa;AACnC,gCAAIL,QAAJ,EAAc;AACV;AACH;AACD,gCAAIM,IAAIF,EAAED,CAAF,CAAR;AACArD,qCAASoD,CAAT,EAAWC,CAAX,EAAaC,CAAb,EAAeC,CAAf,EAAiBC,CAAjB;AACAN,uCAAW,IAAX;AACAO,uCAAW;AAAA,uCAAIP,WAAW,KAAf;AAAA,6BAAX,EAAiCH,QAAQG,QAAzC;AACH,yBARW;AAAA,qBAAD,CAQRlD,QARQ,CAAX;AASH;;AAED,oBAAI0D,eAAJ;;AAEA,oBAAIX,QAAQ1C,IAAR,IAAgB,CAApB,EAAuB;AACnBL,+BAAY,UAACA,QAAD;AAAA,+BAAc,UAACoD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAAa;AACnC,gCAAIG,MAAJ,EAAY;AACRC,6CAAaD,MAAb;AACH;AACD,gCAAIF,IAAIF,EAAED,CAAF,CAAR;AACAK,qCAASD,WAAW;AAAA,uCAAIzD,SAASoD,CAAT,EAAWC,CAAX,EAAaC,CAAb,EAAeC,CAAf,EAAiBC,CAAjB,CAAJ;AAAA,6BAAX,EAAoCT,QAAQ1C,IAA5C,CAAT;AACH,yBANW;AAAA,qBAAD,CAMRL,QANQ,CAAX;AAOH;;AAED,oBAAGgD,SAAH,EAAc;AACV,wBAAIY,aAAY7B,OAAOS,gBAAP,CAAwBqB,MAAxC;;AAEA9B,2BAAOS,gBAAP,CAAwBb,IAAxB,CAA6B3B,QAA7B;;AAEA,yBAAK,IAAIJ,CAAT,IAAcmC,MAAd,EAAsB;AAClB/B,iCAAS+B,OAAOnC,CAAP,CAAT,EAAoBA,CAApB,EAAuBmC,MAAvB,EAA+B,KAA/B;AACH;;AAED,2BAAO,YAAM;AACTA,+BAAOS,gBAAP,CAAwBoB,UAAxB,IAAqC,IAArC;AACH,qBAFD;AAGH;;AAED,oBAAI,CAAC7B,OAAOC,aAAP,CAAqBc,QAArB,CAAL,EAAqC;AACjCf,2BAAOC,aAAP,CAAqBc,QAArB,IAAiC,EAAjC;AACH;;AAED,oBAAIc,YAAY7B,OAAOC,aAAP,CAAqBc,QAArB,EAA+Be,MAA/C;;AAEA9B,uBAAOC,aAAP,CAAqBc,QAArB,EAA+BnB,IAA/B,CAAoC3B,QAApC;;AAEAA,yBAAS+B,OAAOe,QAAP,CAAT,EAA2BA,QAA3B,EAAqCf,MAArC,EAA6C,KAA7C;;AAEA,uBAAO,YAAM;AACT,wBAAI,CAACA,OAAOC,aAAP,CAAqBc,QAArB,CAAL,EAAqC;AACjC;AACH;AACDf,2BAAOC,aAAP,CAAqBc,QAArB,EAA+Bc,SAA/B,IAA4C,IAA5C;AACH,iBALD;AAMH,aAxED;;AA0EA7B,mBAAO+B,OAAP,GAAiB,YAAM;AACnB,qBAAK,IAAIlE,CAAT,IAAcmC,OAAOS,gBAArB,EAAuC;AACnC,wBAAIT,OAAOS,gBAAP,CAAwB5C,CAAxB,CAAJ,EAAgC;AAC5B,+BAAO,IAAP;AACH;AACJ;;AAED,qBAAK,IAAIA,EAAT,IAAcmC,OAAOC,aAArB,EAAoC;AAChC,yBAAK,IAAI+B,CAAT,IAAchC,OAAOC,aAAP,CAAqBpC,EAArB,CAAd,EAAuC;AACnC,4BAAImC,OAAOC,aAAP,CAAqBpC,EAArB,EAAwBmE,CAAxB,CAAJ,EAAgC;AAC5B,mCAAO,IAAP;AACH;AACJ;AACJ;AACD,uBAAO,KAAP;AACH,aAfD;;AAiBA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,iBAAK,IAAInE,CAAT,IAAcmC,MAAd,EAAsB;AAClB,oBAAIA,OAAOnC,CAAP,KACA,QAAOmC,OAAOnC,CAAP,CAAP,KAAoB,QADpB,IAEA,CAACmC,OAAOnC,CAAP,CAAD,YAAsBqC,IAF1B,EAGE;AACEF,2BAAOnC,CAAP,IAAYR,SAASC,YAAT,CAAsB0C,OAAOnC,CAAP,CAAtB,CAAZ;AACH;AACJ;;AAED,gBAAIoE,MAAM,SAANA,GAAM,CAACC,MAAD,EAASjD,GAAT,EAAcqB,KAAd,EAAwB;AAC9B,oBAAG,OAAOrB,GAAP,KAAe,QAAf,IACIA,IAAIkD,SAAJ,CAAc,CAAd,EAAgB,CAAhB,MAAuB,KAD3B,IAEIlD,IAAIE,KAAJ,CAAU,CAAC,CAAX,MAAkB,KAFzB,EAGC;AACG,2BAAO,IAAP;AACH;;AAED,oBAAI+C,OAAOjD,GAAP,MAAgBqB,KAApB,EAA2B;AACvB,2BAAO,IAAP;AACH;;AAED;;AAEA,oBAAIA,SAAS,QAAOA,KAAP,yCAAOA,KAAP,MAAgB,QAAzB,IAAqC,EAAEA,iBAAiBJ,IAAnB,CAAzC,EAAmE;AAC/D,wBAAII,MAAMC,gBAAN,KAA2BlD,QAA/B,EAAyC;AACrCiD,gCAAQjD,SAASC,YAAT,CAAsBgD,KAAtB,CAAR;;AAEA,6BAAK,IAAIzC,GAAT,IAAcyC,KAAd,EAAqB;AACjB,gCAAIA,MAAMzC,GAAN,KAAY,QAAOyC,MAAMzC,GAAN,CAAP,KAAmB,QAAnC,EAA6C;AACzCyC,sCAAMzC,GAAN,IAAWR,SAASC,YAAT,CAAsBgD,MAAMzC,GAAN,CAAtB,CAAX;AACH;AACJ;AACJ;AACJ;;AAED,qBAAK,IAAIA,GAAT,IAAcmC,OAAOS,gBAArB,EAAuC;AACnC,wBAAG,CAACT,OAAOS,gBAAP,CAAwB5C,GAAxB,CAAJ,EAAgC;AAC5B;AACH;AACDmC,2BAAOS,gBAAP,CAAwB5C,GAAxB,EAA2ByC,KAA3B,EAAkCrB,GAAlC,EAAuCiD,MAAvC,EAA+C,KAA/C;AACH;;AAED,oBAAIE,OAAO,KAAX;;AAEA,oBAAInD,OAAOe,OAAOC,aAAlB,EAAiC;AAC7B,yBAAK,IAAIpC,GAAT,IAAcmC,OAAOC,aAAP,CAAqBhB,GAArB,CAAd,EAAyC;AACrC,4BAAG,CAACe,OAAOC,aAAP,CAAqBhB,GAArB,CAAJ,EAA+B;AAC3B;AACH;AACD,4BAAG,CAACe,OAAOC,aAAP,CAAqBhB,GAArB,EAA0BpB,GAA1B,CAAJ,EAAkC;AAC9B;AACH;AACD,4BAAImC,OAAOC,aAAP,CAAqBhB,GAArB,EAA0BpB,GAA1B,EAA6ByC,KAA7B,EAAoCrB,GAApC,EAAyCiD,MAAzC,EAAiD,KAAjD,EAAwDA,OAAOjD,GAAP,CAAxD,MAAyE,KAA7E,EAAoF;AAChFmD,mCAAO,IAAP;AACH;AACJ;AACJ;;AAED,oBAAI,CAACA,IAAL,EAAW;AACP,wBAAIC,aAAaxD,OAAOyD,wBAAP,CACbJ,MADa,EAEXjD,GAFW,CAAjB;;AAKA,wBAAIsD,WACAL,kBAAkBM,IAAlB,IACGvD,OAAO,kBAFd;;AAKA,wBAAG,CAACsD,QAAD,KACK,CAACF,UAAD,IAAeA,WAAWhC,QAD/B,CAAH,EAEC;AACG6B,+BAAOjD,GAAP,IAAcqB,KAAd;AACH;AACJ;;AAED,oBAAI,CAAC4B,OAAOpB,cAAP,CAAsB7B,GAAtB,CAAL,EAAiC;AAC7BiD,2BAAOpB,cAAP,CAAsB7B,GAAtB,IAA6B,CAA7B;AACH;;AAEDiD,uBAAOpB,cAAP,CAAsB7B,GAAtB;;AAEA,oBAAMwD,SAAS,EAAf;;AAEA,oBAAIP,OAAOpB,cAAP,CAAsB7B,GAAtB,IAA6BwD,MAA7B,IAAuCnC,iBAAiBzB,MAA5D,EAAoE;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACH;;AAED,uBAAO,IAAP;AACH,aAtFD;;AAwFA,gBAAI6D,MAAM,SAANA,GAAM,CAACR,MAAD,EAASjD,GAAT,EAAiB;AACvB,oBAAI,EAAEA,OAAOiD,MAAT,CAAJ,EAAsB;AAClB,2BAAO,IAAP;AACH;;AAED,qBAAK,IAAIrE,GAAT,IAAcmC,OAAOS,gBAArB,EAAuC;AACnCT,2BAAOS,gBAAP,CAAwB5C,GAAxB,EAA2BkB,SAA3B,EAAsCE,GAAtC,EAA2CiD,MAA3C,EAAmD,IAAnD,EAAyDA,OAAOjD,GAAP,CAAzD;AACH;;AAED,oBAAIA,OAAOe,OAAOC,aAAlB,EAAiC;AAC7B,yBAAK,IAAIpC,GAAT,IAAcmC,OAAOC,aAAP,CAAqBhB,GAArB,CAAd,EAAyC;AACrC,4BAAG,CAACe,OAAOC,aAAP,CAAqBhB,GAArB,EAA0BpB,GAA1B,CAAJ,EAAkC;AAC9B;AACH;AACDmC,+BAAOC,aAAP,CAAqBhB,GAArB,EAA0BpB,GAA1B,EAA6BkB,SAA7B,EAAwCE,GAAxC,EAA6CiD,MAA7C,EAAqD,IAArD,EAA2DA,OAAOjD,GAAP,CAA3D;AACH;AACJ;;AAED,oBAAI0D,MAAMC,OAAN,CAAcV,MAAd,CAAJ,EAA2B;AACvBA,2BAAOnC,MAAP,CAAcd,GAAd,EAAmB,CAAnB;AACH,iBAFD,MAEO;AACH,2BAAOiD,OAAOjD,GAAP,CAAP;AACH;;AAED,uBAAO,IAAP;AACH,aAzBD;;AA2BA,gBAAIK,MAAM,SAANA,GAAM,CAAC4C,MAAD,EAASjD,GAAT,EAAiB;AACvB,oBAAIiD,OAAOjD,GAAP,aAAuBiC,QAA3B,EAAqC;;AAEpC,wBAAGgB,OAAO1B,aAAP,CAAqBvB,GAArB,CAAH,EACA;AACC,+BAAOiD,OAAO1B,aAAP,CAAqBvB,GAArB,CAAP;AACA;;AAEEiD,2BAAO1B,aAAP,CAAqBvB,GAArB,IAA4B,YAAW;AACnCiD,+BAAOW,eAAP,GAAyB5D,GAAzB;;AAEAiD,+BAAOxB,WAAP,CAAmBoC,OAAnB,CAA2B7D,GAA3B;AACA;;AAEA;;AAED,6BAAK,IAAIpB,GAAT,IAAcqE,OAAOtB,YAArB,EAAmC;AAC9BsB,mCAAOtB,YAAP,CAAoB/C,GAApB,EAAuBqE,MAAvB,EAA+BjD,GAA/B,EAAoCe,MAApC;AACH;;AAED,4BAAI+C,MAAMb,OAAOjD,GAAP,EAAY+D,KAAZ,CAAkBhD,OAAOiD,SAAzB,EAAoCC,SAApC,CAAV;;AAEA,6BAAK,IAAIrF,GAAT,IAAcqE,OAAOrB,WAArB,EAAkC;AAC9BqB,mCAAOrB,WAAP,CAAmBhD,GAAnB,EAAsBqE,MAAtB,EAA8BjD,GAA9B,EAAmCe,MAAnC;AACH;;AAEDkC,+BAAOW,eAAP,GAAyB,IAAzB;;AAEA;;AAEA;AACA;AACA;;AAEAX,+BAAOxB,WAAP,CAAmByC,KAAnB;AACA;;AAEA,+BAAOJ,GAAP;AACH,qBA9BD;;AAgCA,2BAAOb,OAAO1B,aAAP,CAAqBvB,GAArB,CAAP;AACH;;AAED,oBAAIiD,OAAOjD,GAAP,aAAuBJ,MAA3B,EAAmC;AAC/BxB,6BAASC,YAAT,CAAsB4E,OAAOjD,GAAP,CAAtB;AACH;;AAED;;AAEA,uBAAOiD,OAAOjD,GAAP,CAAP;AACH,aAlDD;;AAoDAe,mBAAOiD,SAAP,GAAmB,IAAIG,KAAJ,CAAUpD,MAAV,EAAkB;AACjCqD,gCAAgBX,GADiB;AAEjCpD,qBAAKA,GAF4B;AAGjC2C,qBAAKA;AAH4B,aAAlB,CAAnB;;AAMA,mBAAOjC,OAAOiD,SAAd;AACH;;;sCACoBjD,M,EAAQ;AACzBA,mBAAOQ,aAAP,GAA0B,EAA1B;AACAR,mBAAOS,gBAAP,GAA0B,EAA1B;AACAT,mBAAOC,aAAP,GAA0B,EAA1B;AACAD,mBAAOY,YAAP,GAA0B,EAA1B;AACAZ,mBAAOa,WAAP,GAA0B,EAA1B;AACAb,mBAAOiD,SAAP,GAA0B,EAA1B;AACA;AACH;;;gCACcjD,M,EAAQsD,I,EACvB;AAAA,gBAD6BC,KAC7B,uEADqC,KACrC;;AACI;;AAEA,gBAAIC,aAAJ;AACA,gBAAIC,YAAYH,KAAKI,KAAL,CAAW,GAAX,CAAhB;AACA,gBAAIC,MAAYF,UAAU,CAAV,CAAhB;;AAEA,mBAAMA,UAAU3B,MAAhB,EACA;AACI,oBAAGyB,SAASE,UAAU3B,MAAV,KAAqB,CAAjC,EACA;AACI,wBAAI8B,MAAM,KAAKtG,YAAL,CAAkB0C,MAAlB,CAAV;;AAEA,2BAAO,CAAC4D,GAAD,EAAMH,UAAUN,KAAV,EAAN,EAAyBQ,GAAzB,CAAP;AACH;;AAEDH,uBAAOC,UAAUN,KAAV,EAAP;;AAEA,oBAAG,CAACK,IAAD,IAASxD,MAAT,IACI,CAACA,OAAOwD,IAAP,CADL,IAEI,EAAExD,OAAOwD,IAAP,aAAwB3E,MAA1B,CAFP,EAGC;AACGmB,2BAAOwD,IAAP,IAAe,EAAf;AACH;;AAEDxD,yBAAS,KAAK1C,YAAL,CAAkB0C,OAAOwD,IAAP,CAAlB,CAAT;AACH;;AAED,mBAAO,CAAC,KAAKlG,YAAL,CAAkB0C,MAAlB,CAAD,EAA4BwD,IAA5B,EAAkCG,GAAlC,CAAP;AACH;;;;;;;;;;;;;;;;;;ICzaQE,K,WAAAA,K;;;;;;;wBAEC5E,G,EAAKqB,K,EAAOwD,M,EACzB;AAAA,OADiCC,MACjC,uEAD0C,UAC1C;;AACC,OAAIC,aAAa,CAAjB;;AAEA,OAAGF,MAAH,EACA;AACCE,iBAAcF,SAAS,IAAV,GAAmB,IAAIG,IAAJ,EAAD,CAAWC,OAAX,EAA/B;AACA;;AAED;AACA;AACA;AACA;AACA;;AAEA,OAAG,CAAC,KAAKH,MAAT,EACA;AACC,SAAKA,MAAL,GAAc,EAAd;AACA;;AAED,OAAG,CAAC,KAAKA,MAAL,CAAYA,MAAZ,CAAJ,EACA;AACC,SAAKA,MAAL,CAAYA,MAAZ,IAAsB,EAAtB;AACA;;AAED,QAAKA,MAAL,CAAYA,MAAZ,EAAoB9E,GAApB,IAA2B,EAAC+E,sBAAD,EAAa1D,YAAb,EAA3B;AACA;;;uBAEWrB,G,EACZ;AAAA,OADiBkF,YACjB,uEADgC,KAChC;AAAA,OADuCJ,MACvC,uEADgD,UAChD;;AACC;AACA;AACA;AACA;;AAEA,OAAG,KAAKA,MAAL,IAAe,KAAKA,MAAL,CAAYA,MAAZ,CAAf,IAAsC,KAAKA,MAAL,CAAYA,MAAZ,EAAoB9E,GAApB,CAAzC,EACA;AACC;AACA,QAAG,KAAK8E,MAAL,CAAYA,MAAZ,EAAoB9E,GAApB,EAAyB+E,UAAzB,IAAuC,CAAvC,IACC,KAAKD,MAAL,CAAYA,MAAZ,EAAoB9E,GAApB,EAAyB+E,UAAzB,GAAuC,IAAIC,IAAJ,EAAD,CAAWC,OAAX,EAD1C,EAEC;AACA,YAAO,KAAKH,MAAL,CAAYA,MAAZ,EAAoB9E,GAApB,EAAyBqB,KAAhC;AACA;AACD;;AAED,UAAO6D,YAAP;AACA;;;;;;;;;;;;;;;;;;;AChDF;;;;IAEaC,M,WAAAA,M;;;;;;;sBAEDC,I,EAAM/D,K,EACjB;AACC8D,UAAOE,GAAP,CAAWD,IAAX,IAAmB/D,KAAnB;AACA;;;sBAEU+D,I,EACX;AACC,UAAOD,OAAOE,GAAP,CAAWD,IAAX,CAAP;AACA;;;0BAEaA,I,EACd;AACC,UAAOD,OAAOE,GAAP,CAAWD,IAAX,CAAP;AACA;;;;;;AACD;;AAEDD,OAAOE,GAAP,GAAaF,OAAOE,GAAP,IAAcjH,mBAASC,YAAT,CAAsB,EAAtB,CAA3B;;AAEA,IAAG5B,OAAO6I,QAAP,CAAgBC,IAAhB,CAAqBC,MAArB,CAA4B,CAA5B,EAA8B,CAA9B,MAAqC,MAAxC,EACA;AACCC,UAASC,MAAT,CAAgBjB,KAAhB,CAAsB,GAAtB,EAA2BrE,GAA3B,CAA+B,aAAK;AAAA,iBAChBuF,EAAElB,KAAF,CAAQ,GAAR,CADgB;AAAA;AAAA,MAC9BzE,GAD8B;AAAA,MACzBqB,KADyB;;AAGnC,MACA;AACCA,WAAQuE,KAAKC,KAAL,CAAWxE,KAAX,CAAR;AACA,GAHD,CAIA,OAAMyE,KAAN,EACA;AACCzE,WAAQA,KAAR;AACA;;AAEDrB,QAAMA,IAAI+F,IAAJ,EAAN;;AAEAZ,SAAOE,GAAP,CAAWW,mBAAmBhG,GAAnB,CAAX,IAAsCqB,KAAtC;AACA;AACA,EAhBD;;AAkBA8D,QAAOE,GAAP,CAAWpG,MAAX,CAAkB,UAACmD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAAa;AAC9BD,IAAED,CAAF,IAAOD,CAAP;;AAEA,MAAGG,CAAH,EACA;AACCD,KAAED,CAAF,IAAO,IAAP;AACA;;AAED,MAAM4D,eAAkBC,mBAAmB7D,CAAnB,CAAlB,SAA2CC,EAAED,CAAF,CAAjD;AACA;AACAoD,WAASC,MAAT,GAAkBO,YAAlB;AACA,EAXD;AAYA;;;;;;;;;;;;;;ICtDYE,G,WAAAA,G;;;;;;;0BAEGC,G,EAAKC,Q,EAAUrH,Q,EAAUsH,S,EAAWC,O,EACnD;AACC,OAAIC,SAAS,EAAb;;AAEA,OAAIC,UAAU,IAAd;;AAEA,OAAGH,SAAH,EACA;AACCG,cAAU,KAAV;AACA;;AAED,OAAIC,QAAQ,KAAZ;;AAEA,OAAIC,aAAalB,SAASmB,gBAAT,CAChBR,GADgB,EAEhBS,WAAWC,QAFK,EAGhB;AACCC,gBAAY,oBAACxC,IAAD,EAAU;AACrB,SAAG,CAACkC,OAAJ,EACA;AACC,UAAGlC,SAAS+B,SAAZ,EACA;AACCG,iBAAU,IAAV;AACA,OAHD,MAKA;AACC,cAAOI,WAAWG,WAAlB;AACA;AACD;AACD,SAAGT,WAAWhC,SAASgC,OAAvB,EACA;AACCG,cAAQ,IAAR;AACA;AACD,SAAGA,KAAH,EACA;AACC,aAAOG,WAAWG,WAAlB;AACA;AACD,SAAGX,QAAH,EACA;AACC;AACA,UAAG9B,gBAAgB0C,OAAnB,EACA;AACC,WAAG1C,KAAK2C,OAAL,CAAab,QAAb,CAAH,EACA;AACC,eAAOQ,WAAWM,aAAlB;AACA;AACD;;AAED,aAAON,WAAWG,WAAlB;AACA;;AAED,YAAOH,WAAWM,aAAlB;AACA;AApCF,IAHgB,EAyChB,KAzCgB,CAAjB;;AA4CA,UAAMR,WAAWS,QAAX,EAAN,EACA;AACCZ,WAAO7F,IAAP,CAAY3B,SAAS2H,WAAWU,WAApB,CAAZ;AACA;;AAED,UAAOb,MAAP;AACA;;;gCACoBJ,G,EAAKhK,K,EAC1B;AACCgK,OAAIkB,aAAJ,CAAkBlL,KAAlB;;AAEA+J,OAAIoB,OAAJ,CAAYnB,GAAZ,EAAiB,KAAjB,EAAwB,UAAC7B,IAAD,EAAU;AACjCA,SAAK+C,aAAL,CAAmBlL,KAAnB;AACA,IAFD;AAGA;;;;;;;;;;;;;;;;;ACzEF;;AACA;;AACA;;;;IAEaoL,K,WAAAA,K;AAEZ,gBAAYC,UAAZ,EACA;AAAA;;AACC,OAAKA,UAAL,GAAkBA,UAAlB;AACA;;;;0BAEOC,M,EACR;AACC,QAAI,IAAI5F,QAAR,IAAoB4F,MAApB,EACA;AACC,QAAIrG,QAAQqG,OAAO5F,QAAP,CAAZ;;AAEA,QAAG4F,OAAO5F,QAAP,aAA4BlC,MAA5B,IACC8H,OAAO5F,QAAP,EAAiBjD,KADlB,IAEC6I,OAAO5F,QAAP,EAAiBhE,QAFrB,EAGC;AACA,SAAI6J,WAAcD,OAAO5F,QAAP,EAAiBjD,KAA/B,UAAyC6I,OAAO5F,QAAP,EAAiB8F,QAA9D;;AAEA,SAAIC,SAASjD,aAAMkD,IAAN,CAAWH,QAAX,EAAqB,KAArB,EAA4B,iBAA5B,CAAb;;AAEAtG,aAAQjD,mBAASC,YAAT,CAAsB,IAAImJ,KAAJ,CAAU,KAAKC,UAAf,CAAtB,CAAR;;AAEA,SAAGI,MAAH,EACA;AACCxG,cAAQwG,MAAR;AACA;;AAEDxG,WAAM0G,OAAN,CAAcL,OAAO5F,QAAP,CAAd;;AAEA8C,kBAAMoD,KAAN,CACCL,QADD,EAEGtG,KAFH,EAGG,CAHH,EAIG,iBAJH;AAMA;;AAED,SAAKS,QAAL,IAAiBT,KAAjB;AACA;AACD;;;;;;;;;;;;;;;;;;;AC5CF;;AACA;;;;IAEa4G,O,WAAAA,O;;;;;;;wBAECnD,M,EAAQ/D,M,EACrB;AACC,OAAImH,aAAa,EAAjB;AACA,OAAIlI,qBAA0B8E,MAA1B,MAAJ;;AAEA,OAAIqD,UAAUC,aAAaC,OAAb,CAAqBrI,GAArB,CAAd;AACA,OAAIsI,eAAJ;;AAEAvH,YAAS3C,mBAASC,YAAT,CAAsB0C,MAAtB,CAAT;;AAEA,OAAIwH,SAASxH,OAAO9B,MAAP,CAAc,UAACmD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAa;AACvC,QAAG0F,WAAW7F,CAAX,CAAH,EACA;AACC,SAAGD,MAAMI,CAAT,EACA;AACC,aAAM0F,WAAW7F,CAAX,EAAcQ,MAApB,EACA;AACCqF,kBAAW7F,CAAX,EAAc3E,GAAd;AACA;AACD;AACD,KATD,MAWA;AACCwK,gBAAW7F,CAAX,IAAgB,EAAhB;AACA;;AAED,QAAG,QAAOD,CAAP,yCAAOA,CAAP,OAAa,QAAhB,EACA;AACC8F,gBAAW7F,CAAX,EAAc1B,IAAd,CAAmBsH,QAAQO,KAAR,CAAiB1D,MAAjB,UAA4BzC,CAA5B,EAAiCD,CAAjC,CAAnB;AACA;;AAEDgG,iBAAaK,OAAb,CAAqBzI,GAArB,EAA0B4F,KAAK8C,SAAL,CAAe3H,MAAf,CAA1B;AAEA,IAvBY,EAuBV,EAACoB,OAAO,CAAR,EAvBU,CAAb;;AAyBA,OAAGmG,SAAS1C,KAAKC,KAAL,CAAWsC,OAAX,CAAZ,EACA;AACC,SAAI,IAAIvJ,CAAR,IAAa0J,MAAb,EACA;AACCvH,YAAOnC,CAAP,IAAY0J,OAAO1J,CAAP,CAAZ;AACA;AACD;;AAED,UAAO,YAAI;AACV2J;AACA,SAAI,IAAI3J,EAAR,IAAasJ,UAAb,EACA;AACC,YAAMA,WAAWtJ,EAAX,EAAciE,MAApB,EACA;AACCqF,iBAAWtJ,EAAX,EAAclB,GAAd;AACA;AACD;AACD0K,iBAAaO,UAAb,CAAwB3I,GAAxB;AACA,IAVD;AAWA;;;;;;;;;;;;;;;;;;;AC3DF;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;AAEA,IAAI4I,UAAU,EAAd;;IAEarL,U;AAEZ,qBAAYmB,GAAZ,EACA;AAAA;;AACC,OAAKA,GAAL,GAAWA,GAAX;AACA;;;;sBAEGtB,E,EACJ;AAAA;;AAAA,OADQc,OACR,uEADkB,KAClB;AAAA,OADyBC,IACzB,uEADgC,EAChC;;AACC,OAAI0K,cAAc,KAAKnK,GAAL,GAAW,GAAX,GAAiBtB,EAAnC;;AAEA,OAAIyK,SAASjD,aAAMkD,IAAN,CACZe,cAAcxL,eAAOyL,aAAP,CACbzL,eAAO0L,SAAP,CAAiB5K,IAAjB,CADa,EAEX,IAFW,CADF,EAKV,KALU,EAMV,gBANU,CAAb;;AASA,OAAG,CAACD,OAAD,IAAY2J,MAAf,EACA;AACC,WAAOtJ,QAAQC,OAAR,CAAgBqJ,MAAhB,CAAP;AACA;;AAED,UAAOtK,WAAWkB,OAAX,CAAmBoK,WAAnB,EAAgC1K,IAAhC,EAAsCnB,IAAtC,CAA2C,UAACC,QAAD,EAAc;AAC/D,WAAO,MAAK+L,YAAL,CAAkB/L,SAASE,IAA3B,CAAP;AACA,IAFM,CAAP;AAGA;;;yBAGD;AAAA;;AAAA,OADK8L,KACL,uEADY,CACZ;;AAAA,OADe9K,IACf;;AACC,UAAOZ,WAAWkB,OAAX,CAAmB,KAAKC,GAAxB,EAA6BP,IAA7B,EAAmCnB,IAAnC,CAAwC,UAACC,QAAD,EAAc;AAC5D,QAAIiM,UAAU,EAAd;;AAEA,SAAI,IAAItK,CAAR,IAAa3B,SAASE,IAAtB,EACA;AACC,SAAIgM,SAASlM,SAASE,IAAT,CAAcyB,CAAd,CAAb;;AAEAsK,aAAQvI,IAAR,CAAa,OAAKqI,YAAL,CAAkBG,MAAlB,CAAb;AACA;;AAEDlM,aAASE,IAAT,GAAgB+L,OAAhB;;AAEA,WAAOjM,QAAP;AACA,IAbM,CAAP;AAcA;;;yBAGD;AAAA,OADKa,QACL,uEADgB,IAChB;AAAA,OADsBsL,IACtB,uEAD6B,IAC7B;AAAA,OADmCC,YACnC,uEADkD,EAClD;;AACC,OAAIR,cAAc,KAAKnK,GAAL,GAAW,SAA7B;;AAEA,OAAGZ,QAAH,EACA;AACC+K,kBAAc,KAAKnK,GAAL,GAAW,GAAX,GAAiBZ,QAAjB,GAA4B,OAA1C;AACA;;AAED;;AAEA,OAAG,CAACsL,IAAJ,EACA;AACC,WAAO7L,WAAWkB,OAAX,CAAmBoK,WAAnB,EAAgC7L,IAAhC,CAAqC,UAACC,QAAD,EAAc;AACzD,SAAIqM,OAAQ,IAAIC,UAAJ,CAAStM,SAASkC,IAAT,CAAcmK,IAAvB,EAA6BD,YAA7B,CAAZ;AACA;;AAEA,YAAO,IAAIG,wBAAJ,CAAgBF,IAAhB,EAAsBT,WAAtB,EAAmC,MAAnC,EAA2CQ,YAA3C,CAAP;AACA,KALM,CAAP;AAMA,IARD,MAUA;AACC,WAAO9L,WAAWkB,OAAX,CACNoK,WADM,EAEJ,EAACY,KAAK,MAAN,EAFI,EAGJL,IAHI,EAILpM,IAJK,CAIA,UAACC,QAAD,EAAc;AACpB,YAAOA,SAASE,IAAhB;AACA,KANM,CAAP;AAOA;AACD;;;+BAEYuM,O,EACb;AACC,OAAIC,QAAQvL,mBAASC,YAAT,CAAsB,IAAImJ,YAAJ,CAAU,IAAV,CAAtB,CAAZ;;AAEAmC,SAAM5B,OAAN,CAAc2B,OAAd;;AAEA,OAAIb,cAAc,KAAKnK,GAAL,GAAW,GAAX,GAAiBiL,MAAM7L,QAAzC;;AAEA8G,gBAAMoD,KAAN,CACCa,WADD,EAEGc,KAFH,EAGG,EAHH,EAIG,gBAJH;;AAOA,OAAGA,MAAM9K,KAAT,EACA;AACC,QAAI8I,WAAcgC,MAAM9K,KAApB,UAA8B8K,MAAM/B,QAAxC;;AAEA,QAAIC,SAASjD,aAAMkD,IAAN,CAAWH,QAAX,EAAqB,KAArB,EAA4B,iBAA5B,CAAb;;AAEA;AACA;AACA;AACA;AACA;;AAEA/C,iBAAMoD,KAAN,CACCL,QADD,EAEGgC,KAFH,EAGG,EAHH,EAIG,iBAJH;AAMA;;AAED,UAAOA,KAAP;AACA;;;6BAM2C;AAAA,OAA5BxL,IAA4B,uEAArB,EAAqB;AAAA,OAAjBD,OAAiB,uEAAP,KAAO;;AAC3C,UAAO,KAAKO,OAAL,CAAa,KAAKC,GAAlB,EAAuBP,IAAvB,EAA6BnB,IAA7B,CAAkC,UAACC,QAAD,EAAc;AACtD,WAAOA,QAAP;AACA;AACA,IAHM,CAAP;AAIA;;;2BACeyB,G,EAAKe,O,EACrB;AACC;AACA;;;uBACWrC,E,EAAqB;AAAA,OAAjBc,OAAiB,uEAAP,KAAO;;AAChC,QAAK0K,OAAL,GAAyB,KAAKA,OAAL,IAA0B,EAAnD;AACA,QAAKA,OAAL,CAAa,KAAKlK,GAAlB,IAAyB,KAAKkK,OAAL,CAAa,KAAKlK,GAAlB,KAA0B,EAAnD;;AAEA,OAAG,KAAKkK,OAAL,CAAa,KAAKlK,GAAlB,EAAuBtB,EAAvB,CAAH,EAA+B;AAC9B,WAAOmB,QAAQC,OAAR,CAAgB,KAAKoK,OAAL,CAAa,KAAKlK,GAAlB,EAAuBtB,EAAvB,CAAhB,CAAP;AACA;;AAED,UAAO,KAAKqB,OAAL,CAAa,KAAKC,GAAL,GAAW,GAAX,GAAiBtB,EAA9B,EAAkCJ,IAAlC,CAAuC,UAACC,QAAD,EAAc;AAC3D;AACA;AACA,IAHM,CAAP;AAIA;;;yBACsB;AAAA,OAAXG,EAAW,uEAAN,IAAM;;AACtB,OAAIsB,MAAM,KAAKA,GAAL,GAAW,GAAX,GAAiB,QAA3B;AACA,OAAGtB,EAAH,EAAO;AACNsB,UAAM,KAAKA,GAAL,GAAW,GAAX,GAAiBtB,EAAjB,GAAsB,OAA5B;AACA;AACD,UAAO,KAAKqB,OAAL,CAAaC,GAAb,EAAkB1B,IAAlB,CAAuB,UAAC4M,QAAD,EAAc;AAC3C,WAAOA,QAAP;AACA,IAFM,CAAP;AAGA;;;+BACmB;AACnB,OAAG,KAAKhB,OAAL,IAAgB,KAAKA,OAAL,CAAa,KAAKlK,GAAlB,CAAnB,EAA2C;AAC1C,SAAKkK,OAAL,CAAa,KAAKlK,GAAlB,IAAyB,EAAzB;AACA;AACD;;;yBAEaiG,G,EACd;AAAA,OADmBkF,SACnB,uEAD+B,IAC/B;AAAA,OADqCC,QACrC,uEADgD,IAChD;;AACC,OAAG,CAACA,QAAJ,EACA;AACCA,eAAW,IAAIC,QAAJ,EAAX;AACA;;AAED,QAAI,IAAInL,CAAR,IAAa+F,GAAb,EACA;AACC,QAAIqF,KAAKpL,CAAT;;AAEA,QAAGiL,SAAH,EACA;AACCG,UAAQH,SAAR,SAAqBG,EAArB;AACA;;AAED,QAAGrF,IAAI/F,CAAJ,KAAU,QAAO+F,IAAI/F,CAAJ,CAAP,MAAkB,QAA/B,EACA;AACCkL,cAASG,MAAT,CAAgBD,EAAhB,EAAoBrF,IAAI/F,CAAJ,CAApB;AACA,KAHD,MAKA;AACC,UAAKsL,MAAL,CAAYvF,IAAI/F,CAAJ,CAAZ,EAAoBoL,EAApB,EAAwBF,QAAxB;AACA;AACD;;AAED,UAAOA,QAAP;AACA;;;6BAEiB9K,Q,EAClB;AACC,OAAG,CAAC,KAAKmL,WAAT,EACA;AACC,SAAKA,WAAL,GAAmB,IAAI7K,QAAJ,EAAnB;AACA;;AAED,UAAO,KAAK6K,WAAL,CAAiB5J,GAAjB,CAAqBvB,QAArB,CAAP;AACA;;;0BAEcN,G,EAA2D;AAAA,OAAtDP,IAAsD,uEAA/C,IAA+C;AAAA,OAAzCiM,IAAyC,uEAAlC,IAAkC;;AAAA;;AAAA,OAA5BC,KAA4B,uEAApB,IAAoB;AAAA,OAAdtI,OAAc,uEAAJ,EAAI;;AACzE,OAAIuI,OAAc,KAAlB;AACA,OAAIC,cAAc,EAAlB;AACA,OAAIT,WAAc,IAAlB;AACA,OAAIU,YAAc,EAAlB;;AAEA,OAAGrM,IAAH,EAAS;AACRqM,gBAAYrM,IAAZ;AACA;;AAED,OAAG,CAAC,KAAKgM,WAAT,EACA;AACC,SAAKA,WAAL,GAAmB,IAAI7K,QAAJ,EAAnB;AACA;;AAEDkL,aAAUf,GAAV,GAAgBe,UAAUf,GAAV,IAAiB,MAAjC;;AAEAc,iBAAc3K,OAAOO,IAAP,CAAYqK,SAAZ,EAAuBpK,GAAvB,CAA2B,UAACqK,GAAD,EAAS;AACjD,WAAOvE,mBAAmBuE,GAAnB,IACL,GADK,GAELvE,mBAAmBsE,UAAUC,GAAV,CAAnB,CAFF;AAGA,IAJa,EAIXC,IAJW,CAIN,GAJM,CAAd;;AAMA,OAAIC,UAAajM,GAAjB;AACA;;AAEA,OAAG0L,IAAH,EAAS;AACRC,YAAQ,KAAR;AACAC,WAAO,MAAP;AACA,QAAGF,gBAAgBL,QAAnB,EACA;AACCD,gBAAWM,IAAX;AACA,KAHD,MAKA;AACCN,gBAAW,KAAKI,MAAL,CAAYE,IAAZ,CAAX;AACA;AACD;AACA;AACA;AACA;AACA;AACA;;AAEDO,aAAUjM,MAAM,GAAN,GAAY6L,WAAtB;;AAEA,OAAIK,MAAM,IAAIC,cAAJ,EAAV;;AAEA,OAAG,kBAAkB9I,OAArB,EACA;AACC6I,QAAIE,YAAJ,GAAmB/I,QAAQ+I,YAA3B;AACA;;AAED,OAAG,CAACV,IAAD,IAASC,KAAT,IAAkB,KAAKA,KAAvB,IAAgC,KAAKA,KAAL,CAAWM,OAAX,CAAnC,EAAwD;AACvD,WAAOpM,QAAQC,OAAR,CAAgB,KAAK6L,KAAL,CAAWM,OAAX,CAAhB,CAAP;AACA;;AAED,OAAII,mBAAmB,sBACpBJ,OADoB,GAEpB,IAFH;;AAIA,OAAIK,WAAWvF,SAASwF,aAAT,CAAuBF,gBAAvB,CAAf;;AAEA,OAAG,CAACX,IAAD,IAASC,KAAT,IAAkBW,QAArB,EAA+B;AAC9B,QAAIE,kBAAkBtF,KAAKC,KAAL,CAAWmF,SAASG,SAApB,CAAtB;;AAEA,WAAO5M,QAAQC,OAAR,CAAgB0M,eAAhB,CAAP;AACA;;AAEDN,OAAIQ,eAAJ,GAAsB,IAAtB;AACAR,OAAIS,OAAJ,GAAsB,KAAtB;;AAEA,OAAIC,QAAQ,KAAKC,IAAL,CAAU1I,MAAtB;;AAEA,OAAG,CAACuH,IAAJ,EAAU;AACT,SAAKmB,IAAL,CAAU5K,IAAV,CAAeiK,GAAf;AACA;;AAED,UAAO,IAAIrM,OAAJ,CAAa,UAAC+M,KAAD;AAAA,WAAW,UAAC9M,OAAD,EAAUgN,MAAV,EAAqB;AACnDZ,SAAIa,kBAAJ,GAAyB,YAAM;AAC9B,UAAIC,OAAO,CAAX;AACA,UAAIC,KAAK,GAAT;;AAEA,UAAI1O,iBAAJ;;AAEA,UAAI2N,IAAIgB,UAAJ,KAAmBF,IAAvB,EAA6B;;AAE5B,WAAG,CAAC,OAAKrB,KAAT,EAAgB;AACf,eAAKA,KAAL,GAAa,EAAb;AACA;;AAED,WAAIO,IAAIiB,MAAJ,KAAeF,EAAnB,EAAuB;;AAEtB,YAAGf,IAAIkB,iBAAJ,CAAsB,cAAtB,KAAyC,kBAAzC,IACClB,IAAIkB,iBAAJ,CAAsB,cAAtB,KAAyC,iCAD1C,IAEClB,IAAIkB,iBAAJ,CAAsB,cAAtB,KAAyC,WAF1C,IAGClB,IAAIkB,iBAAJ,CAAsB,cAAtB,KAAyC,0BAH7C,EAIE;AACD7O,oBAAW2I,KAAKC,KAAL,CAAW+E,IAAImB,YAAf,CAAX;AACA,aAAG9O,SAAS+O,IAAT,IAAiB,CAApB,EAAuB;AACtB;;AAEA,cAAG,CAAC5B,IAAD,IAASC,KAAZ,EAAmB;AAClB;AACA;;AAED,cAAIW,YAAWvF,SAASwF,aAAT,CACd,sBACEN,OADF,GAEE,IAHY,CAAf;;AAMA,cAAIsB,eAAgBxP,OAAO6B,WAA3B;;AAEA,cAAG2N,YAAH,EACA;AACC,eAAG,CAACjB,SAAJ,EACA;AACCA,wBAAYvF,SAASyG,aAAT,CAAuB,QAAvB,CAAZ;AACAlB,sBAASV,IAAT,GAAgB,WAAhB;AACAU,sBAASmB,YAAT,CAAsB,UAAtB,EAAkCxB,OAAlC;AACAlF,qBAAS2G,IAAT,CAAcC,WAAd,CAA0BrB,SAA1B;AACA;;AAED;;AAEAA,qBAASG,SAAT,GAAqBvF,KAAK8C,SAAL,CAAezL,QAAf,CAArB;AACA;;AAED,cAAIiC,aAAa,OAAKiL,WAAL,CAAiB1J,KAAjB,EAAjB;;AAEA,eAAI,IAAI7B,CAAR,IAAaM,UAAb,EACA;AACCA,sBAAWN,CAAX,EAAc3B,QAAd,EAAwB,IAAxB;AACA;;AAEDuB,kBAAQvB,QAAR;AACA,UAtCD,MAuCK;AACJ,cAAG,CAACmN,IAAD,IAASC,KAAZ,EAAmB;AAClB;AACA;;AAED,cAAInL,cAAa,OAAKiL,WAAL,CAAiB1J,KAAjB,EAAjB;;AAEA,eAAI,IAAI7B,EAAR,IAAaM,WAAb,EACA;AACCA,uBAAWN,EAAX,EAAc3B,QAAd,EAAwB,IAAxB;AACA;;AAEDuO,iBAAOvO,QAAP;AACA;AACD,SA3DD,MA4DK;AACJ;;AAEA,aAAG,CAACmN,IAAD,IAASC,KAAZ,EAAmB;AAClB;AACA;;AAED,aAAInL,eAAa,OAAKiL,WAAL,CAAiB1J,KAAjB,EAAjB;;AAEA,cAAI,IAAI7B,GAAR,IAAaM,YAAb,EACA;AACCA,uBAAWN,GAAX,EAAcgM,GAAd,EAAmB,IAAnB;AACA;;AAEDpM,iBAAQoM,GAAR;AACA;AACD,QA9ED,MA+EK;AACJY,eAAO,SAASZ,IAAIiB,MAApB;AACA;AACD,cAAKN,IAAL,CAAUD,KAAV,IAAmB,IAAnB;AACA;AACD,MAhGD;;AAkGAV,SAAIlO,IAAJ,CAAS4N,IAAT,EAAeK,OAAf,EAAwB,IAAxB;;AAEA;AACA;AACA;AACA;AACAC,SAAI0B,IAAJ,CAASxC,QAAT;AACA,KA1GmB;AAAA,IAAD,CA0GhBwB,KA1GgB,CAAZ,CAAP;AA2GA;;;2BACe;AACf,QAAI,IAAI1M,CAAR,IAAa,KAAK2M,IAAlB,EAAwB;AACvB,QAAG,CAAC,KAAKA,IAAL,CAAU3M,CAAV,CAAJ,EAAkB;AACjB;AACA;AACD,SAAK2M,IAAL,CAAU3M,CAAV,EAAa2N,KAAb;AACA;AACD,QAAKC,OAAL,GAAe,EAAf;AACA;;;sBAnRgB;AAChB,UAAO,KAAKA,OAAL,GAAe,KAAKA,OAAL,IAAgB,EAAtC;AACA;;;;;;AAoRF;;;;;;;;;;;;;;;;ACvZA;;AACA;;AACA;;;;IAEanP,M,WAAAA,M;;;;;;;uBACAoP,I,EACZ;AAAA;;AAAA,OADkBrQ,KAClB,uEAD0B,kBAC1B;AAAA,OAD8CmI,IAC9C,uEADqDkB,QACrD;;AACClB,QAAKmI,gBAAL,CAAsBtQ,KAAtB,EAA6B,YAAM;AAClC,UAAKuQ,MAAL,CAAYF,IAAZ;AACA,IAFD;AAGA;;;yBACaG,Q,EACd;AAAA;;AACC,OAAIC,eAAoB,CAACvH,SAASwH,QAAT,EAAD,CAAxB;AACA,OAAIC,oBAAoBC,QAAQnK,MAAhC;;AAEA,OAAIoK,QAAQ3H,SAAS4H,QAAT,GAAoB5H,SAAS6H,MAAzC;;AAEA,OAAG7H,SAAS8H,IAAZ,EACA;AACCH,aAAS3H,SAAS8H,IAAlB;AACA;;AAED3Q,UAAOiQ,gBAAP,CACC,UADD,EAEG,UAACtQ,KAAD,EAAW;AACZA,UAAMG,cAAN;;AAEA,QAAGsQ,aAAahK,MAAb,IAAuBkK,qBAAqBC,QAAQnK,MAAvD,EACA;AACC,SAAGyC,SAASwH,QAAT,MAAuBD,aAAaA,aAAahK,MAAb,GAAsB,CAAnC,CAA1B,EACA;AACCgK,mBAAanP,GAAb;AACA,MAHD,MAKA;AACCmP,mBAAalM,IAAb,CAAkB2E,SAASwH,QAAT,EAAlB;AACA;AACD,KAVD,MAYA;AACCD,kBAAalM,IAAb,CAAkB2E,SAASwH,QAAT,EAAlB;AACAC,yBAAoBC,QAAQnK,MAA5B;AACA;;AAED,WAAKwK,KAAL,CAAW/H,SAAS4H,QAApB,EAA8BN,QAA9B;AACA,IAvBF;;AA0BA,QAAKU,EAAL,CAAQL,KAAR;AACA;;;qBACSA,K,EAAOM,M,EACjB;AACC9H,YAAS7H,KAAT,GAAiB5B,eAAO4B,KAAxB;AACA6E,cACC,YAAM;AACLuK,YAAQQ,SAAR,CAAkB,IAAlB,EAAwB,IAAxB,EAA8BP,KAA9B;;AAEA,QAAG,CAACM,MAAJ,EACA;AACC9Q,YAAO6K,aAAP,CAAqB,IAAImG,KAAJ,CAAU,UAAV,CAArB;;AAEA,SAAGR,MAAM/J,SAAN,CAAgB,CAAhB,EAAkB,CAAlB,MAAyB,GAA5B,EACA;AACCzG,aAAO6K,aAAP,CAAqB,IAAIoG,eAAJ,CACpB,YADoB,CAArB;AAGA;AAED;AACD,IAhBF,EAiBG,CAjBH;AAmBA;;;wBACYrJ,I,EAAMoI,I,EACnB;AAAA;;AAAA,OADyBkB,YACzB,uEADwC,KACxC;;AACC,OAAG,KAAKtJ,IAAL,IAAaA,IAAb,IAAqB,CAACsJ,YAAzB,EACA;AACC;AACA;;AAED,OAAIC,aAAa,IAAIC,WAAJ,CAAgB,cAAhB,EAAgC;AAChDC,gBAAY,IADoC;AAE9CC,YAAU,EAACvH,cAAD,EAASnC,UAAT,EAAeoI,UAAf;AAFoC,IAAhC,CAAjB;;AAKA,OAAI1N,UAAU0N,KAAKtO,IAAL,CAAUsB,OAAxB;AACA,OAAIuO,SAAUvB,KAAKuB,MAAnB;;AAEA,QAAK3J,IAAL,GAAcA,IAAd;AACA,QAAK4J,KAAL,GAAc,EAAd;;AAEA,OAAIA,QAAU,IAAIC,eAAJ,CAAoB5I,SAAS6H,MAA7B,CAAd;;AAEA,QAAK5C,WAAL,GAAmBjF,SAAS6H,MAA5B;;AAnBD;AAAA;AAAA;;AAAA;AAqBC,yBAAgBc,KAAhB,8HAAuB;AAAA,SAAfE,IAAe;;AACtB,UAAKF,KAAL,CAAYE,KAAK,CAAL,CAAZ,IAAwBA,KAAK,CAAL,CAAxB;AACA;AAvBF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAyBC,OAAIhQ,OAAO,EAAX;AAAA,OAAeiQ,WAAW,KAA1B;AAAA,OAAiC5H,SAAS,EAA1C;;AAEAnC,UAAOA,KAAKmB,MAAL,CAAY,CAAZ,EAAef,KAAf,CAAqB,GAArB,CAAP;;AAEA,QAAI,IAAI7F,CAAR,IAAa,KAAKqP,KAAlB,EACA;AACC9P,SAAKS,CAAL,IAAU,KAAKqP,KAAL,CAAWrP,CAAX,CAAV;AACA;;AAEDyP,OAAI,KAAI,IAAIzP,EAAR,IAAaoP,MAAb,EACJ;AACC,QAAIf,QAAQrO,GAAE6F,KAAF,CAAQ,GAAR,CAAZ;AACA,QAAGwI,MAAMpK,MAAN,GAAewB,KAAKxB,MAAvB,EACA;AACC;AACA;;AAEDyL,QAAI,KAAI,IAAIvL,CAAR,IAAakK,KAAb,EACJ;AACC,SAAGA,MAAMlK,CAAN,EAASyC,MAAT,CAAgB,CAAhB,EAAmB,CAAnB,KAAyB,GAA5B,EAAiC;AAChC,UAAI+I,UAAU,IAAd;AACA,UAAIC,SAAU,aAAaC,IAAb,CAAkBxB,MAAMlK,CAAN,CAAlB,CAAd;AACA,UAAGyL,UAAUA,OAAO,CAAP,CAAb,EAAwB;AACvBD,iBAAUC,OAAO,CAAP,CAAV;AACA;AACD,UAAG,CAACD,OAAJ,EAAa;AACZ,aAAM,IAAI1O,KAAJ,CAAaoN,MAAMlK,CAAN,CAAb,mDAAmEnE,EAAnE,OAAN;AACA;AACD,UAAG,CAACyF,KAAKtB,CAAL,CAAJ,EAAa;AACZ,WAAGkK,MAAMlK,CAAN,EAASyC,MAAT,CAAgByH,MAAMlK,CAAN,EAASF,MAAT,GAAkB,CAAlC,EAAqC,CAArC,KAA2C,GAA9C,EAAmD;AAClD1E,aAAMoQ,OAAN,IAAkB,EAAlB;AACA,QAFD,MAGK;AACJ,iBAASF,EAAT;AACA;AACD,OAPD,MAQK;AACJlQ,YAAMoQ,OAAN,IAAkBlK,KAAKtB,CAAL,CAAlB;AACA;AACD,MApBD,MAqBK,IAAGsB,KAAKtB,CAAL,MAAYkK,MAAMlK,CAAN,CAAf,EAAyB;AAC7B,eAASsL,EAAT;AACA;AACD;;AAED,QAAG,CAACV,YAAD,IACC5O,OADD,IAEEiP,OAAOpP,EAAP,aAAqBgB,MAFvB,IAGEb,mBAAmBiP,OAAOpP,EAAP,CAHrB,IAIC,EAAEoP,OAAOpP,EAAP,aAAqBL,OAAvB,CAJD,IAKCQ,QAAQ2P,MAAR,CAAevQ,IAAf,CALJ,EAME;AACDsO,UAAKtO,IAAL,CAAUsB,OAAV,GAAoBV,OAApB;;AAEA,YAAO,IAAP;AACA;;AAEDqP,eAAWxP,EAAX;AACA4H,aAAWwH,OAAOpP,EAAP,CAAX;;AAEA;AACA;;AAED6G,YAAS6B,aAAT,CAAuBsG,UAAvB;;AAEA,OAAGQ,YAAYJ,MAAZ,IACCA,OAAOI,QAAP,aAA4BxO,MAD7B,IAECoO,OAAOI,QAAP,EAAiBO,MAFlB,IAGCX,OAAOI,QAAP,EAAiBO,MAAjB,EAHJ,EAIC;AACAnI,aAAS,IAAIwH,OAAOI,QAAP,CAAJ,CAAqBjQ,IAArB,CAAT;;AAEAqI,WAAOoI,IAAP,GAAc;AAAA,YAAInC,IAAJ;AAAA,KAAd;AACA,IARD,MASK,IAAGuB,OAAOI,QAAP,aAA4BnM,QAA/B,EACL;AACCuE,aAAS,EAAT;;AAEA,QAAMqI,UAAUb,OAAOI,QAAP,EAAiBjQ,IAAjB,CAAhB;;AAEA,QAAG0Q,mBAAmBtQ,OAAtB,EACA;AACCiI,cAAS,KAAT;;AAEAqI,aAAQ7R,IAAR,CAAa,aAAG;AACf,aAAK0R,MAAL,CAAYjC,IAAZ,EAAkBpI,IAAlB,EAAwByK,CAAxB;AACA,MAFD,EAEGC,KAFH,CAES,aAAG;AACX,aAAKL,MAAL,CAAYjC,IAAZ,EAAkBpI,IAAlB,EAAwByK,CAAxB;AACA,MAJD;AAKA,KATD,MAWA;AACCtI,cAASqI,OAAT;AACA;AACD,IApBI,MAqBA,IAAGb,OAAOI,QAAP,aAA4B7P,OAA/B,EACL;AACCiI,aAAS,KAAT;;AAEAwH,WAAOI,QAAP,EAAiBpR,IAAjB,CAAsB,aAAK;AAC1B,YAAK0R,MAAL,CAAYjC,IAAZ,EAAkBpI,IAAlB,EAAwByK,CAAxB;AACA,KAFD,EAEGC,KAFH,CAES,aAAG;AACX,YAAKL,MAAL,CAAYjC,IAAZ,EAAkBpI,IAAlB,EAAwByK,CAAxB;AACA,KAJD;AAKA,IATI,MAUA,IAAGd,OAAOI,QAAP,aAA4BxO,MAA/B,EACL;AACC4G,aAAS,IAAIwH,OAAOI,QAAP,CAAJ,CAAqBjQ,IAArB,CAAT;AACA,IAHI,MAIA,IAAG,OAAO6P,OAAOI,QAAP,CAAP,IAA2B,QAA9B,EACL;AACC5H,aAASwH,OAAOI,QAAP,CAAT;AACA;;AAED,QAAKM,MAAL,CAAYjC,IAAZ,EAAkBpI,IAAlB,EAAwBmC,MAAxB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAGA,kBAAkBvI,UAArB,EACA;AACCuI,WAAOwI,KAAP,CAAa,KAAb;;AAEAxI,WAAOkI,MAAP,CAAcvQ,IAAd,EAAoBwP,YAApB;AACA;;AAED,UAAOS,aAAa,KAApB;AACA;;;yBAEa3B,I,EAAMpI,I,EAAMmC,M,EAC1B;AACC,OAAIpK,QAAQ,IAAIyR,WAAJ,CAAgB,SAAhB,EAA2B;AACtCC,gBAAY,IAD0B;AAEpCC,YAAU,EAACvH,cAAD,EAASnC,UAAT,EAAeoI,UAAf;AAF0B,IAA3B,CAAZ;;AAKA,OAAIwC,WAAW,IAAIpB,WAAJ,CAAgB,YAAhB,EAA8B;AAC5CC,gBAAY,IADgC;AAE1CC,YAAU,EAACvH,cAAD,EAASnC,UAAT,EAAeoI,UAAf;AAFgC,IAA9B,CAAf;;AAKA,OAAGjG,WAAW,KAAd,EACA;AACC,QAAGiG,KAAKtO,IAAL,CAAUsB,OAAV,YAA6BxB,UAAhC,EACA;AACC;AACAwO,UAAKtO,IAAL,CAAUsB,OAAV,CAAkBe,MAAlB;AACA;;AAED,QAAGiF,SAAS6B,aAAT,CAAuBlL,KAAvB,CAAH,EACA;AACCqQ,UAAKtO,IAAL,CAAUsB,OAAV,GAAoB+G,MAApB;AACA;;AAEDf,aAAS6B,aAAT,CAAuB2H,QAAvB;AACA;AACD;;;+BACmB;AACnB;AACA;;;8BAED;AAAA,OADiB9Q,IACjB,uEADwB,EACxB;;AACC,OAAI+Q,SAAY,IAAIhB,eAAJ,CAAoB5I,SAAS6H,MAA7B,CAAhB;AACA,OAAIgC,YAAY,EAAhB;AACA,OAAIlB,QAAY,EAAhB;;AAHD;AAAA;AAAA;;AAAA;AAKC,0BAAgBiB,MAAhB,mIAAwB;AAAA,SAAhBf,IAAgB;;AACvBF,WAAOE,KAAK,CAAL,CAAP,IAAmBA,KAAK,CAAL,CAAnB;AACA;AAPF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AASC,QAAI,IAAIvP,CAAR,IAAaqP,KAAb,EACA;AACCkB,cAAUvQ,CAAV,IAAeqP,MAAMrP,CAAN,CAAf;AACA;;AAED,QAAI,IAAIA,GAAR,IAAaT,IAAb,EACA;AACCgR,cAAUvQ,GAAV,IAAeT,KAAKS,GAAL,CAAf;AACA;;AAED,UAAOuQ,UAAU,KAAV,CAAP;;AAEA,UAAOA,SAAP;AACA;;;kCAED;AAAA,OADqBhR,IACrB,uEAD4B,EAC5B;AAAA,OADgCiR,KAChC,uEADwC,KACxC;;AACC,OAAIC,QAAQ,EAAZ;AAAA,OAAgBF,YAAYhR,IAA5B;;AAEA,OAAG,CAACiR,KAAJ,EACA;AACCD,gBAAY,KAAKpG,SAAL,CAAe5K,IAAf,CAAZ;AACA;;AAED,QAAI,IAAIS,CAAR,IAAauQ,SAAb,EACA;AACC,QAAGA,UAAUvQ,CAAV,MAAiB,EAApB,EACA;AACC;AACA;AACDyQ,UAAM1O,IAAN,CAAW/B,IAAI,GAAJ,GAAUsH,mBAAmBiJ,UAAUvQ,CAAV,CAAnB,CAArB;AACA;;AAED,UAAOyQ,MAAM3E,IAAN,CAAW,GAAX,CAAP;AACA;;;2BACetF,I,EAAM/D,K,EAAOkM,M,EAC7B;AACC,OAAIpP,OAAO,EAAX;;AAEAA,QAAKiH,IAAL,IAAa/D,KAAb;;AAEA,QAAKiM,EAAL,CACC,KAAKjJ,IAAL,GACG,GADH,GAEG,KAAKyE,aAAL,CAAmB3K,IAAnB,CAHJ,EAIGoP,MAJH;AAMA;;;;;;;;;;;;;;;;;ACvUF;;AACA;;AACA;;;;IAEa+B,O,WAAAA,O;;;;;;;sBAgCRjJ,Q,EAAUrH,Q,EACd;AACC,QAAKuQ,KAAL,GAAa,KAAKA,KAAL,IACT,EADJ;AAEA,QAAKA,KAAL,CAAWlJ,QAAX,IAAuB,KAAKkJ,KAAL,CAAWlJ,QAAX,KACnB,EADJ;;AAGA,QAAKkJ,KAAL,CAAWlJ,QAAX,EAAqB1F,IAArB,CAA0B3B,QAA1B;;AAEA,UAAO,IAAP;AACA;;;0BAGD;AAAA,OADMoH,GACN,uEADYX,QACZ;AAAA,OADsBgH,IACtB,uEAD6B,IAC7B;;AACC6C,WAAQvL,KAAR,CAAcqC,GAAd,EAAmBqG,IAAnB;;AAEA,QAAI,IAAIpG,QAAR,IAAoB,KAAKkJ,KAAzB,EACA;AACC,SAAI,IAAI3Q,CAAR,IAAa,KAAK2Q,KAAL,CAAWlJ,QAAX,CAAb,EACA;AACC,SAAMrH,WAAW,KAAKuQ,KAAL,CAAWlJ,QAAX,EAAqBzH,CAArB,CAAjB;AACA,SAAM4Q,UAAWF,QAAQG,IAAR,CAAarJ,GAAb,EAAkBpH,QAAlB,EAA4ByN,IAA5B,CAAjB;AACA,SAAMiD,QAAWtJ,IAAIuJ,gBAAJ,CAAqBtJ,QAArB,CAAjB;;AAHD;AAAA;AAAA;;AAAA;AAKC,2BAAgBqJ,KAAhB,8HACA;AAAA,WADQnL,IACR;;AACCiL,eAAQjL,IAAR;AACA;AARF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASC;AACD;AACD;;;sBA5DU8B,Q,EAAUrH,Q,EACrB;AACC,QAAK4Q,WAAL,GAAmB,KAAKA,WAAL,IACf,EADJ;AAEA,QAAKA,WAAL,CAAiBvJ,QAAjB,IAA6B,KAAKuJ,WAAL,CAAiBvJ,QAAjB,KACzB,EADJ;;AAGA,QAAKuJ,WAAL,CAAiBvJ,QAAjB,EAA2B1F,IAA3B,CAAgC3B,QAAhC;;AAEA,UAAO,IAAP;AACA;;;0BAGD;AAAA,OADaoH,GACb,uEADmBX,QACnB;AAAA,OAD6BgH,IAC7B,uEADoC,IACpC;;AACC,QAAI,IAAIpG,QAAR,IAAoB,KAAKuJ,WAAzB,EACA;AACC,SAAI,IAAIhR,CAAR,IAAa,KAAKgR,WAAL,CAAiBvJ,QAAjB,CAAb,EACA;AACC,SAAMrH,WAAW,KAAK4Q,WAAL,CAAiBvJ,QAAjB,EAA2BzH,CAA3B,CAAjB;AACA,SAAM4Q,UAAW,KAAKC,IAAL,CAAUrJ,GAAV,EAAepH,QAAf,EAAyByN,IAAzB,CAAjB;AACA,SAAMiD,QAAWtJ,IAAIuJ,gBAAJ,CAAqBtJ,QAArB,CAAjB;;AAHD;AAAA;AAAA;;AAAA;AAKC,4BAAgBqJ,KAAhB,mIACA;AAAA,WADQnL,IACR;;AACCiL,eAAQjL,IAAR;AACA;AARF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASC;AACD;AACD;;;yBAmCD;AAAA;;AAAA,OADYnI,KACZ,uEADoB,kBACpB;AAAA,OADwCmI,IACxC,uEAD+CkB,QAC/C;;AACC,OAAIoK,WAAY,UAACzT,KAAD,EAAQmI,IAAR;AAAA,WAAiB,YAAM;AACtCA,UAAKuL,mBAAL,CAAyB1T,KAAzB,EAAgCyT,QAAhC;AACA,YAAO,MAAK9L,KAAL,EAAP;AACA,KAHe;AAAA,IAAD,CAGZ3H,KAHY,EAGLmI,IAHK,CAAf;;AAKAA,QAAKmI,gBAAL,CAAsBtQ,KAAtB,EAA6ByT,QAA7B;AACA;;;uBAEWzJ,G,EAAKpH,Q,EACjB;AAAA,OAD2ByN,IAC3B,uEADkC,IAClC;;AACC,OAAGzN,oBAAoBf,UAApB,IACEe,YACAA,SAAS+Q,SADT,IAEA/Q,SAAS+Q,SAAT,YAA8B9R,UAHnC,EAKC;AACAe,eAAY,UAACA,QAAD;AAAA,YAAY;AAAA,aAAIA,QAAJ;AAAA,MAAZ;AAAA,KAAD,CAA2BA,QAA3B,CAAX;AACA;;AAED,UAAO,UAACgR,OAAD,EAAa;AACnB,QAAG,CAACA,QAAQC,eAAZ,EACA;AACCrQ,YAAOsB,cAAP,CACC8O,OADD,EAEG,iBAFH,EAGG;AACD7O,kBAAY,KADX;AAEDC,gBAAU;AAFT,MAHH;;AASA4O,aAAQC,eAAR,GAA0B,EAA1B;AACA;;AAED,SAAI,IAAIrR,CAAR,IAAaoR,QAAQC,eAArB,EACA;AACC,SAAGjR,YAAYgR,QAAQC,eAAR,CAAwBrR,CAAxB,CAAf,EACA;AACC;AACA;AACD;;AAED,QAAIsR,eAAJ;AAAA,QAAYC,mBAAZ;;AAEA,QAAG1D,IAAH,EACA;AACCyD,cAASC,aAAa1D,IAAtB;;AAEA,SAAGA,KAAK2D,QAAR,EACA;AACCD,mBAAa1D,KAAK2D,QAAL,CAAcC,MAA3B;AACA;AACD;;AAED,QAAMC,MAAU,IAAIC,QAAJ,CAAQP,OAAR,EAAiBG,UAAjB,EAA6B,IAA7B,EAAmCrQ,SAAnC,EAA8CoQ,MAA9C,CAAhB;;AAEA,QAAMG,SAAUC,IAAIN,OAAJ,CAAYQ,UAA5B;AACA,QAAMC,UAAUH,IAAIN,OAAJ,CAAYU,WAA5B;;AAEA,QAAIlK,SAAYxH,SAASsR,GAAT,CAAhB;;AAEA,QAAG9J,WAAW,KAAd,EACA;AACCwJ,aAAQC,eAAR,CAAwBtP,IAAxB,CAA6B3B,QAA7B;AACA;;AAED,QAAGwH,kBAAkBmK,WAArB,EACA;AACCnK,cAAS,IAAI+J,QAAJ,CAAQ/J,MAAR,CAAT;AACA;;AAED,QAAGA,kBAAkB+J,QAArB,EACA;AACC,SAAG,CAAC/J,OAAOwJ,OAAP,CAAeY,QAAf,CAAwBN,IAAIN,OAA5B,CAAJ,EACA;AACC,aAAMM,IAAIN,OAAJ,CAAYa,UAAlB,EACA;AACCrK,cAAOwJ,OAAP,CAAe3D,WAAf,CAA2BiE,IAAIN,OAAJ,CAAYa,UAAvC;AACA;;AAEDP,UAAI9P,MAAJ;AACA;;AAED,SAAGiQ,OAAH,EACA;AACCJ,aAAOS,YAAP,CAAoBtK,OAAOwJ,OAA3B,EAAoCS,OAApC;AACA,MAHD,MAKA;AACCJ,aAAOhE,WAAP,CAAmB7F,OAAOwJ,OAA1B;AACA;AACD;;AAED,QAAGxJ,UACCA,OAAOuJ,SADR,IAEEvJ,OAAOuJ,SAAP,YAA4B9R,UAFjC,EAGC;AACAuI,cAAS,IAAIA,MAAJ,EAAT;AACA;;AAED,QAAGA,kBAAkBvI,UAArB,EACA;AACC,SAAGwO,IAAH,EACA;AACCA,WAAKsE,OAAL,CAAapQ,IAAb,CAAmB,UAACqQ,CAAD;AAAA,cAAK,YAAI;AAC3BA,UAAExQ,MAAF;AACA,QAFkB;AAAA,OAAD,CAEfgG,MAFe,CAAlB;;AAIAA,aAAO6J,MAAP,GAAgB5D,IAAhB;;AAEAA,WAAKsE,OAAL,CAAapQ,IAAb,CACC8L,KAAKtO,IAAL,CAAUc,MAAV,CAAiB,UAACmD,CAAD,EAAIC,CAAJ,EAAMC,CAAN,EAAU;AAC1BA,SAAED,CAAF,IAAOD,CAAP;AACAoE,cAAOrI,IAAP,CAAYkE,CAAZ,IAAiBD,CAAjB;AACA,OAHD,CADD;AAMAqK,WAAKsE,OAAL,CAAapQ,IAAb,CACC6F,OAAOrI,IAAP,CAAYc,MAAZ,CAAmB,UAACmD,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,EAAc;AAChCD,SAAED,CAAF,IAAOD,CAAP;AACAqK,YAAKtO,IAAL,CAAUkE,CAAV,IAAeD,CAAf;AACA,OAHD,CADD;AAMA;;AAEDkO,SAAIW,KAAJ;AACAzK,YAAO0K,MAAP,CAAcZ,IAAIN,OAAlB;AACA;AACD,IA5GD;AA6GA;;;;;;;;;;;;;;;;;ACtMF;;;;IACaO,G,WAAAA,G;AAEZ,eAAYP,OAAZ,EAAqBK,MAArB,EAA6Bc,GAA7B,EAAkCC,KAAlC,EAAyClB,MAAzC,EACA;AAAA;;AACC,SAAKF,OAAL,GAAe5R,mBAASC,YAAT,CAAsB2R,OAAtB,CAAf;AACA,SAAKK,MAAL,GAAeA,MAAf;AACA,SAAKH,MAAL,GAAeA,MAAf;AACA,SAAKiB,GAAL,GAAeA,GAAf;AACA,SAAKC,KAAL,GAAeA,KAAf;;AAEA,SAAKL,OAAL,GAAe,EAAf;;AAEA,SAAKM,KAAL,GAAejT,mBAASC,YAAT,CAAsB,IAAtB,CAAf;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;;6BAED;AACCD,yBAASkT,aAAT,CAAuB,IAAvB;;AAEA,UAAIP,gBAAJ;;AAEA,aAAMA,UAAU,KAAKA,OAAL,CAAa7M,KAAb,EAAhB,EACA;AACC6M;AACA;;AAED,WAAKE,KAAL;;AAEA,UAAG,CAAC,KAAKjB,OAAT,EACA;AACC;AACA;;AAED,UAAIuB,cAAc,IAAI9D,KAAJ,CAAU,eAAV,CAAlB;;AAEA,WAAKuC,OAAL,CAAa1I,aAAb,CAA2BiK,WAA3B;AACA,WAAKvB,OAAL,CAAaxP,MAAb;;AAEA,WAAKwP,OAAL,GAAe,KAAKmB,GAAL,GAAW,KAAKd,MAAL,GAAc,IAAxC;AACA;;;4BAED;AACC,UAAG,CAAC,KAAKL,OAAT,EACA;AACC;AACA;;AAED,UAAIuB,cAAc,IAAI9D,KAAJ,CAAU,eAAV,CAAlB;;AAEA,aAAM,KAAKuC,OAAL,CAAaa,UAAnB,EACA;AACC,aAAKb,OAAL,CAAaa,UAAb,CAAwBvJ,aAAxB,CAAsCiK,WAAtC;AACA,aAAKvB,OAAL,CAAawB,WAAb,CAAyB,KAAKxB,OAAL,CAAaa,UAAtC;AACA;AACD;;;4BAED;AAAA,UADMY,MACN,uEADe,IACf;AAEC;;;;;;;;;;;;;;;;;;IC/EWC,K,WAAAA,K;AAEZ,kBACA;AAAA;;AACC,OAAKC,KAAL,GAAa;AACZ,sCAAoC;AACnCC,YAAQ,sBAD2B;AAEjCC,UAAM;AAF2B,IADxB;AAKV,mCAAiC;AAClCD,YAAQ,YAD0B;AAEhCC,UAAM;AAF0B;AALvB,GAAb;AAUA;;;;0BAEOlI,K,EACR;AACC,OAAImI,mBAAJ;;AAEA,OAAGpO,MAAMC,OAAN,CAAcgG,KAAd,CAAH,EACA;AACC,SAAI,IAAI/K,CAAR,IAAa+K,KAAb,EACA;AACC,SAAIoI,cAAcpI,MAAM/K,CAAN,EAASC,KAAT,IAAkB8K,MAAM/K,CAAN,EAASoT,YAA7C;;AAEA,SAAGF,cAAcA,eAAeC,WAAhC,EACA;AACC,YAAM,IAAIlS,KAAJ,CAAU,sBAAV,CAAN;AACA,MAHD,MAKA;AACCiS,mBAAaC,WAAb;AACA;AACD;;AAED,QAAG,KAAKJ,KAAL,CAAWG,UAAX,CAAH,EACA;AACC,SAAG,KAAKH,KAAL,CAAWG,UAAX,EAAuBD,IAA1B,EACA;AACC,aAAO,KAAKF,KAAL,CAAWG,UAAX,EAAuBD,IAA9B;AACA;;AAED,YAAO,KAAKF,KAAL,CAAWG,UAAX,CAAP;AACA;;AAED,WAAO,gBAAP;AACA,IA3BD,MA4BK,IAAGnI,KAAH,EACL;AACCmI,iBAAanI,MAAM9K,KAAN,IAAe8K,MAAMqI,YAAlC;;AAEA,QAAG,KAAKL,KAAL,CAAWG,UAAX,CAAH,EACA;AACC,SAAG,KAAKH,KAAL,CAAWG,UAAX,EAAuBF,MAA1B,EACA;AACC,aAAO,KAAKD,KAAL,CAAWG,UAAX,EAAuBF,MAA9B;AACA;;AAED,YAAO,KAAKD,KAAL,CAAWG,UAAX,CAAP;AACA;;AAED,WAAO,YAAP;AACA;;AAED,UAAO,KAAP;AACA;;;;;;;;;;;;;;;;;;;AClEF;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;IAEa7T,I,WAAAA,I;AAEZ,iBACA;AAAA,MADYE,IACZ,uEADmB,EACnB;;AAAA;;AACCyB,SAAOsB,cAAP,CAAsB,IAAtB,EAA4B,YAA5B,EAA0C;AACzCC,eAAY,KAD6B;AAEzCC,aAAa;AAF4B,GAA1C;;AAKA,OAAK6Q,UAAL,GAAkBhU,IAAlB;;AAEA,OAAKE,IAAL,GAAiBC,mBAASC,YAAT,CAAsBF,IAAtB,CAAjB;AACA,OAAK+T,GAAL,GAAiB,KAAKC,IAAL,EAAjB;AACA,OAAKhU,IAAL,CAAU+T,GAAV,GAAiB,KAAKA,GAAtB;AACA,OAAK/V,QAAL;AACA,OAAKsJ,QAAL;;AAEA,OAAK2M,SAAL,GAAiB,IAAjB;AACA,OAAKC,QAAL,GAAiB,IAAjB;AACA,OAAK3C,KAAL,GAAiB,IAAjB;;AAEA,OAAKqB,OAAL,GAAiB,EAAjB;;AAEA,OAAKuB,MAAL,GAAiB,EAAjB;AACA,OAAKC,MAAL,GAAiB,EAAjB;;AAEA,OAAKC,YAAL,GAAoB,EAApB;;AAEA,OAAKnC,MAAL,GAAiB,IAAjB;AACA,OAAKD,QAAL,GAAiB,IAAjB;AACA,OAAKqC,SAAL,GAAiB,EAAjB;;AAEA,OAAKC,SAAL,GAAiB,EAAjB;;AAEA,OAAKC,IAAL,GAAiB,EAAjB;;AAEA,OAAKC,SAAL,GAAiB,EAAjB;AACA,OAAKC,QAAL,GAAiB,EAAjB;AACA,OAAKC,MAAL,GAAiB,EAAjB;;AAEA,OAAKC,OAAL,GAAmB,IAAIzD,gBAAJ,EAAnB;AACA,OAAK0D,UAAL,GAAmB,IAAI1D,gBAAJ,EAAnB;AACA,OAAK2D,WAAL,GAAmB,EAAnB;;AAEA,OAAKlT,OAAL,GAAiB,KAAjB;AACA,OAAKmT,QAAL,GAAiB,KAAjB;;AAEA,OAAKC,gBAAL,GAAwB,6BAAxB;AACA;;;;0BAOOnU,Q,EAAU;AACjB,OAAI2G,IAAI,SAAJA,CAAI,CAACyN,SAAD,EAAe;AACtBpU,aAASoU,SAAT;AACA3W,WAAO4W,qBAAP,CAA6B1N,CAA7B;AACA,IAHD;;AAKAA;AACA;;;4BAES5H,I,EAAMiB,Q,EAAU;AAAA;;AACzB,OAAIsU,kBAAkB,SAAlBA,eAAkB,GAAM;AAC3B,UAAKT,QAAL,CAAczB,KAAd,EAAqBmC,KAArB,GAAgC,IAAhC;AACA,UAAKV,QAAL,CAAczB,KAAd,EAAqBpS,QAArB,GAAgC,IAAhC;AACAA;AACA,IAJD;AAKA,OAAIqM,UAAU5I,WAAW6Q,eAAX,EAA4BvV,IAA5B,CAAd;AACA,OAAIqT,QAAU,KAAKyB,QAAL,CAAchQ,MAA5B;;AAEA,QAAKgQ,QAAL,CAAclS,IAAd,CAAmB;AAClB0K,aAAYA,OADM;AAEhBrM,cAAUsU,eAFM;AAGhBvV,UAAUA,IAHM;AAIhBwV,WAAU,KAJM;AAKhBC,aAAW,IAAIxO,IAAJ,EAAD,CAAWC,OAAX,EALM;AAMhBwM,YAAU;AANM,IAAnB;;AASA,UAAOpG,OAAP;AACA;;;+BAEYA,O,EAAS;AACrB,QAAI,IAAIzM,CAAR,IAAa,KAAKiU,QAAlB,EAA4B;AAC3B,QAAGxH,YAAY,KAAKwH,QAAL,CAAcjU,CAAd,EAAiByM,OAAhC,EAAyC;AACxCzO,mBAAc,KAAKiW,QAAL,CAAcjU,CAAd,EAAiByM,OAA/B;;AAEA,YAAO,KAAKwH,QAAL,CAAcjU,CAAd,CAAP;AACA;AACD;AACD;;;6BAEUb,I,EAAMiB,Q,EAAU;AAC1B,OAAIqM,UAAUoI,YAAYzU,QAAZ,EAAsBjB,IAAtB,CAAd;;AAEA,QAAK6U,SAAL,CAAejS,IAAf,CAAoB;AACnB0K,aAAYA,OADO;AAEjBrM,cAAUA,QAFO;AAGjBjB,UAAUA,IAHO;AAIjB0T,YAAU;AAJO,IAApB;;AAOA,UAAOpG,OAAP;AACA;;;;;;;;;;;;;cAEaA,O,EAAS;AACtB,QAAI,IAAIzM,CAAR,IAAa,KAAKgU,SAAlB,EAA6B;AAC5B,QAAGvH,YAAY,KAAKuH,SAAL,CAAehU,CAAf,EAAkByM,OAAjC,EAA0C;AACzCzO,mBAAc,KAAKgW,SAAL,CAAehU,CAAf,EAAkByM,OAAhC;;AAEA,YAAO,KAAKuH,SAAL,CAAehU,CAAf,CAAP;AACA;AACD;AACD,G;;;0BAGD;AAAA,OADM6S,MACN,uEADe3R,SACf;;AACC,OAAG2R,WAAW3R,SAAd,EACA;AACC,SAAK2R,MAAL,GAAc,CAAC,KAAKA,MAApB;AACA;;AAED,QAAKA,MAAL,GAAcA,MAAd;;AAEA,OAAG,KAAKA,MAAR,EACA;AACC,SAAI,IAAI7S,CAAR,IAAa,KAAKiU,QAAlB,EACA;AACC,SAAG,KAAKA,QAAL,CAAcjU,CAAd,EAAiB2U,KAApB,EACA;AACC,aAAO,KAAKV,QAAL,CAAcjU,CAAd,CAAP;AACA;AACA;;AAED+D,kBAAa,KAAKkQ,QAAL,CAAcjU,CAAd,EAAiByM,OAA9B;AACA;;AAED,SAAI,IAAIzM,EAAR,IAAa,KAAKgU,SAAlB,EACA;AACChW,mBAAc,KAAKgW,SAAL,CAAehU,EAAf,EAAkByM,OAAhC;AACA;AACD,IAjBD,MAmBA;AACC,SAAI,IAAIzM,GAAR,IAAa,KAAKiU,QAAlB,EACA;AACC,SAAG,CAAC,KAAKA,QAAL,CAAcjU,GAAd,EAAiByM,OAAjB,CAAyBoG,MAA7B,EACA;AACC;AACA;;AAED,SAAG,KAAKoB,QAAL,CAAcjU,GAAd,EAAiB2U,KAApB,EACA;AACC,aAAO,KAAKV,QAAL,CAAcjU,GAAd,CAAP;AACA;AACA;;AAED,UAAKiU,QAAL,CAAcjU,GAAd,EAAiByM,OAAjB,GAA2B5I,WAC1B,KAAKoQ,QAAL,CAAcjU,GAAd,EAAiBI,QADS,EAExB,KAAK6T,QAAL,CAAcjU,GAAd,EAAiBb,IAFO,CAA3B;AAIA;;AAED,SAAI,IAAIa,GAAR,IAAa,KAAKgU,SAAlB,EACA;AACC,SAAG,CAAC,KAAKA,SAAL,CAAehU,GAAf,EAAkByM,OAAlB,CAA0BoG,MAA9B,EACA;AACC;AACA;;AAED,UAAKmB,SAAL,CAAehU,GAAf,EAAkByM,OAAlB,CAA0BoG,MAA1B,GAAmC,KAAnC;;AAEA,UAAKmB,SAAL,CAAehU,GAAf,EAAkByM,OAAlB,GAA4BoI,YAC3B,KAAKb,SAAL,CAAehU,GAAf,EAAkBI,QADS,EAEzB,KAAK4T,SAAL,CAAehU,GAAf,EAAkBb,IAFO,CAA5B;AAIA;AACD;;AAED,QAAI,IAAIa,GAAR,IAAa,KAAK6T,SAAlB,EACA;AACC,QAAG,CAAC,KAAKA,SAAL,CAAe7T,GAAf,CAAJ,EACA;AACC;AACA;;AAED,SAAK6T,SAAL,CAAe7T,GAAf,EAAkBoQ,KAAlB,CAAwB,CAAC,CAACyC,MAA1B;AACA;;AAED,QAAI,IAAI7S,GAAR,IAAa,KAAK+T,IAAlB,EACA;AACC,QAAGjP,MAAMC,OAAN,CAAc,KAAKgP,IAAL,CAAU/T,GAAV,CAAd,CAAH,EACA;AACC,UAAI,IAAImE,CAAR,IAAa,KAAK4P,IAAL,CAAU/T,GAAV,CAAb,EACA;AACC,WAAK+T,IAAL,CAAU/T,GAAV,EAAamE,CAAb,EAAgBiM,KAAhB,CAAsB,CAAC,CAACyC,MAAxB;AACA;AACD;AACA;AACD,SAAKkB,IAAL,CAAU/T,GAAV,EAAaoQ,KAAb,CAAmB,CAAC,CAACyC,MAArB;AACA;AACD;;;2BAGD;AAAA;;AAAA,OADOjB,UACP,uEADoB,IACpB;AAAA,OAD0BkD,WAC1B,uEADwC,IACxC;;AACC,OAAGA,uBAAuBzV,IAA1B,EACA;AACCyV,kBAAcA,YAAYtB,SAA1B;AACA;;AAED,OAAG,KAAK1C,KAAR,EACA;AACC,SAAI,IAAI9Q,CAAR,IAAa,KAAK2T,MAAlB,EACA;AACC,UAAKA,MAAL,CAAY3T,CAAZ;AACA;;AAJF,+BAMSA,GANT;AAQE,SAAI2S,cAAc,IAAI9D,KAAJ,CAAU,eAAV,EAA2B,EAACkG,SAAS,IAAV,EAAgB1Q,QAAQ,OAAKyM,KAAL,CAAW9Q,GAAX,CAAxB,EAA3B,CAAlB;AACA,SAAIgV,cAAc,IAAInG,KAAJ,CAAU,eAAV,EAA2B,EAACkG,SAAS,IAAV,EAAgB1Q,QAAQ,OAAKyM,KAAL,CAAW9Q,GAAX,CAAxB,EAA3B,CAAlB;;AAEA,YAAK8Q,KAAL,CAAW9Q,GAAX,EAAc0I,aAAd,CAA4BiK,WAA5B;;AAEApL,cAAIoB,OAAJ,CAAY,OAAKmI,KAAL,CAAW9Q,GAAX,CAAZ,EAA2B,KAA3B,EAAkC,UAAC2F,IAAD,EAAU;AAC3CA,WAAK+C,aAAL,CAAmBiK,WAAnB;AACA,MAFD;;AAIA,SAAGf,UAAH,EACA;AACC,UAAGkD,WAAH,EACA;AACClD,kBAAWM,YAAX,CAAwB,OAAKpB,KAAL,CAAW9Q,GAAX,CAAxB,EAAuC8U,WAAvC;AACA,OAHD,MAKA;AACClD,kBAAWnE,WAAX,CAAuB,OAAKqD,KAAL,CAAW9Q,GAAX,CAAvB;AACA;AACD;;AAEDuH,cAAIoB,OAAJ,CAAY,OAAKmI,KAAL,CAAW9Q,GAAX,CAAZ,EAA2B,KAA3B,EAAkC,UAAC2F,IAAD,EAAU;AAC3CA,WAAK+C,aAAL,CAAmBsM,WAAnB;AACA,MAFD;;AAIA,YAAKlE,KAAL,CAAW9Q,GAAX,EAAc0I,aAAd,CAA4BsM,WAA5B;AAjCF;;AAMC,SAAI,IAAIhV,GAAR,IAAa,KAAK8Q,KAAlB,EACA;AAAA,WADQ9Q,GACR;AA2BC;;AAED,SAAI,IAAIA,GAAR,IAAa,KAAK0T,MAAlB,EACA;AACC,UAAKA,MAAL,CAAY1T,GAAZ;AACA;;AAED;AACA;;AAED,OAAIiV,eAAJ;;AAEA,OAAG,KAAK1X,QAAL,IAAiBsJ,QAApB,EACA;AACCoO,aAAS,KAAK1X,QAAd;AACA,IAHD,MAIK,IAAG,KAAKsJ,QAAR,EACL;AACCoO,aAAS,KAAKpO,QAAd;AACA,IAHI,MAKL;AACCoO,aAASpO,SAASqO,WAAT,GAAuBC,wBAAvB,CAAgD,KAAK5X,QAArD,CAAT;;AAEA,SAAKsJ,QAAL,GAAgBoO,MAAhB;AACA;;AAED,QAAKb,UAAL,CAAgBjP,KAAhB,CAAsB8P,MAAtB,EAA8B,IAA9B;;AAEA1N,YAAIoB,OAAJ,CAAYsM,MAAZ,EAAoB,KAApB,EAA2B,UAACvD,GAAD,EAAO;AACjC,QAAGA,IAAIpJ,OAAP,EACA;AACCoJ,SAAIpJ,OAAJ,CAAY,WAAZ,KACI,OAAK8M,WAAL,CAAiB1D,GAAjB,CADJ;;AAGAA,SAAIpJ,OAAJ,CAAY,WAAZ,KACI,OAAK+M,WAAL,CAAiB3D,GAAjB,CADJ;;AAGAA,SAAIpJ,OAAJ,CAAY,gBAAZ,KACI,OAAKgN,gBAAL,CAAsB5D,GAAtB,CADJ;;AAGAA,SAAIpJ,OAAJ,CAAY,WAAZ,KACI,OAAKiN,WAAL,CAAiB7D,GAAjB,CADJ;;AAGAA,SAAIpJ,OAAJ,CAAY,WAAZ,KACI,OAAKkN,WAAL,CAAiB9D,GAAjB,CADJ;;AAGAA,SAAIpJ,OAAJ,CAAY,WAAZ,KACI,OAAKmN,WAAL,CAAiB/D,GAAjB,CADJ;;AAGA,YAAKgE,qBAAL,CAA2BhE,GAA3B;;AAEAA,SAAIpJ,OAAJ,CAAY,aAAZ,KACI,OAAKqN,iBAAL,CAAuBjE,GAAvB,CADJ;;AAGAA,SAAIpJ,OAAJ,CAAY,SAAZ,KACI,OAAKsN,SAAL,CAAelE,GAAf,CADJ;;AAGAA,SAAIpJ,OAAJ,CAAY,UAAZ,KACI,OAAKuN,UAAL,CAAgBnE,GAAhB,CADJ;;AAGAA,SAAIpJ,OAAJ,CAAY,SAAZ,KACI,OAAKwN,SAAL,CAAepE,GAAf,CADJ;AAEA,KAjCD,MAmCA;AACC,YAAKgE,qBAAL,CAA2BhE,GAA3B;AACA;AACD,IAvCD;;AAyCA,QAAKyC,OAAL,CAAahP,KAAb,CAAmB8P,MAAnB,EAA2B,IAA3B;;AAEA,QAAKnE,KAAL,GAAa,EAAb;;AAEA,OAAGjT,OAAO,SAAP,MAAsB,IAAzB,EACA;AACC,SAAK2V,SAAL,GAAiB3M,SAASkP,aAAT,eAAmC,KAAKzC,GAAxC,YAAjB;AACA,IAHD,MAKA;AACC,SAAKE,SAAL,GAAiB3M,SAASmP,cAAT,CAAwB,EAAxB,CAAjB;AACA;;AAED,QAAKlF,KAAL,CAAW/O,IAAX,CAAgB,KAAKyR,SAArB;;AAEA,OAAG5B,UAAH,EACA;AACC,QAAGkD,WAAH,EACA;AACClD,gBAAWM,YAAX,CAAwB,KAAKsB,SAA7B,EAAwCsB,WAAxC;AACA,KAHD,MAKA;AACClD,gBAAWnE,WAAX,CAAuB,KAAK+F,SAA5B;AACA;AACD;;AAxIF;AA4IE,QAAIyC,UAAUhB,OAAOhD,UAArB;AACA,QAAI+C,cAAc,IAAInG,KAAJ,CAAU,eAAV,EAA2B,EAACkG,SAAS,IAAV,EAAgB1Q,QAAQ4R,OAAxB,EAA3B,CAAlB;;AAEA,WAAKnF,KAAL,CAAW/O,IAAX,CAAgBkU,OAAhB;;AAEA,QAAGrE,UAAH,EACA;AACC,SAAGkD,WAAH,EACA;AACClD,iBAAWM,YAAX,CAAwB+D,OAAxB,EAAiCnB,WAAjC;AACA,MAHD,MAKA;AACClD,iBAAWnE,WAAX,CAAuBwI,OAAvB;AACA;AACD;;AAED1O,aAAIoB,OAAJ,CAAYsN,OAAZ,EAAqB,KAArB,EAA4B,UAACtQ,IAAD,EAAU;AACrCA,UAAK+C,aAAL,CAAmBsM,WAAnB;AACA,KAFD;;AAIAiB,YAAQvN,aAAR,CAAsBsM,WAAtB;AAjKF;;AA0IC,UAAMC,OAAOhD,UAAb,EACA;AAAA;AAuBC;;AAED,OAAGpU,OAAO,SAAP,MAAsB,IAAzB,EACA;AACC,SAAK4V,QAAL,GAAgB5M,SAASkP,aAAT,eAAmC,KAAKzC,GAAxC,UAAhB;AACA,IAHD,MAKA;AACC,SAAKG,QAAL,GAAgB5M,SAASmP,cAAT,CAAwB,EAAxB,CAAhB;AACA;;AAED,QAAKlF,KAAL,CAAW/O,IAAX,CAAgB,KAAK0R,QAArB;;AAEA,OAAG7B,UAAH,EACA;AACC,QAAGkD,WAAH,EACA;AACClD,gBAAWM,YAAX,CAAwB,KAAKuB,QAA7B,EAAuCqB,WAAvC;AACA,KAHD,MAKA;AACClD,gBAAWnE,WAAX,CAAuB,KAAKgG,QAA5B;AACA;AACD;;AAED,QAAI,IAAIzT,GAAR,IAAa,KAAK0T,MAAlB,EACA;AACC,SAAKA,MAAL,CAAY1T,GAAZ;AACA;;AAED,QAAKkW,UAAL,CAAgBtE,UAAhB;;AAEA;AACA;;;oCAEiBF,G,EAClB;AAAA;;AACC,OAAIyE,iBAAiBzE,IAAI0E,YAAJ,CAAiB,WAAjB,CAArB;AACA,OAAIC,YAAY7W,mBAASC,YAAT,CACf,KAAKF,IAAL,CAAU4W,cAAV,KAA6B,EADd,CAAhB;;AAIAzE,OAAI4E,eAAJ,CAAoB,WAApB;;AAND,gCAQStW,CART;AAUE,QAAGA,KAAK,MAAL,IAAeA,KAAK,MAAvB,EACA;AACC;AACA;;AAED,QAAI2J,SAAS0M,UAAUhW,MAAV,CAAiBL,CAAjB,EAAqB,UAAC0R,GAAD,EAAK1R,CAAL;AAAA,YAAS,UAACwD,CAAD,EAAK;AAC/CkO,UAAInE,YAAJ,CAAiBvN,CAAjB,EAAoBwD,CAApB;AACA,MAFiC;AAAA,KAAD,CAE9BkO,GAF8B,EAE1B1R,CAF0B,CAApB,CAAb;;AAIA,WAAKmS,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB4H;AACA,SAAG0M,UAAUnS,OAAV,EAAH,EACA;AACC1E,yBAASkT,aAAT,CAAuB2D,SAAvB;AACA;AACD,KAND;AAnBF;;AAQC,QAAI,IAAIrW,CAAR,IAAaqW,SAAb,EACA;AAAA,uBADQrW,CACR;;AAAA,8BAGE;AAcD;AACD;;;8BAEW0R,G,EACZ;AAAA;;AACC,OAAI6E,eAAe7E,IAAI0E,YAAJ,CAAiB,SAAjB,CAAnB;;AAEA1E,OAAI4E,eAAJ,CAAoB,SAApB;;AAEA,OAAIE,QAAQD,aAAa1Q,KAAb,CAAmB,GAAnB,CAAZ;AACA,OAAI4Q,QAAQD,MAAMhV,GAAN,CAAU,UAACoC,CAAD;AAAA,WAAOA,EAAEiC,KAAF,CAAQ,GAAR,CAAP;AAAA,IAAV,CAAZ;;AAND,gCAQU7F,CARV;AAUE,QAAIyS,QAAe,OAAKlT,IAAxB;AACA,QAAImX,eAAeD,MAAMzW,CAAN,EAAS,CAAT,CAAnB;AACA,QAAIkD,WAAewT,YAAnB;;AAEA,QAAGA,aAAajI,KAAb,CAAmB,IAAnB,CAAH,EACA;AAAA,6BACqBjP,mBAASI,OAAT,CACnB,OAAKL,IADc,EAEjBmX,YAFiB,EAGjB,IAHiB,CADrB;;AAAA;;AACEjE,UADF;AACSvP,aADT;AAMC;;AAED,QAAGuP,MAAOgE,MAAMzW,CAAN,EAAS,CAAT,CAAP,CAAH,EACA;AACC0R,SAAInE,YAAJ,CACCkJ,MAAMzW,CAAN,EAAS,CAAT,CADD,EAEGyS,MAAOgE,MAAMzW,CAAN,EAAS,CAAT,CAAP,CAFH;AAIA;;AAED,QAAI2W,SAASF,MAAMzW,CAAN,EAAS,CAAT,CAAb;;AAEA,WAAKmS,OAAL,CAAapQ,IAAb,CAAkB0Q,MAAMpS,MAAN,CACjB6C,QADiB,EAEf,UAACM,CAAD,EAAK;AACN,SAAGA,KAAK,IAAR,EACA;AACCkO,UAAInE,YAAJ,CAAiBoJ,MAAjB,EAAyB,EAAzB;AACA;AACA;AACDjF,SAAInE,YAAJ,CAAiBoJ,MAAjB,EAAyBnT,CAAzB;AACA,KATgB,CAAlB;AAjCF;;AAQC,QAAK,IAAIxD,CAAT,IAAcyW,KAAd,EACA;AAAA,WADSzW,CACT;AAmCC;AACD;;;wCAEqB0R,G,EACtB;AAAA;;AACC,OAAIkF,QAAQ,KAAKrC,gBAAjB;;AAEA,OAAG7C,IAAImF,QAAJ,IAAgBxU,KAAKyU,SAAxB,EACA;AACC,QAAIC,WAAWrF,IAAIsF,SAAnB;;AAEA,QAAG,CAAC,KAAKC,cAAL,CAAoBF,QAApB,CAAJ,EACA;AACC;AACA;;AAED,QAAIG,SAAW,CAAf;AACA,QAAIzI,cAAJ;;AATD;AAaE,SAAIiI,eAAejI,MAAM,CAAN,CAAnB;;AAEA,SAAI0I,aAAa,KAAjB;;AAEA,SAAGT,aAAa9P,MAAb,CAAoB,CAApB,EAAuB,CAAvB,MAA8B,GAAjC,EACA;AACCuQ,mBAAe,IAAf;AACAT,qBAAeA,aAAa9P,MAAb,CAAoB,CAApB,CAAf;AACA;;AAED,SAAG8P,aAAa9P,MAAb,CAAoB,CAApB,EAAuB,CAAvB,MAA8B,KAAjC,EACA;AACCwQ,eAAe,IAAf;AACAV,qBAAeA,aAAa9P,MAAb,CAAoB,CAApB,CAAf;;AAEA;AACA;;AAED,SAAIyQ,eAAeN,SAASzS,SAAT,CAAmB4S,MAAnB,EAA2BzI,MAAM+D,KAAjC,CAAnB;;AAEA0E,cAASzI,MAAM+D,KAAN,GAAc/D,MAAM,CAAN,EAASxK,MAAhC;;AAEA,SAAIqT,aAAazQ,SAASmP,cAAT,CAAwBqB,YAAxB,CAAjB;;AAEA3F,SAAIE,UAAJ,CAAeM,YAAf,CAA4BoF,UAA5B,EAAwC5F,GAAxC;;AAEA,SAAI6F,oBAAJ;;AAEA,SAAGJ,UAAH,EACA;AACCI,oBAAc1Q,SAASyG,aAAT,CAAuB,KAAvB,CAAd;AACA,MAHD,MAKA;AACCiK,oBAAc1Q,SAASmP,cAAT,CAAwB,EAAxB,CAAd;AACA;;AAED,SAAIvD,QAAW,OAAKlT,IAApB;AACA,SAAI2D,WAAWwT,YAAf;;AAEA,SAAGA,aAAajI,KAAb,CAAmB,IAAnB,CAAH,EACA;AAAA,+BACqBjP,mBAASI,OAAT,CACnB,OAAKL,IADc,EAEjBmX,YAFiB,EAGjB,IAHiB,CADrB;;AAAA;;AACEjE,WADF;AACSvP,cADT;AAMC;;AAEDwO,SAAIE,UAAJ,CAAeM,YAAf,CAA4BqF,WAA5B,EAAyC7F,GAAzC;;AAEA,SAAI/H,SAAS8I,MAAMpS,MAAN,CAAa6C,QAAb,EAAwB,UAACqU,WAAD,EAAaJ,UAAb;AAAA,aAA4B,UAAC3T,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAW;AAC3E,WAAGA,EAAED,CAAF,aAAgBpE,IAAhB,IAAwBqE,EAAED,CAAF,MAASD,CAApC,EACA;AACC,YAAG,CAACE,EAAED,CAAF,EAAK6Q,QAAT,EACA;AACC5Q,WAAED,CAAF,EAAK7B,MAAL;AACA;AACD;;AAED2V,mBAAYP,SAAZ,GAAwB,EAAxB;;AAEA,WAAGxT,aAAanE,IAAhB,EACA;AACCmE,UAAE8O,MAAF,CAASZ,IAAIE,UAAb,EAAyB2F,WAAzB;;AAEA,eAAKpF,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB,aAAG,CAACyB,EAAE8Q,QAAN,EACA;AACC9Q,YAAE5B,MAAF;AACA;AACD,SALD;AAMA,QAVD,MAYA;AACC,YAAG4B,aAAaxC,MAAb,IAAuBwC,EAAEgU,UAAF,YAAwBnU,QAAlD,EACA;AACCG,aAAIA,EAAEgU,UAAF,EAAJ;AACA;;AAED,YAAGL,UAAH,EACA;AACCI,qBAAYE,SAAZ,GAAwBjU,CAAxB;AACA,SAHD,MAKA;AACC+T,qBAAYP,SAAZ,GAAwBxT,CAAxB;AACA;AACD;AACD,OAtCoC;AAAA,MAAD,CAsCjC+T,WAtCiC,EAsCrBJ,UAtCqB,CAAvB,CAAb;;AAwCA,YAAKhF,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB4H;AACA,UAAG,CAAC8I,MAAMvO,OAAN,EAAJ,EACA;AACC1E,0BAASkT,aAAT,CAAuBD,KAAvB;AACA;AACD,MAND;AAxGF;;AAWC,WAAMhE,QAAQmI,MAAM/G,IAAN,CAAWkH,QAAX,CAAd,EACA;AAAA;;AAAA,+BAgBE;AAmFD;;AAED,QAAIW,eAAeX,SAASzS,SAAT,CAAmB4S,MAAnB,CAAnB;;AAEA,QAAII,aAAazQ,SAASmP,cAAT,CAAwB0B,YAAxB,CAAjB;;AAEAhG,QAAIE,UAAJ,CAAeM,YAAf,CAA4BoF,UAA5B,EAAwC5F,GAAxC;;AAEAA,QAAIsF,SAAJ,GAAgB,EAAhB;AACA;;AAED,OAAGtF,IAAImF,QAAJ,IAAgBxU,KAAKsV,YAAxB,EACA;AAAA,iCACU3X,CADV;AAGE,SAAG,CAAC,OAAKiX,cAAL,CAAoBvF,IAAIkG,UAAJ,CAAe5X,CAAf,EAAkByC,KAAtC,CAAJ,EACA;AACC;AACA;;AAED,SAAIyU,SAAY,CAAhB;AACA,SAAIzI,cAAJ;AACA,SAAIsI,WAAYrF,IAAIkG,UAAJ,CAAe5X,CAAf,EAAkByC,KAAlC;AACA,SAAIoV,YAAYnG,IAAIkG,UAAJ,CAAe5X,CAAf,CAAhB;;AAEA,SAAI8X,iBAAiB,EAArB;AACA,SAAIC,WAAiB,EAArB;;AAEA,YAAMtJ,QAAQmI,MAAM/G,IAAN,CAAWkH,QAAX,CAAd,EACA;AACCgB,eAAShW,IAAT,CAAcgV,SAASzS,SAAT,CAAmB4S,MAAnB,EAA2BzI,MAAM+D,KAAjC,CAAd;;AAEA,UAAG,CAACsF,eAAerJ,MAAM,CAAN,CAAf,CAAJ,EACA;AACCqJ,sBAAerJ,MAAM,CAAN,CAAf,IAA2B,EAA3B;AACA;;AAEDqJ,qBAAerJ,MAAM,CAAN,CAAf,EAAyB1M,IAAzB,CAA8BgW,SAAS9T,MAAvC;;AAEA8T,eAAShW,IAAT,CAAc0M,MAAM,CAAN,CAAd;;AAEAyI,eAASzI,MAAM+D,KAAN,GAAc/D,MAAM,CAAN,EAASxK,MAAhC;AACA;;AAED8T,cAAShW,IAAT,CAAcgV,SAASzS,SAAT,CAAmB4S,MAAnB,CAAd;;AAhCF,kCAkCU/S,CAlCV;AAoCG,UAAIsO,QAAW,OAAKlT,IAApB;AACA,UAAI2D,WAAWiB,CAAf;;AAEA,UAAGA,EAAEsK,KAAF,CAAQ,IAAR,CAAH,EACA;AAAA,gCACqBjP,mBAASI,OAAT,CACnB,OAAKL,IADc,EAEjB4E,CAFiB,EAGjB,IAHiB,CADrB;;AAAA;;AACEsO,YADF;AACSvP,eADT;AAMC;;AAED,UAAI8U,eAAe7T,CAAnB;;AAEA,UAAIwF,SAAS8I,MAAMpS,MAAN,CAAa6C,QAAb,EAAuB,UAACM,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,EAAgB;AACnD,YAAI,IAAI3D,GAAR,IAAa8X,cAAb,EACA;AACC,aAAI,IAAI3T,EAAR,IAAa2T,eAAeE,YAAf,CAAb,EACA;AACCD,kBAAUD,eAAeE,YAAf,EAA6B7T,EAA7B,CAAV,IAA8CT,EAAE1D,GAAF,CAA9C;;AAEA,aAAGyD,MAAMP,QAAT,EACA;AACC6U,mBAAUD,eAAeE,YAAf,EAA6B7T,EAA7B,CAAV,IAA8CX,CAA9C;AACA;AACD;AACD;;AAEDkO,WAAInE,YAAJ,CAAiBsK,UAAUrR,IAA3B,EAAiCuR,SAASjM,IAAT,CAAc,EAAd,CAAjC;AACA,OAfY,CAAb;;AAiBA,aAAKqG,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB4H;AACA,WAAG,CAAC8I,MAAMvO,OAAN,EAAJ,EACA;AACC1E,2BAASkT,aAAT,CAAuBD,KAAvB;AACA;AACD,OAND;AAnEH;;AAkCE,UAAI,IAAItO,CAAR,IAAa2T,cAAb,EACA;AAAA,aADQ3T,CACR;AAuCC;AA1EH;;AACC,SAAK,IAAInE,IAAI,CAAb,EAAgBA,IAAI0R,IAAIkG,UAAJ,CAAe3T,MAAnC,EAA2CjE,GAA3C,EACA;AAAA,wBADSA,CACT;;AAAA,+BAGE;AAsED;AACD;AACD;;;6BAEU0R,G,EACX;AACC,OAAIuG,UAAkCvG,IAAI0E,YAAJ,CAAiB,QAAjB,CAAtC;;AADD,wBAEuC6B,QAAQpS,KAAR,CAAc,GAAd,CAFvC;AAAA;AAAA,OAEMqS,OAFN;AAAA,OAEeC,YAFf;AAAA,OAE6BC,MAF7B;;AAIC,OAAIC,WAAW,KAAKC,aAAL,CAAmBH,YAAnB,CAAf;;AAEAzG,OAAI4E,eAAJ,CAAoB,QAApB;;AAEAtV,UAAOsB,cAAP,CAAsBoP,GAAtB,EAA2B,WAA3B,EAAwC;AAC9BnP,gBAAY,KADkB;AAE9BC,cAAU;AAFoB,IAAxC;;AAKM,QAAK2P,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB2P,QAAI6G,SAAJ,GAAgB,IAAhB;AACN7G,QAAI9P,MAAJ;AACA,IAHK;;AAKN,OAAI6P,SAAS,IAAb;AACA,OAAIH,SAAS,IAAb;;AAEA,OAAG,KAAKE,QAAR,EACA;AACCC,aAAS,KAAKD,QAAL,CAAcC,MAAvB;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAbD,MAeA;AACC;AACA;AACA;AACA;;AAED,OAAI+G,YAAY,IAAIH,QAAJ,CACf3G,GADe,EACV,IADU,EACJwG,OADI,EACKhX,SADL,EACgBoQ,MADhB,CAAhB;;AAIAI,OAAI6G,SAAJ,GAAgBC,SAAhB;;AAEA,UAAM/G,MAAN,EACA;AACC,QAAG,CAACA,OAAOA,MAAX,EACA;AACC,SAAIgH,YAAY,KAAKlZ,IAAL,CAAU6Y,MAAV,CAAhB;;AAEA,SAAGK,cAAcvX,SAAjB,EACA;AACC,UAAG,CAACuQ,OAAOsC,IAAP,CAAYmE,OAAZ,CAAJ,EACA;AACCzG,cAAOsC,IAAP,CAAYmE,OAAZ,IAAuB,EAAvB;AACA;;AAEDzG,aAAOsC,IAAP,CAAYmE,OAAZ,EAAqBO,SAArB,IAAkCD,SAAlC;AACA;AACD;;AAED/G,WAAOsC,IAAP,CAAYmE,OAAZ,IAAuBM,SAAvB;;AAEA/G,aAASA,OAAOA,MAAhB;AACA;AACD;;;8BAEWC,G,EACZ;AAAA;;AACC,OAAIgH,UAAWhH,IAAI0E,YAAJ,CAAiB,SAAjB,CAAf;AACA,OAAI3D,QAAW,KAAKlT,IAApB;AACA,OAAI2D,WAAWwV,OAAf;AACA,OAAI5S,MAAW,IAAf;;AAEA,OAAG4S,QAAQjK,KAAR,CAAc,IAAd,CAAH,EACA;AAAA,6BAC0BjP,mBAASI,OAAT,CACxB,KAAKL,IADmB,EAEtBmZ,OAFsB,EAGtB,IAHsB,CAD1B;;AAAA;;AACEjG,SADF;AACSvP,YADT;AACmB4C,OADnB;AAMC;;AAED,OAAG2M,UAAU,KAAKlT,IAAlB,EACA;AACC,SAAK8U,WAAL,CAAiBqE,OAAjB,IAA4B,KAAKrE,WAAL,CAAiBqE,OAAjB,KAA6B,EAAzD;;AAEA,SAAKvG,OAAL,CAAapQ,IAAb,CACC,KAAKxC,IAAL,CAAUc,MAAV,CAAiByF,GAAjB,EAAsB,YAAI;AACzB,YAAM,OAAKuO,WAAL,CAAiBpQ,MAAvB,EACA;AACCxG,cAAQC,GAAR,CAAY,OAAZ;AACA,aAAK2W,WAAL,CAAiB/O,KAAjB;AACA;AACD,KAND,CADD;AASA;;AAED,OAAIqE,SAAS8I,MAAMpS,MAAN,CAAa6C,QAAb,EAAuB,UAACM,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAe;;AAElD,QAAGA,aAAavE,IAAb,IAAqBuE,MAAMJ,CAA9B,EACA;AACCI,OAAEhC,MAAF;AACA;;AAED,QAAG8P,IAAIiH,OAAJ,IAAe,OAAf,IACCjH,IAAIiH,OAAJ,IAAe,QADhB,IAECjH,IAAIiH,OAAJ,IAAe,UAFnB,EAGE;AACD,SAAIjN,OAAOgG,IAAI0E,YAAJ,CAAiB,MAAjB,CAAX;AACA,SAAG1K,QAAQA,KAAKkN,WAAL,MAAsB,UAAjC,EAA6C;AAC5ClH,UAAImH,OAAJ,GAAc,CAAC,CAACrV,CAAhB;AACA,MAFD,MAGK,IAAGkI,QAAQA,KAAKkN,WAAL,MAAsB,OAAjC,EAA0C;AAC9ClH,UAAImH,OAAJ,GAAerV,KAAKkO,IAAIjP,KAAxB;AACA,MAFI,MAGA,IAAGiJ,SAAS,MAAZ,EAAoB;AACxB,UAAGgG,IAAIiH,OAAJ,IAAe,QAAlB,EACA;AACC;AACA,YAAI,IAAI3Y,CAAR,IAAa0R,IAAIvO,OAAjB,EACA;AACC,YAAI2V,SAASpH,IAAIvO,OAAJ,CAAYnD,CAAZ,CAAb;;AAEA,YAAG8Y,OAAOrW,KAAP,IAAgBe,CAAnB,EACA;AACCkO,aAAIqH,aAAJ,GAAoB/Y,CAApB;AACA;AACD;AACD;AACD0R,UAAIjP,KAAJ,GAAYe,KAAK,IAAL,GAAY,EAAZ,GAAiBA,CAA7B;AACA,MAfI,MAgBA,IAAGkI,SAAS,MAAZ,EAAoB;AACxB;AACA;AACD;AACA;;AAED,QAAGlI,aAAanE,IAAhB,EACA;AACCmE,OAAE8O,MAAF,CAASZ,GAAT;AACA,KAHD,MAKA;AACCA,SAAInF,SAAJ,GAAgB/I,CAAhB;AACA;AACD,IAhDY,CAAb;;AAkDA,OAAGiP,UAAU,KAAKlT,IAAlB,EACA;AACC,SAAK8U,WAAL,CAAiBqE,OAAjB,EAA0B3W,IAA1B,CAA+B4H,MAA/B;AACA;;AAED,QAAKwI,OAAL,CAAapQ,IAAb,CAAkB4H,MAAlB;;AAEA,OAAIqP,gBAAgB,SAAhBA,aAAgB,CAACxb,KAAD,EAAW;AAC9B,QAAGA,MAAM6G,MAAN,KAAiBqN,GAApB,EAAyB;AACxB;AACA;;AAED,QAAIhG,OAAQgG,IAAI0E,YAAJ,CAAiB,MAAjB,CAAZ;AACA,QAAI6C,QAAQvH,IAAI0E,YAAJ,CAAiB,UAAjB,CAAZ;AACA,QAAI1K,QAAQA,KAAKkN,WAAL,MAAsB,UAAlC,EAA8C;AAC7C,SAAIlH,IAAImH,OAAR,EAAiB;AAChBpG,YAAMvP,QAAN,IAAkB1F,MAAM6G,MAAN,CAAa5B,KAA/B;AACA,MAFD,MAGK;AACJgQ,YAAMvP,QAAN,IAAkB,KAAlB;AACA;AACD,KAPD,MAQK,IAAGwI,SAAS,MAAZ,EACL;AACC+G,WAAMvP,QAAN,IAAkB1F,MAAM6G,MAAN,CAAa5B,KAA/B;AACA,KAHI,MAIA,IAAGiJ,QAAQ,MAAR,IAAkBuN,KAArB,EACL;AACCxG,WAAMvP,QAAN,IAAkB4B,MAAMoU,IAAN,CAAW1b,MAAM6G,MAAN,CAAa8U,KAAxB,CAAlB;AACA;AACD,IAvBD;;AAyBAzH,OAAI5D,gBAAJ,CAAqB,OAArB,EAAsCkL,aAAtC;AACAtH,OAAI5D,gBAAJ,CAAqB,QAArB,EAAsCkL,aAAtC;AACAtH,OAAI5D,gBAAJ,CAAqB,eAArB,EAAsCkL,aAAtC;;AAEA,QAAK7G,OAAL,CAAapQ,IAAb,CAAoB,UAAC2P,GAAD,EAAM0H,aAAN;AAAA,WAAwB,YAAI;AAC/C1H,SAAIR,mBAAJ,CAAwB,OAAxB,EAAyC8H,aAAzC;AACAtH,SAAIR,mBAAJ,CAAwB,QAAxB,EAAyC8H,aAAzC;AACAtH,SAAIR,mBAAJ,CAAwB,eAAxB,EAAyC8H,aAAzC;AACAtH,WAAgBxQ,SAAhB;AACAkY,qBAAgBlY,SAAhB;AACA,KANmB;AAAA,IAAD,CAMhBwQ,GANgB,EAMXsH,aANW,CAAnB;;AAQAtH,OAAI4E,eAAJ,CAAoB,SAApB;AACA;;;4BAES5E,G,EACV;AAAA;;AACC,OAAI2H,SAASC,OAAO5H,IAAI0E,YAAJ,CAAiB,OAAjB,CAAP,EACXvQ,KADW,CACL,GADK,EAEXrE,GAFW,CAEP,UAAC+X,CAAD;AAAA,WAAOA,EAAE1T,KAAF,CAAQ,GAAR,CAAP;AAAA,IAFO,EAGXrE,GAHW,CAGN,UAACW,MAAD,EAASuP,GAAT;AAAA,WAAiB,UAAC6H,CAAD,EAAO;AAC7B,SAAIC,YAAeD,EAAE,CAAF,EAAKE,OAAL,CAAa,qBAAb,EAAoC,EAApC,CAAnB;AACA,SAAIC,eAAeH,EAAE,CAAF,CAAnB;AACA,SAAII,UAAe,EAAnB;AACA,SAAI/J,SAAS,8BAA8BC,IAA9B,CAAmC6J,YAAnC,CAAb;AACA,SAAG9J,OAAO3L,MAAV,EAAkB;AACjByV,qBAAe9J,OAAO,CAAP,EAAU6J,OAAV,CAAkB,qBAAlB,EAAyC,EAAzC,CAAf;AACA,UAAG7J,OAAO,CAAP,CAAH,EAAc;AACb+J,iBAAU/J,OAAO,CAAP,EAAU/J,KAAV,CAAgB,GAAhB,EAAqBrE,GAArB,CAAyB;AAAA,eAAKoY,EAAEzS,IAAF,EAAL;AAAA,QAAzB,CAAV;AACA;AACD;;AAED,SAAI0S,oBAAJ;AACA,SAAIpI,SAAS,MAAb;;AAEA,YAAMA,MAAN,EACA;AACC,UAAG,OAAOA,OAAOiI,YAAP,CAAP,IAA+B,UAAlC,EACA;AAAA;AACC,YAAII,UAAgBrI,MAApB;AACA,YAAIsI,gBAAgBL,YAApB;AACAG,sBAAc,uBAAa;AAC1BC,iBAASC,aAAT;AACA,SAFD;AAGA;AAND;;AAAA,8BAMC;AACA;;AAED,UAAGtI,OAAOD,QAAP,IAAmBC,OAAOD,QAAP,CAAgBC,MAAtC,EACA;AACCA,gBAASA,OAAOD,QAAP,CAAgBC,MAAzB;AACA,OAHD,MAIK,IAAGA,OAAOA,MAAV,EACL;AACCA,gBAASA,OAAOA,MAAhB;AACA,OAHI,MAKL;AACC;AACA;AACD;;AAED,SAAI2H,gBAAiB,UAACjX,MAAD,EAASsP,MAAT,EAAiBoI,WAAjB,EAA8BnI,GAA9B;AAAA,aAAsC,UAAClU,KAAD,EAAW;AACrE,WAAIwc,UAAUL,QAAQnY,GAAR,CAAY,UAACqK,GAAD,EAAS;AAClC,YAAI4C,cAAJ;AACA,YAAGwL,SAASpO,GAAT,KAAiBA,GAApB,EACA;AACC,gBAAOA,GAAP;AACA,SAHD,MAIK,IAAGA,QAAQ,OAAR,IAAmBA,QAAQ,QAA9B,EAAwC;AAC5C,gBAAOrO,KAAP;AACA,SAFI,MAGA,IAAGqO,QAAQ,OAAX,EAAoB;AACxB,gBAAO4F,MAAP;AACA,SAFI,MAGA,IAAG5F,QAAQ,MAAX,EAAmB;AACvB,gBAAO6F,GAAP;AACA,SAFI,MAGA,IAAG7F,QAAQ,SAAX,EAAsB;AAC1B,gBAAO,OAAK4F,MAAZ;AACA,SAFI,MAGA,IAAG5F,QAAQ,UAAX,EAAuB;AAC3B,gBAAO,MAAP;AACA,SAFI,MAGA,IAAGA,OAAO,OAAKtM,IAAf,EAAqB;AACzB,gBAAO,OAAKA,IAAL,CAAUsM,GAAV,CAAP;AACA,SAFI,MAGA,IAAG4C,QAAQ,mBAAmBoB,IAAnB,CAAwBhE,GAAxB,CAAX,EACL;AACC,gBAAO4C,MAAM,CAAN,CAAP;AACA;AACD,QA5Ba,CAAd;AA6BA,WAAG,EAAE,OAAOoL,WAAP,IAAsB,UAAxB,CAAH,EAAwC;AACvC,cAAM,IAAI5Y,KAAJ,CACFyY,YADE,mDAKVhI,IAAIwI,SALM,CAAN;AAOA;AACDL,uDAAeG,OAAf;AACA,OAxCoB;AAAA,MAAD,CAwCjB7X,MAxCiB,EAwCTsP,MAxCS,EAwCDoI,WAxCC,EAwCYnI,GAxCZ,CAApB;;AA2CA,aAAO8H,SAAP;AAEC,WAAK,OAAL;AACCJ;AACA;;AAED,WAAK,SAAL;AACC,cAAK1F,MAAL,CAAY3R,IAAZ,CAAiBqX,aAAjB;AACA;;AAED,WAAK,SAAL;AACC,cAAKzF,MAAL,CAAY5R,IAAZ,CAAiBqX,aAAjB;AACA;;AAED;AACC1H,WAAI5D,gBAAJ,CAAqB0L,SAArB,EAAgCJ,aAAhC;;AAEA,cAAKjH,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB2P,YAAIR,mBAAJ,CAAwBsI,SAAxB,EAAmCJ,aAAnC;AACA,QAFD;AAGA;AApBF;;AAuBA,YAAO,CAACI,SAAD,EAAYE,YAAZ,EAA0BC,OAA1B,CAAP;AACA,KA5GK;AAAA,IAAD,CA4GF,IA5GE,EA4GIjI,GA5GJ,CAHO,CAAb;;AAiHAA,OAAI4E,eAAJ,CAAoB,OAApB;AACA;;;8BAEW5E,G,EACZ;AACC,OAAIyI,WAAWzI,IAAI0E,YAAJ,CAAiB,SAAjB,CAAf;;AAEA1E,OAAInE,YAAJ,CAAiB,MAAjB,EAAyB4M,QAAzB;;AAEA,OAAIC,YAAY,SAAZA,SAAY,CAAC5c,KAAD,EAAW;AAC1BA,UAAMG,cAAN;;AAEA,QAAGwc,SAAS7V,SAAT,CAAmB,CAAnB,EAAsB,CAAtB,KAA4B,MAA5B,IACC6V,SAAS7V,SAAT,CAAmB,CAAnB,EAAsB,CAAtB,KAA4B,IADhC,EAEC;AACAzG,YAAOC,IAAP,CAAY4T,IAAI0E,YAAJ,CAAiB,MAAjB,EAAyB+D,QAAzB,CAAZ;;AAEA;AACA;;AAED1b,mBAAOiQ,EAAP,CAAUgD,IAAI0E,YAAJ,CAAiB,MAAjB,CAAV;AACA,IAZD;;AAcA1E,OAAI5D,gBAAJ,CAAqB,OAArB,EAA8BsM,SAA9B;;AAEA,QAAKjI,OAAL,CAAapQ,IAAb,CAAoB,UAAC2P,GAAD,EAAM0H,aAAN;AAAA,WAAwB,YAAI;AAC/C1H,SAAIR,mBAAJ,CAAwB,OAAxB,EAAiCkI,aAAjC;AACA1H,WAAgBxQ,SAAhB;AACAkY,qBAAgBlY,SAAhB;AACA,KAJmB;AAAA,IAAD,CAIhBwQ,GAJgB,EAIX0I,SAJW,CAAnB;;AAMA1I,OAAI4E,eAAJ,CAAoB,SAApB;AACA;;;mCAEgB5E,G,EACjB;AACC,OAAI2I,gBAAgB3I,IAAI0E,YAAJ,CAAiB,cAAjB,CAApB;AACA,OAAI/I,eAAgBxP,OAAO6B,WAA3B;;AAEA,OAAG2a,iBAAiB,OAAjB,IAA4BhN,YAA5B,IACCgN,iBAAiB,MAAjB,IAA2B,CAAChN,YADhC,EAEC;AACAqE,QAAIE,UAAJ,CAAegB,WAAf,CAA2BlB,GAA3B;AACA;AACD;;;8BAEWA,G,EACZ;AAAA;;AACC,OAAI4I,WAAW5I,IAAI0E,YAAJ,CAAiB,SAAjB,CAAf;AACA,OAAImE,YAAY7I,IAAI0E,YAAJ,CAAiB,UAAjB,CAAhB;AACA1E,OAAI4E,eAAJ,CAAoB,SAApB;AACA5E,OAAI4E,eAAJ,CAAoB,UAApB;;AAEA,OAAIkE,cAAc9I,IAAI+F,SAAtB;;AAEA,OAAIgD,aAAa,EAAjB;;AAEA,OAAGF,SAAH,EACA;AACCE,iBAAaF,UAAU1U,KAAV,CAAgB,GAAhB,EAAqBrE,GAArB,CAAyB;AAAA,YAAGoY,EAAEzS,IAAF,EAAH;AAAA,KAAzB,CAAb;AACA;;AAED,OAAIwC,SAAS,KAAKpK,IAAL,CAAUc,MAAV,CAAiBia,QAAjB,EAA2B,UAAC9W,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAAa;AACpD,QAAG,OAAKmQ,SAAL,CAAerQ,CAAf,CAAH,EACA;AACC,YAAKqQ,SAAL,CAAerQ,CAAf,EAAkB7B,MAAlB;AACA;;AAED,WAAM8P,IAAIO,UAAV,EACA;AACCP,SAAIkB,WAAJ,CAAgBlB,IAAIO,UAApB;AACA;;AAED,QAAIpE,OAAO,IAAIxO,IAAJ,EAAX;;AAEA,WAAK8S,OAAL,CAAapQ,IAAb,CAAmB,UAAC8L,IAAD;AAAA,YAAQ,YAAI;AAC9BA,WAAKjM,MAAL;AACA,MAFkB;AAAA,KAAD,CAEfiM,IAFe,CAAlB;;AAIAA,SAAKtQ,QAAL,GAAgBid,WAAhB;AACA3M,SAAK4D,MAAL,GAAgB,MAAhB;;AAlBoD,iCAoB5CzR,CApB4C;AAsBnD,SAAI2J,SAAS,OAAKpK,IAAL,CAAUc,MAAV,CAAiBoa,WAAWza,CAAX,CAAjB,EAAgC,UAACwD,CAAD,EAAIC,CAAJ,EAAU;AACtDoK,WAAKtO,IAAL,CAAUkE,CAAV,IAAeD,CAAf;AACA,MAFY,CAAb;;AAIAqK,UAAKsE,OAAL,CAAapQ,IAAb,CAAkB4H,MAAlB;AACA,YAAKwI,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB4H;AACAkE,WAAKjM,MAAL;AACA,MAHD;AA3BmD;;AAoBpD,SAAI,IAAI5B,CAAR,IAAaya,UAAb,EACA;AAAA,YADQza,CACR;AAUC;;AA/BmD,iCAiC5CA,CAjC4C;AAmCnD,SAAI2J,SAASnG,EAAEnD,MAAF,CAASL,CAAT,EAAY,UAACwD,CAAD,EAAIC,CAAJ,EAAU;AAClCoK,WAAKtO,IAAL,CAAUkE,CAAV,IAAeD,CAAf;AACA,MAFY,CAAb;;AAIA,YAAK2O,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB4H;AACA,UAAG,CAACnG,EAAEU,OAAF,EAAJ,EACA;AACC1E,0BAASkT,aAAT,CAAuBlP,CAAvB;AACA;AACDqK,WAAKjM,MAAL;AACA,MAPD;;AASAiM,UAAKsE,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB4H;AACA,UAAG,CAACnG,EAAEU,OAAF,EAAJ,EACA;AACC1E,0BAASkT,aAAT,CAAuBlP,CAAvB;AACA;AACD,MAND;AAhDmD;;AAiCpD,SAAI,IAAIxD,CAAR,IAAawD,CAAb,EACA;AAAA,YADQxD,CACR;AAqBC;;AAED6N,SAAKyE,MAAL,CAAYZ,GAAZ;;AAEA,WAAKoC,SAAL,CAAerQ,CAAf,IAAoBoK,IAApB;AACA,IA5DY,CAAb;;AA8DA,QAAKsE,OAAL,CAAapQ,IAAb,CAAkB4H,MAAlB;AACA;;;8BAEW+H,G,EACZ;AAAA;;AACC,OAAIgJ,WAAWhJ,IAAI0E,YAAJ,CAAiB,SAAjB,CAAf;AACA1E,OAAI4E,eAAJ,CAAoB,SAApB;;AAEA,OAAIkE,cAAc9I,IAAI+F,SAAtB;;AAEA,UAAM/F,IAAIO,UAAV,EACA;AACCP,QAAIkB,WAAJ,CAAgBlB,IAAIO,UAApB;AACA;;AAED;;AAEA;AACA;AACA;AACA;;AAhBD,yBAkBmCyI,SAAS7U,KAAT,CAAe,GAAf,CAlBnC;AAAA;AAAA,OAkBM8U,QAlBN;AAAA,OAkBgBC,MAlBhB;AAAA,OAkBwBC,OAlBxB;;AAoBC,OAAIlR,SAAS,KAAKpK,IAAL,CAAUc,MAAV,CAAiBsa,QAAjB,EAA2B,UAACnX,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAa;AACpD,QAAG,OAAKiQ,SAAL,CAAe8G,QAAf,CAAH,EACA;AACC,YAAK9G,SAAL,CAAe8G,QAAf,EAAyB/Y,MAAzB;AACA;;AAED,QAAI4P,WAAW,IAAIsJ,kBAAJ,CAAaN,WAAb,EAA0BI,MAA1B,EAAkCpX,CAAlC,EAAqC,MAArC,EAA2CqX,OAA3C,CAAf;;AAEA,WAAK1I,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrByP,cAAS5P,MAAT;AACA,KAFD;;AAIA,QAAImZ,UAAU,OAAKxb,IAAL,CAAUc,MAAV,CAAiB,UAACmD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAAW;AACzC,SAAGF,KAAK,KAAR,EACA;AACC;AACA;;AAED;;AAEA,SAAG+N,SAASjS,IAAT,CAAcyb,OAAd,CAAsBvX,CAAtB,MAA6BD,CAAhC,EACA;AACC;AACAgO,eAASjS,IAAT,CAAcyb,OAAd,CAAsBvX,CAAtB,IAA2BD,CAA3B;AACA;AACD,KAba,CAAd;;AAeA,SAAI,IAAIxD,CAAR,IAAa,OAAKT,IAAlB,EACA;AACC,SAAGS,KAAK,KAAR,EACA;AACC;AACA;;AAEDwR,cAASjS,IAAT,CAAcyb,OAAd,CAAsBvX,CAAtB,IAA2B,OAAKlE,IAAL,CAAUS,CAAV,CAA3B;AACA;;AAED,QAAIib,UAAUzJ,SAASjS,IAAT,CAAcc,MAAd,CAAqB,UAACmD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAa;AAC/C,SAAGH,KAAK,KAAL,IAAcA,EAAEa,SAAF,CAAY,CAAZ,EAAc,CAAd,MAAqB,KAAtC,EACA;AACC;AACA;;AAED,SAAI4W,SAAS1X,CAAb;AACA,SAAI2X,SAASvX,CAAb,CAP+C,CAOhC;;AAEf,SAAGJ,aAAanE,IAAhB,EACA;AACC6b,eAAS1X,EAAE4B,SAAX;AACA;;AAED,SAAGxB,aAAavE,IAAhB,EACA;AACC8b,eAASvX,EAAEwB,SAAX;AACA;;AAED,SAAG8V,WAAWC,MAAX,IAAqBzX,EAAED,CAAF,aAAgBpE,IAAxC,EACA;AACCqE,QAAED,CAAF,EAAK7B,MAAL;AACA;;AAED,SAAI6B,KAAK,OAAKlE,IAAX,IAAoB2b,WAAWC,MAAlC,EACA;AACC,aAAK5b,IAAL,CAAUkE,CAAV,IAAeD,CAAf;AACA;AACD,KA5Ba,EA4BX,EAAC/C,MAAK,CAAN,EA5BW,CAAd;;AA8BA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,WAAK0R,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrBgZ;AACAE;AACA,KAHD;;AAKA,WAAMvJ,IAAIO,UAAV,EACA;AACCP,SAAIkB,WAAJ,CAAgBlB,IAAIO,UAApB;AACA;;AAED,WAAK4B,SAAL,CAAe8G,QAAf,IAA2BnJ,QAA3B;;AAEAA,aAASc,MAAT,CAAgBZ,GAAhB;AACA,IAnGY,CAAb;;AAqGA,QAAKS,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB4H;AACA,IAFD;AAGA;;;4BAES+H,G,EACV;AAAA;;AACC,OAAI0J,aAAa1J,IAAI0E,YAAJ,CAAiB,OAAjB,CAAjB;;AAEA1E,OAAI4E,eAAJ,CAAoB,OAApB;;AAEA,OAAIkE,cAAc9I,IAAI+F,SAAtB;;AAEA,OAAI4D,WAAW,KAAf;;AAEA,OAAGD,WAAWxU,MAAX,CAAkB,CAAlB,EAAqB,CAArB,MAA4B,GAA/B,EACA;AACCyU,eAAa,IAAb;AACAD,iBAAaA,WAAWxU,MAAX,CAAkB,CAAlB,CAAb;AACA;;AAED,UAAM8K,IAAIO,UAAV,EACA;AACCP,QAAIkB,WAAJ,CAAgBlB,IAAIO,UAApB;AACA;;AAED,OAAIqJ,QAAQzU,SAASqO,WAAT,GAAuBC,wBAAvB,CAAgD,EAAhD,CAAZ;;AAEA,OAAItH,OAAO,IAAIxO,IAAJ,EAAX;;AAEAwO,QAAKtQ,QAAL,GAAgBid,WAAhB;AACA3M,QAAK4D,MAAL,GAAgB,IAAhB;;AAEA,OAAIsJ,UAAU,KAAKxb,IAAL,CAAUc,MAAV,CAAiB,UAACmD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAAW;AACzC,QAAGF,KAAK,KAAR,EACA;AACC;AACA;;AAED,QAAGoK,KAAKtO,IAAL,CAAUkE,CAAV,MAAiBD,CAApB,EACA;AACCqK,UAAKtO,IAAL,CAAUkE,CAAV,IAAeD,CAAf;AACA;AACD,IAVa,CAAd;;AAYA,QAAI,IAAIxD,CAAR,IAAa,KAAKT,IAAlB,EACA;AACC,QAAGS,KAAK,KAAR,EACA;AACC;AACA;;AAED6N,SAAKtO,IAAL,CAAUS,CAAV,IAAe,KAAKT,IAAL,CAAUS,CAAV,CAAf;AACA;;AAED,OAAIib,UAAUpN,KAAKtO,IAAL,CAAUc,MAAV,CAAiB,UAACmD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAa;AAC3C,QAAGH,KAAK,KAAR,EACA;AACC;AACA;;AAED,QAAIyX,SAAS1X,CAAb;AACA,QAAI2X,SAASvX,CAAb;;AAEA,QAAGJ,aAAanE,IAAhB,EACA;AACC6b,cAAS1X,EAAE4B,SAAX;AACA;;AAED,QAAGxB,aAAavE,IAAhB,EACA;AACC8b,cAASvX,EAAEwB,SAAX;AACA;;AAED,QAAG8V,WAAWC,MAAX,IAAqBvX,aAAavE,IAArC,EACA;AACCuE,OAAEhC,MAAF;AACA;;AAED,QAAI6B,KAAK,QAAKlE,IAAX,IAAoB2b,WAAWC,MAAlC,EACA;AACC,aAAK5b,IAAL,CAAUkE,CAAV,IAAeD,CAAf;AACA;AACD,IA5Ba,EA4BX,EAAC/C,MAAK,CAAN,EA5BW,CAAd;;AA8BA,OAAI8a,UAAU,IAAd;;AAEA,UAAMA,QAAQ9J,MAAd,EACA;AACC8J,cAAUA,QAAQ9J,MAAlB;AACA;;AAED,QAAKU,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrBgZ;AACAE;AACA;AACA,IAJD;;AAMApN,QAAKyE,MAAL,CAAYZ,GAAZ;;AAEA,OAAIe,QAAW,KAAKlT,IAApB;AACA,OAAI2D,WAAWkY,UAAf;;AAEA,OAAGA,WAAW3M,KAAX,CAAiB,IAAjB,CAAH,EACA;AAAA,6BACqBjP,mBAASI,OAAT,CACnB,KAAKL,IADc,EAEjB6b,UAFiB,EAGjB,IAHiB,CADrB;;AAAA;;AACE3I,SADF;AACSvP,YADT;AAMC;;AAED,OAAIyG,SAAS8I,MAAMpS,MAAN,CACZ6C,QADY,EAEV,UAACM,CAAD,EAAGC,CAAH,EAAS;AACV,QAAGqB,MAAMC,OAAN,CAAcvB,CAAd,CAAH,EACA;AACCA,SAAI,CAAC,CAACA,EAAES,MAAR;AACA;;AAED,QAAGoX,QAAH,EACA;AACC7X,SAAI,CAACA,CAAL;AACA;;AAED,QAAGA,CAAH,EACA;AACCqK,UAAKyE,MAAL,CAAYZ,GAAZ;AACA,KAHD,MAKA;AACC,YAAMA,IAAIO,UAAV,EACA;AACCP,UAAIO,UAAJ,CAAerQ,MAAf;AACA;AACDiM,UAAKyE,MAAL,CAAYgJ,KAAZ;AACA;AACD,IAzBW,CAAb;;AA4BA,QAAKnJ,OAAL,CAAapQ,IAAb,CAAkB,YAAI;AACrB4H;AACA,QAAG,CAAC8I,MAAMvO,OAAN,EAAJ,EACA;AACC1E,wBAASkT,aAAT,CAAuBD,KAAvB;AACA;AACD,IAND;AAOA;;;6BAEUb,U,EACX,CAEC;;;iCAEc4J,G,EACf;AACC,UAAO,CAAC,CAAElC,OAAOkC,GAAP,EAAY/M,KAAZ,CAAkB,KAAK8F,gBAAvB,CAAV;AACA;;;yBAEM;AACN,UAAO,CAAC,CAAC,GAAD,IAAM,CAAC,GAAP,GAAW,CAAC,GAAZ,GAAgB,CAAC,GAAjB,GAAqB,CAAC,IAAvB,EAA6BkF,OAA7B,CACN,QADM,EAEJ;AAAA,WAAK,CACN1S,IAAI0U,OAAOC,eAAP,CAAuB,IAAIC,UAAJ,CAAe,CAAf,CAAvB,EAA0C,CAA1C,IAA+C,MAAM5U,IAAI,CADvD,EAELmH,QAFK,CAEI,EAFJ,CAAL;AAAA,IAFI,CAAP;AAMA;;;2BAED;AACC,OAAIyE,cAAc,IAAI9D,KAAJ,CAAU,eAAV,CAAlB;;AAEA,QAAI,IAAI7O,IAAR,IAAa,KAAK+T,IAAlB,EACA;AACC,QAAGjP,MAAMC,OAAN,CAAc,KAAKgP,IAAL,CAAU/T,IAAV,CAAd,CAAH,EACA;AACC,UAAI,IAAImE,CAAR,IAAa,KAAK4P,IAAL,CAAU/T,IAAV,CAAb,EACA;AACC,WAAK+T,IAAL,CAAU/T,IAAV,EAAamE,CAAb,EAAgBvC,MAAhB;AACA;AACD;AACA;AACD,SAAKmS,IAAL,CAAU/T,IAAV,EAAa4B,MAAb;AACA;;AAED,QAAI,IAAI5B,IAAR,IAAa,KAAK8Q,KAAlB,EACA;AACC,SAAKA,KAAL,CAAW9Q,IAAX,EAAc0I,aAAd,CAA4BiK,WAA5B;AACA,SAAK7B,KAAL,CAAW9Q,IAAX,EAAc4B,MAAd;AACA;;AAED,OAAIuQ,gBAAJ;;AAEA,UAAMA,UAAU,KAAKA,OAAL,CAAa7M,KAAb,EAAhB,EACA;AACC6M;AACA;;AAED,QAAI,IAAInS,IAAR,IAAa,KAAK6T,SAAlB,EACA;AACC,QAAG,CAAC,KAAKA,SAAL,CAAe7T,IAAf,CAAJ,EACA;AACC;AACA;AACD,SAAK6T,SAAL,CAAe7T,IAAf,EAAkB4B,MAAlB;AACA;;AAED,QAAKiS,SAAL,GAAiB,EAAjB;;AAEA,QAAI,IAAI7T,IAAR,IAAa,KAAKiU,QAAlB,EACA;AACCjW,kBAAc,KAAKiW,QAAL,CAAcjU,IAAd,EAAiByM,OAA/B;AACA,WAAO,KAAKwH,QAAL,CAAcjU,IAAd,CAAP;AACA;;AAED,QAAI,IAAIA,CAAR,IAAa,KAAKgU,SAAlB,EACA;AACChW,kBAAc,KAAKgW,SAAL,CAAehU,CAAf,EAAkByM,OAAhC;AACA,WAAO,KAAKuH,SAAL,CAAehU,CAAf,CAAP;AACA;;AAED,QAAKmB,OAAL,GAAe,IAAf;;AAEA;AACA;;;2BAGD,CAEC;;;+BAEY5B,I,EACb,CAEC;;;8BAEWA,I,EACZ,CAEC;;;gCAEa4Y,Y,EACd;AACC,OAAIyD,gBAA0BzD,aAAatS,KAAb,CAAmB,GAAnB,CAA9B;AACA,OAAIgW,oBAA0BD,cAAeA,cAAc3X,MAAd,GAAuB,CAAtC,CAA9B;AACA,OAAIoU,WAA0ByD,QAAQ3D,YAAR,CAA9B;;AAEA,UAAOE,SAASwD,iBAAT,CAAP;AACA;;;2BAz6CD;AACC,UAAOxc,IAAP;AACA;;;;;;;;;;;;;;;;;AC7DF;;AACA;;;;IAEayb,Q;AAEZ,mBAAYvd,QAAZ,EAAsBwe,WAAtB,EAAmC9I,IAAnC,EAAyCxB,MAAzC,EACA;AAAA;;AAAA,MADiDuK,WACjD,uEAD+D,IAC/D;;AAAA;;AACC,OAAKzc,IAAL,GAAoBC,mBAASC,YAAT,CAAsB,EAAtB,CAApB;AACA,OAAKF,IAAL,CAAUkD,KAAV,GAAoBjD,mBAASC,YAAT,CAAsBwT,QAAQ,EAA9B,CAApB;AACA,OAAK1T,IAAL,CAAUyb,OAAV,GAAoBxb,mBAASC,YAAT,CAAsB,EAAtB,CAApB;AACA,OAAKsT,KAAL,GAAoB,EAApB;AACA,OAAKZ,OAAL,GAAoB,EAApB;AACA,OAAK5U,QAAL,GAAoBA,QAApB;AACA,OAAKwe,WAAL,GAAoBA,WAApB;AACA,OAAKC,WAAL,GAAoBA,WAApB;AACA,OAAKtK,GAAL,GAAoB,IAApB;AACA,OAAKmB,MAAL,GAAoB,KAApB;AACA,OAAKpB,MAAL,GAAoBA,MAApB;;AAEA,OAAKlS,IAAL,CAAUkD,KAAV,CAAgBM,YAAhB,CAA6BhB,IAA7B,CAAkC,UAAC2B,CAAD,EAAK;AACtC,OAAGA,EAAEsB,eAAF,IAAqB,QAAxB,EACA;AACC;AACA;AACD,SAAK6N,MAAL,GAAc,IAAd;AACA,GAND;;AAQA,OAAKtT,IAAL,CAAUkD,KAAV,CAAgBO,WAAhB,CAA4BjB,IAA5B,CAAiC,UAAC2B,CAAD,EAAK;AACrC,OAAGA,EAAEsB,eAAF,IAAqB,QAAxB,EACA;AACC;AACA;;AAED,SAAK6N,MAAL,GAAcnP,EAAEb,WAAF,CAAcoB,MAAd,GAAuB,CAArC;;AAEA,SAAKgY,QAAL;AAEA,GAVD;;AAYA,MAAItS,SAAS,KAAKpK,IAAL,CAAUkD,KAAV,CAAgBpC,MAAhB,CAAuB,UAACmD,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,EAAgB;;AAEnD,OAAG,MAAKkP,MAAR,EACA;AACC;AACA;;AAED,OAAGlP,CAAH,EACA;AACC,QAAG,MAAKoP,KAAL,CAAWtP,CAAX,CAAH,EACA;AACC,WAAKsP,KAAL,CAAWtP,CAAX,EAAc7B,MAAd;AACA;;AAED,UAAKmR,KAAL,CAAW7Q,MAAX,CAAkBuB,CAAlB,EAAoB,CAApB;;AAEA,SAAI,IAAIzD,CAAR,IAAa,MAAK+S,KAAlB,EACA;AACC,WAAKA,KAAL,CAAW/S,CAAX,EAAcT,IAAd,CAAoB,MAAKyc,WAAzB,IAAyChc,CAAzC;AACA;;AAED;AACA;;AAED,OAAG,CAAC,MAAK+S,KAAL,CAAWtP,CAAX,CAAJ,EACA;AACC,UAAKwY,QAAL;AACA;AACD,GA5BY,EA4BV,EAACxb,MAAM,CAAP,EA5BU,CAAb;;AA8BA,OAAK0R,OAAL,CAAapQ,IAAb,CAAkB4H,MAAlB;AACA;;;;yBAEM+H,G,EACP;AACC,QAAI,IAAI1R,CAAR,IAAa,KAAK+S,KAAlB,EACA;AACC,SAAKA,KAAL,CAAW/S,CAAX,EAAcsS,MAAd,CAAqBZ,GAArB;AACA;;AAED,QAAKA,GAAL,GAAWA,GAAX;AACA;;;6BAGD;AAAA;;AACC,OAAG,KAAKmB,MAAL,IAAe,CAAC,KAAKnB,GAAxB,EACA;AACC;AACA;;AAED,OAAIqB,QAAQ,EAAZ;;AAEA,QAAI,IAAI/S,CAAR,IAAa,KAAK+S,KAAlB,EACA;AACCA,UAAM/S,CAAN,IAAW,KAAK+S,KAAL,CAAW/S,CAAX,CAAX;AACA;;AAED,OAAIkc,aAAa,EAAjB;;AAEA,QAAI,IAAIlc,EAAR,IAAa,KAAKT,IAAL,CAAUkD,KAAvB,EACA;AACC,QAAI0Z,QAAQ,KAAZ;;AAEA,SAAI,IAAIhY,CAAR,IAAa4O,KAAb,EACA;AACC,SAAGA,MAAM5O,CAAN,KACC,KAAK5E,IAAL,CAAUkD,KAAV,CAAgBzC,EAAhB,MAAuB+S,MAAM5O,CAAN,EAAS5E,IAAT,CAAe,KAAKwc,WAApB,CAD3B,EAEC;AACAI,cAAQ,IAAR;AACAD,iBAAWlc,EAAX,IAAgB+S,MAAM5O,CAAN,CAAhB;AACA+X,iBAAWlc,EAAX,EAAcT,IAAd,CAAoB,KAAKyc,WAAzB,IAAyChc,EAAzC;AACA,aAAO+S,MAAM5O,CAAN,CAAP;AACA;AACA;AACD;;AAED,QAAG,CAACgY,KAAJ,EACA;AAAA;AACC,UAAIC,WAAW,EAAf;AACA,UAAIvO,OAAOqO,WAAWlc,EAAX,IAAgB,IAAIX,UAAJ,CAAS+c,QAAT,CAA3B;;AAEAF,iBAAWlc,EAAX,EAAczC,QAAd,GAAyB,OAAKA,QAA9B;AACA2e,iBAAWlc,EAAX,EAAcyR,MAAd,GAAyB,OAAKA,MAA9B;AACAyK,iBAAWlc,EAAX,EAAcwR,QAAd,GAAyB,MAAzB;;AAEA0K,iBAAWlc,EAAX,EAAcT,IAAd,CAAoB,OAAKyc,WAAzB,IAAyChc,EAAzC;AACAkc,iBAAWlc,EAAX,EAAcT,IAAd,CAAoB,OAAKwc,WAAzB,IAAyC,OAAKxc,IAAL,CAAUkD,KAAV,CAAgBzC,EAAhB,CAAzC;;AAEA,aAAKmS,OAAL,CAAapQ,IAAb,CACC,OAAKxC,IAAL,CAAUkD,KAAV,CAAgBpC,MAAhB,CAAuBL,EAAvB,EAA0B,UAACwD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAS;AAClC;AACA;AACA,OAHD,CADD;;AAOA,aAAKyO,OAAL,CAAapQ,IAAb,CACCqa,SAAS/b,MAAT,CAAgB,OAAK0b,WAArB,EAAkC,UAACvY,CAAD,EAAGC,CAAH,EAAO;AACxC,WAAI+O,QAAQ4J,SAAU,OAAKJ,WAAf,CAAZ;AACA,cAAKzc,IAAL,CAAUkD,KAAV,CAAgB+P,KAAhB,IAAyBhP,CAAzB;AACA,OAHD,CADD;;AAOA,aAAK2O,OAAL,CAAapQ,IAAb,CACC,OAAKxC,IAAL,CAAUyb,OAAV,CAAkB3a,MAAlB,CAAyB,UAACmD,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,EAAgB;AACxCyY,gBAAS3Y,CAAT,IAAcD,CAAd;AACA,OAFD,CADD;;AAMA4Y,eAAS,OAAKL,WAAd,IAA6B,OAAKxc,IAAL,CAAUkD,KAAV,CAAgBzC,EAAhB,CAA7B;AA/BD;AAgCC;AACD;;AAED,QAAI,IAAIA,GAAR,IAAa+S,KAAb,EACA;AACC,QAAIoJ,SAAQ,KAAZ;;AAEA,SAAI,IAAIhY,EAAR,IAAa+X,UAAb,EACA;AACC,SAAGnJ,MAAM/S,GAAN,MAAakc,WAAW/X,EAAX,CAAhB,EACA;AACCgY,eAAQ,IAAR;AACA;AACA;AACD;;AAED,QAAG,CAACA,MAAJ,EACA;AACCpJ,WAAM/S,GAAN,EAAS4B,MAAT;AACA;AACD;;AAED,OAAIya,aAAa,IAAjB;;AAEA,QAAI,IAAIrc,GAAR,IAAa,KAAK+S,KAAlB,EACA;AACC,QAAG,KAAKA,KAAL,CAAW/S,GAAX,MAAkBkc,WAAWlc,GAAX,CAArB,EACA;AACCqc,kBAAa,KAAb;AACA;AACD;;AAED,QAAI,IAAIrc,GAAR,IAAakc,UAAb,EACA;AACC,QAAGA,WAAWlc,GAAX,MAAkB,KAAK+S,KAAL,CAAW/S,GAAX,CAArB,EACA;AACC;AACA;;AAED+S,UAAM7Q,MAAN,CAAalC,MAAE,CAAf,EAAkB,CAAlB,EAAqBkc,WAAWlc,GAAX,CAArB;;AAEAkc,eAAWlc,GAAX,EAAcsS,MAAd,CAAqB,KAAKZ,GAA1B;AACA;;AAED,QAAI,IAAI1R,GAAR,IAAakc,UAAb,EACA;AACCA,eAAWlc,GAAX,EAAcT,IAAd,CAAoB,KAAKyc,WAAzB,IAAyChc,GAAzC;AACA;;AAED,QAAK+S,KAAL,GAAamJ,UAAb;AACA;;;0BAED;AAAA,OADM9L,MACN,uEADY,IACZ;;AACC,QAAI,IAAIpQ,CAAR,IAAa,KAAK+S,KAAlB,EACA;AACC,SAAKA,KAAL,CAAW/S,CAAX,EAAcoQ,KAAd,CAAoBA,MAApB;AACA;AACD;;;2BAED;AACC,QAAI,IAAIpQ,CAAR,IAAa,KAAK+S,KAAlB,EACA;AACC,SAAKA,KAAL,CAAW/S,CAAX,EAAc4B,MAAd;AACA;;AAED,OAAIuQ,gBAAJ;;AAEA,UAAM,KAAKA,OAAL,CAAalO,MAAnB,EACA;AACCkO,cAAU,KAAKA,OAAL,CAAarT,GAAb,EAAV;AACAqT;AACA;;AAED,QAAKY,KAAL,GAAa,EAAb;;AAEA,UAAM,KAAKrB,GAAL,IAAY,KAAKA,GAAL,CAASO,UAA3B,EACA;AACC,SAAKP,GAAL,CAASkB,WAAT,CAAqB,KAAKlB,GAAL,CAASO,UAA9B;AACA;;AAEDzS,sBAASkT,aAAT,CAAuB,KAAKnT,IAAL,CAAUyb,OAAjC;AACAxb,sBAASkT,aAAT,CAAuB,KAAKnT,IAA5B;;AAEA,OAAG,CAAC,KAAKA,IAAL,CAAUkD,KAAV,CAAgByB,OAAhB,EAAJ,EACA;AACC1E,uBAASkT,aAAT,CAAuB,KAAKnT,IAAL,CAAUkD,KAAjC;AACA;AACD;;;;;;;;;;;;;;;;;;;AC3OF;;;;;;;;IAEa6Z,W,WAAAA,W;;;AACZ,sBAAYxT,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EAAuC;AAAA;;AAAA,wHAChC0H,MADgC,EACxB4B,IADwB,EAClB+G,MADkB,EACVrQ,GADU;;AAEtC,QAAK7B,IAAL,CAAUP,KAAV,GAAkB,MAAKO,IAAL,CAAUP,KAAV,IAAmB,MAAKO,IAAL,CAAUkD,KAA/C;AACA,QAAKlF,QAAL,uCAEW,MAAKgC,IAAL,CAAUiH,IAFrB,gCAGiB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHjC,6FAMe,MAAKnM,IAAL,CAAUiH,IANzB,+BAOe,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAP/B;AAHsC;AAiBtC;;;;0BACOlO,K,EAAO;AACd,OAAG,KAAK+B,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,IAAwB,QAA3B,EACA;AACClO,UAAMG,cAAN;AACAH,UAAM+e,eAAN;AACA,SAAK7R,IAAL,CAAUqJ,IAAV,CAAeyI,OAAf,CAAuBpL,OAAvB,CAA+B1I,aAA/B,CAA6C,IAAImG,KAAJ,CAC5C,QAD4C,EAClC;AACT,mBAAc,IADL;AAEP,gBAAY;AAFL,KADkC,CAA7C;AAMA;AACD;;;;EA/B+B4N,a;;;;;;;;;;;;;ACFjC;;AACA;;;;;;;;IAEaA,K,WAAAA,K;;;AACZ,gBAAY3T,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EAAuC;AAAA;;AACtC,MAAI4J,WAAWhK,OAAO0b,MAAP,CAAc,EAAd,EAAkB5T,MAAlB,CAAf;;AADsC,4GAGhCkC,QAHgC;;AAKtC,QAAKzL,IAAL,CAAUP,KAAV,GAAkB,MAAKO,IAAL,CAAUP,KAAV,IAAmB,EAArC;AACA,QAAKO,IAAL,CAAUkD,KAAV,GAAkB,MAAKlD,IAAL,CAAUkD,KAAV,KAAoB,IAApB,GAA4B,EAA5B,GAAiC,MAAKlD,IAAL,CAAUkD,KAA7D;AACA,QAAKA,KAAL,GAAkB,MAAKlD,IAAL,CAAUkD,KAA5B;AACA,QAAKuI,QAAL,GAAkBA,QAAlB;AACA,QAAK2R,QAAL,GAAkB,IAAlB;;AAEA,QAAKpd,IAAL,CAAUqd,WAAV,GAAwB,EAAxB;;AAEA,QAAKlS,IAAL,GAAcA,IAAd;AACA,QAAK+G,MAAL,GAAcA,MAAd;AACA,QAAKrQ,GAAL,GAAcA,GAAd;;AAEA,QAAKyb,MAAL,GAAc,MAAKtd,IAAL,CAAUkX,KAAV,CAAgB,gBAAhB,KAAqC,KAAnD;;AAEA,MAAIqG,QAAQ,EAAZ;;AAEA,MAAG,MAAKvd,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,IAAwB,UAA3B,EACA;AACCoR,WAAQ,aAAR;AACA;;AAED,QAAKvf,QAAL,iDAEqB,MAAKgC,IAAL,CAAUiH,IAF/B,oCAGqB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHrC,sOAUkB,MAAKnM,IAAL,CAAUiH,IAV5B,mCAWkB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,IAAsB,MAXxC,sIAeKoR,KAfL;AAmBA;;AAEA;AACA,MAAIC,UAAU,IAAd;;AAEA,QAAKxd,IAAL,CAAUc,MAAV,CAAiB,OAAjB,EAA0B,UAACmD,CAAD,EAAIC,CAAJ,EAAU;AACnC,SAAKhB,KAAL,GAAae,CAAb;;AAEA,OAAGuZ,WAAWtZ,CAAd,EACA;AACC;AACA;;AAEDsZ,aAAU3b,GAAV;;AAEA,SAAK7B,IAAL,CAAUqd,WAAV,GAAwB5V,KAAK8C,SAAL,CAAetG,KAAG,EAAlB,EAAsB,IAAtB,EAA4B,CAA5B,CAAxB;AACA,SAAKoZ,WAAL,GAAmB,MAAKrd,IAAL,CAAUqd,WAA7B;;AAEA,OAAG,MAAKrd,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,IAAwB,MAAxB,IACC,MAAKqI,IAAL,CAAUiJ,KADX,IAEC,MAAKjJ,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwB+H,KAFzB,IAGC,MAAKpF,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwBnN,MAH5B,EAIC;AACA,QAAG,CAAC,MAAK1E,IAAL,CAAUkX,KAAV,CAAgBwG,QAApB,EACA;AACC,WAAKxL,MAAL,CAAYlS,IAAZ,CAAiBkD,KAAjB,CAAuBrB,GAAvB,IAA8B,MAAK2S,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwB+H,KAAxB,CAA8B,CAA9B,CAA9B;AACA,KAHD,MAKA;AACC,WAAK1H,MAAL,CAAYlS,IAAZ,CAAiBkD,KAAjB,CAAuBrB,GAAvB,IAA8B0D,MAAMoU,IAAN,CAAW,MAAKnF,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwB+H,KAAnC,CAA9B;AACA;AACD,IAbD,MAeA;AACC,QAAG,CAAC,MAAK1H,MAAL,CAAYlS,IAAZ,CAAiBkD,KAArB,EACA;AACC,WAAKgP,MAAL,CAAYlS,IAAZ,CAAiBkD,KAAjB,GAAyB,EAAzB;AACA;;AAED,UAAKgP,MAAL,CAAYlS,IAAZ,CAAiBkD,KAAjB,CAAuBrB,GAAvB,IAA8BoC,CAA9B;AACA;AACDuZ,aAAU,IAAV;AACA,GArCD,EAqCG,EAACtc,MAAM,CAAP,EArCH;;AAuCA;;AAEA,QAAKgR,MAAL,CAAYlS,IAAZ,CAAiBkD,KAAjB,CAAuB,MAAKrB,GAA5B,IAAmC,MAAK7B,IAAL,CAAUkD,KAA7C;;AAEA,QAAKgP,MAAL,CAAYlS,IAAZ,CAAiBkD,KAAjB,CAAuBpC,MAAvB,CAA8Be,GAA9B,EAAmC,UAACoC,CAAD,EAAIC,CAAJ,EAAQ;;AAE1C,OAAGsZ,WAAWtZ,CAAd,EACA;AACC;AACA;;AAEDsZ,aAAUtZ,CAAV;;AAGA,OAAG,MAAKlE,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,IAAwB,MAA3B,EACA;AACC,QAAG,MAAKqI,IAAL,CAAUiJ,KAAV,IACE,MAAKjJ,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwB+H,KAD1B,IAEE,MAAKpF,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwB+H,KAAxB,CAA8BlV,MAFnC,EAGC;AACA,SAAG,CAAC,MAAK1E,IAAL,CAAUkX,KAAV,CAAgBwG,QAApB,EACA;AACC,YAAKxL,MAAL,CAAYlS,IAAZ,CAAiBkD,KAAjB,CAAuBrB,GAAvB,IAA8B,MAAK2S,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwB+H,KAAxB,CAA8B,CAA9B,CAA9B;AACA,MAHD,MAKA;AACC,YAAK1H,MAAL,CAAYlS,IAAZ,CAAiBkD,KAAjB,CAAuBrB,GAAvB,IAA8B0D,MAAMoU,IAAN,CAAW,MAAKnF,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwB+H,KAAnC,CAA9B;AACA;AACD,KAZD,MAcA;AACC,WAAK5Z,IAAL,CAAUkD,KAAV,GAAkBe,CAAlB;AACA;AACD,IAnBD,MAqBA;AACC,UAAKjE,IAAL,CAAUkD,KAAV,GAAkBe,CAAlB;AACA;;AAEDuZ,aAAU,IAAV;AACA,GApCD;AA7FsC;AAkItC;;;;4BAGD;AACC,OAAG,KAAKG,WAAL,EAAH,EACA;AACC;AACA;AACA;AACA;AACA;;AAED,QAAKP,QAAL,GAAgB,UAAhB;AACA;;;2BAGD;AACC,OAAG,KAAKO,WAAL,EAAH,EACA;AACC;AACA;AACA;AACA;AACA;;AAED,QAAKP,QAAL,GAAgB,KAAhB;AACA;;;gCAGD;AACC,UAAO,KAAP;AACA;;;4BAGD;AACC,OAAG,KAAK5I,IAAL,CAAUiJ,KAAb,EACA;AACC,WAAO,KAAKjJ,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwBgF,YAAxB,CAAqC,MAArC,CAAP;AACA;;AAED,UAAO,KAAK7W,IAAL,CAAUiH,IAAjB;AACA;;;;EA5KyBnH,W;;;;;;;;;;;;;ACH3B;;AACA;;;;;;;;IAEa8d,Q,WAAAA,Q;;;AAEZ,mBAAYrU,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EACA;AAAA;;AAAA,kHACO0H,MADP,EACe4B,IADf,EACqB+G,MADrB,EAC6BrQ,GAD7B;;AAEC,QAAK7B,IAAL,CAAUkD,KAAV,GAAmB,EAAnB;AACA,QAAKlD,IAAL,CAAU6d,MAAV,GAAmBzS,WAAK0S,YAAL,CAAkBvU,OAAOwU,QAAzB,QAAnB;AACA,QAAKF,MAAL,GAAmB,MAAK7d,IAAL,CAAU6d,MAA7B;AACA,QAAK7f,QAAL,8CAEkB,MAAKgC,IAAL,CAAUiH,IAF5B,iCAGkB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHlC,kCAIkB,MAAKnM,IAAL,CAAUkX,KAAV,CAAgB,YAAhB,IAAgC,MAAhC,GAAyC,OAJ3D,oOAWe,MAAKlX,IAAL,CAAUiH,IAXzB;AALD;AAyBC;;;;gCAED;AACC,UAAO,CAAC,CAACxF,OAAOO,IAAP,CAAY,KAAKhC,IAAL,CAAU6d,MAAtB,EAA8BnZ,MAAvC;AACA;;;+BACYsZ,K,EACb;AACC,UAAOA,KAAP;AACA;;;;EApC4Bd,a;;;;;;;;;;;ACH9B;;;;;;;;IAEae,S,WAAAA,S;;;AACZ,oBAAY1U,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EAAuC;AAAA;;AAAA,oHAChC0H,MADgC,EACxB4B,IADwB,EAClB+G,MADkB,EACVrQ,GADU;;AAEtC,QAAK7D,QAAL,6CAEiB,MAAKgC,IAAL,CAAUiH,IAF3B,gCAGiB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHjC,0GAOgB,MAAKnM,IAAL,CAAUiH,IAP1B,gCAQgB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IARhC;AAFsC;AAiBtC;;;EAlB6B+Q,a;;;;;;;;;;;;;ACF/B;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;;;;;;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;IAEa9R,I,WAAAA,I;;;AAEZ,eAAYK,QAAZ,EACA;AAAA,MADsBP,YACtB,uEADqC,EACrC;;AAAA;;AAAA,0GACO,EADP;;AAEC,QAAKlL,IAAL,CAAUke,SAAV,GAAsB,MAAKle,IAAL,CAAUke,SAAV,IAAuB,EAA7C;AACA,QAAKle,IAAL,CAAUkD,KAAV,GAAsB,MAAKlD,IAAL,CAAUkD,KAAV,IAAuB,EAA7C;;AAEA,QAAKlD,IAAL,CAAUme,MAAV,GAAsB1S,SAAS2S,OAAT,IAAoB,KAA1C;;AAEA,QAAKpe,IAAL,CAAUqe,OAAV,GAAsB,MAAKre,IAAL,CAAUqe,OAAV,IAAqB,EAA3C;;AAEA,QAAKre,IAAL,CAAUc,MAAV,CAAiB,SAAjB,EAA4B,UAACmD,CAAD,EAAK;AAChC,SAAKjE,IAAL,CAAUse,QAAV,GAAqBra,EAAEsI,IAAF,CAAO,GAAP,CAArB;AACA,GAFD;;AAIA,QAAKgS,SAAL,GAAmB,EAAnB;AACA,QAAKzE,MAAL,GAAmB,EAAnB;AACA,QAAK9b,QAAL;;AAaA,QAAKgC,IAAL,CAAU6d,MAAV,GAAmBzS,KAAK0S,YAAL,CAAkBrS,QAAlB,SAAkCP,YAAlC,CAAnB;;AAEA,QAAK2S,MAAL,GAAc,MAAK7d,IAAL,CAAU6d,MAAxB;;AAEA,QAAK7d,IAAL,CAAUc,MAAV,CACC,OADD,EAEG,UAACmD,CAAD,EAAO;AACR,SAAKjE,IAAL,CAAUqd,WAAV,GAAwB5V,KAAK8C,SAAL,CAAetG,CAAf,EAAkB,IAAlB,EAAwB,CAAxB,CAAxB;AACA,SAAKoZ,WAAL,GAAmB,MAAKrd,IAAL,CAAUqd,WAA7B;AACA,SAAKna,KAAL,GAAae,CAAb;AACA,GANF;AAhCD;AAwCC;;;;gCAEahG,K,EACd;AACCA,SAAMG,cAAN;AACAH,SAAM+e,eAAN;AACA;;;yBAEM/e,K,EACP;AACC,QAAK+B,IAAL,CAAUqd,WAAV,GAAwB5V,KAAK8C,SAAL,CACvB,KAAKvK,IAAL,CAAUkD,KADa,EAErB,IAFqB,EAGrB,CAHqB,CAAxB;;AAMA,QAAI,IAAIzC,CAAR,IAAa,KAAK8d,SAAlB,EACA;AACC,SAAKA,SAAL,CAAe9d,CAAf,EAAkB,IAAlB,EAAwBxC,KAAxB;AACA;AACD;;;8BACWA,K,EACZ;AACC;AACA;;;2BACQ4C,Q,EACT;AACC,QAAK0d,SAAL,CAAe/b,IAAf,CAAoB3B,QAApB;AACA;;;6BA0GD;AAAA,OADSiL,MACT,uEADkB,IAClB;AAAA,OADwBkS,KACxB,uEADgC,IAChC;AAAA,OADsCQ,KACtC,uEAD8C,EAC9C;;AACC,OAAG,CAAC1S,MAAJ,EACA;AACCA,aAAS,IAAIF,QAAJ,EAAT;AACA;;AAED,OAAG,CAACoS,KAAJ,EACA;AACCA,YAAQ,IAAR;AACA;;AAED,OAAI9M,QAAQ,EAAZ;;AAEA,QAAI,IAAIzQ,CAAR,IAAaud,MAAMhe,IAAN,CAAW6d,MAAxB,EACA;;AAEC,QAAGG,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,KACCud,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqB2c,QADzB,EAEC;AACA;AACA;;AAED,QAAIqB,WAAWD,MAAMzc,KAAN,CAAY,CAAZ,CAAf;;AAEA0c,aAASjc,IAAT,CAAc/B,CAAd;;AAEA,QAAGud,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,KACCud,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqBkd,WAArB,EADJ,EAEC;AACA,UAAKhS,QAAL,CACCG,MADD,EAEGkS,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,CAFH,EAGGge,QAHH;AAKA,KARD,MASK,IAAGT,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,CAAH,EACL;AACC;;AAEA,SAAIie,YAAYV,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqBke,OAArB,EAAhB;;AAEA,SAAGX,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqBT,IAArB,CAA0BmM,IAA1B,IAAkC,MAAlC,IACC6R,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqB+T,IAArB,CAA0BiJ,KAA1B,CAAgC5L,OAAhC,CAAwC+H,KAAxC,CAA8ClV,MADlD,EAEC;AACA,UAAGsZ,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqBT,IAArB,CAA0BkX,KAA1B,CAAgCwG,QAAnC,EACA;AACC,WAAI9D,QAAQoE,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqB+T,IAArB,CAA0BiJ,KAA1B,CAAgC5L,OAAhC,CAAwC+H,KAApD;;AAEA,YAAI,IAAInZ,KAAI,CAAZ,EAAeA,KAAImZ,MAAMlV,MAAzB,EAAiCjE,IAAjC,EACA;AACCqL,eAAOA,MAAP,CAAc4S,YAAY,IAA1B,EAAgC9E,MAAMnZ,EAAN,CAAhC;AACA;AACD,OARD,MAUA;AACCqL,cAAOA,MAAP,CACC4S,SADD,EAEGV,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqB+T,IAArB,CAA0BiJ,KAA1B,CAAgC5L,OAAhC,CAAwC+H,KAAxC,CAA8C,CAA9C,CAFH;AAIA;AAED,MApBD,MAsBA;AACC9N,aAAOA,MAAP,CACC4S,SADD,EAEGV,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqBT,IAArB,CAA0BkD,KAA1B,KAAoCvB,SAApC,GACC,EADD,GAECqc,MAAMhe,IAAN,CAAW6d,MAAX,CAAkBpd,CAAlB,EAAqBT,IAArB,CAA0BkD,KAJ9B;AAMA;AACD;AACD;;AAED,UAAO4I,MAAP;AACA;;;gCAED;AAAA,OADY9L,IACZ,uEADmB,EACnB;;AACC,OAAIkR,QAAQ,EAAZ;;AAEA,QAAI,IAAIzQ,CAAR,IAAa,KAAKT,IAAL,CAAUke,SAAvB,EACA;AACCle,SAAKS,CAAL,IAAUT,KAAKS,CAAL,KAAW,KAAKT,IAAL,CAAUke,SAAV,CAAoBzd,CAApB,CAArB;AACA;;AAED,QAAI,IAAIA,GAAR,IAAaT,IAAb,EACA;AACCkR,UAAM1O,IAAN,CAAW/B,MAAI,GAAJ,GAAUsH,mBAAmB/H,KAAKS,GAAL,CAAnB,CAArB;AACA;;AAED,UAAOyQ,MAAM3E,IAAN,CAAW,GAAX,CAAP;AACA;;;2BACQhD,M,EACT;AACC;;AAEA,QAAI,IAAI9I,CAAR,IAAa8I,MAAb,EACA;AACC,SAAKvJ,IAAL,CAAUkD,KAAV,CAAgBzC,CAAhB,IAAqB8I,OAAO9I,CAAP,CAArB;AACA;AACD;;;gCAED;AACC,UAAO,CAAC,CAACgB,OAAOO,IAAP,CAAY,KAAKhC,IAAL,CAAU6d,MAAtB,EAA8BnZ,MAAvC;AACA;;;+BAjNmB+G,Q,EACpB;AAAA,OAD8ByG,MAC9B,uEADuC,IACvC;AAAA,OAD6ChH,YAC7C,uEAD4D,EAC5D;;AACC,OAAI2S,SAAS,EAAb;;AADD,8BAESpd,CAFT;AAIE,QAAGod,OAAOpd,CAAP,CAAH,EACA;AACC;AACA;;AAED,QAAGA,EAAE4G,MAAF,CAAS,CAAT,EAAW,CAAX,KAAiB,GAApB,EACA;AACC;AACA;;AAED,QAAI2W,QAAQ,IAAZ;AACA,QAAI7S,OAAQ,IAAZ;;AAEA,QAAG+G,MAAH,EACA;AACC,SAAGA,kBAAkB9G,IAArB,EACA;AACCD,aAAO+G,MAAP;AACA,MAHD,MAKA;AACC/G,aAAO+G,OAAO/G,IAAd;AACA;AACD;;AAED;;AAEA,QAAGD,gBAAgBO,SAAShL,CAAT,EAAYwG,IAAZ,IAAoBiE,YAAvC,EACA;AACC8S,aAAQ,IAAI9S,aAAcO,SAAShL,CAAT,EAAYwG,IAA1B,CAAJ,CAAqCwE,SAAShL,CAAT,CAArC,EAAkD0K,IAAlD,EAAwD+G,MAAxD,EAAgEzR,CAAhE,CAAR;AACA,KAHD,MAKA;AACC,aAAOgL,SAAShL,CAAT,EAAY0L,IAAnB;AAEC,WAAK,UAAL;AACC,WAAGV,SAAShL,CAAT,EAAYyW,KAAZ,CAAkB,YAAlB,CAAH,EACA;AACC8G,gBAAQ,IAAIY,WAAJ,CAAenT,SAAShL,CAAT,CAAf,EAA4B0K,IAA5B,EAAkC+G,MAAlC,EAA0CzR,CAA1C,CAAR;AACA,QAHD,MAKA;AACCud,gBAAQ,IAAIJ,kBAAJ,CAAanS,SAAShL,CAAT,CAAb,EAA0B0K,IAA1B,EAAgC+G,MAAhC,EAAwCzR,CAAxC,CAAR;AACA;AACD;AACD,WAAK,QAAL;AACCvC,eAAQC,GAAR,CAAYsN,SAAShL,CAAT,CAAZ;AACAud,eAAQ,IAAIa,wBAAJ,CAAgBpT,SAAShL,CAAT,CAAhB,EAA6B0K,IAA7B,EAAmC+G,MAAnC,EAA2CzR,CAA3C,CAAR;AACA;AACD,WAAK,QAAL;AACCud,eAAQ,IAAIc,sBAAJ,CAAerT,SAAShL,CAAT,CAAf,EAA4B0K,IAA5B,EAAkC+G,MAAlC,EAA0CzR,CAA1C,CAAR;AACA;AACD,WAAK,MAAL;AACCud,eAAQ,IAAIe,oBAAJ,CAActT,SAAShL,CAAT,CAAd,EAA2B0K,IAA3B,EAAiC+G,MAAjC,EAAyCzR,CAAzC,CAAR;AACA;AACD,WAAK,QAAL;AACA,WAAK,QAAL;AACCud,eAAQ,IAAIjB,wBAAJ,CAAgBtR,SAAShL,CAAT,CAAhB,EAA6B0K,IAA7B,EAAmC+G,MAAnC,EAA2CzR,CAA3C,CAAR;AACA;AACD,WAAK,QAAL;AACCud,eAAQ,IAAIgB,wBAAJ,CAAgBvT,SAAShL,CAAT,CAAhB,EAA6B0K,IAA7B,EAAmC+G,MAAnC,EAA2CzR,CAA3C,CAAR;AACA;AACD,WAAK,UAAL;AACCud,eAAQ,IAAIiB,4BAAJ,CAAkBxT,SAAShL,CAAT,CAAlB,EAA+B0K,IAA/B,EAAqC+G,MAArC,EAA6CzR,CAA7C,CAAR;AACA;AACD;AACCud,eAAQ,IAAId,YAAJ,CAAUzR,SAAShL,CAAT,CAAV,EAAuB0K,IAAvB,EAA6B+G,MAA7B,EAAqCzR,CAArC,CAAR;AACA;AAlCF;AAoCA;;AAEDod,WAAOpd,CAAP,IAAYud,KAAZ;;AAEAA,UAAMhe,IAAN,CAAWc,MAAX,CACC,OADD,EAEG,UAACmD,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,EAAgB;AACjB;AACA,SAAGD,EAAEgI,IAAF,IAAU,MAAV,IACE,CAAChI,EAAE+a,eADL,IAEE/a,EAAEgI,IAAF,IAAU,UAFf,EAGC;AACA;AACA;;AAED;AACA,SAAIuS,YAAYV,MAAMW,OAAN,EAAhB;;AAEA,SAAGxa,EAAEiZ,QAAL,EACA;AACC,aAAOjS,KAAKnL,IAAL,CAAUke,SAAV,CAAqBQ,SAArB,CAAP;;AAEA;AACA;AACDvT,UAAKnL,IAAL,CAAUke,SAAV,CAAqBQ,SAArB,IAAmCza,CAAnC;AACA,KArBF;AA7EF;;AAEC,QAAI,IAAIxD,CAAR,IAAagL,QAAb,EACA;AAAA,qBADQhL,CACR;;AAAA,6BAQE;AAyFD;AACD,UAAOod,MAAP;AACA;;;;EA/KwB/d,W;;;;;;;;;;;ACtB1B;;;;;;;;IAEakf,W,WAAAA,W;;;AACZ,sBAAYzV,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EAAuC;AAAA;;AAAA,wHAChC0H,MADgC,EACxB4B,IADwB,EAClB+G,MADkB,EACVrQ,GADU;;AAEtC,QAAK7B,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,GAAuB,MAAKnM,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,IAAwB,QAA/C;AACA,QAAKnO,QAAL,6CAEiB,MAAKgC,IAAL,CAAUiH,IAF3B,gCAGiB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHjC,uIAOiB,MAAKnM,IAAL,CAAUiH,IAP3B,kCAQiB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IARjC;AAHsC;AAkBtC;;;EAnB+B+Q,a;;;;;;;;;;;;;ACFjC;;;;;;;;IAEa6B,S,WAAAA,S;;;AACZ,oBAAYxV,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EAAuC;AAAA;;AAAA,oHAChC0H,MADgC,EACxB4B,IADwB,EAClB+G,MADkB,EACVrQ,GADU;;AAEtC,QAAKyb,MAAL,GAAc,MAAKtd,IAAL,CAAUkX,KAAV,CAAgB,gBAAhB,KAAqC,KAAnD;AACA,QAAKlX,IAAL,CAAUkf,eAAV,GAA4B,MAAKlf,IAAL,CAAUkX,KAAV,CAAgBiI,eAAhB,IAAmC,KAA/D;AACA,QAAKnhB,QAAL,uCACsB,MAAKgC,IAAL,CAAUiH,IADhC;AAJsC;AAStC;;;;gCAED;AACC,UAAO,KAAP;AACA;;;4BAED;AACC,QAAKjH,IAAL,CAAUod,QAAV,GAAqB,UAArB;AACA;;;4BAED;AACC,OAAG,KAAK5I,IAAL,CAAUiJ,KAAb,EACA;AACC,WAAO,KAAKjJ,IAAL,CAAUiJ,KAAV,CAAgB5L,OAAhB,CAAwBgF,YAAxB,CAAqC,MAArC,CAAP;AACA;;AAED,UAAO,KAAK7W,IAAL,CAAUiH,IAAjB;AACA;;;;EA3B6BnH,W;;;;;;;;;;;;;ACF/B;;;;;;;;IAEagf,U,WAAAA,U;;;AACZ,qBAAYvV,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EAAuC;AAAA;;AAAA,sHAChC0H,MADgC,EACxB4B,IADwB,EAClB+G,MADkB,EACVrQ,GADU;;AAEtC,QAAK7D,QAAL,6CAEiB,MAAKgC,IAAL,CAAUiH,IAF3B,gCAGiB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHjC,gZAekB,MAAKnM,IAAL,CAAUiH,IAf5B;AAFsC;AA2BtC;;;;6BAED;AACC,QAAI,IAAIxG,CAAR,IAAa,KAAKT,IAAL,CAAU4D,OAAvB,EACA;AACC,QAAG,KAAK5D,IAAL,CAAU4D,OAAV,CAAkBnD,CAAlB,KAAwB,KAAKT,IAAL,CAAUkD,KAArC,EACA;AACC,YAAOzC,CAAP;AACA;AACD;AACD;;;;EAtC8Byc,a;;;;;;;;;;;;;ACFhC;;;;;;;;IAEa2B,W,WAAAA,W;;;AACZ,sBAAYtV,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EAAuC;AAAA;;AAAA,wHAChC0H,MADgC,EACxB4B,IADwB,EAClB+G,MADkB,EACVrQ,GADU;;AAEtC,QAAK7D,QAAL,6CAEiB,MAAKgC,IAAL,CAAUiH,IAF3B,gCAGiB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHjC,yNASgB,MAAKnM,IAAL,CAAUiH,IAT1B;;AAmBA,QAAKjH,IAAL,CAAUc,MAAV,CAAiB,OAAjB,EAA0B,UAACmD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAa;AACtCnG,WAAQC,GAAR,CAAY,MAAK6B,IAAL,CAAUiH,IAAtB,EAA2BhD,CAA3B,EAA6BI,CAA7B;AACA,GAFD;AArBsC;AAwBtC;;;;6BAEUgO,U,EACX;AAAA;;AACC,QAAK+M,SAAL,CAAe,CAAf,EAAiB,YAAI;AACpB,QAAIjN,MAAM,OAAKqC,IAAL,CAAUiJ,KAAV,CAAgB5L,OAA1B;;AAEA,SAAI,IAAIpR,CAAR,IAAa0R,IAAIvO,OAAjB,EACA;AACC,SAAI2V,SAASpH,IAAIvO,OAAJ,CAAYnD,CAAZ,CAAb;;AAEA,SAAG8Y,OAAOrW,KAAP,IAAgB,OAAKlD,IAAL,CAAUkD,KAA7B,EACA;AACCiP,UAAIqH,aAAJ,GAAoB/Y,CAApB;AACA;AACD;AACD,IAZD;AAaA;;;6BAGD;AACC,QAAI,IAAIA,CAAR,IAAa,KAAKT,IAAL,CAAU4D,OAAvB,EACA;AACC,QAAG,KAAK5D,IAAL,CAAU4D,OAAV,CAAkBnD,CAAlB,KAAwB,KAAKT,IAAL,CAAUkD,KAArC,EACA;AACC,YAAOzC,CAAP;AACA;AACD;AACD;;;;EArD+Byc,a;;;;;;;;;;;ACFjC;;;;;;;;IAEa+B,a,WAAAA,a;;;AACZ,wBAAY1V,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EAAuC;AAAA;;AAAA,4HAChC0H,MADgC,EACxB4B,IADwB,EAClB+G,MADkB,EACVrQ,GADU;;AAEtC,QAAK7B,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,GAAuB,MAAKnM,IAAL,CAAUkX,KAAV,CAAgB/K,IAAhB,IAAwB,QAA/C;AACA,QAAKnO,QAAL,6CAEiB,MAAKgC,IAAL,CAAUiH,IAF3B,gCAGiB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHjC,6NASiB,MAAKnM,IAAL,CAAUiH,IAT3B;AAHsC;AAkBtC;;;EAnBiCiW,a;;;;;;;;;;;;;;;ACFnC;;AACA;;;;;;;;IAEamC,U,WAAAA,U;;;AAEZ,qBAAYrf,IAAZ,EAAkBkG,IAAlB,EACA;AAAA,MADwBiY,MACxB,uEADiC,KACjC;AAAA,MADwCjT,YACxC,uEADuD,EACvD;;AAAA;;AAAA,sHAEElL,IAFF,EAGIkG,IAHJ,EAII,MAJJ,EAKIgF,gBAAgB;AACjB;AADiB,GALpB;;AAUC,QAAKoU,QAAL,GAAgB,CAAC,CAACtf,KAAKL,QAAvB;AAVD;AAWC;;;;yBAEMwL,I,EACP;AACC,QAAI,IAAI1K,CAAR,IAAa0K,KAAKnL,IAAL,CAAU6d,MAAvB,EACA;AACC,QAAG,CAAC1S,KAAKnL,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoB+T,IAApB,CAAyBiJ,KAA7B,EACA;AACC;AACA;;AAED,QAAGtS,KAAKnL,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoBT,IAApB,CAAyBkX,KAAzB,CAA+B/K,IAA/B,IAAuC,QAA1C,EACA;AACC;AACA;;AAED,QAAI0F,UAAU1G,KAAKnL,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoB+T,IAApB,CAAyBiJ,KAAzB,CAA+B5L,OAA7C;;AAEAA,YAAQ0N,KAAR;;AAEA;AACA;;AAED,kHAAapU,IAAb;AACA;;;8BAGD;AACC,QAAKnL,IAAL,CAAUsO,IAAV,CAAetO,IAAf,CAAoBwf,OAApB,GAA8B,IAA9B;AACA,QAAKxf,IAAL,CAAUsO,IAAV,CAAetO,IAAf,CAAoBqe,OAApB,IAA+B,UAA/B;;AAEA;AACA;;;6BAEUvf,Q,EACX;AACC,QAAKkB,IAAL,CAAUsO,IAAV,CAAetO,IAAf,CAAoBwf,OAApB,GAA8B,KAA9B;AACA,QAAKxf,IAAL,CAAUsO,IAAV,CAAetO,IAAf,CAAoBqe,OAApB,GAA8B,EAA9B;;AAEA,OAAG,CAAC,KAAKre,IAAL,CAAUyf,OAAd,EACA;AACC,SAAKzf,IAAL,CAAUsO,IAAV,CAAeoR,SAAf,CAAyB5gB,SAASE,IAAlC;AACA,IAHD,MAKA;AACC,SAAKgB,IAAL,CAAUyf,OAAV,CAAkB1f,OAAlB,CAA0BjB,SAASE,IAAnC;AACA;;AAED,QAAKgB,IAAL,CAAUsO,IAAV,CAAeqR,gBAAf;;AAEA,sHAAiB7gB,QAAjB;AACA;;;;EAjE8BuM,yB;;;;ACHhC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;;;;;;;;;;;;AC9DA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;IAEaA,W,WAAAA,W;;;AAEZ,sBAAYrL,IAAZ,EAAkBkG,IAAlB,EACA;AAAA,MADwBiY,MACxB,uEADiC,KACjC;AAAA,MADwCjT,YACxC,uEADuD,EACvD;;AAAA;;AAAA,wHACOlL,IADP;;AAGC,QAAKkG,IAAL,GAAoBA,IAApB;AACA,QAAKlG,IAAL,CAAUme,MAAV,GAAoBA,MAApB;AACA,QAAKne,IAAL,CAAU8Z,MAAV,GAAoB,MAAK9Z,IAAL,CAAU8Z,MAAV,IAAoB,IAAxC;AACA,QAAK9Z,IAAL,CAAUmL,IAAV,GAAoB,IAApB;AACA,QAAKnL,IAAL,CAAUP,KAAV,GAAoB,IAApB;AACA,QAAKO,IAAL,CAAUU,KAAV,GAAoB,EAApB;AACA,QAAK1C,QAAL;;AAOA,QAAK4hB,OAAL,GAAmB,EAAnB;AACA,QAAKrB,SAAL,GAAmB,EAAnB;AACA,QAAKsB,SAAL,GAAmB,EAAnB;AACA,QAAKC,UAAL,GAAmB,EAAnB;AACA,QAAK9T,WAAL,GAAmB,EAAnB;;AAEA,MAAG9F,gBAAgBkF,UAAnB,EACA;AACC,SAAK2U,QAAL,CAAc5U,IAAd,EAAoBD,YAApB;AACA,GAHD,MAKA;AACC9L,0BAAWkB,OAAX,CAAmB4F,IAAnB,EAAyBrH,IAAzB,CAA8B,gBAAM;AACnC,QAAG,CAACmhB,IAAD,IACC,CAACA,KAAKhf,IADP,IAEC,CAACgf,KAAKhf,IAAL,CAAUmK,IAFZ,IAGC,EAAE6U,KAAKhf,IAAL,CAAUmK,IAAV,YAA0B1J,MAA5B,CAHJ,EAIC;AACAvD,aAAQC,GAAR,CAAY,0BAAZ,EAAwC6hB,IAAxC;AACA;AACA;AACA;;AAED,UAAKD,QAAL,CAAc,IAAI3U,UAAJ,CAAS4U,KAAKhf,IAAL,CAAUmK,IAAnB,EAAyBD,YAAzB,CAAd;;AAEA,UAAK+U,MAAL,CAAY,MAAKjgB,IAAL,CAAUmL,IAAtB,EAA4B6U,KAAKhhB,IAAjC;AACA,IAdD;AAeA;;AA3CF;AA6CC;;;;2BAEQmM,I,EACT;AAAA;;AACC,QAAKnL,IAAL,CAAUmL,IAAV,GAAiBA,IAAjB;;AAEA,QAAKnL,IAAL,CAAUmL,IAAV,CAAe+U,QAAf,CAAwB,UAAC/U,IAAD,EAAOlN,KAAP,EAAe;AACtC,QAAG,OAAKiiB,QAAL,CAAc/U,IAAd,EAAoBlN,KAApB,MAA+B,KAAlC,EACA;AACC;AACA;;AAED,QAAGA,KAAH,EACA;AACCA,WAAMG,cAAN;AACAH,WAAM+e,eAAN;AACA;;AAED,QAAImD,cAAchV,KAAKqJ,IAAL,CAAUyI,OAAV,CAAkBpL,OAApC;AACA,QAAItR,MAAc4f,YAAYtJ,YAAZ,CAAyB,QAAzB,KAAsC,OAAK7W,IAAL,CAAU8Z,MAAhD,IAA0D,OAAK5T,IAAjF;AACA,QAAIiY,SAAcgC,YAAYtJ,YAAZ,CAAyB,QAAzB,KAAsC,OAAK7W,IAAL,CAAUme,MAAlE;AACA,QAAIrO,QAAc3E,KAAKnL,IAAL,CAAUke,SAA5B;;AAEAC,aAASA,OAAOiC,WAAP,EAAT;;AAEA;;AAEA,QAAGjC,UAAU,KAAb,EACA;AACC,SAAIkC,SAAS,EAAb;;AAEA,SAAG,OAAKrgB,IAAL,CAAUsB,OAAV,IAAqB,OAAKtB,IAAL,CAAUsB,OAAV,CAAkBtB,IAA1C,EACA;AACC,aAAKA,IAAL,CAAUsB,OAAV,CAAkBtB,IAAlB,CAAuB8K,IAAvB,GAA8B,CAA9B;AACA;;AAEDuV,YAAOvV,IAAP,GAAc,CAAd;;AAEA,UAAI,IAAIrK,CAAR,IAAaqP,KAAb,EACA;AACC,UAAGrP,MAAM,KAAT,EACA;AACC;AACA;AACD4f,aAAO5f,CAAP,IAAYqP,MAAMrP,CAAN,CAAZ;AACA;;AAED,SAAI6f,WAAW,OAAKC,SAAL,CAAeF,MAAf,CAAf;;AAEAC,cAASzhB,IAAT,CAAc,YAAI;AACjB,aAAKkC,UAAL,CAAgB,EAAhB;;AAEA7B,qBAAOiQ,EAAP,CAAU5O,MAAM,GAAN,GAAYrB,eAAOyL,aAAP,CAAqB0V,MAArB,CAAtB;;AAEA,aAAK9P,MAAL,CAAY8P,MAAZ;AACA,MAND,EAMGzP,KANH,CAMS,UAACjJ,KAAD,EAAW;AACnB,aAAK6Y,cAAL,CAAoB7Y,KAApB;AACA,MARD;AASA,KA/BD,MAgCK,IAAGwW,UAAU,MAAb,EACL;AACC,SAAIxS,WAAWR,KAAKQ,QAAL,EAAf;;AADD;AAAA;AAAA;;AAAA;AAGC,2BAAiBA,SAAS8U,OAAT,EAAjB,8HACA;AACC;;AADD,WADSzQ,IACT;AAEC;AANF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQC,SAAIsQ,YAAW,OAAKC,SAAL,CAAe5U,QAAf,CAAf;;AAEA,SAAG2U,SAAH,EACA;AACCA,gBAASzhB,IAAT,CAAc,YAAI;AACjBO,8BAAWkB,OAAX,CACCC,GADD,EAEG,EAAC+K,KAAK,MAAN,EAFH,EAGGK,QAHH,EAIE9M,IAJF,CAIO,UAACC,QAAD,EAAc;AACpB,eAAKiC,UAAL,CAAgBjC,QAAhB;AACA,QAND,EAMG8R,KANH,CAMS,UAACjJ,KAAD,EAAW;AACnB,eAAK6Y,cAAL,CAAoB7Y,KAApB;AACA,QARD;AASA,OAVD;AAWA;AACD;AACD,IA/ED;AAgFA;;;4BAES+Y,W,EACV;AACC,OAAIJ,WAAW,EAAf;;AAEA,QAAI,IAAI7f,CAAR,IAAa,KAAKqf,UAAlB,EACA;AACC,QAAIa,QAAQ,KAAKb,UAAL,CAAgBrf,CAAhB,EAAmBigB,WAAnB,EAAgC,IAAhC,CAAZ;;AAEA,QAAGC,KAAH,EACA;AACCL,cAAS9d,IAAT,CAAcme,KAAd;AACA;AACD;;AAED,OAAGL,SAAS5b,MAAT,IAAmB,CAAtB,EACA;AACC,WAAOtE,QAAQC,OAAR,EAAP;AACA;;AAED,UAAOD,QAAQwgB,GAAR,CAAYN,QAAZ,CAAP;AACA;;;iCAEc3Y,K,EACf,CAEC;;;6BAEU7I,Q,EACX;AACC,QAAI,IAAI2B,CAAR,IAAa,KAAKuL,WAAlB,EACA;AACC,SAAKA,WAAL,CAAiBvL,CAAjB,EAAoB3B,QAApB,EAA8B,IAA9B;AACA;;AAED,OAAGA,SAAS+hB,QAAZ,EACA;AACC,SAAI,IAAIpgB,EAAR,IAAa3B,SAAS+hB,QAAtB,EACA;AACCxhB,kBAAMC,QAAN,GAAiBwhB,KAAjB,CACChiB,SAASE,IAAT,IAAiBF,SAASE,IAAT,CAAcC,EAA/B,GACG,UADH,GAEG,QAHJ,EAIGH,SAAS+hB,QAAT,CAAkBpgB,EAAlB,CAJH,EAKG,IALH;AAOA;AACD;AACD;;;yBAEM0K,I,EAAMK,K,EACb;AACC,QAAI,IAAI/K,CAAR,IAAa,KAAKmf,OAAlB,EACA;AACC,SAAKA,OAAL,CAAanf,CAAb,EAAgB,IAAhB,EAAsB0K,IAAtB,EAA4BK,KAA5B;AACA;AACD;;;2BAEQL,I,EAAMlN,K,EACf;AACC,QAAI,IAAIwC,CAAR,IAAa,KAAK8d,SAAlB,EACA;AACC,SAAKA,SAAL,CAAe9d,CAAf,EAAkB,IAAlB,EAAwBxC,KAAxB;AACA;AACD;;;+BAGD;AACC,QAAI,IAAIwC,CAAR,IAAa,KAAKof,SAAlB,EACA;AACC,SAAKA,SAAL,CAAepf,CAAf,EAAkB,KAAKT,IAAL,CAAUmL,IAA5B;AACA;AACD;;;iCAGD;AACC,UAAO,EAAP;AACA;;;2BAGD;AACC;AACA;;;;EAzN+BrL,W;;;;;;;;;;;;;;;ACTjC;;AACA;;AACA;;AACA;;;;;;;;IAEaihB,U,WAAAA,U;;;AAEZ,qBAAY/gB,IAAZ,EAAkBkG,IAAlB,EACA;AAAA,MADwBiY,MACxB,uEADiC,KACjC;AAAA,MADwCjT,YACxC,uEADuD,EACvD;;AAAA;;AAAA,sHAEElL,IAFF,EAGIkG,IAHJ,EAII,MAJJ,EAKI,EAAC8I,QAAQgQ,wBAAT,EALJ;;AAQC,QAAKgC,aAAL,GAAqB,MAAKhjB,QAA1B;;AAEA,QAAKgC,IAAL,CAAU+K,OAAV,GAAoB,EAApB;AACA,QAAKkF,QAAL,GAAoB,IAApB;;AAEA,QAAKjS,QAAL,gBACG,MAAKgjB,aADR;AAbD;AA0BC;;;;yBAEM7V,I,EACP;AAAA;;AACC,QAAI,IAAI1K,CAAR,IAAa0K,KAAKnL,IAAL,CAAU6d,MAAvB,EACA;AACC,QAAG,CAAC1S,KAAKnL,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoB+T,IAApB,CAAyBiJ,KAA7B,EACA;AACC;AACA;;AAED,QAAGtS,KAAKnL,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoBT,IAApB,CAAyBkX,KAAzB,CAA+B/K,IAA/B,IAAuC,QAA1C,EACA;AACC;AACA;;AAED,QAAI0F,UAAU1G,KAAKnL,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoB+T,IAApB,CAAyBiJ,KAAzB,CAA+B5L,OAA7C;;AAEAA,YAAQ0N,KAAR;;AAEA;AACA;;AAEDpU,QAAKnL,IAAL,CAAUke,SAAV,CAAoBpd,MAApB,CAA2B,SAA3B,EAAsC,UAACmD,CAAD,EAAK;AAC1C,WAAKjE,IAAL,CAAU+K,OAAV,GAAoB,EAApB;AACA,WAAKkF,QAAL,GAAoB,IAApB;;AAEA,QAAG,CAAChM,CAAJ,EACA;AACC;AACA;;AAED/F,YAAQC,GAAR,CAAY,OAAK+H,IAAjB,EAAuBjC,CAAvB;;AAEA7E,2BAAWkB,OAAX,CACCzC,eAAOC,OAAP,GAAiB,OAAKoI,IADvB,EAEG,EAAC+a,SAAShd,CAAV,EAFH,EAGEpF,IAHF,CAGO,UAACC,QAAD,EAAY;AAClBZ,aAAQC,GAAR,CAAYW,SAASE,IAArB;AACA,SAAG,CAACF,SAASE,IAAb,EACA;AACC;AACA;;AAED,YAAKgB,IAAL,CAAU+K,OAAV,GAAoBjM,SAASE,IAAT,CAAciD,GAAd,CAAkB,UAAC4Q,CAAD,EAAK;AAC1CA,QAAEwL,OAAF,GAAY,EAAZ;AACA,UAAGxL,EAAEpT,KAAF,IAAWwE,CAAd,EACA;AACC4O,SAAEwL,OAAF,GAAY,UAAZ;AACA,cAAKpO,QAAL,GAAgB4C,CAAhB;AACA;AACD,aAAOA,CAAP;AACA,MARmB,CAApB;AASA,KAnBD;AAoBA,IA/BD;;AAkCA,kHAAa1H,IAAb;AACA;;;8BAGD;AACC;AACA;;AAEA;AACA;;;6BAEUrM,Q,EACX;AACC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,sHAAiBA,QAAjB;AACA;;;yBAEMb,K,EACP;AAAA;;AACC,OAAIgV,QAAWhV,MAAM6G,MAAN,CAAa+R,YAAb,CAA0B,YAA1B,CAAf;AACA,OAAIlX,WAAW1B,MAAM6G,MAAN,CAAa+R,YAAb,CAA0B,eAA1B,CAAf;;AAEA,OAAI7L,SAAW,KAAKhL,IAAL,CAAU+K,OAAV,CAAkBkI,KAAlB,CAAf;;AAEA/U,WAAQC,GAAR,CAAY6M,MAAZ;;AAEA,QAAKhL,IAAL,CAAUsO,IAAV,CAAeoR,SAAf,CAAyB1U,MAAzB;AACA,QAAKhL,IAAL,CAAUsO,IAAV,CAAeqR,gBAAf;;AAEA;;AAEAvgB,0BAAWkB,OAAX,CACCzC,eAAOC,OAAP,GACG,KAAKoI,IADR,GAEG,GAFH,GAGGvG,QAJJ,EAKEd,IALF,CAKO,UAACC,QAAD,EAAY;AAClBZ,YAAQC,GAAR,CAAYW,SAASE,IAArB;AACA,QAAG,CAACF,SAASE,IAAb,EACA;AACC;AACA;;AAED,WAAKgB,IAAL,CAAUsO,IAAV,CAAeoR,SAAf,CAAyB5gB,SAASE,IAAlC;AACA,WAAKgB,IAAL,CAAUsO,IAAV,CAAeqR,gBAAf;AACA,IAdD;AAeA;;;2BAEQxU,I,EAAMlN,K,EACf;AACCA,SAAMG,cAAN;AACAH,SAAM+e,eAAN;AACA,OAAG,KAAK/M,QAAR,EACA;AACC,SAAKjQ,IAAL,CAAUsO,IAAV,CAAeoR,SAAf,CAAyB,KAAKzP,QAA9B;AACA,SAAKjQ,IAAL,CAAUsO,IAAV,CAAeqR,gBAAf;AACA;AACD,UAAO,KAAP;AACA;;;;EA7J8BtU,yB;;;;;;;;;;;;;;;ACLhC;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AACA;;IAEavL,I,WAAAA,I;;;AAEZ,eAAYyJ,MAAZ,EAAoB4B,IAApB,EAA0B+G,MAA1B,EAAkCrQ,GAAlC,EACA;AAAA;;AAAA,0GACO0H,MADP,EACe4B,IADf,EACqB+G,MADrB,EAC6BrQ,GAD7B;;AAGC,QAAK7B,IAAL,CAAUkhB,OAAV,GAAoB,EAApB;;AAEA,QAAKC,QAAL,GAAgB,KAAhB;AACA,QAAKC,QAAL,GAAgB,KAAhB;;AAEA,OAAI,IAAI3gB,CAAR,IAAa,MAAKT,IAAL,CAAU6d,MAAvB,EACA;AACC,SAAK7d,IAAL,CAAUkhB,OAAV,CAAkBzgB,CAAlB,IAAuB,MAAK4gB,YAAL,CAAkB,MAAKrhB,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,CAAlB,CAAvB;AACA;;AAED,QAAKT,IAAL,CAAU6d,MAAV,CAAiB,CAAC,CAAlB,EAAqByD,OAArB;;AAEA,QAAKthB,IAAL,CAAUsf,QAAV,GAAsB,EAAtB;AACA,QAAKtf,IAAL,CAAUuhB,SAAV,GAAsB,EAAtB;;AAEA;AACA;AACA,QAAKvhB,IAAL,CAAUwhB,MAAV,GAAmB,IAAnB;;AAEA,QAAKxhB,IAAL,CAAUyhB,UAAV,GAAuB,MAAKzhB,IAAL,CAAUyhB,UAAV,IAAwB,EAA/C;AACA,QAAKzhB,IAAL,CAAU0hB,UAAV,GAAuB,MAAK1hB,IAAL,CAAU0hB,UAAV,IAAwB,EAA/C;;AAEA,QAAKC,aAAL,CAAmB,EAACrT,WAAD,EAAnB;;AAEA,QAAKtQ,QAAL,8CAEkB,MAAKgC,IAAL,CAAUiH,IAF5B,iCAGkB,MAAKjH,IAAL,CAAUkX,KAAV,CAAgB/K,IAHlC,kCAIkB,MAAKnM,IAAL,CAAUkX,KAAV,CAAgB,YAAhB,IAAgC,MAAhC,GAAyC,OAJ3D,oLAWc,MAAKlX,IAAL,CAAUiH,IAXxB;AA3BD;AAwFC;;;;gCAEajH,I,EACd;AAAA;;AACC,QAAKA,IAAL,CAAUyhB,UAAV,GAAuB,IAAIpC,sBAAJ,CACtB5d,OAAO0b,MAAP,CAAc,EAAd,EAAkBnd,IAAlB,CADsB,EAEpBA,KAAKL,QAAL,GACI,KAAKK,IAAL,CAAUkX,KAAV,CAAgB,eAAhB,CADJ,SACwClX,KAAKL,QAD7C,aAEI,KAAKK,IAAL,CAAUkX,KAAV,CAAgB,eAAhB,CAFJ,YAFoB,CAAvB;;AAOA,QAAKlX,IAAL,CAAUyhB,UAAV,CAAqB7B,OAArB,CAA6Bpd,IAA7B,CAAkC,UAAC8O,IAAD,EAAOnG,IAAP,EAAc;AAC/C,WAAKnL,IAAL,CAAU4hB,eAAV,GAA4B,IAA5B;AACA,IAFD;;AAIA,QAAK5hB,IAAL,CAAU0hB,UAAV,GAAuB,IAAIX,sBAAJ,CACtBtf,OAAO0b,MAAP,CAAc,EAAd,EAAkBnd,IAAlB,CADsB,EAEpB,KAAKA,IAAL,CAAUkX,KAAV,CAAgB,eAAhB,CAFoB,CAAvB;AAIA;;;+BAEY8G,K,EACb;AACC,UAAO,IAAI6D,gBAAJ,CAAY,EAAC7D,YAAD,EAAQ9L,QAAO,IAAf,EAAZ,CAAP;AACA;;;qCAGD;AACC;;AAEA,QAAKlS,IAAL,CAAUsf,QAAV,GAAqB,KAAKtf,IAAL,CAAUsf,QAAV,GAAqB,EAArB,GAA0B,UAA/C;AACA;;;4BAEStU,M,EACV;AACC,OAAG,CAACzF,MAAMC,OAAN,CAAcwF,MAAd,CAAJ,EACA;AACCA,aAAS,CAACA,MAAD,CAAT;AACA;;AAED,QAAI,IAAIvK,CAAR,IAAauK,MAAb,EACA;AACC,QAAI8W,aAAa,KAAK9hB,IAAL,CAAU6d,MAAV,CAAiB,CAAC,CAAlB,EAAqBkE,WAAtC;;AAEA,QAAItW,WAAahK,OAAO0b,MAAP,CAAc,EAAd,EAAkB,KAAKnd,IAAL,CAAU6d,MAAV,CAAiB,CAAC,CAAlB,EAAqBpS,QAAvC,CAAjB;AACA,QAAIxE,OAAaxF,OAAO8H,MAAP,CAAc,KAAKvJ,IAAL,CAAU6d,MAAxB,EAAgCnZ,MAAhC,GAAyC,CAA1D;;AAEA+G,eAAW,KAAKuW,aAAL,CAAmBvW,QAAnB,CAAX;;AAEAA,eAAW,KAAKwW,YAAL,CAAkBxW,QAAlB,EAA4BxE,IAA5B,CAAX;;AAEA,QAAIib,gBAAgB,EAApB;;AAEAA,kBAAcjb,OAAO,CAArB,IAA0BwE,QAA1B;;AAEA,QAAI0W,WAAW/W,WAAK0S,YAAL,CAAkBoE,aAAlB,EAAiC,IAAjC,EAAuCjb,OAAO,CAA9C,CAAf;;AAEA,SAAKjH,IAAL,CAAU6d,MAAV,CAAiB5W,IAAjB,IAAyBkb,QAAzB;;AAEA,QAAIC,UAAU,KAAKf,YAAL,CAAkBc,QAAlB,CAAd;;AAEAA,aAASniB,IAAT,CAAckD,KAAd,CAAoBjE,EAApB,GAA4B+L,OAAOvK,CAAP,EAAUxB,EAAV,IAAmB,EAA/C;AACAkjB,aAASniB,IAAT,CAAckD,KAAd,CAAoBxC,KAApB,GAA4BsK,OAAOvK,CAAP,EAAUC,KAAV,IAAmB,EAA/C;AACAyhB,aAASniB,IAAT,CAAckD,KAAd,CAAoBzD,KAApB,GAA4BuL,OAAOvK,CAAP,EAAUhB,KAAV,IAAmB,EAA/C;;AAEA,SAAKO,IAAL,CAAUkhB,OAAV,CAAkB1e,IAAlB,CAAuB4f,OAAvB;;AAEAA,YAAQriB,OAAR,CAAgBiL,OAAOvK,CAAP,CAAhB;AACA;AAED;;;6BAEUuK,M,EAAQyU,O,EACnB;AACC,QAAKkC,aAAL,CAAmB;AAClBrT,UAAM,IADY;AAEhB3O,cAAUqL,OAAOrL,QAFD;AAGhB8f;AAHgB,IAAnB;;AAMA,QAAKzf,IAAL,CAAUsf,QAAV,GAAqB,KAAKtf,IAAL,CAAUsf,QAAV,GAAqB,EAArB,GAA0B,UAA/C;AACA;;;8BAEWrM,K,EACZ;AACC,QAAKjT,IAAL,CAAU6d,MAAV,CAAiB5K,KAAjB,EAAwBqO,OAAxB;AACA,QAAKthB,IAAL,CAAUkhB,OAAV,CAAkBjO,KAAlB,EAAyBjT,IAAzB,CAA8Bqe,OAA9B,GAAwC,SAAxC;AACA;;;gCAEapL,K,EACd;AACC,QAAKjT,IAAL,CAAU6d,MAAV,CAAiB5K,KAAjB,EAAwBoP,MAAxB;AACA;AACA;AACA;;AAEA,QAAKriB,IAAL,CAAUkhB,OAAV,CAAkBjO,KAAlB,EAAyBjT,IAAzB,CAA8Bqe,OAA9B,GAAwC,EAAxC;AACA;;;gCAEazb,M,EACd;AAAA,OADsB0f,KACtB,uEAD8B,CAC9B;;AACC,OAAIC,UAAU,EAAd;;AAEA,OAAGhd,MAAMC,OAAN,CAAc5C,MAAd,CAAH,EACA;AACC2f,cAAU,EAAV;AACA;;AAED,QAAI,IAAI9hB,CAAR,IAAamC,MAAb,EACA;AACC,QAAGnC,KAAK,QAAR,EACA;AACC;AACA;;AAED,QAAG,CAACmC,OAAOnC,CAAP,CAAD,IAAc,QAAOmC,OAAOnC,CAAP,CAAP,MAAqB,QAAtC,EACA;AACC8hB,aAAQ9hB,CAAR,IAAamC,OAAOnC,CAAP,CAAb;;AAEA;AACA;;AAED8hB,YAAQ9hB,CAAR,IAAagB,OAAO0b,MAAP,CAAc,EAAd,EAAkB,KAAK6E,aAAL,CAC9Bpf,OAAOnC,CAAP,CAD8B,EAE5B6hB,QAAM,CAFsB,CAAlB,CAAb;AAIA;;AAED,UAAOC,OAAP;AACA;;;+BAEY9W,Q,EAAUxM,E,EACvB;AACCwM,YAASxE,IAAT,GAAgBwE,SAASxE,IAAT,CAAciT,OAAd,CACf,QADe,QAETjb,EAFS,OAAhB;;AAKAwM,YAASyL,KAAT,CAAejQ,IAAf,GAAsBwE,SAASxE,IAA/B;;AAEA,OAAG,cAAcwE,QAAjB,EACA;AACC,SAAI,IAAIhL,CAAR,IAAagL,SAASsS,QAAtB,EACA;AACCtS,cAASsS,QAAT,CAAkBtd,CAAlB,IAAuB,KAAKwhB,YAAL,CACtBxW,SAASsS,QAAT,CAAkBtd,CAAlB,CADsB,EAEpBxB,EAFoB,CAAvB;AAIA;AACD;;AAED,UAAOwM,QAAP;AACA;;;uBAEIxN,K,EACL;AACC,QAAKkjB,QAAL,GAAgBljB,MAAM6G,MAAtB;AACA;;;2BAEQ7G,K,EACT;AACC,OAAG,CAAC,KAAKkjB,QAAT,EACA;AACC,WAAO,KAAP;AACA;;AAED,OAAIC,WAAWnjB,MAAM6G,MAArB;;AAEA,UAAMsc,YAAY,CAACA,SAASrY,OAAT,CAAiB,oBAAjB,CAAnB,EACA;AACCqY,eAAWA,SAAS/O,UAApB;AACA;;AAED,OAAG+O,QAAH,EACA;AACC,SAAKA,QAAL,GAAgBA,QAAhB;AACAnjB,UAAMG,cAAN;AACA;AACD;;;uBAEIH,K,EACL;AACCA,SAAM+e,eAAN;;AAEA,OAAIwF,YAAY,KAAKrB,QAAL,CAAcrU,aAAd,CAA4B,OAA5B,CAAhB;AACA,OAAI2V,YAAY,KAAKrB,QAAL,CAActU,aAAd,CAA4B,OAA5B,CAAhB;;AAEA,OAAI4V,WAAWF,UAAU3L,YAAV,CAAuB,KAAvB,CAAf;AACA,OAAI8L,WAAWF,UAAU5L,YAAV,CAAuB,KAAvB,CAAf;;AAEA,OAAI+L,YAAY,KAAKC,YAAL,CAAkBH,QAAlB,CAAhB;AACA,OAAII,YAAY,KAAKD,YAAL,CAAkBF,QAAlB,CAAhB;;AAEA,OAAGC,aAAaE,SAAb,IAA0BF,aAAaE,YAAY,CAAtD,EACA;AACC,SAAK3B,QAAL,GAAgB,KAAhB;AACA,SAAKC,QAAL,GAAgB,KAAhB;AACA;AACA;;AAED,OAAI2B,aAAaP,UAAUhR,gBAAV,CAChB,aAAakR,QAAb,GAAwB,IADR,CAAjB;AAGA,OAAIM,aAAaR,UAAUhR,gBAAV,CAChB,YAAYkR,QAAZ,GAAuB,IADP,CAAjB;;AAIA,OAAIO,aAAaR,UAAUjR,gBAAV,CAChB,aAAamR,QAAb,GAAwB,IADR,CAAjB;AAGA,OAAIO,aAAaT,UAAUjR,gBAAV,CAChB,YAAYmR,QAAZ,GAAuB,IADP,CAAjB;;AAIA,OAAIQ,aAAa,KAAK/B,QAAtB;;AAEA,OAAIgC,SAAS,CAAb;;AAEA,OAAIC,kBAAJ;AAAA,OAAeC,kBAAf;;AAEA,QAAI,IAAI7iB,CAAR,IAAa,KAAKT,IAAL,CAAU6d,MAAvB,EACA;AACC,QAAI0F,kBAAkB,KAAKvjB,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoB+T,IAApB,CAAyBiJ,KAAzB,CAA+B5L,OAArD;AACA,QAAI2R,eAAkB,KAAKxjB,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoB+T,IAApB,CAAyBiP,KAAzB,CAA+B5R,OAArD;AACA,QAAI6R,cAAkBH,gBAAgB1M,YAAhB,CAA6B,MAA7B,CAAtB;;AAEA,QAAG2L,aAAagB,YAAhB,EACA;AACCH,iBAAY,KAAKrjB,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,CAAZ;AACA;;AAED,QAAGgiB,aAAae,YAAhB,EACA;AACCF,iBAAY,KAAKtjB,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,CAAZ;AACA;;AAED,QAAIkjB,eAAkB,KAAKd,YAAL,CAAkBa,WAAlB,CAAtB;AACA,QAAIE,UAAkB,KAAtB;;AAEA,QAAGD,eAAe,CAAlB,EACA;AACC;AACA;;AAED,QAAGf,YAAYE,SAAZ,IACCa,gBAAgBb,SADjB,IAECa,gBAAgBf,SAFpB,EAGC;AACAgB,eAAU,KAAKC,WAAL,CAAiBH,WAAjB,EAA8BC,eAAe,CAA7C,CAAV;AACAP,cAAS,CAAC,CAAV;AACA,KAND,MAOK,IACJR,YAAYE,SAAZ,IACGa,gBAAgBb,SADnB,IAEGa,gBAAgBf,SAHf,EAIJ;AACAgB,eAAU,KAAKC,WAAL,CAAiBH,WAAjB,EAA8BC,eAAe,CAA7C,CAAV;AACAP,cAAS,CAAT;AACA;;AAED,QAAGQ,YAAY,KAAf,EACA;AACC,UAAKE,qBAAL,CACCN,YADD,EAEG,KAFH,EAGGE,WAHH,EAIGE,OAJH;;AAOA,UAAK5jB,IAAL,CAAU6d,MAAV,CAAiBpd,CAAjB,EAAoBT,IAApB,CAAyB0e,SAAzB,GAAqCkF,OAArC;;AAEA,UAAKE,qBAAL,CACCP,eADD,EAEG,MAFH,EAGGG,WAHH,EAIGE,OAJH;;AAOA,SAAIG,gBAAgBR,gBAAgBlR,UAAhB,CAA2Bb,gBAA3B,CACnB,aAAakS,WAAb,GAA2B,IADR,CAApB;;AAIA,UAAI,IAAIjjB,KAAI,CAAZ,EAAeA,KAAIsjB,cAAcrf,MAAjC,EAAyCjE,IAAzC,EACA;AACC,WAAKqjB,qBAAL,CACCC,cAActjB,EAAd,CADD,EAEG,MAFH,EAGGijB,WAHH,EAIGE,OAJH;AAMA;;AAED,SAAII,gBAAgBT,gBAAgBlR,UAAhB,CAA2Bb,gBAA3B,CACnB,YAAYkS,WAAZ,GAA0B,IADP,CAApB;;AAIA,UAAI,IAAIjjB,MAAI,CAAZ,EAAeA,MAAIujB,cAActf,MAAjC,EAAyCjE,KAAzC,EACA;AACC,WAAKqjB,qBAAL,CACCE,cAAcvjB,GAAd,CADD,EAEG,KAFH,EAGGijB,WAHH,EAIGE,OAJH;AAMA;AACD;AACD;;AAEDlB,cAAWF,UAAU3L,YAAV,CAAuB,KAAvB,CAAX;AACA8L,cAAWF,UAAU5L,YAAV,CAAuB,KAAvB,CAAX;;AAEA+L,eAAY,KAAKC,YAAL,CAAkBH,QAAlB,CAAZ;AACAI,eAAY,KAAKD,YAAL,CAAkBF,QAAlB,CAAZ;;AAEA,QAAKmB,qBAAL,CACCtB,SADD,EAEG,KAFH,EAGGE,QAHH,EAIG,KAAKmB,WAAL,CAAiBnB,QAAjB,EAA2BI,YAAYM,MAAvC,CAJH;;AAOA,QAAI,IAAI3iB,MAAG,CAAX,EAAcA,MAAIsiB,WAAWre,MAA7B,EAAqCjE,KAArC,EACA;AACC,SAAKqjB,qBAAL,CACCf,WAAWtiB,GAAX,CADD,EAEG,MAFH,EAGGiiB,QAHH,EAIG,KAAKmB,WAAL,CAAiBnB,QAAjB,EAA2BI,YAAYM,MAAvC,CAJH;AAMA;;AAED,QAAI,IAAI3iB,MAAG,CAAX,EAAcA,MAAIuiB,WAAWte,MAA7B,EAAqCjE,KAArC,EACA;AACC,SAAKqjB,qBAAL,CACCd,WAAWviB,GAAX,CADD,EAEG,KAFH,EAGGiiB,QAHH,EAIG,KAAKmB,WAAL,CAAiBnB,QAAjB,EAA2BI,YAAYM,MAAvC,CAJH;AAMA;;AAEDC,aAAUrjB,IAAV,CAAe0e,SAAf,GAA2B8D,UAAU3L,YAAV,CAAuB,KAAvB,CAA3B;;AAEA,QAAKiN,qBAAL,CACCrB,SADD,EAEG,KAFH,EAGGE,QAHH,EAIG,KAAKkB,WAAL,CAAiBlB,QAAjB,EAA4BG,YAAYM,MAAb,GAAuB,CAAlD,CAJH;;AAOA,QAAI,IAAI3iB,MAAG,CAAX,EAAcA,MAAIwiB,WAAWve,MAA7B,EAAqCjE,KAArC,EACA;AACC,SAAKqjB,qBAAL,CACCb,WAAWxiB,GAAX,CADD,EAEG,MAFH,EAGGkiB,QAHH,EAIG,KAAKkB,WAAL,CAAiBlB,QAAjB,EAA4BG,YAAYM,MAAb,GAAuB,CAAlD,CAJH;AAMA;;AAED,QAAI,IAAI3iB,MAAG,CAAX,EAAcA,MAAIyiB,WAAWxe,MAA7B,EAAqCjE,KAArC,EACA;AACC,SAAKqjB,qBAAL,CACCZ,WAAWziB,GAAX,CADD,EAEG,KAFH,EAGGkiB,QAHH,EAIG,KAAKkB,WAAL,CAAiBlB,QAAjB,EAA4BG,YAAYM,MAAb,GAAuB,CAAlD,CAJH;AAMA;;AAEDE,aAAUtjB,IAAV,CAAe0e,SAAf,GAA2B+D,UAAU5L,YAAV,CAAuB,KAAvB,CAA3B;;AAEA,QAAKsK,QAAL,CAAc9O,UAAd,CAAyBM,YAAzB,CACC,KAAKwO,QADN,EACgBgC,UADhB;;AAIA,QAAKhC,QAAL,GAAgB,KAAhB;AACA,QAAKC,QAAL,GAAgB,KAAhB;AACA;;;6BAGD;AACC,QAAKD,QAAL,GAAgB,KAAhB;AACA,QAAKC,QAAL,GAAgB,KAAhB;AACA;;;wCAEqBhb,I,EAAMkS,S,EAAW2L,S,EAAWC,S,EAClD;AACC,OAAIC,UAAU/d,KAAKyQ,YAAL,CAAkByB,SAAlB,CAAd;;AAEA,OAAIsL,UAAUM,YACX9d,KAAKyQ,YAAL,CAAkByB,SAAlB,EAA6BvT,SAA7B,CACDkf,UAAUvf,MADT,CADH;;AAKA0B,QAAK4H,YAAL,CAAkBsK,SAAlB,EAA6BsL,OAA7B;AACA;;;+BAEY3c,I,EACb;AACC,OAAIoJ,eAAJ;;AAEA,OAAGA,SAAS,eAAeC,IAAf,CAAoBrJ,IAApB,CAAZ,EACA;AACC,WAAOyT,SAASrK,OAAO,CAAP,CAAT,CAAP;AACA;;AAED,UAAO,KAAP;AACA;;;8BAEWpJ,I,EAAMgM,K,EAClB;AACC,OAAI2Q,UAAU3c,KAAKiT,OAAL,CAAa,cAAb,EAA6B,MAAMjH,KAAN,GAAc,GAA3C,CAAd;;AAEA,UAAO2Q,OAAP;AACA;;;yBAEM3lB,K,EACP;AACCA,SAAM+e,eAAN;AACA;;;;EA/fwBY,mB;;;;;;;;;;;;;ACR1B;;AACA;;AACA;;;;;;;;IAEaiE,O,WAAAA,O;;;AAEZ,kBAAY7hB,IAAZ,EACA;AAAA;;AAAA,gHACOA,IADP;;AAGC,QAAKhC,QAAL;;AAmBA,QAAKgC,IAAL,CAAUge,KAAV,GAAsB,MAAKhe,IAAL,CAAUge,KAAV,IAAmB,GAAzC;AACA,QAAKhe,IAAL,CAAUihB,OAAV,GAAsB,EAAtB;AACA,QAAKjhB,IAAL,CAAUP,KAAV,GAAsB,EAAtB;AACA,QAAKO,IAAL,CAAUgL,MAAV,GAAsB,EAAtB;AACA,QAAKhL,IAAL,CAAU6B,GAAV,GAAsB,MAAK7B,IAAL,CAAUge,KAAV,CAAgBnc,GAAtC;AACA,QAAK7B,IAAL,CAAUqe,OAAV,GAAsB,EAAtB;AACA,QAAKre,IAAL,CAAUokB,IAAV,GAAsB,GAAtB;AACA,QAAKC,OAAL,GAAsB,KAAtB;;AAGA,QAAKrkB,IAAL,CAAUge,KAAV,CAAgBhe,IAAhB,CAAqBc,MAArB,CAA4B,WAA5B,EAAyC,UAACmD,CAAD,EAAK;AAC7C,SAAKjE,IAAL,CAAU0e,SAAV,GAAsBza,CAAtB;AACA,GAFD;;AAIA,QAAKjE,IAAL,CAAU0e,SAAV,GAAsB,MAAK1e,IAAL,CAAUge,KAAV,CAAgBhe,IAAhB,CAAqBiH,IAA3C;;AAEA,QAAKjH,IAAL,CAAUf,EAAV,GAAe,MAAKe,IAAL,CAAUge,KAAV,CAAgBhe,IAAhB,CAAqBkD,KAArB,CAA2BjE,EAA1C;;AAEA,QAAKe,IAAL,CAAUc,MAAV,CAAiB,IAAjB,EAAuB,UAACmD,CAAD,EAAK;AAC3B,SAAKjE,IAAL,CAAUge,KAAV,CAAgBhe,IAAhB,CAAqBkD,KAArB,CAA2BjE,EAA3B,GAAgCgF,CAAhC;AACA,GAFD;;AAIA,QAAKjE,IAAL,CAAUge,KAAV,CAAgBhe,IAAhB,CAAqBkD,KAArB,CAA2BpC,MAA3B,CAAkC,IAAlC,EAAwC,UAACmD,CAAD,EAAK;AAC5C,OAAG,CAACA,CAAJ,EACA;AACC;AACA;;AAED7E,0BAAWkB,OAAX,CACC,MAAKgkB,WAAL,EADD,EAEG,EAACrlB,IAAIgF,CAAL,EAFH,EAGEpF,IAHF,CAGO,oBAAU;AAChB,UAAKmB,IAAL,CAAUf,EAAV,GAAegF,CAAf;;AAEA,QAAI+G,SAASlM,SAASE,IAAT,CAAc,CAAd,CAAb;;AAEA,QAAG,CAACgM,MAAJ,EACA;AACC,WAAKhL,IAAL,CAAUL,QAAV,GAAqB,IAArB;AACA,WAAKK,IAAL,CAAUP,KAAV,GAAqB,IAArB;;AAEA;AACA;;AAED,UAAKM,OAAL,CAAaiL,MAAb;AACA,IAjBD;AAkBA,GAxBD,EAwBG,EAAC9J,MAAM,CAAP,EAxBH;;AA0BA,QAAKlB,IAAL,CAAUge,KAAV,CAAgBhe,IAAhB,CAAqBkD,KAArB,CAA2BpC,MAA3B,CAAkC,SAAlC,EAA6C,UAACmD,CAAD,EAAK;AACjD,SAAKjE,IAAL,CAAUihB,OAAV,GAAoBhd,CAApB;AACA,GAFD;AAtED;AAyEC;;;;+BAGD;AACC,QAAKjE,IAAL,CAAUkS,MAAV,CAAiBqS,UAAjB,CACC,KAAKvkB,IAAL,CAAUgL,MADX,EAEG,IAFH;AAIA;;;8BAEW/M,K,EAAOgV,K,EACnB;AACChV,SAAM+e,eAAN;;AAEA,OAAG,CAAC,KAAKqH,OAAT,EACA;AACC,SAAKrkB,IAAL,CAAUokB,IAAV,GAAiB,GAAjB;AACA,SAAKpkB,IAAL,CAAUkS,MAAV,CAAiBsS,WAAjB,CAA6BvR,KAA7B;AACA,SAAKoR,OAAL,GAAe,IAAf;AACA,IALD,MAOA;AACC,SAAKrkB,IAAL,CAAUokB,IAAV,GAAiB,GAAjB;AACA,SAAKpkB,IAAL,CAAUkS,MAAV,CAAiBuS,aAAjB,CAA+BxR,KAA/B;AACA,SAAKoR,OAAL,GAAe,KAAf;AACA;AACD;;;gCAGD;AACC,UAAOxmB,eAAOC,OAAP,GAAiB,KAAKkC,IAAL,CAAUkS,MAAV,CAAiBlS,IAAjB,CAAsBkX,KAAtB,CAA4B,eAA5B,CAAxB;AACA;;;iCAEclM,M,EACf;AACC,OAAGA,OAAO0Z,WAAV,EACA;AACC,WAAO1Z,OAAQA,OAAO0Z,WAAf,CAAP;AACA;;AAED,UAAO1Z,OAAOvL,KAAP,IACHuL,OAAOrL,QADJ,IAEHqL,OAAO/L,EAFX;AAGA;;;0BAEOuM,K,EACR;AACC,QAAI,IAAI/K,CAAR,IAAa+K,KAAb,EACA;AACC,SAAKxL,IAAL,CAAUS,CAAV,IAAe+K,MAAM/K,CAAN,CAAf;AACA;;AAED,QAAKT,IAAL,CAAUgL,MAAV,GAAmBQ,KAAnB;;AAEA,QAAKxL,IAAL,CAAUP,KAAV,GAAkB,KAAKklB,cAAL,CAAoBnZ,KAApB,CAAlB;AACA;;;;EAnI2B1L,W;;;;;;;;;;;;;;;;;ACJ7B;;;;IAEa8kB,Q,WAAAA,Q;AAEZ,qBACA;AAAA;;AAAA;;AACC,OAAKC,QAAL,GAAgB,GAAhB;;AAEA,OAAKC,SAAL,GAAiB,IAAjB;;AAEA,OAAK9iB,IAAL,GAAa/B,mBAASC,YAAT,CAAsB,EAAtB,CAAb;AACA,OAAK6kB,KAAL,GAAa9kB,mBAASC,YAAT,CAAsB,EAAtB,CAAb;;AAEAoH,WAASiH,gBAAT,CAA0B,OAA1B,EAAmC,UAACtQ,KAAD,EAAW;AAC7C,SAAK+D,IAAL,CAAW/D,MAAM4D,GAAjB,IAA2B,CAAC,CAA5B;AACA,SAAKkjB,KAAL,CAAY9mB,MAAM4P,IAAlB,IAA2B,CAAC,CAA5B;AACA,GAHD;;AAKAvG,WAASiH,gBAAT,CAA0B,SAA1B,EAAqC,UAACtQ,KAAD,EAAW;AAC/C,OAAG,MAAK+D,IAAL,CAAW/D,MAAM4D,GAAjB,IAAyB,CAA5B,EACA;AACC;AACA;AACD,SAAKG,IAAL,CAAW/D,MAAM4D,GAAjB,IAA2B,CAA3B;AACA,SAAKkjB,KAAL,CAAY9mB,MAAM4P,IAAlB,IAA2B,CAA3B;AACA,GAPD;;AASAvP,SAAOiQ,gBAAP,CAAwB,MAAxB,EAAgC,UAACtQ,KAAD,EAAS;AACxC,QAAI,IAAIwC,CAAR,IAAa,MAAKuB,IAAlB,EACA;AACC,UAAKA,IAAL,CAAUvB,CAAV,IAAe,CAAC,CAAhB;AACA;AACD,QAAI,IAAIA,EAAR,IAAa,MAAKskB,KAAlB,EACA;AACC,UAAKA,KAAL,CAAWtkB,EAAX,IAAgB,CAAC,CAAjB;AACA;AACD,GATD;AAUA;;;;yBAEMoB,G,EACP;AACC,OAAG,CAAC,KAAKG,IAAL,CAAUH,GAAV,CAAJ,EACA;AACC,WAAO,CAAP;AACA;;AAED,UAAO,KAAKG,IAAL,CAAUH,GAAV,CAAP;AACA;;;6BAEUgM,I,EACX;AACC,OAAG,CAAC,KAAKkX,KAAL,CAAWlX,IAAX,CAAJ,EACA;AACC,WAAO,CAAP;AACA;;AAED,UAAO,KAAKkX,KAAL,CAAWlX,IAAX,CAAP;AACA;;;2BAGD;AACC,QAAI,IAAIpN,CAAR,IAAa,KAAKuB,IAAlB,EACA;AACC,QAAG,KAAKA,IAAL,CAAUvB,CAAV,IAAe,CAAlB,EACA;AACC,UAAKuB,IAAL,CAAUvB,CAAV;AACA,KAHD,MAKA;AACC,UAAKuB,IAAL,CAAUvB,CAAV;;AAEA,SAAG,KAAKuB,IAAL,CAAUvB,CAAV,IAAe,CAAC,KAAKokB,QAAxB,EACA;AACC,aAAO,KAAK7iB,IAAL,CAAUvB,CAAV,CAAP;AACA;AACD;AACD;AACD,QAAI,IAAIA,CAAR,IAAa,KAAKskB,KAAlB,EACA;AACC,QAAG,KAAKA,KAAL,CAAWtkB,CAAX,IAAgB,CAAnB,EACA;AACC,UAAKskB,KAAL,CAAWtkB,CAAX;AACA,KAHD,MAKA;AACC,UAAKskB,KAAL,CAAWtkB,CAAX;;AAEA,SAAG,KAAKskB,KAAL,CAAWtkB,CAAX,IAAgB,CAAC,KAAKokB,QAAzB,EACA;AACC,aAAO,KAAK7iB,IAAL,CAAUvB,CAAV,CAAP;AACA;AACD;AACD;AACD;;;;;;;;;;;;;;;AC7FF;;AACA;;;;;;;;IAEaukB,O,WAAAA,O;;;AAEZ,kBAAYnT,OAAZ,EAAqBK,MAArB,EAA6Bc,GAA7B,EAAkCC,KAAlC,EAAyClB,MAAzC,EACA;AAAA;;AAAA,gHACOF,OADP,EACgBK,MADhB,EACwBc,GADxB,EAC6BC,KAD7B,EACoClB,MADpC;;AAGC,QAAKF,OAAL,CAAaoT,SAAb,CAAuB5iB,MAAvB,CAA8B,YAA9B;AACA,QAAKwP,OAAL,CAAaoT,SAAb,CAAuB7iB,GAAvB,CAA2B,gBAA3B;;AAEA,QAAKtB,MAAL,CAAY,SAAZ,EAAuB,UAACmD,CAAD,EAAK;AAC3B,OAAGA,CAAH,EACA;AACC,QAAG,MAAKihB,WAAR,EACA;AACC1gB,kBAAa,MAAK0gB,WAAlB;AACA;AACD,UAAKA,WAAL,GAAmB5gB,WAClB,YAAI;AACH,SAAG,CAAC,MAAKuN,OAAT,EACA;AACC;AACA;;AAED,WAAKA,OAAL,CAAaoT,SAAb,CAAuB7iB,GAAvB,CAA2B,YAA3B;AACA,WAAKyP,OAAL,CAAaoT,SAAb,CAAuB5iB,MAAvB,CAA8B,gBAA9B;;AAEA2F,cAAIoB,OAAJ,CAAY,MAAKyI,OAAjB,EAA0B,iBAA1B,EAA6C,UAACM,GAAD,EAAS;AACrD,UAAIgT,YAAYhT,IAAI0E,YAAJ,CAAiB,eAAjB,CAAhB;AACA,UAAIuO,QAAYjT,IAAI0E,YAAJ,CAAiB,OAAjB,CAAhB;;AAEA1E,UAAInE,YAAJ,CAAiB,OAAjB,EAA0BoX,QAAQ,GAAR,GAAcD,SAAxC;;AAEAhT,UAAI4E,eAAJ,CAAoB,eAApB;AACA,MAPD;AAQA,KAlBiB,EAoBhB,CAAC,MAAKsO,SAAL,IAAkB,MAAKxT,OAAL,CAAawT,SAAhC,IAA6C,GAA9C,GACI,MAAKxT,OAAL,CAAayT,UAAd,GAA4B,GArBd,CAAnB;AAwBA;AACD,GAhCD;AAND;AAuCC;;;EA1C2BC,qB;;;;;;;;;;;;;;;ACH7B;;AACA;;AACA;;;;;;;;IAEaC,S,WAAAA,S;;;AAEZ,oBAAY3T,OAAZ,EAAqBK,MAArB,EAA6Bc,GAA7B,EAAkCC,KAAlC,EAAyClB,MAAzC,EACA;AAAA;;AAAA,oHACOF,OADP,EACgBK,MADhB,EACwBc,GADxB,EAC6BC,KAD7B,EACoClB,MADpC;;AAGC,QAAK0T,SAAL,GAAiB,KAAjB;AACA,QAAKL,KAAL,GAAiBvT,QAAQgF,YAAR,CAAqB,OAArB,CAAjB;AACA,QAAK6O,MAAL,GAAiB,KAAjB;;AAEA,QAAKC,YAAL,GAAoB,MAAK9T,OAAL,CAAagF,YAAb,CAA0B,WAA1B,CAApB;;AAEA,QAAKhF,OAAL,CAAakF,eAAb,CAA6B,WAA7B;;AAEA,QAAK6O,YAAL,GAAsB,CAAtB;AACA,QAAKC,WAAL,GAAsB,CAAtB;AACA,QAAKC,aAAL,GAAsB,CAAtB;AACA,QAAKC,cAAL,GAAsB,CAAtB;;AAEA,QAAKC,gBAAL,GAA0B,CAA1B;AACA,QAAKC,kBAAL,GAA0B,CAA1B;;AAEA,QAAKC,aAAL,GAAsB,EAAtB;AACA,QAAKC,cAAL,GAAsB,CAAtB;;AAEA,QAAKC,SAAL,GAAkB,EAAlB;AACA,QAAKC,UAAL,GAAkB,CAAlB;;AAEA,QAAKxU,OAAL,CAAaoT,SAAb,CAAuB7iB,GAAvB,CAA2B,UAA3B;;AAEA,QAAKkkB,WAAL;;AAEA,QAAKC,UAAL,GAAkB,IAAlB;;AAEA;AACA,QAAKC,IAAL;;AAEA,QAAKC,aAAL,GAAqB,UAACxoB,KAAD,EAAW;AAC/B,SAAKuoB,IAAL,GAAY,MAAK3U,OAAL,CAAa6U,qBAAb,EAAZ;;AAEA,OAAG,CAAC,MAAKjB,SAAT,EACA;AACC,UAAKkB,QAAL,GAAgBC,KAAKC,IAAL,CACf,eAAKL,IAAL,CAAUjgB,GAAV,EAAiB,CAAjB,aACE,MAAKigB,IAAL,CAAUM,IADZ,EACoB,CADpB,CADe,CAAhB;;AAKA,QAAMC,MAAMlV,QAAQgF,YAAR,CAAqB,gBAArB,KAA0C,IAAtD;;AAEA,QAAImQ,YAAa1oB,OAAO2oB,UAAP,GAAqB,MAAKT,IAAL,CAAUU,KAAhD;AACA,QAAIC,aAAa7oB,OAAO8oB,WAAP,GAAqB,MAAKZ,IAAL,CAAUa,MAAhD;;AAEA,QAAIC,oBAAoB,CAAC,MAAKd,IAAL,CAAUM,IAAV,GAAiBE,SAAlB,IAAgC,CAAxD;AACA,QAAIO,iBAAoB,CAAC,MAAKf,IAAL,CAAUjgB,GAAV,GAAiB4gB,UAAlB,IAAgC,CAAxD;;AAEA,UAAKlB,kBAAL,GAA0BqB,oBAAoBP,GAA9C;AACA,UAAKf,gBAAL,GAA0BuB,iBAAiBR,GAA3C;;AAEA,QAAG,MAAKd,kBAAL,GAA0B,IAA7B,EACA;AACC,WAAKA,kBAAL,GAA0B,IAA1B;AACA;AACD,QAAG,MAAKD,gBAAL,GAAwB,IAA3B,EACA;AACC,WAAKA,gBAAL,GAAwB,IAAxB;AACA;;AAED,QAAG,MAAKC,kBAAL,GAA0B,GAA7B,EACA;AACC,WAAKA,kBAAL,GAA0B,GAA1B;AACA;AACD,QAAG,MAAKD,gBAAL,GAAwB,GAA3B,EACA;AACC,WAAKA,gBAAL,GAAwB,GAAxB;AACA;;AAED;AACA;;AAED,OAAG,CAAC,MAAKnU,OAAL,CAAaY,QAAb,CAAsBxU,MAAM6G,MAA5B,CAAJ,EACA;AACC;AACA;;AAED7G,SAAM+e,eAAN;AACA/e,SAAMG,cAAN;;AAEA,OAAG,MAAKsnB,MAAR,EACA;AACC;AACA;;AAED,OAAG,CAAC,MAAKD,SAAT,EACA;AACC,UAAKlmB,GAAL;AACA,IAHD,MAIK,IAAGtB,MAAM6G,MAAN,CAAaiE,OAAb,CAAqB,cAArB,KAAwC,MAAK0c,SAAhD,EACL;AACC,UAAK+B,KAAL;AACA;AACD,GA/DD;;AAkEA,QAAKC,cAAL,GAAsB,UAACxpB,KAAD,EAAW;AAChC;AACA,OAAGA,MAAM4D,GAAN,KAAc,QAAjB,EACA;AACC;AACA;AACD,SAAK2lB,KAAL;AACA,GAPD;;AASA,MAAG,CAAC,MAAK3V,OAAL,CAAa6V,mBAAjB,EACA;AACCjmB,UAAOsB,cAAP,CAAsB,MAAK8O,OAA3B,EAAoC,uBAApC,EAA6D;AAC5D7O,gBAAY,KADgD;AAE1DC,cAAU;AAFgD,IAA7D;;AAKA,SAAK4O,OAAL,CAAa6V,mBAAb,GAAmC,MAAKjB,aAAxC;AACA,SAAK5U,OAAL,CAAa8V,oBAAb,GAAoC,MAAKF,cAAzC;;AAEA,SAAK5V,OAAL,CAAatD,gBAAb,CAA8B,OAA9B,EAAwCsD,QAAQ6V,mBAAhD;AACAppB,UAAOiQ,gBAAP,CAAwB,OAAxB,EAAkCsD,QAAQ8V,oBAA1C;;AAEA,SAAK/U,OAAL,CAAapQ,IAAb,CAAmB,UAACqP,OAAD;AAAA,WAAW,YAAI;AACjCA,aAAQF,mBAAR,CAA4B,OAA5B,EAAsCE,QAAQ6V,mBAA9C;AACAppB,YAAOqT,mBAAP,CAA2B,OAA3B,EAAqCE,QAAQ8V,oBAA7C;AACA,KAHkB;AAAA,IAAD,CAGf9V,OAHe,CAAlB;AAIA;AA9HF;AA+HC;;;;0BAgCD;AAAA,OADMyB,MACN,uEADe,IACf;;AACC,+GAAYA,MAAZ;;AAEA,OAAGA,MAAH,EACA;AACChM,aAAStI,IAAT,CAAcgP,YAAd,CAA2B,OAA3B,EAAoC,KAAKoY,SAAzC;AACA9e,aAAStI,IAAT,CAAcgP,YAAd,CAA2B,OAA3B,EAAoC,EAApC;AACA;AACD;;;wBAGD;AAAA;;AACCwX,aAAUoC,QAAV;;AAEA,QAAKzB,cAAL,GAAsB7nB,OAAOupB,OAA7B;;AAEA,QAAKrB,IAAL,GAAa,KAAK3U,OAAL,CAAa6U,qBAAb,EAAb;AACA,QAAKtB,KAAL,GAAa,KAAKvT,OAAL,CAAagF,YAAb,CAA0B,OAA1B,CAAb;;AAEA,OAAIiR,UAAU,KAAKjW,OAAnB;;AAEA;;AAEA,UAAMiW,QAAQzV,UAAR,IAAsB,CAACyV,QAAQ/e,OAAR,CAAgB,KAAK4c,YAArB,CAA7B,EACA;AACC,QAAGmC,QAAQzV,UAAR,IAAsB/K,QAAzB,EACA;AACC;AACA;AACDwgB,cAAUA,QAAQzV,UAAlB;AACA;;AAED;;AAEA,OAAI0V,WAAWD,QAAQpB,qBAAR,EAAf;;AAEApoB,UAAO4W,qBAAP,CAA6B,YAAI;;AAEhC,WAAKgR,aAAL,0DAEe,OAAKM,IAAL,CAAU7V,CAFzB,iCAGe,OAAK6V,IAAL,CAAUwB,CAHzB,iCAIe,OAAKxB,IAAL,CAAUyB,KAJzB,iCAKe,OAAKzB,IAAL,CAAU0B,MALzB,mEAOqB,OAAKjC,kBAP1B,yCAQY,OAAKD,gBARjB,4CASa,OAAKC,kBATlB,2CAUe,OAAKD,gBAVpB,wCAWY,OAAKC,kBAXjB;;AAeA,QAAIb,QAAQ,OAAKA,KAAL,GAAa,OAAKc,aAA9B;;AAEA,WAAKrU,OAAL,CAAa7D,YAAb,CAA0B,OAA1B,EAAmCoX,KAAnC;;AAEA9mB,WAAO4W,qBAAP,CAA6B,YAAI;AAChCkQ,2CACe2C,SAASpX,CADxB,mCAEeoX,SAASC,CAFxB,mCAGeD,SAASE,KAHxB,mCAIeF,SAASG,MAJxB,sEAMqB,OAAKjC,kBAN1B,sCAOU,OAAKD,gBAPf,iDAQW,OAAKC,kBARhB,gDASa,OAAKD,gBATlB,6CAUU,OAAKC,kBAVf;;AAaA,YAAKP,MAAL,GAAc,IAAd;;AAEA,YAAK7T,OAAL,CAAa7D,YAAb,CAA0B,OAA1B,EAAmCoX,KAAnC;AACA,YAAKvT,OAAL,CAAaoT,SAAb,CAAuB7iB,GAAvB,CAA2B,QAA3B;AACA,YAAKyP,OAAL,CAAaoT,SAAb,CAAuB5iB,MAAvB,CAA8B,UAA9B;;AAEA,YAAKkkB,UAAL,GAAkBjiB,WAAW,YAAI;AAChC,UAAG,CAAC,OAAKuN,OAAT,EACA;AACC;AACA;AACD,aAAKuU,SAAL,GAAiB9e,SAAStI,IAAT,CAAc6X,YAAd,CAA2B,OAA3B,CAAjB;;AAEAvP,eAAStI,IAAT,CAAcgP,YAAd,CAA2B,OAA3B,EAAoC,8BAApC;;AAEA,aAAK0X,MAAL,GAAc,KAAd;AACA1d,eAAIoB,OAAJ,CAAY,OAAKyI,OAAjB,EAA0B,KAA1B,EAAiC,UAACM,GAAD,EAAO;AACvC,WAAIlU,QAAQ,IAAIyR,WAAJ,CAAgB,UAAhB,CAAZ;;AAEAyC,WAAIhJ,aAAJ,CAAkBlL,KAAlB;;AAEA,cAAKqoB,WAAL,GAAmB,OAAKzU,OAAL,CAAagF,YAAb,CAA0B,OAA1B,CAAnB;AACA,OAND;AAOA,UAAI5Y,QAAQ,IAAIyR,WAAJ,CAAgB,OAAhB,EAAyB;AACpC8F,gBAAS,IAD2B;AAElC5F,eAAQ;AACTuC,aAAK,MADI;AAEP7D,cAAM,OAAK4D,MAFJ;AAGPvS,kBAAU,OAAKuS,MAAL,CAAYlS,IAAZ,CAAiBL;AAHpB;AAF0B,OAAzB,CAAZ;AAQA,aAAKkS,OAAL,CAAa1I,aAAb,CAA2BlL,KAA3B;AAEA,MA3BiB,EA2Bf,OAAKgoB,kBAAL,GAAwB,IA3BT,CAAlB;AA4BA,KAhDD;;AAkDA,WAAKR,SAAL,GAAiB,IAAjB;AACA,IAxED;AAyEA;;;0BAGD;AAAA;;AACC,QAAK5T,OAAL,CAAaoT,SAAb,CAAuB7iB,GAAvB,CAA2B,WAA3B;;AAEA,OAAG,KAAKmkB,UAAR,EACA;AACC/hB,iBAAa,KAAK+hB,UAAlB;AACA;;AAED,OAAGf,UAAUlD,KAAV,IAAmB,CAAtB,EACA;AACChb,aAAStI,IAAT,CAAcgP,YAAd,CAA2B,OAA3B,EAAoC,EAApC;AACA,IAHD,MAKA;AACC1G,aAAStI,IAAT,CAAcgP,YAAd,CAA2B,OAA3B,EAAoC,KAAKoY,SAAL,IAAkB,EAAtD;AACA;;AAEDZ,aAAU2C,UAAV;;AAEA,OAAG,CAAC,KAAK3B,IAAT,EACA;AACC,SAAKA,IAAL,GAAY,KAAK3U,OAAL,CAAa6U,qBAAb,EAAZ;AACA;;AAEDpoB,UAAO8pB,QAAP,CAAgB,CAAhB,EAAkB,KAAKjC,cAAvB;;AAEA,OAAIf,QAAQ,KAAKA,KAAL,GACT,KAAKc,aADI,4BAEa,KAAKD,kBAFlB,sCAGE,KAAKD,gBAHP,0CAID,KAAKC,kBAJJ,wBAAZ;;AAMA,QAAKpU,OAAL,CAAa7D,YAAb,CAA0B,OAA1B,EAAmCoX,KAAnC;;AAEA,QAAKM,MAAL,GAAc,IAAd;;AAEAphB,cAAW,YAAI;AACd,QAAG,CAAC,OAAKuN,OAAT,EACA;AACC;AACA;AACD,WAAKA,OAAL,CAAaoT,SAAb,CAAuB5iB,MAAvB,CAA8B,QAA9B;AAEA,IAPD,EAOG,KAAK4jB,kBAAL,GAAwB,IAP3B;AAQA3hB,cAAW,YAAI;AACd,WAAKuN,OAAL,CAAaoT,SAAb,CAAuB7iB,GAAvB,CAA2B,UAA3B;AACA,WAAKyP,OAAL,CAAaoT,SAAb,CAAuB5iB,MAAvB,CAA8B,WAA9B;AACA,QAAG,CAAC,OAAKwP,OAAT,EACA;AACC;AACA;AACD,WAAKA,OAAL,CAAa7D,YAAb,CAA0B,OAA1B,EAAmC,OAAKoX,KAAxC;AACA,WAAKM,MAAL,GAAc,KAAd;AACA1d,aAAIoB,OAAJ,CAAY,OAAKyI,OAAjB,EAA0B,KAA1B,EAAiC,UAACM,GAAD,EAAO;AACvC,SAAIlU,QAAQ,IAAIyR,WAAJ,CAAgB,YAAhB,CAAZ;;AAEAyC,SAAIhJ,aAAJ,CAAkBlL,KAAlB;AACA,KAJD;AAKA,QAAIA,QAAQ,IAAIyR,WAAJ,CAAgB,SAAhB,EAA2B;AACtC8F,cAAS,IAD6B;AAEpC5F,aAAQ;AACTuC,WAAK,MADI;AAEP7D,YAAM,OAAK4D,MAFJ;AAGPvS,gBAAU,OAAKuS,MAAL,CAAYlS,IAAZ,CAAiBL;AAHpB;AAF4B,KAA3B,CAAZ;AAQA,WAAKkS,OAAL,CAAa1I,aAAb,CAA2BlL,KAA3B;AACA,IAvBD,EAuBG,KAAKgoB,kBAAL,GAAwB,IAvB3B;;AAyBA,QAAKR,SAAL,GAAiB,KAAjB;AACA;;;2BAGD;AACCne,YAAStI,IAAT,CAAcgP,YAAd,CAA2B,OAA3B,EAAoC,KAAKoY,SAAzC;AACA;AACA;;;6BAzND;AACC,OAAG,CAAC,KAAK9D,KAAT,EACA;AACC,SAAKA,KAAL,GAAa,CAAb;AACA;;AAED,QAAKA,KAAL;;AAEA,UAAO,KAAKA,KAAZ;AACA;;;+BAGD;AACC,OAAG,CAAC,KAAKA,KAAT,EACA;AACC,SAAKA,KAAL,GAAa,CAAb;AACA;;AAED,QAAKA,KAAL;;AAEA,OAAG,KAAKA,KAAL,GAAa,CAAhB,EACA;AACC,SAAKA,KAAL,GAAa,CAAb;AACA;;AAED,UAAO,KAAKA,KAAZ;AACA;;;;EA/J6BlQ,S;;;;;;;;;;;;;ACJ/B;;AACA;;AACA;;;;;;;;IAEamT,S,WAAAA,S;;;AAEZ,oBAAY1T,OAAZ,EAAqBK,MAArB,EAA6Bc,GAA7B,EAAkCC,KAAlC,EAAyClB,MAAzC,EACA;AAAA;;AAAA,oHACOF,OADP,EACgBK,MADhB,EACwBc,GADxB,EAC6BC,KAD7B,EACoClB,MADpC;;AAGC,QAAKsW,OAAL,GAAuB,KAAvB;AACA,QAAKhD,SAAL,GAAuB,KAAvB;AACA,QAAKiD,YAAL,GAAuB,KAAvB;;AAEA,QAAKC,cAAL,GAAsB,UAACC,CAAD,EAAO;AAC5B,OAAIC,WAAWD,EAAE1jB,MAAjB;;AAEA,UAAM2jB,SAASpW,UAAf,EACA;AACCoW,eAAWA,SAASpW,UAApB;AACA;;AAED,OAAGoW,aAAanqB,MAAb,IAAuBmqB,aAAanhB,QAAvC,EACA;AACC;AACA;;AAED,OAAGkhB,EAAE1jB,MAAF,KAAa+M,OAAhB,EACA;AACC;AACA;;AAED,SAAK6W,iBAAL,CAAuBF,EAAE1jB,MAAzB;AACA,SAAK6jB,iBAAL,CAAuBH,EAAE1jB,MAAzB;;AAEA,SAAK8jB,QAAL,CAAcJ,EAAE1jB,MAAhB;;AAEA0jB,KAAE1jB,MAAF,CAAS6M,mBAAT,CACC,eADD,EAEG,MAAK4W,cAFR;AAIA,GA3BD;;AA6BA,QAAK1W,OAAL,CAAatD,gBAAb,CACC,eADD,EAEG,MAAKga,cAFR;;AAKA,QAAK3V,OAAL,CAAapQ,IAAb,CAAmB,UAACqP,OAAD;AAAA,UAAa,YAAM;AACrCA,YAAQF,mBAAR,CACC,eADD,EAEG,MAAK4W,cAFR;AAIA,IALkB;AAAA,GAAD,CAKf,MAAK1W,OALU,CAAlB;;AAOA,QAAK/Q,MAAL,CAAY,SAAZ,EAAuB,UAACmD,CAAD,EAAO;AAC7B,OAAI4kB,sBAAJ;;AAEA,OAAG5kB,CAAH,EACA;AACC4kB,oBAAgB,IAAIvZ,KAAJ,CAAU,cAAV,CAAhB;AACA,IAHD,MAKA;AACCuZ,oBAAgB,IAAIvZ,KAAJ,CAAU,eAAV,CAAhB;AACA;;AAEDtH,YAAIoB,OAAJ,CAAY,MAAKyI,OAAjB,EAA0B,KAA1B,EAAiC,UAACzL,IAAD,EAAU;AAC1CA,SAAK+C,aAAL,CAAmB0f,aAAnB;AACA,IAFD;;AAIA,SAAKhX,OAAL,CAAa1I,aAAb,CAA2B0f,aAA3B;AACA,GAjBD;;AAmBA,QAAK/nB,MAAL,CAAY,WAAZ,EAAyB,UAACmD,CAAD,EAAO;AAC/B,OAAI4kB,gBAAgB,IAAInZ,WAAJ,CAAgB,YAAhB,EAA8B;AACjDE,YAAQ,EAACwT,QAAQnf,CAAT;AADyC,IAA9B,CAApB;AAGA+D,YAAIoB,OAAJ,CAAY,MAAKyI,OAAjB,EAA0B,KAA1B,EAAiC,UAACzL,IAAD,EAAU;AAC1CA,SAAK+C,aAAL,CAAmB0f,aAAnB;AACA,IAFD;;AAIA,SAAKhX,OAAL,CAAa1I,aAAb,CAA2B0f,aAA3B;AACA,GATD;AAnED;AA6EC;;;;2BAEQC,Q,EACT;AACC,OAAIloB,UAAU,KAAKiR,OAAnB;;AAEA,OAAG,CAACjR,OAAJ,EACA;AACC;AACA;;AAED,OAAIykB,YAAoB,CAAxB;AAAA,OACGiD,eAAkB,CADrB;;AAGA,OAAID,UAAU,KAAd;;AAEA,OAAI7B,OAAO5lB,QAAQ8lB,qBAAR,EAAX;;AAEA,OAAGF,KAAKa,MAAL,GAAc,CAAd,IAAmBb,KAAKjgB,GAAL,GAAWjI,OAAO8oB,WAAxC,EACA;AACCiB,cAAU,IAAV;AACA;;AAED,QAAKnV,KAAL,CAAWmV,OAAX,GAA0BA,OAA1B;AACA,QAAKnV,KAAL,CAAWmS,SAAX,GAA0BmB,KAAKjgB,GAAL,IAAe,CAAzC;AACA,QAAK2M,KAAL,CAAWoV,YAAX,GAA0B9B,KAAKa,MAAL,IAAe,CAAzC;AACA;;;oCAEiBlV,G,EAClB;AAAA;;AACC,OAAG,CAACA,IAAI4W,oBAAR,EACA;AACCtnB,WAAOsB,cAAP,CAAsBoP,GAAtB,EAA2B,sBAA3B,EAAmD;AAClDnP,iBAAY,KADsC;AAEhDC,eAAU;AAFsC,KAAnD;;AAKAkP,QAAI4W,oBAAJ,GAA2B,UAAC9qB,KAAD,EAAW;AACrC,YAAK2qB,QAAL,CAAc3qB,MAAM6G,MAApB;AACA,KAFD;;AAIA,QAAIsB,OAAO+L,GAAX;AACA,QAAIvO,UAAU,EAAColB,SAAS,IAAV,EAAgBC,SAAS,IAAzB,EAAd;;AAEA,WAAM7iB,KAAKiM,UAAX,EACA;AACCjM,YAAOA,KAAKiM,UAAZ;;AAEAjM,UAAKmI,gBAAL,CACC,QADD,EAEG4D,IAAI4W,oBAFP,EAGGnlB,OAHH;;AAMA,UAAKmO,MAAL,CAAYa,OAAZ,CAAoBpQ,IAApB,CAA0B,UAAC4D,IAAD,EAAO+L,GAAP,EAAYvO,OAAZ;AAAA,aAAsB,YAAI;AACnDwC,YAAKuL,mBAAL,CACC,QADD,EAEGQ,IAAI4W,oBAFP,EAGGnlB,OAHH;AAKAuO,aAAM/L,OAAO,IAAb;AACA,OAPyB;AAAA,MAAD,CAOtBA,IAPsB,EAOhB+L,GAPgB,EAOXvO,OAPW,CAAzB;AAQA;AACD;AACD;;;oCAEiBuO,G,EAClB;AAAA;;AACC,OAAG,CAACA,IAAI+W,oBAAR,EACA;AACCznB,WAAOsB,cAAP,CAAsBoP,GAAtB,EAA2B,sBAA3B,EAAmD;AAClDnP,iBAAY,KADsC;AAEhDC,eAAU;AAFsC,KAAnD;;AAKAkP,QAAI+W,oBAAJ,GAA2B,UAACjrB,KAAD,EAAS;AACnC,YAAK2qB,QAAL,CAAc3qB,MAAM6G,MAApB;AACA,KAFD;;AAIAxG,WAAOiQ,gBAAP,CAAwB,QAAxB,EAAkC,KAAK4a,cAAvC;;AAEA,SAAKpX,MAAL,CAAYa,OAAZ,CAAoBpQ,IAApB,CAA0B,UAACqP,OAAD;AAAA,YAAW,YAAI;AACxCvT,aAAOqT,mBAAP,CAA2B,QAA3B,EAAqCE,QAAQqX,oBAA7C;AACA/W,UAAI+W,oBAAJ,GAA2B,IAA3B;AACA/W,YAAM,IAAN;AACA,MAJyB;AAAA,KAAD,CAItBA,GAJsB,CAAzB;AAKA;AACD;;;;EAvK6BC,S;;;;;;;;;;;;;ACJ/B;;AAEA;;;;;;;;IAEa/S,K,WAAAA,K;;;;;6BACM;AACjB,OAAG,CAAC,KAAK+pB,IAAT,EAAe;AACd,SAAKA,IAAL,GAAY,IAAI,IAAJ,EAAZ;AACA;AACD,UAAO,KAAKA,IAAZ;AACA;;;AACD,kBAAc;AAAA;;AAAA;;AAEb,QAAKprB,QAAL;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAKgC,IAAL,CAAUqpB,MAAV,GAAmB,EAAnB;;AAEA;AArBa;AAsBb;;;;sBACGvI,K,EAAO;AAAA;;AACV,OAAI7N,QAAQ,KAAKjT,IAAL,CAAUqpB,MAAV,CAAiB3kB,MAA7B;;AAEA,QAAK1E,IAAL,CAAUqpB,MAAV,CAAiB7mB,IAAjB,CAAsBse,KAAtB;;AAEAA,SAAMwI,KAAN,CAAa,UAACxI,KAAD;AAAA,WAAS,YAAI;AACzB,UAAI,IAAIrgB,CAAR,IAAa,OAAKT,IAAL,CAAUqpB,MAAvB,EACA;AACC,UAAG,OAAKrpB,IAAL,CAAUqpB,MAAV,CAAiB5oB,CAAjB,EAAoBoF,SAApB,KAAkCib,MAAMjb,SAA3C,EACA;AACCib,aAAMze,MAAN;AACA,cAAO,OAAKrC,IAAL,CAAUqpB,MAAV,CAAiB5oB,CAAjB,CAAP;AACA;AACA;AACD;AACD,KAVY;AAAA,IAAD,CAUTqgB,KAVS,CAAZ;AAWA;;;wBACKrhB,K,EAAOT,I,EAAMY,I,EAAM;AACxB,UAAO,KAAKL,GAAL,CAAS,IAAIC,sBAAJ,CAAe;AAC9BC,WAAOA,KADuB;AAE5BT,UAAMA,IAFsB;AAG5BY,UAAMA;AAHsB,IAAf,CAAT,CAAP;AAKA;;;;EArDyBE,W;;;;;;;;;;;;;ACJ3B;;;;;;;;IAEaN,U,WAAAA,U;;;AACZ,qBAAYQ,IAAZ,EAAkB;AAAA;;AAAA,sHACXA,IADW;;AAEjB,QAAKA,IAAL,CAAUJ,IAAV,GAAoB,MAAKI,IAAL,CAAUJ,IAAV,IAAkB,KAAtC;AACA,QAAK2pB,IAAL,GAAoB,MAAKvpB,IAAL,CAAUJ,IAA9B;AACA,QAAKI,IAAL,CAAUwpB,OAAV,GAAoB,CAApB;AACA,QAAKxpB,IAAL,CAAUP,KAAV,GAAoB,MAAKO,IAAL,CAAUP,KAAV,IAAmB,gBAAvC;AACA,QAAKO,IAAL,CAAUhB,IAAV,GAAoB,MAAKgB,IAAL,CAAUhB,IAAV,IAAmB,2BAAvC;AACA,QAAKhB,QAAL;AAPiB;AAajB;;;;wBACKyrB,Q,EAAU;AAAA;;AACf,OAAIC,gBAAgB,EAApB;AACA,OAAIJ,QAAQhU,YACX,YAAI;AACH,QAAG,OAAKtV,IAAL,CAAUJ,IAAV,GAAiB,CAApB,EAAuB;AACtB,YAAKI,IAAL,CAAUJ,IAAV,IAAkB8pB,aAAlB;AACA,YAAK1pB,IAAL,CAAUwpB,OAAV,GAAoB,OAAKxpB,IAAL,CAAUJ,IAAV,GAAiB,OAAK2pB,IAA1C;;AAEA,SAAG,OAAKvpB,IAAL,CAAUJ,IAAV,IAAkB,CAArB,EAAwB;AACvB,UAAG6pB,QAAH,EAAa;AACZA;AACA;AACDhrB,oBAAc6qB,KAAd;AACA;AACD;AACD,IAbU,EAcTI,aAdS,CAAZ;AAgBA;;;;EAjC8B5pB,W","file":".dist/curvature.js","sourcesContent":["export class Config {}\n\nConfig.backend = '//';\n","import { Config         } from 'Config';\r\n\r\nimport { View           } from '../base/View';\r\nimport { Router         } from '../base/Router';\r\nimport { Repository     } from '../base/Repository';\r\n\r\nimport { UserRepository } from './UserRepository';\r\n\r\nimport { Toast      } from '../toast/Toast';\r\nimport { ToastAlert } from '../toast/ToastAlert';\r\n\r\nexport class LoginView extends View{\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.template = `\r\n\t\t\t<a cv-link = \"user\">User</a>\r\n\t\t\t<br />\r\n\t\t\t\r\n\t\t\t<a cv-link = \"user/login\">Login</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<a cv-link = \"user/register\">Register</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<a cv-link = \"user/logout\">Logout</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<input\r\n\t\t\t\ttype  = \"button\"\r\n\t\t\t\tvalue = \"Login via FaceBook\"\r\n\t\t\t \tcv-on = \"click:facebookLogin(event)\"\r\n\t\t\t />\r\n\t\t\t <input\r\n\t\t\t\ttype  = \"button\"\r\n\t\t\t\tvalue = \"Log Out\"\r\n\t\t\t \tcv-on = \"click:logout(event)\"\r\n\t\t\t />\r\n\t\t`;\r\n\t}\r\n\tfacebookLogin(event) {\r\n\t\tconsole.log('fb!')\r\n\t\tevent.preventDefault();\r\n\t\tlet fbWindow = window.open(\r\n\t\t\tConfig.backend\r\n\t\t\t\t+ '/facebookLogin'\r\n\t\t);\r\n\r\n\t\tif(this.userCheck)\r\n\t\t{\r\n\t\t\tthis.clearInterval(this.userCheck);\r\n\t\t}\r\n\r\n\t\tthis.userCheck = this.onInterval(333, () => {\r\n\t\t\tUserRepository.getCurrentUser(true).then((response) => {\r\n\t\t\t\tlet user = response.body;\r\n\t\t\t\tif(!user.id || !user)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.clearInterval(this.userCheck);\r\n\r\n\t\t\t\tRouter.clearCache();\r\n\t\t\t\tRepository.clearCache();\r\n\r\n\t\t\t\tToast.instance().pop(new ToastAlert({\r\n\t\t\t\t\ttitle: 'Logged in as ' + user.username\r\n\t\t\t\t\t, body: 'ID: '  + user.publicId\r\n\t\t\t\t\t, time: 2400\r\n\t\t\t\t}));\r\n\r\n\t\t\t\t// history.go(-1);\r\n\r\n\t\t\t\t// Router.instance().updateView(this, this.routes, true);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tlogout(event) {\r\n\t\tlet logoutWindow = window.open(\r\n\t\t\tConfig.backend\r\n\t\t\t\t+ '/user/logout?page=app%3Fclose%3D1'\r\n\t\t);\r\n\t}\r\n}\r\n\r\n","import { Config     } from 'Config';\r\nimport { Bindable   } from '../base/Bindable';\r\nimport { Repository } from '../base/Repository';\r\n\r\nexport class UserRepository extends Repository {\r\n\tstatic get uri() { return Config.backend + '/user/'; }\r\n\tstatic getCurrentUser(refresh = false) {\r\n\t\tthis.args = this.args || Bindable.makeBindable({});\r\n\t\tif(window.prerenderer)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!refresh && this.args.response)\r\n\t\t{\r\n\t\t\tconsole.log(this.args.response);\r\n\t\t\treturn Promise.resolve(this.args.response);\r\n\t\t}\r\n\t\treturn this.request(\r\n\t\t\tthis.uri + 'current'\r\n\t\t\t, false\r\n\t\t\t, false\r\n\t\t\t, false\r\n\t\t).then((response) => {\r\n\t\t\tif(response.body.roles)\r\n\t\t\t{\r\n\t\t\t\tfor(let i in response.body.roles)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(response.body.roles[i].class == 'SeanMorris\\\\Access\\\\Role\\\\Administrator')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tresponse.body.isAdmin = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.args.response && this.args.response.id)\r\n\t\t\t{\r\n\t\t\t\tthis.args.response = response;\r\n\t\t\t\tthis.args.current  = response.body;\r\n\t\t\t}\r\n\t\t\treturn response;\r\n\t\t});\r\n\t}\r\n\tstatic login() {\r\n\t\treturn this.request(this.uri + '/login');\r\n\t}\r\n\tstatic logout() {\r\n\t\tthis.args = this.args || Bindable.makeBindable({});\r\n\t\tthis.args.current = null;\r\n\t\treturn this.request(\r\n\t\t\tthis.uri + 'current'\r\n\t\t\t, false\r\n\t\t\t, {}\r\n\t\t\t, false\r\n\t\t).then((user) => {\r\n\t\t\tthis.request(\r\n\t\t\t\tthis.uri + 'logout'\r\n\t\t\t\t, false\r\n\t\t\t\t, {}\r\n\t\t\t\t, false\r\n\t\t\t).then(() => {\r\n\t\t\t\treturn user;\r\n\t\t\t});\r\n\t\t\treturn user;\r\n\t\t});\r\n\t}\r\n\tstatic onChange(callback) {\r\n\t\tthis.args = this.args || Bindable.makeBindable({});\r\n\t\treturn this.args.bindTo('current', callback);\r\n\t}\r\n}\r\n\r\nRepository.onResponse((response)=>{\r\n\tUserRepository.args = UserRepository.args || Bindable.makeBindable({});\r\n\tif(response\r\n\t\t&& response.meta\r\n\t\t&& response.meta.currentUser\r\n\t\t&& (!UserRepository.args.current\r\n\t\t\t|| response.meta.currentUser.id !== UserRepository.args.current.id\r\n\t\t)\r\n\t){\r\n\t\tUserRepository.args.current = response.meta.currentUser;\r\n\t}\r\n}, {wait:0});\r\n\r\n// setInterval(() => {\r\n// \tUserRepository.getCurrentUser();\r\n// \tconsole.log('!!!');\r\n// }, 5000);","export class Bag\n{\n\tconstructor(changeCallback)\n\t{\n\t\tthis.meta    = Symbol('meta');\n\t\tthis.content = {};\n\t\tthis._items  = false;\n\n\t\tthis.changeCallback = changeCallback;\n\t}\n\n\tadd(item)\n\t{\n\t\tif(typeof item instanceof Object)\n\t\t{\n\t\t\tthrow new Error('Only objects may be added/removed from Bags.');\n\t\t}\n\n\t\tif(!item[this.meta])\n\t\t{\n\t\t\titem[this.meta] = Symbol('bagId');\n\t\t}\n\n\t\tthis.content[ item[this.meta] ] = item;\n\n\t\tif(this.changeCallback)\n\t\t{\n\t\t\tthis.changeCallback(\n\t\t\t\tthis.content[ item[this.meta] ]\n\t\t\t\t, this.meta\n\t\t\t\t, 1\n\t\t\t);\n\t\t}\n\t}\n\n\tremove(item)\n\t{\n\t\tif(typeof item !== 'object')\n\t\t{\n\t\t\tthrow new Error('Only objects may be added/removed from Bags.');\n\t\t}\n\n\t\tif(!item[this.meta] || !this.content[ item[this.meta] ])\n\t\t{\n\t\t\tif(this.changeCallback)\n\t\t\t{\n\t\t\t\tthis.changeCallback(\n\t\t\t\t\tundefined\n\t\t\t\t\t, this.meta\n\t\t\t\t\t, 0\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tlet removed = this.content[ item[this.meta] ];\n\n\t\tdelete this.content[ item[this.meta] ];\n\n\t\tif(this.changeCallback)\n\t\t{\n\t\t\tthis.changeCallback(\n\t\t\t\tremoved\n\t\t\t\t, this.meta\n\t\t\t\t, -1\n\t\t\t);\n\t\t}\n\t}\n\n\tid(item)\n\t{\n\t\treturn item[ this.meta ];\n\t}\n\n\tget(key)\n\t{\n\t\treturn this.content[ key ];\n\t}\n\n\tkeys()\n\t{\n\t\treturn Object.getOwnPropertySymbols(\n\t\t\tthis.content\n\t\t).slice();\n\t}\n\n\titems()\n\t{\n\t\treturn this.keys().map((key)=>this.get(key)).slice();\n\n\t\tlet newItems = this.keys().map((key)=>this.get(key)).slice();\n\n\t\tif(!this._items)\n\t\t{\n\t\t\tthis._items = [];\n\t\t}\n\n\t\tlet add    = [];\n\t\tlet remove = [];\n\n\t\tfor(let i in this.items)\n\t\t{\n\t\t\tconsole.log('R', newItems.indexOf(this.items[i]));\n\n\t\t\tif(newItems.indexOf(this.items[i]) < 0)\n\t\t\t{\n\t\t\t\tremove.push(i);\n\t\t\t}\n\t\t}\n\n\t\tremove.sort();\n\t\tremove.reverse();\n\n\t\tfor(let i in newItems)\n\t\t{\n\t\t\tconsole.log('A', this._items.indexOf(newItems[i]));\n\n\t\t\tif(this._items.indexOf(newItems[i]) < 0)\n\t\t\t{\n\t\t\t\tadd.push(i);\n\t\t\t}\n\t\t}\n\n\t\tconsole.log(add, remove);\n\n\t\tfor(let i in remove)\n\t\t{\n\t\t\tthis._items.splice(remove[i], 1);\n\t\t}\n\n\t\tfor(let i in add)\n\t\t{\n\t\t\tthis._items.push(newItems[add[i]]);\n\t\t}\n\n\t\tconsole.log(newItems, this._items);\n\n\t\treturn this._items;\n\t}\n}","export class Bindable {\r\n    static isBindable(object) {\r\n        if (!object.___binding___) {\r\n            return false;\r\n        }\r\n\r\n        return object.___binding___ === Bindable;\r\n    }\r\n    static makeBindable(object) {\r\n\r\n        if (!object\r\n            || object.___binding___\r\n            || typeof object !== 'object'\r\n            || object instanceof Node\r\n        ) {\r\n            return object;\r\n        }\r\n\r\n        Object.defineProperty(object, '___ref___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, 'bindTo', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, 'isBound', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___binding___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___bindingAll___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___isBindable___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___executing___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___stack___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___stackTime___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___before___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___after___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        // Object.defineProperty(object, 'toString', {\r\n        //     enumerable: false,\r\n        //     writable: true\r\n        // });\r\n\r\n        Object.defineProperty(object, '___setCount___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___wrapped___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        Object.defineProperty(object, '___object___', {\r\n            enumerable: false,\r\n            writable: false,\r\n            value: object\r\n        });\r\n        object.___isBindable___ = Bindable;\r\n        object.___wrapped___    = {};\r\n        object.___binding___    = {};\r\n        object.___bindingAll___ = [];\r\n        object.___stack___      = [];\r\n        object.___stackTime___  = [];\r\n        object.___before___     = [];\r\n        object.___after___      = [];\r\n        object.___setCount___ = {};\r\n        object.bindTo = (property, callback = null, options = {}) => {\r\n            let bindToAll = false;\r\n\r\n            if (property instanceof Function) {\r\n                options   = callback || {};\r\n                callback  = property;\r\n                bindToAll = true;\r\n            }\r\n\r\n            let throttle = false;\r\n\r\n            if (options.delay >= 0) {\r\n                callback = ((callback) => (v,k,t,d) => {\r\n                    let p = t[k];\r\n                    setTimeout(()=>callback(v,k,t,d,p), options.delay);\r\n                })(callback);\r\n            }\r\n\r\n            if (options.throttle >= 0) {\r\n                callback = ((callback) => (v,k,t,d) => {\r\n                    if (throttle) {\r\n                        return;\r\n                    }\r\n                    let p = t[k];\r\n                    callback(v,k,t,d,p);\r\n                    throttle = true;\r\n                    setTimeout(()=>throttle = false, options.throttle);\r\n                })(callback);\r\n            }\r\n\r\n            let waiter;\r\n\r\n            if (options.wait >= 0) {\r\n                callback = ((callback) => (v,k,t,d) => {\r\n                    if (waiter) {\r\n                        clearTimeout(waiter);\r\n                    }\r\n                    let p = t[k];\r\n                    waiter = setTimeout(()=>callback(v,k,t,d,p), options.wait);\r\n                })(callback);\r\n            }\r\n\r\n            if(bindToAll) {\r\n                let bindIndex = object.___bindingAll___.length;\r\n\r\n                object.___bindingAll___.push(callback);\r\n\r\n                for (let i in object) {\r\n                    callback(object[i], i, object, false);\r\n                }\r\n\r\n                return () => {\r\n                    object.___bindingAll___[bindIndex] = null;\r\n                };\r\n            }\r\n\r\n            if (!object.___binding___[property]) {\r\n                object.___binding___[property] = [];\r\n            }\r\n\r\n            let bindIndex = object.___binding___[property].length;\r\n\r\n            object.___binding___[property].push(callback);\r\n\r\n            callback(object[property], property, object, false);\r\n\r\n            return () => {\r\n                if (!object.___binding___[property]) {\r\n                    return;\r\n                }\r\n                object.___binding___[property][bindIndex] = null;\r\n            };\r\n        };\r\n\r\n        object.isBound = () => {\r\n            for (let i in object.___bindingAll___) {\r\n                if (object.___bindingAll___[i]) {\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            for (let i in object.___binding___) {\r\n                for (let j in object.___binding___[i]) {\r\n                    if (object.___binding___[i][j]) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n\r\n        // object.toString = object.toString || (() => {\r\n        //     if (typeof object == 'object') {\r\n        //         return JSON.stringify(object);\r\n        //         return '[object]'\r\n        //     }\r\n\r\n        //     return object;\r\n        // });\r\n\r\n        for (let i in object) {\r\n            if (object[i] &&\r\n                typeof object[i] == 'object' &&\r\n                !object[i] instanceof Node\r\n            ) {\r\n                object[i] = Bindable.makeBindable(object[i]);\r\n            }\r\n        }\r\n\r\n        let set = (target, key, value) => {\r\n            if(typeof key === 'string'\r\n                && key.substring(0,3) === '___'\r\n                && key.slice(-3) === '___'\r\n            ){\r\n                return true;\r\n            }\r\n\r\n            if (target[key] === value) {\r\n                return true;\r\n            }\r\n\r\n            // console.log(`Setting ${key}`, value);\r\n\r\n            if (value && typeof value == 'object' && !(value instanceof Node)) {\r\n                if (value.___isBindable___ !== Bindable) {\r\n                    value = Bindable.makeBindable(value);\r\n\r\n                    for (let i in value) {\r\n                        if (value[i] && typeof value[i] == 'object') {\r\n                            value[i] = Bindable.makeBindable(value[i]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let i in object.___bindingAll___) {\r\n                if(!object.___bindingAll___[i]) {\r\n                    continue;\r\n                }\r\n                object.___bindingAll___[i](value, key, target, false);\r\n            }\r\n\r\n            let stop = false;\r\n\r\n            if (key in object.___binding___) {\r\n                for (let i in object.___binding___[key]) {\r\n                    if(!object.___binding___[key]) {\r\n                        continue;\r\n                    }\r\n                    if(!object.___binding___[key][i]) {\r\n                        continue;\r\n                    }\r\n                    if (object.___binding___[key][i](value, key, target, false, target[key]) === false) {\r\n                        stop = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!stop) {\r\n                let descriptor = Object.getOwnPropertyDescriptor(\r\n                    target\r\n                    , key\r\n                );\r\n\r\n                let excluded = (\r\n                    target instanceof File\r\n                    && key == 'lastModifiedDate'\r\n                );\r\n                \r\n                if(!excluded\r\n                    && (!descriptor || descriptor.writable)\r\n                ){\r\n                    target[key] = value;\r\n                }\r\n            }\r\n\r\n            if (!target.___setCount___[key]) {\r\n                target.___setCount___[key] = 0;\r\n            }\r\n\r\n            target.___setCount___[key]++;\r\n\r\n            const warnOn = 10;\r\n\r\n            if (target.___setCount___[key] > warnOn && value instanceof Object) {\r\n                // console.log(\r\n                //     'Warning: Resetting bindable reference \"' +\r\n                //     key +\r\n                //     '\" to object ' +\r\n                //     target.___setCount___[key] +\r\n                //     ' times.'\r\n                // );\r\n            }\r\n\r\n            return true;\r\n        };\r\n\r\n        let del = (target, key) => {\r\n            if (!(key in target)) {\r\n                return true;\r\n            }\r\n\r\n            for (let i in object.___bindingAll___) {\r\n                object.___bindingAll___[i](undefined, key, target, true, target[key]);\r\n            }\r\n\r\n            if (key in object.___binding___) {\r\n                for (let i in object.___binding___[key]) {\r\n                    if(!object.___binding___[key][i]) {\r\n                        continue;\r\n                    }\r\n                    object.___binding___[key][i](undefined, key, target, true, target[key]);\r\n                }\r\n            }\r\n\r\n            if (Array.isArray(target)) {\r\n                target.splice(key, 1);\r\n            } else {\r\n                delete target[key];\r\n            }\r\n\r\n            return true;\r\n        };\r\n\r\n        let get = (target, key) => {\r\n            if (target[key] instanceof Function) {\r\n\r\n            \tif(target.___wrapped___[key])\r\n            \t{\r\n            \t\treturn target.___wrapped___[key];\r\n            \t}\r\n\r\n                target.___wrapped___[key] = function() {\r\n                    target.___executing___ = key;\r\n\r\n                    target.___stack___.unshift(key);\r\n                    // target.___stackTime___.unshift((new Date).getTime());\r\n\r\n                    // console.log(`Start ${key}()`);\r\n\r\n                   for (let i in target.___before___) {\r\n                        target.___before___[i](target, key, object);\r\n                    }\r\n\r\n                    let ret = target[key].apply(object.___ref___, arguments);\r\n\r\n                    for (let i in target.___after___) {\r\n                        target.___after___[i](target, key, object);\r\n                    }\r\n\r\n                    target.___executing___ = null;\r\n\r\n                    // let execTime = (new Date).getTime() - target.___stackTime___[0];\r\n\r\n                    // if (execTime > 150) {\r\n                    //     // console.log(`End ${key}(), took ${execTime} ms`);\r\n                    // }\r\n\r\n                    target.___stack___.shift();\r\n                    // target.___stackTime___.shift();\r\n\r\n                    return ret;\r\n                };\r\n\r\n                return target.___wrapped___[key];\r\n            }\r\n\r\n            if (target[key] instanceof Object) {\r\n                Bindable.makeBindable(target[key]);\r\n            }\r\n\r\n            // console.log(`Getting ${key}`);\r\n\r\n            return target[key];\r\n        };\r\n\r\n        object.___ref___ = new Proxy(object, {\r\n            deleteProperty: del,\r\n            get: get,\r\n            set: set\r\n        });\r\n\r\n        return object.___ref___;\r\n    }\r\n    static clearBindings(object) {\r\n        object.___wrapped___    = {};\r\n        object.___bindingAll___ = [];\r\n        object.___binding___    = {};\r\n        object.___before___     = [];\r\n        object.___after___      = [];\r\n        object.___ref___        = {};\r\n        // object.toString         = ()=>'{}';\r\n    }\r\n    static resolve(object, path, owner = false)\r\n    {\r\n        // console.log(path, object);\r\n\r\n        let node;\r\n        let pathParts = path.split('.');\r\n        let top       = pathParts[0];\r\n\r\n        while(pathParts.length)\r\n        {\r\n            if(owner && pathParts.length === 1)\r\n            {\r\n                let obj = this.makeBindable(object);\r\n\r\n                return [obj, pathParts.shift(), top];\r\n            }\r\n\r\n            node = pathParts.shift();\r\n\r\n            if(!node in object\r\n                || !object[node]\r\n                || !(object[node] instanceof Object)\r\n            ){\r\n                object[node] = {};\r\n            }\r\n\r\n            object = this.makeBindable(object[node]);\r\n        }\r\n\r\n        return [this.makeBindable(object), node, top];\r\n    }\r\n}","export class Cache\r\n{\r\n\tstatic store(key, value, expiry, bucket = 'standard')\r\n\t{\r\n\t\tlet expiration = 0;\r\n\r\n\t\tif(expiry)\r\n\t\t{\r\n\t\t\texpiration = (expiry * 1000) + (new Date).getTime();\r\n\t\t}\r\n\r\n\t\t// console.log(\r\n\t\t// \t`Caching ${key} until ${expiration} in ${bucket}.`\r\n\t\t// \t, value\r\n\t\t// \t, this.bucket\r\n\t\t// );\r\n\r\n\t\tif(!this.bucket)\r\n\t\t{\r\n\t\t\tthis.bucket = {};\r\n\t\t}\r\n\r\n\t\tif(!this.bucket[bucket])\r\n\t\t{\r\n\t\t\tthis.bucket[bucket]\t= {};\r\n\t\t}\r\n\r\n\t\tthis.bucket[bucket][key] = {expiration, value};\r\n\t}\r\n\r\n\tstatic load(key, defaultvalue = false, bucket = 'standard')\r\n\t{\r\n\t\t// console.log(\r\n\t\t// \t`Checking cache for ${key} in ${bucket}.`\r\n\t\t// \t, this.bucket\r\n\t\t// );\r\n\r\n\t\tif(this.bucket && this.bucket[bucket] && this.bucket[bucket][key])\r\n\t\t{\r\n\t\t\t// console.log(this.bucket[bucket][key].expiration, (new Date).getTime());\r\n\t\t\tif(this.bucket[bucket][key].expiration == 0\r\n\t\t\t\t|| this.bucket[bucket][key].expiration > (new Date).getTime()\r\n\t\t\t){\r\n\t\t\t\treturn this.bucket[bucket][key].value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn defaultvalue;\r\n\t}\r\n}","import { Bindable } from './Bindable';\n\nexport class Cookie\n{\n\tstatic set(name, value)\n\t{\n\t\tCookie.jar[name] = value;\n\t}\n\n\tstatic get(name)\n\t{\n\t\treturn Cookie.jar[name];\n\t}\n\n\tstatic delete(name)\n\t{\n\t\tdelete Cookie.jar[name];\n\t}\n};\n\nCookie.jar = Cookie.jar || Bindable.makeBindable({});\n\nif(window.location.href.substr(0,4) !== 'data')\n{\n\tdocument.cookie.split(';').map(c => {\n\t\tlet [key, value] = c.split('=');\n\n\t\ttry\n\t\t{\n\t\t\tvalue = JSON.parse(value);\n\t\t}\n\t\tcatch(error)\n\t\t{\n\t\t\tvalue = value;\n\t\t}\n\n\t\tkey = key.trim();\n\n\t\tCookie.jar[decodeURIComponent(key)] = value;\n\t\t// console.log(Cookie.jar);\n\t});\n\n\tCookie.jar.bindTo((v,k,t,d) => {\n\t\tt[k] = v;\n\n\t\tif(d)\n\t\t{\n\t\t\tt[k] = null;\n\t\t}\n\t\t\n\t\tconst cookieString = `${encodeURIComponent(k)}=${t[k]}`;\n\t\t// console.log(cookieString);\n\t\tdocument.cookie = cookieString;\n\t});\n}\n","export class Dom\r\n{\r\n\tstatic mapTags(doc, selector, callback, startNode, endNode)\r\n\t{\r\n\t\tlet result = [];\r\n\r\n\t\tlet started = true;\r\n\r\n\t\tif(startNode)\r\n\t\t{\r\n\t\t\tstarted = false;\r\n\t\t}\r\n\r\n\t\tlet ended = false;\r\n\r\n\t\tvar treeWalker = document.createTreeWalker(\r\n\t\t\tdoc,\r\n\t\t\tNodeFilter.SHOW_ALL,\r\n\t\t\t{\r\n\t\t\t\tacceptNode: (node) => {\r\n\t\t\t\t\tif(!started)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(node === startNode)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tstarted = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(endNode && node === endNode)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tended = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(ended)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(selector)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// console.log(selector, node, !!(node instanceof Element));\r\n\t\t\t\t\t\tif(node instanceof Element)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(node.matches(selector))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfalse\r\n\t\t);\r\n\r\n\t\twhile(treeWalker.nextNode())\r\n\t\t{\r\n\t\t\tresult.push(callback(treeWalker.currentNode));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\tstatic dispatchEvent(doc, event)\r\n\t{\r\n\t\tdoc.dispatchEvent(event);\r\n\r\n\t\tDom.mapTags(doc, false, (node) => {\r\n\t\t\tnode.dispatchEvent(event);\r\n\t\t});\r\n\t}\r\n}","import { Cache } from './Cache';\nimport { Bindable   } from './Bindable';\nimport { Repository } from './Repository';\n\nexport class Model\n{\n\tconstructor(repository)\n\t{\n\t\tthis.repository = repository;\n\t}\n\n\tconsume(values)\n\t{\n\t\tfor(let property in values)\n\t\t{\n\t\t\tlet value = values[property];\n\n\t\t\tif(values[property] instanceof Object\n\t\t\t\t&& values[property].class\n\t\t\t\t&& values[property].publicId\n\t\t\t){\n\t\t\t\tlet cacheKey = `${values[property].class}::${values[property].publidId}`;\n\n\t\t\t\tlet cached = Cache.load(cacheKey, false, 'model-type-repo');\n\n\t\t\t\tvalue = Bindable.makeBindable(new Model(this.repository));\n\n\t\t\t\tif(cached)\n\t\t\t\t{\n\t\t\t\t\tvalue = cached;\n\t\t\t\t}\n\n\t\t\t\tvalue.consume(values[property]);\n\n\t\t\t\tCache.store(\n\t\t\t\t\tcacheKey\n\t\t\t\t\t, value\n\t\t\t\t\t, 0\n\t\t\t\t\t, 'model-type-repo'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis[property] = value;\n\t\t}\n\t}\n}\n","import { View }     from './View';\nimport { Bindable } from './Bindable';\n\nexport class Persist\n{\n\tstatic watch(bucket, object)\n\t{\n\t\tlet subBinding = {};\n\t\tlet key        = `Persist::[${bucket}]`;\n\n\t\tlet _source = localStorage.getItem(key);\n\t\tlet source;\n\n\t\tobject = Bindable.makeBindable(object);\n\n\t\tlet debind = object.bindTo((v,k,t,d,p)=>{\n\t\t\tif(subBinding[k])\n\t\t\t{\n\t\t\t\tif(v !== p)\n\t\t\t\t{\n\t\t\t\t\twhile(subBinding[k].length)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubBinding[k].pop()();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsubBinding[k] = [];\n\t\t\t}\n\n\t\t\tif(typeof v === 'object')\n\t\t\t{\n\t\t\t\tsubBinding[k].push(Persist.watch(`${bucket}::${k}`, v));\n\t\t\t}\n\n\t\t\tlocalStorage.setItem(key, JSON.stringify(object));\n\n\t\t}, {delay: 0});\n\n\t\tif(source = JSON.parse(_source))\n\t\t{\n\t\t\tfor(let i in source)\n\t\t\t{\n\t\t\t\tobject[i] = source[i];\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn ()=>{\n\t\t\tdebind()\n\t\t\tfor(let i in subBinding)\n\t\t\t{\n\t\t\t\twhile(subBinding[i].length)\n\t\t\t\t{\n\t\t\t\t\tsubBinding[i].pop()();\n\t\t\t\t}\n\t\t\t}\n\t\t\tlocalStorage.removeItem(key);\n\t\t};\n\t}\n}\n","import { Bindable    } from './Bindable';\r\nimport { Router      } from './Router';\r\nimport { Cache       } from './Cache';\r\nimport { Model       } from './Model';\r\nimport { Bag         } from './Bag';\r\n\r\nimport { Form        } from '../form/Form';\r\nimport { FormWrapper } from '../form/multiField/FormWrapper';\r\n\r\nvar objects = {};\r\n\r\nexport class Repository\r\n{\r\n\tconstructor(uri)\r\n\t{\r\n\t\tthis.uri = uri;\r\n\t}\r\n\r\n\tget(id, refresh = false, args = {})\r\n\t{\r\n\t\tlet resourceUri = this.uri + '/' + id;\r\n\r\n\t\tlet cached = Cache.load(\r\n\t\t\tresourceUri + Router.queryToString(\r\n\t\t\t\tRouter.queryOver(args)\r\n\t\t\t\t, true\r\n\t\t\t)\r\n\t\t\t, false\r\n\t\t\t, 'model-uri-repo'\r\n\t\t);\r\n\r\n\t\tif(!refresh && cached)\r\n\t\t{\r\n\t\t\treturn Promise.resolve(cached);\r\n\t\t}\r\n\r\n\t\treturn Repository.request(resourceUri, args).then((response) => {\r\n\t\t\treturn this.extractModel(response.body);\r\n\t\t});\r\n\t}\r\n\r\n\tpage(page = 0, args)\r\n\t{\r\n\t\treturn Repository.request(this.uri, args).then((response) => {\r\n\t\t\tlet records = [];\r\n\r\n\t\t\tfor(let i in response.body)\r\n\t\t\t{\r\n\t\t\t\tlet record = response.body[i];\r\n\r\n\t\t\t\trecords.push(this.extractModel(record));\r\n\t\t\t}\r\n\r\n\t\t\tresponse.body = records;\r\n\r\n\t\t\treturn response;\r\n\t\t});\r\n\t}\r\n\r\n\tedit(publicId = null, data = null, customFields = {})\r\n\t{\r\n\t\tlet resourceUri = this.uri + '/create';\r\n\r\n\t\tif(publicId)\r\n\t\t{\r\n\t\t\tresourceUri = this.uri + '/' + publicId + '/edit';\r\n\t\t}\r\n\r\n\t\t// console.log(resourceUri);\r\n\r\n\t\tif(!data)\r\n\t\t{\r\n\t\t\treturn Repository.request(resourceUri).then((response) => {\r\n\t\t\t\tlet form  = new Form(response.meta.form, customFields);\r\n\t\t\t\t// let model = this.extractModel(response.body);\r\n\r\n\t\t\t\treturn new FormWrapper(form, resourceUri, 'POST', customFields);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn Repository.request(\r\n\t\t\t\tresourceUri\r\n\t\t\t\t, {api: 'json'}\r\n\t\t\t\t, data\r\n\t\t\t).then((response) => {\r\n\t\t\t\treturn response.body;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\textractModel(rawData)\r\n\t{\r\n\t\tlet model = Bindable.makeBindable(new Model(this));\r\n\r\n\t\tmodel.consume(rawData);\r\n\r\n\t\tlet resourceUri = this.uri + '/' + model.publicId;\r\n\r\n\t\tCache.store(\r\n\t\t\tresourceUri\r\n\t\t\t, model\r\n\t\t\t, 10\r\n\t\t\t, 'model-uri-repo'\r\n\t\t);\r\n\r\n\t\tif(model.class)\r\n\t\t{\r\n\t\t\tlet cacheKey = `${model.class}::${model.publidId}`;\r\n\r\n\t\t\tlet cached = Cache.load(cacheKey, false, 'model-type-repo');\r\n\r\n\t\t\t// if(cached)\r\n\t\t\t// {\r\n\t\t\t// \tcached.consume(rawData);\r\n\t\t\t// \treturn cached;\r\n\t\t\t// }\r\n\r\n\t\t\tCache.store(\r\n\t\t\t\tcacheKey\r\n\t\t\t\t, model\r\n\t\t\t\t, 10\r\n\t\t\t\t, 'model-type-repo'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn model;\r\n\t}\r\n\r\n\tstatic get xhrs(){\r\n\t\treturn this.xhrList = this.xhrList || [];\r\n\t}\r\n\r\n\tstatic loadPage(args = {}, refresh = false) {\r\n\t\treturn this.request(this.uri, args).then((response) => {\r\n\t\t\treturn response;\r\n\t\t\t// return response.map((skeleton) => new Model(skeleton));\r\n\t\t});\r\n\t}\r\n\tstatic domCache(uri, content)\r\n\t{\r\n\t\t// console.log(uri, content);\r\n\t}\r\n\tstatic load(id, refresh = false) {\r\n\t\tthis.objects           = this.objects           || {};\r\n\t\tthis.objects[this.uri] = this.objects[this.uri] || {};\r\n\r\n\t\tif(this.objects[this.uri][id]) {\r\n\t\t\treturn Promise.resolve(this.objects[this.uri][id]);\r\n\t\t}\r\n\r\n\t\treturn this.request(this.uri + '/' + id).then((response) => {\r\n\t\t\t// let model = new Model(response);\r\n\t\t\t// return this.objects[this.uri][id] = model;\r\n\t\t});\r\n\t}\r\n\tstatic form(id = null) {\r\n\t\tlet uri = this.uri + '/' + 'create';\r\n\t\tif(id) {\r\n\t\t\turi = this.uri + '/' + id + '/edit';\r\n\t\t}\r\n\t\treturn this.request(uri).then((skeleton) => {\r\n\t\t\treturn skeleton;\r\n\t\t});\r\n\t}\r\n\tstatic clearCache() {\r\n\t\tif(this.objects && this.objects[this.uri]) {\r\n\t\t\tthis.objects[this.uri] = {};\r\n\t\t}\r\n\t}\r\n\r\n\tstatic encode(obj, namespace = null, formData = null)\r\n\t{\r\n\t\tif(!formData)\r\n\t\t{\r\n\t\t\tformData = new FormData();\r\n\t\t}\r\n\r\n\t\tfor(let i in obj)\r\n\t\t{\r\n\t\t\tlet ns = i;\r\n\r\n\t\t\tif(namespace)\r\n\t\t\t{\r\n\t\t\t\tns = `${namespace}[${ns}]`;\r\n\t\t\t}\r\n\r\n\t\t\tif(obj[i] && typeof obj[i] !== 'object')\r\n\t\t\t{\r\n\t\t\t\tformData.append(ns, obj[i]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.encode(obj[i], ns, formData);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn formData;\r\n\t}\r\n\r\n\tstatic onResponse(callback)\r\n\t{\r\n\t\tif(!this._onResponse)\r\n\t\t{\r\n\t\t\tthis._onResponse = new Bag;\r\n\t\t}\r\n\r\n\t\treturn this._onResponse.add(callback);\r\n\t}\r\n\r\n\tstatic request(uri, args = null, post = null, cache = true, options = {}) {\r\n\t\tlet type        = 'GET';\r\n\t\tlet queryString = '';\r\n\t\tlet formData    = null;\r\n\t\tlet queryArgs   = {};\r\n\r\n\t\tif(args) {\r\n\t\t\tqueryArgs = args;\r\n\t\t}\r\n\r\n\t\tif(!this._onResponse)\r\n\t\t{\r\n\t\t\tthis._onResponse = new Bag;\r\n\t\t}\r\n\r\n\t\tqueryArgs.api = queryArgs.api || 'json';\r\n\r\n\t\tqueryString = Object.keys(queryArgs).map((arg) => {\r\n\t\t\treturn encodeURIComponent(arg)\r\n\t\t\t+ '='\r\n\t\t\t+ encodeURIComponent(queryArgs[arg])\r\n\t\t}).join('&');\r\n\r\n\t\tlet fullUri    = uri;\r\n\t\t// let postString = '';\r\n\r\n\t\tif(post) {\r\n\t\t\tcache = false;\r\n\t\t\ttype = 'POST';\r\n\t\t\tif(post instanceof FormData)\r\n\t\t\t{\r\n\t\t\t\tformData = post;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tformData = this.encode(post);\r\n\t\t\t}\r\n\t\t\t// postString = Object.keys(post).map((arg) => {\r\n\t\t\t// \treturn encodeURIComponent(arg)\r\n\t\t\t// \t+ '='\r\n\t\t\t// \t+ encodeURIComponent(post[arg])\r\n\t\t\t// }).join('&');\r\n\t\t}\r\n\r\n\t\tfullUri = uri + '?' + queryString;\r\n\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\r\n\t\tif('responseType' in options)\r\n\t\t{\r\n\t\t\txhr.responseType = options.responseType;\r\n\t\t}\r\n\r\n\t\tif(!post && cache && this.cache && this.cache[fullUri]) {\r\n\t\t\treturn Promise.resolve(this.cache[fullUri]);\r\n\t\t}\r\n\r\n\t\tlet tagCacheSelector = 'script[data-uri=\"'\r\n\t\t\t+ fullUri\r\n\t\t\t+ '\"]';\r\n\r\n\t\tlet tagCache = document.querySelector(tagCacheSelector);\r\n\r\n\t\tif(!post && cache && tagCache) {\r\n\t\t\tlet tagCacheContent = JSON.parse(tagCache.innerText);\r\n\t\t\t\r\n\t\t\treturn Promise.resolve(tagCacheContent);\r\n\t\t}\r\n\r\n\t\txhr.withCredentials = true;\r\n\t\txhr.timeout         = 15000;\r\n\r\n\t\tlet xhrId = this.xhrs.length;\r\n\r\n\t\tif(!post) {\r\n\t\t\tthis.xhrs.push(xhr);\r\n\t\t}\r\n\r\n\t\treturn new Promise(((xhrId) => (resolve, reject) => {\r\n\t\t\txhr.onreadystatechange = () => {\r\n\t\t\t\tlet DONE = 4;\r\n\t\t\t\tlet OK = 200;\r\n\r\n\t\t\t\tlet response;\r\n\r\n\t\t\t\tif (xhr.readyState === DONE) {\r\n\r\n\t\t\t\t\tif(!this.cache) {\r\n\t\t\t\t\t\tthis.cache = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (xhr.status === OK) {\r\n\r\n\t\t\t\t\t\tif(xhr.getResponseHeader(\"Content-Type\") == 'application/json'\r\n\t\t\t\t\t\t\t|| xhr.getResponseHeader(\"Content-Type\") == 'application/json; charset=utf-8'\r\n\t\t\t\t\t\t\t|| xhr.getResponseHeader(\"Content-Type\") == 'text/json'\r\n\t\t\t\t\t\t\t|| xhr.getResponseHeader(\"Content-Type\") == 'text/json; charset=utf-8'\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tresponse = JSON.parse(xhr.responseText)\r\n\t\t\t\t\t\t\tif(response.code == 0) {\r\n\t\t\t\t\t\t\t\t// Repository.lastResponse = response;\r\n\r\n\t\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\t\t// this.cache[fullUri] = response;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet tagCache = document.querySelector(\r\n\t\t\t\t\t\t\t\t\t'script[data-uri=\"'\r\n\t\t\t\t\t\t\t\t\t+ fullUri\r\n\t\t\t\t\t\t\t\t\t+ '\"]'\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\tlet prerendering  = window.prerenderer;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif(prerendering)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tif(!tagCache)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttagCache  = document.createElement('script');\r\n\t\t\t\t\t\t\t\t\t\ttagCache.type = 'text/json';\r\n\t\t\t\t\t\t\t\t\t\ttagCache.setAttribute('data-uri', fullUri);\r\n\t\t\t\t\t\t\t\t\t\tdocument.head.appendChild(tagCache);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// console.log(JSON.stringify(response));\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\ttagCache.innerText = JSON.stringify(response);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet onResponse = this._onResponse.items();\r\n\r\n\t\t\t\t\t\t\t\tfor(let i in onResponse)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonResponse[i](response, true);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tresolve(response);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\t\t// this.cache[fullUri] = response;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet onResponse = this._onResponse.items();\r\n\r\n\t\t\t\t\t\t\t\tfor(let i in onResponse)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonResponse[i](response, true);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\treject(response);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Repository.lastResponse = xhr.responseText;\r\n\r\n\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\t// this.cache[fullUri] = xhr.responseText;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet onResponse = this._onResponse.items();\r\n\r\n\t\t\t\t\t\t\tfor(let i in onResponse)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tonResponse[i](xhr, true);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tresolve(xhr);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treject('HTTP' + xhr.status);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.xhrs[xhrId] = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(type, fullUri, true);\r\n\r\n\t\t\t// if(post)\r\n\t\t\t// {\r\n\t\t\t// \txhr.setRequestHeader(\"Content-type\", \"multipart/form-data\");\r\n\t\t\t// }\r\n\t\t\txhr.send(formData);\r\n\t\t})(xhrId));\r\n\t}\r\n\tstatic cancel() {\r\n\t\tfor(var i in this.xhrs) {\r\n\t\t\tif(!this.xhrs[i]) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.xhrs[i].abort();\r\n\t\t}\r\n\t\tthis.xhrList = [];\r\n\t}\r\n}\r\n\r\n// Repository.lastResponse = null;","import { View  }   from './View';\r\nimport { Cache }   from './Cache';\r\nimport { Config }   from 'Config';\r\n\r\nexport class Router {\r\n\tstatic wait(view, event = 'DOMContentLoaded', node = document)\r\n\t{\r\n\t\tnode.addEventListener(event, () => {\r\n\t\t\tthis.listen(view);\r\n\t\t});\r\n\t}\r\n\tstatic listen(mainView)\r\n\t{\r\n\t\tlet routeHistory      = [location.toString()];\r\n\t\tlet prevHistoryLength = history.length;\r\n\r\n\t\tlet route = location.pathname + location.search;\r\n\r\n\t\tif(location.hash)\r\n\t\t{\r\n\t\t\troute += location.hash;\r\n\t\t}\r\n\r\n\t\twindow.addEventListener(\r\n\t\t\t'popstate'\r\n\t\t\t, (event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\tif(routeHistory.length && prevHistoryLength == history.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(location.toString() == routeHistory[routeHistory.length - 2])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trouteHistory.pop();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trouteHistory.push(location.toString());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\trouteHistory.push(location.toString());\r\n\t\t\t\t\tprevHistoryLength = history.length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.match(location.pathname, mainView);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.go(route);\r\n\t}\r\n\tstatic go(route, silent)\r\n\t{\r\n\t\tdocument.title = Config.title;\r\n\t\tsetTimeout(\r\n\t\t\t() => {\r\n\t\t\t\thistory.pushState(null, null, route);\r\n\r\n\t\t\t\tif(!silent)\r\n\t\t\t\t{\r\n\t\t\t\t\twindow.dispatchEvent(new Event('popstate'))\r\n\r\n\t\t\t\t\tif(route.substring(0,1) === '#')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twindow.dispatchEvent(new HashChangeEvent(\r\n\t\t\t\t\t\t\t'hashchange'\r\n\t\t\t\t\t\t));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t, 0\r\n\t\t);\r\n\t}\r\n\tstatic match(path, view, forceRefresh = false)\r\n\t{\r\n\t\tif(this.path == path && !forceRefresh)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet eventStart = new CustomEvent('cvRouteStart', {\r\n\t\t\tcancelable: true\r\n\t\t\t, detail:   {result, path, view}\r\n\t\t});\r\n\r\n\t\tlet current = view.args.content;\r\n\t\tlet routes  = view.routes;\r\n\r\n\t\tthis.path   = path;\r\n\t\tthis.query  = {};\r\n\r\n\t\tlet query   = new URLSearchParams(location.search);\r\n\r\n\t\tthis.queryString = location.search;\r\n\r\n\t\tfor(let pair of query) {\r\n\t\t\tthis.query[ pair[0] ] = pair[1];\r\n\t\t}\r\n\r\n\t\tlet args = {}, selected = false, result = '';\r\n\r\n\t\tpath = path.substr(1).split('/');\r\n\r\n\t\tfor(let i in this.query)\r\n\t\t{\r\n\t\t\targs[i] = this.query[i];\r\n\t\t}\r\n\r\n\t\tL1: for(let i in routes)\r\n\t\t{\r\n\t\t\tlet route = i.split('/');\r\n\t\t\tif(route.length < path.length)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tL2: for(let j in route)\r\n\t\t\t{\r\n\t\t\t\tif(route[j].substr(0, 1) == '%') {\r\n\t\t\t\t\tlet argName = null;\r\n\t\t\t\t\tlet groups  = /^%(\\w+)\\??/.exec(route[j]);\r\n\t\t\t\t\tif(groups && groups[1]) {\r\n\t\t\t\t\t\targName = groups[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!argName) {\r\n\t\t\t\t\t\tthrow new Error(`${route[j]} is not a valid argument segment in route \"${i}\"`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!path[j]) {\r\n\t\t\t\t\t\tif(route[j].substr(route[j].length - 1, 1) == '?') {\r\n\t\t\t\t\t\t\targs[ argName ] = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tcontinue L1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\targs[ argName ] = path[j];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if(path[j] !== route[j]) {\r\n\t\t\t\t\tcontinue L1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!forceRefresh\r\n\t\t\t\t&& current\r\n\t\t\t\t&& (routes[i] instanceof Object)\r\n\t\t\t\t&& (current instanceof routes[i])\r\n\t\t\t\t&& !(routes[i] instanceof Promise)\r\n\t\t\t\t&& current.update(args)\r\n\t\t\t) {\r\n\t\t\t\tview.args.content = current;\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tselected = i;\r\n\t\t\tresult   = routes[i];\r\n\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tdocument.dispatchEvent(eventStart);\r\n\r\n\t\tif(selected in routes\r\n\t\t\t&& routes[selected] instanceof Object\r\n\t\t\t&& routes[selected].isView\r\n\t\t\t&& routes[selected].isView()\r\n\t\t){\r\n\t\t\tresult = new routes[selected](args);\r\n\r\n\t\t\tresult.root = ()=>view;\r\n\t\t}\r\n\t\telse if(routes[selected] instanceof Function)\r\n\t\t{\r\n\t\t\tresult = '';\r\n\r\n\t\t\tconst _result = routes[selected](args);\r\n\r\n\t\t\tif(_result instanceof Promise)\r\n\t\t\t{\r\n\t\t\t\tresult = false;\r\n\r\n\t\t\t\t_result.then(x=>{\r\n\t\t\t\t\tthis.update(view, path, x);\r\n\t\t\t\t}).catch(x=>{\r\n\t\t\t\t\tthis.update(view, path, x);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tresult = _result;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(routes[selected] instanceof Promise)\r\n\t\t{\r\n\t\t\tresult = false;\r\n\r\n\t\t\troutes[selected].then(x => {\r\n\t\t\t\tthis.update(view, path, x);\r\n\t\t\t}).catch(x=>{\r\n\t\t\t\tthis.update(view, path, x);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if(routes[selected] instanceof Object)\r\n\t\t{\r\n\t\t\tresult = new routes[selected](args);\r\n\t\t}\r\n\t\telse if(typeof routes[selected] == 'string')\r\n\t\t{\r\n\t\t\tresult = routes[selected];\r\n\t\t}\r\n\r\n\t\tthis.update(view, path, result);\r\n\r\n\t\t// if(view.args.content instanceof View)\r\n\t\t// {\r\n\t\t// \t// view.args.content.pause(true);\r\n\t\t// \tview.args.content.remove();\r\n\t\t// }\r\n\r\n\t\t// if(result !== false)\r\n\t\t// {\r\n\t\t// \tif(document.dispatchEvent(event))\r\n\t\t// \t{\r\n\t\t// \t\tview.args.content = result;\r\n\t\t// \t}\r\n\t\t// }\r\n\r\n\t\tif(result instanceof View)\r\n\t\t{\r\n\t\t\tresult.pause(false);\r\n\r\n\t\t\tresult.update(args, forceRefresh);\r\n\t\t}\r\n\r\n\t\treturn selected !== false;\r\n\t}\r\n\r\n\tstatic update(view, path, result)\r\n\t{\r\n\t\tlet event = new CustomEvent('cvRoute', {\r\n\t\t\tcancelable: true\r\n\t\t\t, detail:   {result, path, view}\r\n\t\t});\r\n\r\n\t\tlet eventEnd = new CustomEvent('cvRouteEnd', {\r\n\t\t\tcancelable: true\r\n\t\t\t, detail:   {result, path, view}\r\n\t\t});\r\n\r\n\t\tif(result !== false)\r\n\t\t{\r\n\t\t\tif(view.args.content instanceof View)\r\n\t\t\t{\r\n\t\t\t\t// view.args.content.pause(true);\r\n\t\t\t\tview.args.content.remove();\r\n\t\t\t}\r\n\r\n\t\t\tif(document.dispatchEvent(event))\r\n\t\t\t{\r\n\t\t\t\tview.args.content = result;\r\n\t\t\t}\r\n\r\n\t\t\tdocument.dispatchEvent(eventEnd);\r\n\t\t}\r\n\t}\r\n\tstatic clearCache() {\r\n\t\t// this.cache = {};\r\n\t}\r\n\tstatic queryOver(args = {})\r\n\t{\r\n\t\tlet params    = new URLSearchParams(location.search);\r\n\t\tlet finalArgs = {};\r\n\t\tlet query     = [];\r\n\r\n\t\tfor(let pair of params) {\r\n\t\t\tquery[ pair[0] ] = pair[1];\r\n\t\t}\r\n\r\n\t\tfor(let i in query)\r\n\t\t{\r\n\t\t\tfinalArgs[i] = query[i];\r\n\t\t}\r\n\r\n\t\tfor(let i in args)\r\n\t\t{\r\n\t\t\tfinalArgs[i] = args[i];\r\n\t\t}\r\n\r\n\t\tdelete finalArgs['api'];\r\n\r\n\t\treturn finalArgs;\r\n\t}\r\n\tstatic queryToString(args = {}, fresh = false)\r\n\t{\r\n\t\tlet parts = [], finalArgs = args;\r\n\r\n\t\tif(!fresh)\r\n\t\t{\r\n\t\t\tfinalArgs = this.queryOver(args);\r\n\t\t}\r\n\r\n\t\tfor(let i in finalArgs)\r\n\t\t{\r\n\t\t\tif(finalArgs[i] === '')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tparts.push(i + '=' + encodeURIComponent(finalArgs[i]));\r\n\t\t}\r\n\r\n\t\treturn parts.join('&');\r\n\t}\r\n\tstatic setQuery(name, value, silent)\r\n\t{\r\n\t\tlet args = {};\r\n\r\n\t\targs[name] = value;\r\n\r\n\t\tthis.go(\r\n\t\t\tthis.path\r\n\t\t\t\t+ '?'\r\n\t\t\t\t+ this.queryToString(args)\r\n\t\t\t, silent\r\n\t\t);\r\n\t}\r\n}\r\n","import { Dom  } from './Dom';\nimport { Tag  } from './Tag';\nimport { View } from './View';\n\nexport class RuleSet\n{\n\tstatic add(selector, callback)\n\t{\n\t\tthis.globalRules = this.globalRules\n\t\t\t|| {};\n\t\tthis.globalRules[selector] = this.globalRules[selector]\n\t\t\t|| [];\n\n\t\tthis.globalRules[selector].push(callback);\n\n\t\treturn this;\n\t}\n\n\tstatic apply(doc = document, view = null)\n\t{\n\t\tfor(let selector in this.globalRules)\n\t\t{\n\t\t\tfor(let i in this.globalRules[selector])\n\t\t\t{\n\t\t\t\tconst callback = this.globalRules[selector][i];\n\t\t\t\tconst wrapped  = this.wrap(doc, callback, view);\n\t\t\t\tconst nodes    = doc.querySelectorAll(selector);\n\n\t\t\t\tfor(let node of nodes)\n\t\t\t\t{\n\t\t\t\t\twrapped(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tadd(selector, callback)\n\t{\n\t\tthis.rules = this.rules\n\t\t\t|| {};\n\t\tthis.rules[selector] = this.rules[selector]\n\t\t\t|| [];\n\n\t\tthis.rules[selector].push(callback);\n\n\t\treturn this;\n\t}\n\n\tapply(doc = document, view = null)\n\t{\n\t\tRuleSet.apply(doc, view);\n\n\t\tfor(let selector in this.rules)\n\t\t{\n\t\t\tfor(let i in this.rules[selector])\n\t\t\t{\n\t\t\t\tconst callback = this.rules[selector][i];\n\t\t\t\tconst wrapped  = RuleSet.wrap(doc, callback, view);\n\t\t\t\tconst nodes    = doc.querySelectorAll(selector);\n\n\t\t\t\tfor(let node of nodes)\n\t\t\t\t{\n\t\t\t\t\twrapped(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic wait(event = 'DOMContentLoaded', node = document)\n\t{\n\t\tlet listener = ((event, node) => () => {\n\t\t\tnode.removeEventListener(event, listener);\n\t\t\treturn this.apply();\n\t\t})(event, node);\n\n\t\tnode.addEventListener(event, listener);\n\t}\n\n\tstatic wrap(doc, callback, view = null)\n\t{\n\t\tif(callback instanceof View\n\t\t\t|| (callback\n\t\t\t\t&& callback.prototype\n\t\t\t\t&& callback.prototype instanceof View\n\t\t\t)\n\t\t){\n\t\t\tcallback = ((callback)=>()=>callback)(callback);\n\t\t}\n\n\t\treturn (element) => {\n\t\t\tif(!element.___cvApplied___)\n\t\t\t{\n\t\t\t\tObject.defineProperty(\n\t\t\t\t\telement\n\t\t\t\t\t, '___cvApplied___'\n\t\t\t\t\t, {\n\t\t\t\t\t\tenumerable: false,\n\t\t\t\t\t\twritable: true\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\telement.___cvApplied___ = [];\n\t\t\t}\n\n\t\t\tfor(let i in element.___cvApplied___)\n\t\t\t{\n\t\t\t\tif(callback == element.___cvApplied___[i])\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet direct, parentView;\n\n\t\t\tif(view)\n\t\t\t{\n\t\t\t\tdirect = parentView = view;\n\n\t\t\t\tif(view.viewList)\n\t\t\t\t{\n\t\t\t\t\tparentView = view.viewList.parent;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst tag     = new Tag(element, parentView, null, undefined, direct);\n\n\t\t\tconst parent  = tag.element.parentNode;\n\t\t\tconst sibling = tag.element.nextSibling;\n\n\t\t\tlet result    = callback(tag);\n\n\t\t\tif(result !== false)\n\t\t\t{\n\t\t\t\telement.___cvApplied___.push(callback);\n\t\t\t}\n\n\t\t\tif(result instanceof HTMLElement)\n\t\t\t{\n\t\t\t\tresult = new Tag(result);\n\t\t\t}\n\n\t\t\tif(result instanceof Tag)\n\t\t\t{\n\t\t\t\tif(!result.element.contains(tag.element))\n\t\t\t\t{\n\t\t\t\t\twhile(tag.element.firstChild)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.element.appendChild(tag.element.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ttag.remove();\n\t\t\t\t}\n\n\t\t\t\tif(sibling)\n\t\t\t\t{\n\t\t\t\t\tparent.insertBefore(result.element, sibling);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tparent.appendChild(result.element);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(result\n\t\t\t\t&& result.prototype\n\t\t\t\t&& (result.prototype instanceof View)\n\t\t\t){\n\t\t\t\tresult = new result();\n\t\t\t}\n\n\t\t\tif(result instanceof View)\n\t\t\t{\n\t\t\t\tif(view)\n\t\t\t\t{\n\t\t\t\t\tview.cleanup.push(((r)=>()=>{\n\t\t\t\t\t\tr.remove();\n\t\t\t\t\t})(result));\n\n\t\t\t\t\tresult.parent = view;\n\n\t\t\t\t\tview.cleanup.push(\n\t\t\t\t\t\tview.args.bindTo((v, k,t)=>{\n\t\t\t\t\t\t\tt[k] = v;\n\t\t\t\t\t\t\tresult.args[k] = v;\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t\tview.cleanup.push(\n\t\t\t\t\t\tresult.args.bindTo((v, k, t, d)=>{\n\t\t\t\t\t\t\tt[k] = v;\n\t\t\t\t\t\t\tview.args[k] = v;\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\ttag.clear();\n\t\t\t\tresult.render(tag.element);\n\t\t\t}\n\t\t};\n\t}\n}\n","import { Bindable } from './Bindable';\r\nexport class Tag\r\n{\r\n\tconstructor(element, parent, ref, index, direct)\r\n\t{\r\n\t\tthis.element = Bindable.makeBindable(element);\r\n\t\tthis.parent  = parent;\r\n\t\tthis.direct  = direct;\r\n\t\tthis.ref     = ref;\r\n\t\tthis.index   = index;\r\n\r\n\t\tthis.cleanup = [];\r\n\r\n\t\tthis.proxy   = Bindable.makeBindable(this);\r\n\r\n\t\t// this.detachListener = (event) => {\r\n\t\t// \treturn;\r\n\r\n\t\t// \tif(event.target != this.element)\r\n\t\t// \t{\r\n\t\t// \t\treturn;\r\n\t\t// \t}\r\n\t\t// \tif(event.path[event.path.length -1] !== window)\r\n\t\t// \t{\r\n\t\t// \t\treturn;\r\n\t\t// \t}\r\n\r\n\t\t// \tthis.element.removeEventListener('cvDomDetached', this.detachListener);\r\n\r\n\t\t// \tthis.remove();\r\n\t\t// };\r\n\r\n\t\t// this.element.addEventListener('cvDomDetached', this.detachListener);\r\n\r\n\t\t// return this.proxy;\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tBindable.clearBindings(this);\r\n\r\n\t\tlet cleanup;\r\n\r\n\t\twhile(cleanup = this.cleanup.shift())\r\n\t\t{\r\n\t\t\tcleanup();\r\n\t\t}\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tif(!this.element)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet detachEvent = new Event('cvDomDetached');\r\n\r\n\t\tthis.element.dispatchEvent(detachEvent);\r\n\t\tthis.element.remove();\r\n\r\n\t\tthis.element = this.ref = this.parent = null;\r\n\t}\r\n\tclear()\r\n\t{\r\n\t\tif(!this.element)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet detachEvent = new Event('cvDomDetached');\r\n\r\n\t\twhile(this.element.firstChild)\r\n\t\t{\r\n\t\t\tthis.element.firstChild.dispatchEvent(detachEvent);\r\n\t\t\tthis.element.removeChild(this.element.firstChild);\r\n\t\t}\r\n\t}\r\n\tpause(paused = true)\r\n\t{\r\n\r\n\t}\r\n}\r\n","export class Theme\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.views = {\r\n\t\t\t'SeanMorris\\\\TheWhtRbt\\\\Location' : {\r\n\t\t\t\tsingle: 'twr9/LocationPreview'\r\n\t\t\t\t, list: 'twr9/LocationList'\r\n\t\t\t}\r\n\t\t\t, 'SeanMorris\\\\TheWhtRbt\\\\Image' : {\r\n\t\t\t\tsingle: 'DetailView'\r\n\t\t\t\t, list: 'DetailListView'\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tresolve(model)\r\n\t{\r\n\t\tlet modelClass;\r\n\r\n\t\tif(Array.isArray(model))\r\n\t\t{\r\n\t\t\tfor(let i in model)\r\n\t\t\t{\r\n\t\t\t\tlet _modelClass = model[i].class || model[i].content_type;\r\n\r\n\t\t\t\tif(modelClass && modelClass !== _modelClass)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Model list mismatch!');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmodelClass = _modelClass;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.views[modelClass])\r\n\t\t\t{\r\n\t\t\t\tif(this.views[modelClass].list)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.views[modelClass].list;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.views[modelClass];\r\n\t\t\t}\r\n\r\n\t\t\treturn 'DetailListView';\r\n\t\t}\r\n\t\telse if(model)\r\n\t\t{\r\n\t\t\tmodelClass = model.class || model.content_type;\r\n\r\n\t\t\tif(this.views[modelClass])\r\n\t\t\t{\r\n\t\t\t\tif(this.views[modelClass].single)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.views[modelClass].single;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.views[modelClass];\r\n\t\t\t}\r\n\r\n\t\t\treturn 'DetailView';\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n","import { Bindable } from './Bindable';\r\nimport { ViewList } from './ViewList';\r\nimport { Router   } from './Router';\r\nimport { Cookie   } from './Cookie';\r\nimport { Dom      } from './Dom';\r\nimport { Tag      } from './Tag';\r\nimport { RuleSet  } from './RuleSet';\r\n\r\nexport class View\r\n{\r\n\tconstructor(args = {})\r\n\t{\r\n\t\tObject.defineProperty(this, '___VIEW___', {\r\n\t\t\tenumerable: false,\r\n\t\t\twritable:    true\r\n\t\t});\r\n\r\n\t\tthis.___VIEW___ = View;\r\n\r\n\t\tthis.args      = Bindable.makeBindable(args);\r\n\t\tthis._id       = this.uuid();\r\n\t\tthis.args._id  = this._id;\r\n\t\tthis.template  = ``;\r\n\t\tthis.document  = ``;\t\t\r\n\r\n\t\tthis.firstNode = null;\r\n\t\tthis.lastNode  = null;\r\n\t\tthis.nodes     = null;\r\n\r\n\t\tthis.cleanup   = [];\r\n\r\n\t\tthis.attach    = [];\r\n\t\tthis.detach    = [];\r\n\r\n\t\tthis.eventCleanup = [];\r\n\r\n\t\tthis.parent    = null;\r\n\t\tthis.viewList  = null;\r\n\t\tthis.viewLists = {};\r\n\r\n\t\tthis.withViews = {};\r\n\r\n\t\tthis.tags      = {};\r\n\r\n\t\tthis.intervals = [];\r\n\t\tthis.timeouts  = [];\r\n\t\tthis.frames    = [];\r\n\r\n\t\tthis.ruleSet     = new RuleSet;\r\n\t\tthis.preRuleSet  = new RuleSet;\r\n\t\tthis.subBindings = {};\r\n\r\n\t\tthis.removed   = false;\t\r\n\t\tthis.preserve  = false;\r\n\r\n\t\tthis.interpolateRegex = /(\\[\\[((?:\\$)?[\\w\\.]+)\\]\\])/g;\r\n\t}\r\n\r\n\tstatic isView()\r\n\t{\r\n\t\treturn View;\r\n\t}\r\n\r\n\tonFrame(callback) {\r\n\t\tlet c = (timestamp) => {\r\n\t\t\tcallback(timestamp);\r\n\t\t\twindow.requestAnimationFrame(c);\r\n\t\t};\r\n\r\n\t\tc();\r\n\t}\r\n\r\n\tonTimeout(time, callback) {\r\n\t\tlet wrappedCallback = () => {\r\n\t\t\tthis.timeouts[index].fired    = true;\r\n\t\t\tthis.timeouts[index].callback = null;\r\n\t\t\tcallback();\r\n\t\t};\r\n\t\tlet timeout = setTimeout(wrappedCallback, time)\r\n\t\tlet index   = this.timeouts.length;\r\n\r\n\t\tthis.timeouts.push({\r\n\t\t\ttimeout:    timeout\r\n\t\t\t, callback: wrappedCallback\r\n\t\t\t, time:     time\r\n\t\t\t, fired:    false\r\n\t\t\t, created:  (new Date).getTime()\r\n\t\t\t, paused:   false\r\n\t\t});\r\n\r\n\t\treturn timeout;\r\n\t}\r\n\r\n\tclearTimeout(timeout) {\r\n\t\tfor(var i in this.timeouts) {\r\n\t\t\tif(timeout === this.timeouts[i].timeout) {\r\n\t\t\t\tclearInterval(this.timeouts[i].timeout);\r\n\r\n\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonInterval(time, callback) {\r\n\t\tlet timeout = setInterval(callback, time);\r\n\r\n\t\tthis.intervals.push({\r\n\t\t\ttimeout:    timeout\r\n\t\t\t, callback: callback\r\n\t\t\t, time:     time\r\n\t\t\t, paused:   false\r\n\t\t});\r\n\r\n\t\treturn timeout;\r\n\t}\r\n\r\n\tclearInterval(timeout) {\r\n\t\tfor(var i in this.intervals) {\r\n\t\t\tif(timeout === this.intervals[i].timeout) {\r\n\t\t\t\tclearInterval(this.intervals[i].timeout);\r\n\r\n\t\t\t\tdelete this.intervals[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpause(paused = undefined)\r\n\t{\r\n\t\tif(paused === undefined)\r\n\t\t{\r\n\t\t\tthis.paused = !this.paused;\r\n\t\t}\r\n\r\n\t\tthis.paused = paused;\r\n\r\n\t\tif(this.paused)\r\n\t\t{\r\n\t\t\tfor(let i in this.timeouts)\r\n\t\t\t{\r\n\t\t\t\tif(this.timeouts[i].fired)\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclearTimeout(this.timeouts[i].timeout);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.intervals)\r\n\t\t\t{\r\n\t\t\t\tclearInterval(this.intervals[i].timeout);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor(let i in this.timeouts)\r\n\t\t\t{\r\n\t\t\t\tif(!this.timeouts[i].timeout.paused)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.timeouts[i].fired)\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.timeouts[i].timeout = setTimeout(\r\n\t\t\t\t\tthis.timeouts[i].callback\r\n\t\t\t\t\t, this.timeouts[i].time\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.intervals)\r\n\t\t\t{\r\n\t\t\t\tif(!this.intervals[i].timeout.paused)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.intervals[i].timeout.paused = false;\r\n\r\n\t\t\t\tthis.intervals[i].timeout = setInterval(\r\n\t\t\t\t\tthis.intervals[i].callback\r\n\t\t\t\t\t, this.intervals[i].time\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i in this.viewLists)\r\n\t\t{\r\n\t\t\tif(!this.viewLists[i])\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.viewLists[i].pause(!!paused);\r\n\t\t}\r\n\r\n\t\tfor(let i in this.tags)\r\n\t\t{\r\n\t\t\tif(Array.isArray(this.tags[i]))\r\n\t\t\t{\r\n\t\t\t\tfor(var j in this.tags[i])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.tags[i][j].pause(!!paused);\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.tags[i].pause(!!paused);\r\n\t\t}\r\n\t}\r\n\r\n\trender(parentNode = null, insertPoint = null)\r\n\t{\r\n\t\tif(insertPoint instanceof View)\r\n\t\t{\r\n\t\t\tinsertPoint = insertPoint.firstNode;\r\n\t\t}\r\n\r\n\t\tif(this.nodes)\r\n\t\t{\r\n\t\t\tfor(let i in this.detach)\r\n\t\t\t{\r\n\t\t\t\tthis.detach[i]();\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.nodes)\r\n\t\t\t{\r\n\t\t\t\tlet detachEvent = new Event('cvDomDetached', {bubbles: true, target: this.nodes[i]});\r\n\t\t\t\tlet attachEvent = new Event('cvDomAttached', {bubbles: true, target: this.nodes[i]});\r\n\r\n\t\t\t\tthis.nodes[i].dispatchEvent(detachEvent);\r\n\r\n\t\t\t\tDom.mapTags(this.nodes[i], false, (node) => {\r\n\t\t\t\t\tnode.dispatchEvent(detachEvent);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(parentNode)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(insertPoint)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparentNode.insertBefore(this.nodes[i], insertPoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparentNode.appendChild(this.nodes[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDom.mapTags(this.nodes[i], false, (node) => {\r\n\t\t\t\t\tnode.dispatchEvent(attachEvent);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.nodes[i].dispatchEvent(attachEvent);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.attach)\r\n\t\t\t{\r\n\t\t\t\tthis.attach[i]();\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet subDoc;\r\n\r\n\t\tif(this.template == document)\r\n\t\t{\r\n\t\t\tsubDoc = this.template;\r\n\t\t}\r\n\t\telse if(this.document)\r\n\t\t{\r\n\t\t\tsubDoc = this.document;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tsubDoc = document.createRange().createContextualFragment(this.template);\r\n\r\n\t\t\tthis.document = subDoc;\r\n\t\t}\r\n\r\n\t\tthis.preRuleSet.apply(subDoc, this);\r\n\r\n\t\tDom.mapTags(subDoc, false, (tag)=>{\r\n\t\t\tif(tag.matches)\r\n\t\t\t{\r\n\t\t\t\ttag.matches('[cv-each]')\r\n\t\t\t\t\t&& this.mapEachTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-with]')\r\n\t\t\t\t\t&& this.mapWithTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-prerender]')\r\n\t\t\t\t\t&& this.mapPrendererTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-link]')\r\n\t\t\t\t\t&& this.mapLinkTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-bind]')\r\n\t\t\t\t\t&& this.mapBindTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-attr]')\r\n\t\t\t\t\t&& this.mapAttrTags(tag);\r\n\r\n\t\t\t\tthis.mapInterpolatableTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-expand]')\r\n\t\t\t\t\t&& this.mapExpandableTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-if]')\r\n\t\t\t\t\t&& this.mapIfTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-ref]')\r\n\t\t\t\t\t&& this.mapRefTags(tag);\r\n\r\n\t\t\t\ttag.matches('[cv-on]')\r\n\t\t\t\t\t&& this.mapOnTags(tag);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.mapInterpolatableTags(tag);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.ruleSet.apply(subDoc, this);\r\n\r\n\t\tthis.nodes = [];\r\n\r\n\t\tif(window['devmode'] === true)\r\n\t\t{\r\n\t\t\tthis.firstNode = document.createComment(`Template ${this._id} Start`);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.firstNode = document.createTextNode('');\r\n\t\t}\r\n\r\n\t\tthis.nodes.push(this.firstNode);\r\n\r\n\t\tif(parentNode)\r\n\t\t{\r\n\t\t\tif(insertPoint)\r\n\t\t\t{\r\n\t\t\t\tparentNode.insertBefore(this.firstNode, insertPoint);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tparentNode.appendChild(this.firstNode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twhile(subDoc.firstChild)\r\n\t\t{\r\n\t\t\tlet newNode = subDoc.firstChild;\r\n\t\t\tlet attachEvent = new Event('cvDomAttached', {bubbles: true, target: newNode});\r\n\r\n\t\t\tthis.nodes.push(newNode);\r\n\r\n\t\t\tif(parentNode)\r\n\t\t\t{\r\n\t\t\t\tif(insertPoint)\r\n\t\t\t\t{\r\n\t\t\t\t\tparentNode.insertBefore(newNode, insertPoint);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tparentNode.appendChild(newNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tDom.mapTags(newNode, false, (node) => {\r\n\t\t\t\tnode.dispatchEvent(attachEvent);\r\n\t\t\t});\r\n\r\n\t\t\tnewNode.dispatchEvent(attachEvent);\r\n\t\t}\r\n\r\n\t\tif(window['devmode'] === true)\r\n\t\t{\r\n\t\t\tthis.lastNode = document.createComment(`Template ${this._id} End`);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.lastNode = document.createTextNode('');\r\n\t\t}\r\n\r\n\t\tthis.nodes.push(this.lastNode);\r\n\r\n\t\tif(parentNode)\r\n\t\t{\r\n\t\t\tif(insertPoint)\r\n\t\t\t{\r\n\t\t\t\tparentNode.insertBefore(this.lastNode, insertPoint);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tparentNode.appendChild(this.lastNode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i in this.attach)\r\n\t\t{\r\n\t\t\tthis.attach[i]();\r\n\t\t}\r\n\r\n\t\tthis.postRender(parentNode);\r\n\r\n\t\t// return this.nodes;\r\n\t}\r\n\r\n\tmapExpandableTags(tag)\r\n\t{\r\n\t\tlet expandProperty = tag.getAttribute('cv-expand');\r\n\t\tlet expandArg = Bindable.makeBindable(\r\n\t\t\tthis.args[expandProperty] || {}\r\n\t\t);\r\n\r\n\t\ttag.removeAttribute('cv-expand');\r\n\r\n\t\tfor(let i in expandArg)\r\n\t\t{\r\n\t\t\tif(i == 'name' || i == 'type')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet debind = expandArg.bindTo(i, ((tag,i)=>(v)=>{\r\n\t\t\t\ttag.setAttribute(i, v);\r\n\t\t\t})(tag,i));\r\n\r\n\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\tdebind();\r\n\t\t\t\tif(expandArg.isBound())\r\n\t\t\t\t{\r\n\t\t\t\t\tBindable.clearBindings(expandArg);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tmapAttrTags(tag)\r\n\t{\r\n\t\tlet attrProperty = tag.getAttribute('cv-attr');\r\n\r\n\t\ttag.removeAttribute('cv-attr');\r\n\r\n\t\tlet pairs = attrProperty.split(',');\r\n\t\tlet attrs = pairs.map((p) => p.split(':'));\r\n\r\n\t\tfor (let i in attrs)\r\n\t\t{\r\n\t\t\tlet proxy        = this.args;\r\n\t\t\tlet bindProperty = attrs[i][1];\r\n\t\t\tlet property     = bindProperty;\r\n\r\n\t\t\tif(bindProperty.match(/\\./))\r\n\t\t\t{\r\n\t\t\t\t[proxy, property] = Bindable.resolve(\r\n\t\t\t\t\tthis.args\r\n\t\t\t\t\t, bindProperty\r\n\t\t\t\t\t, true\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif(proxy[ attrs[i][1] ])\r\n\t\t\t{\r\n\t\t\t\ttag.setAttribute(\r\n\t\t\t\t\tattrs[i][0]\r\n\t\t\t\t\t, proxy[ attrs[i][1] ]\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tlet attrib = attrs[i][0];\r\n\r\n\t\t\tthis.cleanup.push(proxy.bindTo(\r\n\t\t\t\tproperty\r\n\t\t\t\t, (v)=>{\r\n\t\t\t\t\tif(v == null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttag.setAttribute(attrib, '');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttag.setAttribute(attrib, v);\r\n\t\t\t\t}\r\n\t\t\t));\r\n\t\t}\r\n\t}\r\n\r\n\tmapInterpolatableTags(tag)\r\n\t{\r\n\t\tlet regex = this.interpolateRegex;\r\n\r\n\t\tif(tag.nodeType == Node.TEXT_NODE)\r\n\t\t{\r\n\t\t\tlet original = tag.nodeValue;\r\n\r\n\t\t\tif(!this.interpolatable(original))\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet header   = 0;\r\n\t\t\tlet match;\r\n\r\n\t\t\twhile(match = regex.exec(original))\r\n\t\t\t{\r\n\t\t\t\tlet bindProperty = match[2];\r\n\r\n\t\t\t\tlet unsafeHtml = false;\r\n\r\n\t\t\t\tif(bindProperty.substr(0, 1) === '$')\r\n\t\t\t\t{\r\n\t\t\t\t\tunsafeHtml   = true;\r\n\t\t\t\t\tbindProperty = bindProperty.substr(1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(bindProperty.substr(0, 3) === '000')\r\n\t\t\t\t{\r\n\t\t\t\t\texpand       = true;\r\n\t\t\t\t\tbindProperty = bindProperty.substr(3);\r\n\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet staticPrefix = original.substring(header, match.index);\r\n\r\n\t\t\t\theader = match.index + match[1].length;\r\n\r\n\t\t\t\tlet staticNode = document.createTextNode(staticPrefix);\r\n\r\n\t\t\t\ttag.parentNode.insertBefore(staticNode, tag);\r\n\r\n\t\t\t\tlet dynamicNode;\r\n\r\n\t\t\t\tif(unsafeHtml)\r\n\t\t\t\t{\r\n\t\t\t\t\tdynamicNode = document.createElement('div');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdynamicNode = document.createTextNode('');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet proxy    = this.args;\r\n\t\t\t\tlet property = bindProperty;\r\n\r\n\t\t\t\tif(bindProperty.match(/\\./))\r\n\t\t\t\t{\r\n\t\t\t\t\t[proxy, property] = Bindable.resolve(\r\n\t\t\t\t\t\tthis.args\r\n\t\t\t\t\t\t, bindProperty\r\n\t\t\t\t\t\t, true\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttag.parentNode.insertBefore(dynamicNode, tag);\r\n\r\n\t\t\t\tlet debind = proxy.bindTo(property, ((dynamicNode,unsafeHtml) => (v,k,t) => {\r\n\t\t\t\t\tif(t[k] instanceof View && t[k] !== v)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(!t[k].preserve)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tt[k].remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdynamicNode.nodeValue = '';\r\n\r\n\t\t\t\t\tif(v instanceof View)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tv.render(tag.parentNode, dynamicNode);\r\n\r\n\t\t\t\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\t\t\t\tif(!v.preserve)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tv.remove();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(v instanceof Object && v.__toString instanceof Function)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tv = v.__toString();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(unsafeHtml)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdynamicNode.innerHTML = v;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdynamicNode.nodeValue = v;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})(dynamicNode,unsafeHtml));\r\n\r\n\t\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\t\tdebind();\r\n\t\t\t\t\tif(!proxy.isBound())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tBindable.clearBindings(proxy);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tlet staticSuffix = original.substring(header)\r\n\r\n\t\t\tlet staticNode = document.createTextNode(staticSuffix);\r\n\r\n\t\t\ttag.parentNode.insertBefore(staticNode, tag);\r\n\r\n\t\t\ttag.nodeValue = '';\r\n\t\t}\r\n\r\n\t\tif(tag.nodeType == Node.ELEMENT_NODE)\r\n\t\t{\r\n\t\t\tfor (let i = 0; i < tag.attributes.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(!this.interpolatable(tag.attributes[i].value))\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet header    = 0;\r\n\t\t\t\tlet match;\r\n\t\t\t\tlet original  = tag.attributes[i].value;\r\n\t\t\t\tlet attribute = tag.attributes[i];\r\n\r\n\t\t\t\tlet bindProperties = {};\r\n\t\t\t\tlet segments       = [];\r\n\r\n\t\t\t\twhile(match = regex.exec(original))\r\n\t\t\t\t{\r\n\t\t\t\t\tsegments.push(original.substring(header, match.index));\r\n\r\n\t\t\t\t\tif(!bindProperties[match[2]])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tbindProperties[match[2]] = [];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbindProperties[match[2]].push(segments.length);\r\n\r\n\t\t\t\t\tsegments.push(match[1]);\r\n\r\n\t\t\t\t\theader = match.index + match[1].length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsegments.push(original.substring(header));\r\n\r\n\t\t\t\tfor(let j in bindProperties)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet proxy    = this.args;\r\n\t\t\t\t\tlet property = j\r\n\r\n\t\t\t\t\tif(j.match(/\\./))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t[proxy, property] = Bindable.resolve(\r\n\t\t\t\t\t\t\tthis.args\r\n\t\t\t\t\t\t\t, j\r\n\t\t\t\t\t\t\t, true\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet longProperty = j;\r\n\r\n\t\t\t\t\tlet debind = proxy.bindTo(property, (v, k, t, d) => {\r\n\t\t\t\t\t\tfor(let i in bindProperties)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tfor(let j in bindProperties[longProperty])\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tsegments[ bindProperties[longProperty][j] ] = t[i];\r\n\r\n\t\t\t\t\t\t\t\tif(k === property)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tsegments[ bindProperties[longProperty][j] ] = v;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttag.setAttribute(attribute.name, segments.join(''));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\t\t\tdebind();\r\n\t\t\t\t\t\tif(!proxy.isBound())\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tBindable.clearBindings(proxy);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tmapRefTags(tag)\r\n\t{\r\n\t\tlet refAttr                         = tag.getAttribute('cv-ref');\r\n\t\tlet [refProp, refClassname, refKey] = refAttr.split(':');\r\n\r\n\t\tlet refClass = this.stringToClass(refClassname);\r\n\r\n\t\ttag.removeAttribute('cv-ref');\r\n\r\n\t\tObject.defineProperty(tag, '___tag___', {\r\n            enumerable: false,\r\n            writable: true\r\n        });\r\n\r\n        this.cleanup.push(()=>{\r\n        \ttag.___tag___ = null;\r\n\t\t\ttag.remove()\r\n\t\t});\r\n\r\n\t\tlet parent = this;\r\n\t\tlet direct = this;\r\n\r\n\t\tif(this.viewList)\r\n\t\t{\r\n\t\t\tparent = this.viewList.parent;\r\n\t\t\t// if(!this.viewList.parent.tags[refProp])\r\n\t\t\t// {\r\n\t\t\t// \tthis.viewList.parent.tags[refProp] = [];\r\n\t\t\t// }\r\n\r\n\t\t\t// let refKeyVal = this.args[refKey];\r\n\r\n\t\t\t// this.viewList.parent.tags[refProp][refKeyVal] = new refClass(\r\n\t\t\t// \ttag, this, refProp, refKeyVal\r\n\t\t\t// );\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// this.tags[refProp] = new refClass(\r\n\t\t\t// \ttag, this, refProp\r\n\t\t\t// );\r\n\t\t}\r\n\r\n\t\tlet tagObject = new refClass(\r\n\t\t\ttag, this, refProp, undefined, direct\r\n\t\t);\r\n\r\n\t\ttag.___tag___ = tagObject;\r\n\r\n\t\twhile(parent)\r\n\t\t{\r\n\t\t\tif(!parent.parent)\r\n\t\t\t{\r\n\t\t\t\tlet refKeyVal = this.args[refKey];\r\n\r\n\t\t\t\tif(refKeyVal !== undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(!parent.tags[refProp])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparent.tags[refProp] = [];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tparent.tags[refProp][refKeyVal] = tagObject;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tparent.tags[refProp] = tagObject;\r\n\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\t}\r\n\r\n\tmapBindTags(tag)\r\n\t{\r\n\t\tlet bindArg  = tag.getAttribute('cv-bind');\r\n\t\tlet proxy    = this.args;\r\n\t\tlet property = bindArg;\r\n\t\tlet top      = null;\r\n\r\n\t\tif(bindArg.match(/\\./))\r\n\t\t{\r\n\t\t\t[proxy, property, top] = Bindable.resolve(\r\n\t\t\t\tthis.args\r\n\t\t\t\t, bindArg\r\n\t\t\t\t, true\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif(proxy !== this.args)\r\n\t\t{\r\n\t\t\tthis.subBindings[bindArg] = this.subBindings[bindArg] || [];\r\n\r\n\t\t\tthis.cleanup.push(\r\n\t\t\t\tthis.args.bindTo(top, ()=>{\r\n\t\t\t\t\twhile(this.subBindings.length)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.log('HERE!');\r\n\t\t\t\t\t\tthis.subBindings.shift()();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet debind = proxy.bindTo(property, (v,k,t,d,p) => {\r\n\r\n\t\t\tif(p instanceof View && p !== v)\r\n\t\t\t{\r\n\t\t\t\tp.remove();\r\n\t\t\t}\r\n\r\n\t\t\tif(tag.tagName == 'INPUT'\r\n\t\t\t\t|| tag.tagName == 'SELECT'\r\n\t\t\t\t|| tag.tagName == 'TEXTAREA'\r\n\t\t\t) {\r\n\t\t\t\tlet type = tag.getAttribute('type');\r\n\t\t\t\tif(type && type.toLowerCase() == 'checkbox') {\r\n\t\t\t\t\ttag.checked = !!v;\r\n\t\t\t\t}\r\n\t\t\t\telse if(type && type.toLowerCase() == 'radio') {\r\n\t\t\t\t\ttag.checked = (v == tag.value);\r\n\t\t\t\t}\r\n\t\t\t\telse if(type !== 'file') {\r\n\t\t\t\t\tif(tag.tagName == 'SELECT')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// console.log(k, v, tag.outerHTML, tag.options.length);\r\n\t\t\t\t\t\tfor(let i in tag.options)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlet option = tag.options[i];\r\n\r\n\t\t\t\t\t\t\tif(option.value == v)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag.selectedIndex = i;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttag.value = v == null ? '' : v;\r\n\t\t\t\t}\r\n\t\t\t\telse if(type === 'file') {\r\n\t\t\t\t\t// console.log(v);\t\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(v instanceof View)\r\n\t\t\t{\r\n\t\t\t\tv.render(tag);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ttag.innerText = v;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(proxy !== this.args)\r\n\t\t{\r\n\t\t\tthis.subBindings[bindArg].push(debind);\r\n\t\t}\r\n\r\n\t\tthis.cleanup.push(debind);\r\n\r\n\t\tlet inputListener = (event) => {\r\n\t\t\tif(event.target !== tag) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet type  = tag.getAttribute('type');\r\n\t\t\tlet multi = tag.getAttribute('multiple');\r\n\t\t\tif (type && type.toLowerCase() == 'checkbox') {\r\n\t\t\t\tif (tag.checked) {\r\n\t\t\t\t\tproxy[property] = event.target.value;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tproxy[property] = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(type !== 'file')\r\n\t\t\t{\r\n\t\t\t\tproxy[property] = event.target.value;\r\n\t\t\t}\r\n\t\t\telse if(type == 'file' && multi)\r\n\t\t\t{\r\n\t\t\t\tproxy[property] = Array.from(event.target.files);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\ttag.addEventListener('input',         inputListener);\r\n\t\ttag.addEventListener('change',        inputListener);\r\n\t\ttag.addEventListener('value-changed', inputListener);\r\n\r\n\t\tthis.cleanup.push( ((tag, eventListener) => ()=>{\r\n\t\t\ttag.removeEventListener('input',         inputListener);\r\n\t\t\ttag.removeEventListener('change',        inputListener);\r\n\t\t\ttag.removeEventListener('value-changed', inputListener);\r\n\t\t\ttag           = undefined;\r\n\t\t\teventListener = undefined;\r\n\t\t})(tag, inputListener));\r\n\r\n\t\ttag.removeAttribute('cv-bind');\r\n\t}\r\n\r\n\tmapOnTags(tag)\r\n\t{\r\n\t\tlet action = String(tag.getAttribute('cv-on'))\r\n\t\t\t.split(/;/)\r\n\t\t\t.map((a) => a.split(':'))\r\n\t\t\t.map(((object, tag) => (a) => {\r\n\t\t\t\tlet eventName    = a[0].replace(/(^[\\s\\n]+|[\\s\\n]+$)/, '');\r\n\t\t\t\tlet callbackName = a[1];\r\n\t\t\t\tlet argList      = [];\r\n\t\t\t\tlet groups = /(\\w+)(?:\\(([$\\w\\s'\",]+)\\))?/.exec(callbackName);\r\n\t\t\t\tif(groups.length) {\r\n\t\t\t\t\tcallbackName = groups[1].replace(/(^[\\s\\n]+|[\\s\\n]+$)/, '');\r\n\t\t\t\t\tif(groups[2]) {\r\n\t\t\t\t\t\targList = groups[2].split(',').map(s => s.trim());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet eventMethod;\r\n\t\t\t\tlet parent = this;\r\n\r\n\t\t\t\twhile(parent)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(typeof parent[callbackName] == 'function')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet _parent       = parent;\r\n\t\t\t\t\t\tlet _callBackName = callbackName;\r\n\t\t\t\t\t\teventMethod = (...args) => {\r\n\t\t\t\t\t\t\t_parent[ _callBackName ](...args);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(parent.viewList && parent.viewList.parent)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparent = parent.viewList.parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(parent.parent)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparent = parent.parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet eventListener = ((object, parent, eventMethod, tag) => (event) => {\r\n\t\t\t\t\tlet argRefs = argList.map((arg) => {\r\n\t\t\t\t\t\tlet match;\r\n\t\t\t\t\t\tif(parseInt(arg) == arg)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\treturn arg;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(arg === 'event' || arg === '$event') {\r\n\t\t\t\t\t\t\treturn event;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(arg === '$view') {\r\n\t\t\t\t\t\t\treturn parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(arg === '$tag') {\r\n\t\t\t\t\t\t\treturn tag;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(arg === '$parent') {\r\n\t\t\t\t\t\t\treturn this.parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(arg === '$subview') {\r\n\t\t\t\t\t\t\treturn this;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(arg in this.args) {\r\n\t\t\t\t\t\t\treturn this.args[arg];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(match = /^['\"](\\w+?)[\"']$/.exec(arg))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\treturn match[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif(!(typeof eventMethod == 'function')) {\r\n\t\t\t\t\t\tthrow new Error(\r\n\t\t\t\t\t\t\t`${callbackName} is not defined on View object.\r\n\r\nTag:\r\n\r\n${tag.outerHTML}`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\teventMethod(...argRefs);\r\n\t\t\t\t})(object, parent, eventMethod, tag);\r\n\r\n\r\n\t\t\t\tswitch(eventName)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase '_init':\r\n\t\t\t\t\t\teventListener();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase '_attach':\r\n\t\t\t\t\t\tthis.attach.push(eventListener);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase '_detach':\r\n\t\t\t\t\t\tthis.detach.push(eventListener);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ttag.addEventListener(eventName, eventListener);\r\n\r\n\t\t\t\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\t\t\t\ttag.removeEventListener(eventName, eventListener);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn [eventName, callbackName, argList];\r\n\t\t\t})(this, tag));\r\n\r\n\t\ttag.removeAttribute('cv-on');\r\n\t}\r\n\r\n\tmapLinkTags(tag)\r\n\t{\r\n\t\tlet linkAttr = tag.getAttribute('cv-link');\r\n\r\n\t\ttag.setAttribute('href', linkAttr);\r\n\r\n\t\tlet linkClick = (event) => {\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tif(linkAttr.substring(0, 4) == 'http'\r\n\t\t\t\t|| linkAttr.substring(0, 2) == '//'\r\n\t\t\t){\r\n\t\t\t\twindow.open(tag.getAttribute('href', linkAttr));\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tRouter.go(tag.getAttribute('href'));\r\n\t\t};\r\n\r\n\t\ttag.addEventListener('click', linkClick);\r\n\r\n\t\tthis.cleanup.push( ((tag, eventListener) => ()=>{\r\n\t\t\ttag.removeEventListener('click', eventListener);\r\n\t\t\ttag           = undefined;\r\n\t\t\teventListener = undefined;\r\n\t\t})(tag, linkClick));\r\n\r\n\t\ttag.removeAttribute('cv-link');\r\n\t}\r\n\r\n\tmapPrendererTags(tag)\r\n\t{\r\n\t\tlet prerenderAttr = tag.getAttribute('cv-prerender');\r\n\t\tlet prerendering  = window.prerenderer;\r\n\r\n\t\tif(prerenderAttr == 'never' && prerendering\r\n\t\t\t|| prerenderAttr == 'only' && !prerendering\r\n\t\t){\r\n\t\t\ttag.parentNode.removeChild(tag);\r\n\t\t}\r\n\t}\r\n\r\n\tmapWithTags(tag)\r\n\t{\r\n\t\tlet withAttr = tag.getAttribute('cv-with');\r\n\t\tlet carryAttr = tag.getAttribute('cv-carry');\r\n\t\ttag.removeAttribute('cv-with');\r\n\t\ttag.removeAttribute('cv-carry');\r\n\r\n\t\tlet subTemplate = tag.innerHTML;\r\n\r\n\t\tlet carryProps = [];\r\n\r\n\t\tif(carryAttr)\r\n\t\t{\r\n\t\t\tcarryProps = carryAttr.split(',').map(s=>s.trim());\r\n\t\t}\r\n\r\n\t\tlet debind = this.args.bindTo(withAttr, (v,k,t,d) => {\r\n\t\t\tif(this.withViews[k])\r\n\t\t\t{\r\n\t\t\t\tthis.withViews[k].remove();\r\n\t\t\t}\r\n\r\n\t\t\twhile(tag.firstChild)\r\n\t\t\t{\r\n\t\t\t\ttag.removeChild(tag.firstChild);\r\n\t\t\t}\r\n\r\n\t\t\tlet view = new View();\r\n\r\n\t\t\tthis.cleanup.push(((view)=>()=>{\r\n\t\t\t\tview.remove();\r\n\t\t\t})(view));\r\n\r\n\t\t\tview.template = subTemplate;\r\n\t\t\tview.parent   = this;\r\n\r\n\t\t\tfor(let i in carryProps)\r\n\t\t\t{\r\n\t\t\t\tlet debind = this.args.bindTo(carryProps[i], (v, k) => {\r\n\t\t\t\t\tview.args[k] = v;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tview.cleanup.push(debind);\r\n\t\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\t\tdebind();\r\n\t\t\t\t\tview.remove();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in v)\r\n\t\t\t{\r\n\t\t\t\tlet debind = v.bindTo(i, (v, k) => {\r\n\t\t\t\t\tview.args[k] = v;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\t\tdebind();\r\n\t\t\t\t\tif(!v.isBound())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tBindable.clearBindings(v);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tview.remove();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tview.cleanup.push(()=>{\r\n\t\t\t\t\tdebind();\r\n\t\t\t\t\tif(!v.isBound())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tBindable.clearBindings(v);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tview.render(tag);\r\n\r\n\t\t\tthis.withViews[k] = view;\r\n\t\t});\r\n\r\n\t\tthis.cleanup.push(debind);\r\n\t}\r\n\r\n\tmapEachTags(tag)\r\n\t{\r\n\t\tlet eachAttr = tag.getAttribute('cv-each');\r\n\t\ttag.removeAttribute('cv-each');\r\n\r\n\t\tlet subTemplate = tag.innerHTML;\r\n\r\n\t\twhile(tag.firstChild)\r\n\t\t{\r\n\t\t\ttag.removeChild(tag.firstChild);\r\n\t\t}\r\n\r\n\t\t// let carryProps = [];\r\n\r\n\t\t// if(carryAttr)\r\n\t\t// {\r\n\t\t// \tcarryProps = carryAttr.split(',');\r\n\t\t// }\r\n\r\n\t\tlet [eachProp, asProp, keyProp] = eachAttr.split(':');\r\n\r\n\t\tlet debind = this.args.bindTo(eachProp, (v,k,t,d,p)=>{\r\n\t\t\tif(this.viewLists[eachProp])\r\n\t\t\t{\r\n\t\t\t\tthis.viewLists[eachProp].remove();\r\n\t\t\t}\r\n\r\n\t\t\tlet viewList = new ViewList(subTemplate, asProp, v, this, keyProp);\r\n\r\n\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\tviewList.remove();\r\n\t\t\t});\r\n\r\n\t\t\tlet debindA = this.args.bindTo((v,k,t,d)=>{\r\n\t\t\t\tif(k == '_id')\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// console.log(k,v);\r\n\r\n\t\t\t\tif(viewList.args.subArgs[k] !== v)\r\n\t\t\t\t{\r\n\t\t\t\t\t// view.args[k] = v;\r\n\t\t\t\t\tviewList.args.subArgs[k] = v;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(let i in this.args)\r\n\t\t\t{\r\n\t\t\t\tif(i == '_id')\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tviewList.args.subArgs[k] = this.args[i];\r\n\t\t\t}\r\n\r\n\t\t\tlet debindB = viewList.args.bindTo((v,k,t,d,p)=>{\r\n\t\t\t\tif(k == '_id' || k.substring(0,3) === '___')\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet newRef = v;\r\n\t\t\t\tlet oldRef = p;//t[k];\r\n\r\n\t\t\t\tif(v instanceof View)\r\n\t\t\t\t{\r\n\t\t\t\t\tnewRef = v.___ref___;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(p instanceof View)\r\n\t\t\t\t{\r\n\t\t\t\t\toldRef = p.___ref___;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(newRef !== oldRef && t[k] instanceof View)\r\n\t\t\t\t{\r\n\t\t\t\t\tt[k].remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif((k in this.args) && newRef !== oldRef)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.args[k] = v;\r\n\t\t\t\t}\r\n\t\t\t}, {wait:0});\r\n\r\n\t\t\t// let debindC = viewList.args.subArgs.bindTo((v,k,t,d,p)=>{\r\n\t\t\t// \tif(k == '_id')\r\n\t\t\t// \t{\r\n\t\t\t// \t\treturn;\r\n\t\t\t// \t}\r\n\r\n\t\t\t// \tconsole.log(k,v,p,this.args[k]);\r\n\r\n\t\t\t// \tif(this.args[k] === v)\r\n\t\t\t// \t{\r\n\t\t\t// \t\t// return;\r\n\t\t\t// \t}\r\n\r\n\t\t\t// \tif(k in this.args)\r\n\t\t\t// \t{\r\n\t\t\t// \t\tthis.args[k] = v;\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\r\n\t\t\tthis.cleanup.push(()=>{\r\n\t\t\t\tdebindA();\r\n\t\t\t\tdebindB();\r\n\t\t\t});\r\n\r\n\t\t\twhile(tag.firstChild)\r\n\t\t\t{\r\n\t\t\t\ttag.removeChild(tag.firstChild);\r\n\t\t\t}\r\n\r\n\t\t\tthis.viewLists[eachProp] = viewList;\r\n\r\n\t\t\tviewList.render(tag);\r\n\t\t});\r\n\r\n\t\tthis.cleanup.push(()=>{\r\n\t\t\tdebind();\r\n\t\t});\r\n\t}\r\n\r\n\tmapIfTags(tag)\r\n\t{\r\n\t\tlet ifProperty = tag.getAttribute('cv-if');\r\n\t\t\r\n\t\ttag.removeAttribute('cv-if');\r\n\r\n\t\tlet subTemplate = tag.innerHTML;\r\n\t\t\r\n\t\tlet inverted = false;\r\n\r\n\t\tif(ifProperty.substr(0, 1) === '!')\r\n\t\t{\r\n\t\t\tinverted   = true;\r\n\t\t\tifProperty = ifProperty.substr(1);\r\n\t\t}\r\n\r\n\t\twhile(tag.firstChild)\r\n\t\t{\r\n\t\t\ttag.removeChild(tag.firstChild);\r\n\t\t}\r\n\r\n\t\tlet ifDoc = document.createRange().createContextualFragment('');\r\n\r\n\t\tlet view = new View();\r\n\r\n\t\tview.template = subTemplate;\r\n\t\tview.parent   = this;\r\n\r\n\t\tlet debindA = this.args.bindTo((v,k,t,d)=>{\r\n\t\t\tif(k == '_id')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(view.args[k] !== v)\r\n\t\t\t{\r\n\t\t\t\tview.args[k] = v;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfor(let i in this.args)\r\n\t\t{\r\n\t\t\tif(i == '_id')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tview.args[i] = this.args[i];\r\n\t\t}\r\n\r\n\t\tlet debindB = view.args.bindTo((v,k,t,d,p)=>{\r\n\t\t\tif(k == '_id')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet newRef = v;\r\n\t\t\tlet oldRef = p;\r\n\r\n\t\t\tif(v instanceof View)\r\n\t\t\t{\r\n\t\t\t\tnewRef = v.___ref___;\r\n\t\t\t}\r\n\r\n\t\t\tif(p instanceof View)\r\n\t\t\t{\r\n\t\t\t\toldRef = p.___ref___;\r\n\t\t\t}\r\n\r\n\t\t\tif(newRef !== oldRef && p instanceof View)\r\n\t\t\t{\r\n\t\t\t\tp.remove();\r\n\t\t\t}\r\n\r\n\t\t\tif((k in this.args) && newRef !== oldRef)\r\n\t\t\t{\r\n\t\t\t\tthis.args[k] = v;\r\n\t\t\t}\r\n\t\t}, {wait:0});\r\n\r\n\t\tlet cleaner = this;\r\n\r\n\t\twhile(cleaner.parent)\r\n\t\t{\r\n\t\t\tcleaner = cleaner.parent;\r\n\t\t}\r\n\r\n\t\tthis.cleanup.push(()=>{\r\n\t\t\tdebindA();\r\n\t\t\tdebindB();\r\n\t\t\t// view.remove();\r\n\t\t});\r\n\r\n\t\tview.render(tag);\r\n\r\n\t\tlet proxy    = this.args;\r\n\t\tlet property = ifProperty;\r\n\r\n\t\tif(ifProperty.match(/\\./))\r\n\t\t{\r\n\t\t\t[proxy, property] = Bindable.resolve(\r\n\t\t\t\tthis.args\r\n\t\t\t\t, ifProperty\r\n\t\t\t\t, true\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet debind = proxy.bindTo(\r\n\t\t\tproperty\r\n\t\t\t, (v,k) => {\r\n\t\t\t\tif(Array.isArray(v))\r\n\t\t\t\t{\r\n\t\t\t\t\tv = !!v.length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(inverted)\r\n\t\t\t\t{\r\n\t\t\t\t\tv = !v;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(v)\r\n\t\t\t\t{\r\n\t\t\t\t\tview.render(tag);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\twhile(tag.firstChild)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttag.firstChild.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tview.render(ifDoc);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.cleanup.push(()=>{\r\n\t\t\tdebind();\r\n\t\t\tif(!proxy.isBound())\r\n\t\t\t{\r\n\t\t\t\tBindable.clearBindings(proxy);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tpostRender(parentNode)\r\n\t{\r\n\r\n\t}\r\n\r\n\tinterpolatable(str)\r\n\t{\r\n\t\treturn !!(String(str).match(this.interpolateRegex));\r\n\t}\r\n\r\n\tuuid() {\r\n\t\treturn ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(\r\n\t\t\t/[018]/g\r\n\t\t\t, c => (\r\n\t\t\t\tc ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4\r\n\t\t\t).toString(16)\r\n\t\t);\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tlet detachEvent = new Event('cvDomDetached');\r\n\r\n\t\tfor(let i in this.tags)\r\n\t\t{\r\n\t\t\tif(Array.isArray(this.tags[i]))\r\n\t\t\t{\r\n\t\t\t\tfor(var j in this.tags[i])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.tags[i][j].remove();\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.tags[i].remove();\r\n\t\t}\r\n\r\n\t\tfor(let i in this.nodes)\r\n\t\t{\r\n\t\t\tthis.nodes[i].dispatchEvent(detachEvent);\r\n\t\t\tthis.nodes[i].remove();\r\n\t\t}\r\n\r\n\t\tlet cleanup;\r\n\r\n\t\twhile(cleanup = this.cleanup.shift())\r\n\t\t{\r\n\t\t\tcleanup();\r\n\t\t}\r\n\r\n\t\tfor(let i in this.viewLists)\r\n\t\t{\r\n\t\t\tif(!this.viewLists[i])\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.viewLists[i].remove();\r\n\t\t}\r\n\r\n\t\tthis.viewLists = [];\r\n\r\n\t\tfor(let i in this.timeouts)\r\n\t\t{\r\n\t\t\tclearInterval(this.timeouts[i].timeout);\r\n\t\t\tdelete this.timeouts[i];\r\n\t\t}\r\n\r\n\t\tfor(var i in this.intervals)\r\n\t\t{\r\n\t\t\tclearInterval(this.intervals[i].timeout);\r\n\t\t\tdelete this.intervals[i];\r\n\t\t}\r\n\r\n\t\tthis.removed = true;\r\n\r\n\t\t// Bindable.clearBindings(this.args);\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\r\n\t}\r\n\r\n\tbeforeUpdate(args)\r\n\t{\r\n\r\n\t}\r\n\r\n\tafterUpdate(args)\r\n\t{\r\n\r\n\t}\r\n\r\n\tstringToClass(refClassname)\r\n\t{\r\n\t\tlet refClassSplit           = refClassname.split('/');\r\n\t\tlet refShortClassname       = refClassSplit[ refClassSplit.length - 1 ];\r\n\t\tlet refClass                = require(refClassname);\r\n\r\n\t\treturn refClass[refShortClassname];\r\n\t}\r\n}\r\n","import { Bindable } from './Bindable';\r\nimport { View     } from './View';\r\n\r\nexport class ViewList\r\n{\r\n\tconstructor(template, subProperty, list, parent, keyProperty = null)\r\n\t{\r\n\t\tthis.args         = Bindable.makeBindable({});\r\n\t\tthis.args.value   = Bindable.makeBindable(list || {});\r\n\t\tthis.args.subArgs = Bindable.makeBindable({});\r\n\t\tthis.views        = [];\r\n\t\tthis.cleanup      = [];\r\n\t\tthis.template     = template;\r\n\t\tthis.subProperty  = subProperty;\r\n\t\tthis.keyProperty  = keyProperty;\r\n\t\tthis.tag          = null;\r\n\t\tthis.paused       = false;\r\n\t\tthis.parent       = parent;\r\n\r\n\t\tthis.args.value.___before___.push((t)=>{\r\n\t\t\tif(t.___executing___ == 'bindTo')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.paused = true;\r\n\t\t});\r\n\r\n\t\tthis.args.value.___after___.push((t)=>{\r\n\t\t\tif(t.___executing___ == 'bindTo')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.paused = t.___stack___.length > 1;\t\r\n\r\n\t\t\tthis.reRender();\r\n\t\t\t\r\n\t\t});\r\n\r\n\t\tlet debind = this.args.value.bindTo((v, k, t, d) => {\r\n\r\n\t\t\tif(this.paused)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(d)\r\n\t\t\t{\r\n\t\t\t\tif(this.views[k])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.views[k].remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.views.splice(k,1);\r\n\r\n\t\t\t\tfor(let i in this.views)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.views[i].args[ this.keyProperty ] = i;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.views[k])\r\n\t\t\t{\r\n\t\t\t\tthis.reRender();\t\r\n\t\t\t}\r\n\t\t}, {wait: 0});\r\n\r\n\t\tthis.cleanup.push(debind);\r\n\t}\r\n\r\n\trender(tag)\r\n\t{\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tthis.views[i].render(tag);\r\n\t\t}\r\n\r\n\t\tthis.tag = tag;\r\n\t}\r\n\r\n\treRender()\r\n\t{\r\n\t\tif(this.paused || !this.tag)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet views = [];\r\n\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tviews[i] = this.views[i];\r\n\t\t}\r\n\r\n\t\tlet finalViews = [];\r\n\r\n\t\tfor(let i in this.args.value)\r\n\t\t{\r\n\t\t\tlet found = false;\r\n\r\n\t\t\tfor(let j in views)\r\n\t\t\t{\r\n\t\t\t\tif(views[j]\r\n\t\t\t\t\t&& this.args.value[i] === views[j].args[ this.subProperty ]\r\n\t\t\t\t){\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tfinalViews[i] = views[j];\r\n\t\t\t\t\tfinalViews[i].args[ this.keyProperty ] = i;\r\n\t\t\t\t\tdelete views[j];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!found)\r\n\t\t\t{\r\n\t\t\t\tlet viewArgs = {};\r\n\t\t\t\tlet view = finalViews[i] = new View(viewArgs);\r\n\r\n\t\t\t\tfinalViews[i].template = this.template;\r\n\t\t\t\tfinalViews[i].parent   = this.parent;\r\n\t\t\t\tfinalViews[i].viewList = this;\r\n\r\n\t\t\t\tfinalViews[i].args[ this.keyProperty ] = i;\r\n\t\t\t\tfinalViews[i].args[ this.subProperty ] = this.args.value[i];\r\n\r\n\t\t\t\tthis.cleanup.push(\r\n\t\t\t\t\tthis.args.value.bindTo(i, (v,k,t)=>{\r\n\t\t\t\t\t\t// viewArgs[ this.keyProperty ] = k;\r\n\t\t\t\t\t\t// viewArgs[ this.subProperty ] = v;\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\t\tthis.cleanup.push(\r\n\t\t\t\t\tviewArgs.bindTo(this.subProperty, (v,k)=>{\r\n\t\t\t\t\t\tlet index = viewArgs[ this.keyProperty ];\r\n\t\t\t\t\t\tthis.args.value[index] = v;\r\n\t\t\t\t\t}\r\n\t\t\t\t));\r\n\r\n\t\t\t\tthis.cleanup.push(\r\n\t\t\t\t\tthis.args.subArgs.bindTo((v, k, t, d) => {\r\n\t\t\t\t\t\tviewArgs[k] = v;\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\t\tviewArgs[this.subProperty] = this.args.value[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i in views)\r\n\t\t{\r\n\t\t\tlet found = false;\r\n\r\n\t\t\tfor(let j in finalViews)\r\n\t\t\t{\r\n\t\t\t\tif(views[i] === finalViews[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!found)\r\n\t\t\t{\r\n\t\t\t\tviews[i].remove();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet appendOnly = true;\r\n\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tif(this.views[i] !== finalViews[i])\r\n\t\t\t{\r\n\t\t\t\tappendOnly = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i in finalViews)\r\n\t\t{\r\n\t\t\tif(finalViews[i] === this.views[i])\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tviews.splice(i+1, 0, finalViews[i]);\r\n\r\n\t\t\tfinalViews[i].render(this.tag);\r\n\t\t}\r\n\r\n\t\tfor(let i in finalViews)\r\n\t\t{\r\n\t\t\tfinalViews[i].args[ this.keyProperty ] = i;\r\n\t\t}\r\n\r\n\t\tthis.views = finalViews;\r\n\t}\r\n\tpause(pause=true)\r\n\t{\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tthis.views[i].pause(pause);\r\n\t\t}\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tthis.views[i].remove();\r\n\t\t}\r\n\r\n\t\tlet cleanup;\r\n\r\n\t\twhile(this.cleanup.length)\r\n\t\t{\r\n\t\t\tcleanup = this.cleanup.pop();\r\n\t\t\tcleanup();\r\n\t\t}\r\n\r\n\t\tthis.views = [];\r\n\r\n\t\twhile(this.tag && this.tag.firstChild)\r\n\t\t{\r\n\t\t\tthis.tag.removeChild(this.tag.firstChild);\r\n\t\t}\r\n\r\n\t\tBindable.clearBindings(this.args.subArgs);\r\n\t\tBindable.clearBindings(this.args);\r\n\r\n\t\tif(!this.args.value.isBound())\r\n\t\t{\r\n\t\t\tBindable.clearBindings(this.args.value);\t\t\t\r\n\t\t}\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class ButtonField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.args.title = this.args.title || this.args.value;\r\n\t\tthis.template = `\r\n\t\t\t<label\r\n\t\t\t\tfor = \"${this.args.name}\"\r\n\t\t\t\tdata-type = \"${this.args.attrs.type}\"\r\n\t\t\t\tcv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tname   = \"${this.args.name}\"\r\n\t\t\t\t\ttype   = \"${this.args.attrs.type}\"\r\n\t\t\t\t\tvalue  = \"[[title]]\"\r\n\t\t\t\t\tcv-on  = \"click:clicked(event)\"\r\n\t\t\t\t\tcv-ref = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n\tclicked(event) {\r\n\t\tif(this.args.attrs.type == 'submit')\r\n\t\t{\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tthis.form.tags.formTag.element.dispatchEvent(new Event(\r\n\t\t\t\t'submit', {\r\n\t\t\t\t\t'cancelable': true\r\n\t\t\t\t\t, 'bubbles':  true\r\n\t\t\t\t}\r\n\t\t\t));\r\n\t\t}\r\n\t}\r\n}\r\n","import { View     } from '../base/View';\r\nimport { Bindable } from '../base/Bindable';\r\n\r\nexport class Field extends View {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tlet skeleton = Object.assign({}, values);\r\n\r\n\t\tsuper(skeleton);\r\n\r\n\t\tthis.args.title = this.args.title || '';\r\n\t\tthis.args.value = this.args.value === null ?  '' : this.args.value;\r\n\t\tthis.value      = this.args.value;\r\n\t\tthis.skeleton   = skeleton;\r\n\t\tthis.disabled   = null;\r\n\r\n\t\tthis.args.valueString = '';\r\n\r\n\t\tthis.form   = form;\r\n\t\tthis.parent = parent;\r\n\t\tthis.key    = key;\r\n\r\n\t\tthis.ignore = this.args.attrs['data-cv-ignore'] || false;\r\n\r\n\t\tlet extra = '';\r\n\r\n\t\tif(this.args.attrs.type == 'checkbox')\r\n\t\t{\r\n\t\t\textra = 'value = \"1\"';\r\n\t\t}\r\n\r\n\t\tthis.template = `\r\n\t\t\t<label\r\n\t\t\t\tfor           = \"${this.args.name}\"\r\n\t\t\t\tdata-type     = \"${this.args.attrs.type}\"\r\n\t\t\t\tcv-ref        = \"label:curvature/base/Tag\"\r\n\t\t\t>\r\n\t\t\t\t<span cv-if = \"title\">\r\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<input\r\n\t\t\t\t\tname      = \"${this.args.name}\"\r\n\t\t\t\t\ttype      = \"${this.args.attrs.type||'text'}\"\r\n\t\t\t\t\tcv-bind   = \"value\"\r\n\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\r\n\t\t\t\t\tcv-expand = \"attrs\"\r\n\t\t\t\t\t${extra}\r\n\t\t\t\t/>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t\t//type    = \"${this.args.attrs.type||'text'}\"\r\n\r\n\t\t// let key     = this.key;\r\n\t\tlet setting = null;\r\n\r\n\t\tthis.args.bindTo('value', (v, k) => {\r\n\t\t\tthis.value = v;\r\n\r\n\t\t\tif(setting == k)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsetting = key;\r\n\r\n\t\t\tthis.args.valueString = JSON.stringify(v||'', null, 4);\r\n\t\t\tthis.valueString = this.args.valueString;\r\n\r\n\t\t\tif(this.args.attrs.type == 'file'\r\n\t\t\t\t&& this.tags.input\r\n\t\t\t\t&& this.tags.input.element.files\r\n\t\t\t\t&& this.tags.input.element.length\r\n\t\t\t){\r\n\t\t\t\tif(!this.args.attrs.multiple)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.parent.args.value[key] = this.tags.input.element.files[0];\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.parent.args.value[key] = Array.from(this.tags.input.element.files);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif(!this.parent.args.value)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.parent.args.value = {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.parent.args.value[key] = v;\r\n\t\t\t}\r\n\t\t\tsetting = null;\r\n\t\t}, {wait: 0});\r\n\r\n\t\t// this.parent.args.value = Bindable.makeBindable(this.parent.args.value);\r\n\r\n\t\tthis.parent.args.value[this.key] = this.args.value;\r\n\r\n\t\tthis.parent.args.value.bindTo(key, (v, k)=>{\r\n\r\n\t\t\tif(setting == k)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsetting = k;\r\n\r\n\t\t\t\r\n\t\t\tif(this.args.attrs.type == 'file')\r\n\t\t\t{\r\n\t\t\t\tif(this.tags.input\r\n\t\t\t\t\t && this.tags.input.element.files\r\n\t\t\t\t\t && this.tags.input.element.files.length\r\n\t\t\t\t){\r\n\t\t\t\t\tif(!this.args.attrs.multiple)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.parent.args.value[key] = this.tags.input.element.files[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.parent.args.value[key] = Array.from(this.tags.input.element.files);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.args.value = v;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.args.value = v;\r\n\t\t\t}\r\n\r\n\t\t\tsetting = null;\r\n\t\t});\r\n\t}\r\n\r\n\tdisable()\r\n\t{\r\n\t\tif(this.hasChildren())\r\n\t\t{\r\n\t\t\t// for(let i in this.args.fields)\r\n\t\t\t// {\r\n\t\t\t// \tthis.args.fields[i].disable();\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\tthis.disabled = 'disabled';\r\n\t}\r\n\r\n\tenable()\r\n\t{\r\n\t\tif(this.hasChildren())\r\n\t\t{\r\n\t\t\t// for(let i in this.args.fields)\r\n\t\t\t// {\r\n\t\t\t// \tthis.args.fields[i].disable();\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\tthis.disabled = false;\r\n\t}\r\n\r\n\thasChildren()\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetName()\r\n\t{\r\n\t\tif(this.tags.input)\r\n\t\t{\r\n\t\t\treturn this.tags.input.element.getAttribute('name');\r\n\t\t}\r\n\r\n\t\treturn this.args.name;\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\nimport { Form  } from './Form';\r\n\r\nexport class FieldSet extends Field\r\n{\r\n\tconstructor(values, form, parent, key)\r\n\t{\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.args.value  = {};\r\n\t\tthis.args.fields = Form.renderFields(values.children, this);\r\n\t\tthis.fields      = this.args.fields;\r\n\t\tthis.template    = `\r\n\t\t\t<label\r\n\t\t\t\tfor        = \"${this.args.name}\"\r\n\t\t\t\tdata-type  = \"${this.args.attrs.type}\"\r\n\t\t\t\tdata-multi = \"${this.args.attrs['data-multi'] ? 'true' : 'false'}\"\r\n\t\t\t\tcv-ref     = \"label:curvature/base/Tag\"\r\n\t\t\t>\r\n\t\t\t\t<span cv-if = \"title\">\r\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<fieldset\r\n\t\t\t\t\tname   = \"${this.args.name}\"\r\n\t\t\t\t\tcv-ref = \"input:curvature/base/Tag\"\r\n\t\t\t\t\tcv-expand=\"attrs\"\r\n\t\t\t\t\tcv-each = \"fields:field\"\r\n\t\t\t\t>\r\n\t\t\t\t\t[[field]]\r\n\t\t\t\t</fieldset>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n\thasChildren()\r\n\t{\r\n\t\treturn !!Object.keys(this.args.fields).length;\r\n\t}\r\n\twrapSubfield(field)\r\n\t{\r\n\t\treturn field;\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class FileField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label\r\n\t\t\t\tfor       = \"${this.args.name}\"\r\n\t\t\t\tdata-type = \"${this.args.attrs.type}\"\r\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\r\n\t\t\t>\r\n\t\t\t\t<input\r\n\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\ttype    = \"${this.args.attrs.type}\"\r\n\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t\t<span style = \"display:none\" cv-if = \"value\">[[[value]]]</span>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nimport { Field         } from './Field';\r\nimport { FieldSet      } from './FieldSet';\r\nimport { SelectField   } from './SelectField';\r\nimport { RadioField    } from './RadioField';\r\nimport { HtmlField     } from './HtmlField';\r\nimport { HiddenField   } from './HiddenField';\r\nimport { ButtonField   } from './ButtonField';\r\nimport { TextareaField } from './TextareaField';\r\n\r\nimport { View as MultiField } from './multiField/View';\r\n\r\n// import { Router           } from 'Router';\r\n\r\n// import { Repository       } from '../Repository';\r\n\r\n// import { FieldSet         } from './FieldSet';\r\n\r\n// import { ToastView        } from '../ToastView';\r\n// import { ToastAlertView   } from '../ToastAlertView';\r\n\r\nexport class Form extends View\r\n{\r\n\tconstructor(skeleton, customFields = {})\r\n\t{\r\n\t\tsuper({});\r\n\t\tthis.args.flatValue = this.args.flatValue || {};\r\n\t\tthis.args.value     = this.args.value     || {};\r\n\r\n\t\tthis.args.method    = skeleton._method || 'GET';\r\n\r\n\t\tthis.args.classes   = this.args.classes || [];\r\n\r\n\t\tthis.args.bindTo('classes', (v)=>{\r\n\t\t\tthis.args._classes = v.join(' ');\r\n\t\t});\r\n\r\n\t\tthis._onSubmit   = [];\r\n\t\tthis.action      = '';\r\n\t\tthis.template    = `\r\n\t\t\t<form\r\n\t\t\t\tclass    = \"[[_classes]]\"\r\n\t\t\t\tmethod   = \"[[method]]\"\r\n\t\t\t\tenctype  = \"multipart/form-data\"\r\n\t\t\t\tcv-on    = \"submit:submit(event)\"\r\n\t\t\t\tcv-ref   = \"formTag:curvature/base/Tag\"\r\n\t\t\t\tcv-each  = \"fields:field\"\r\n\t\t\t>\r\n\t\t\t\t[[field]]\r\n\t\t\t</form>\r\n\t\t`;\r\n\r\n\t\tthis.args.fields = Form.renderFields(skeleton, this, customFields);\r\n\r\n\t\tthis.fields = this.args.fields;\r\n\r\n\t\tthis.args.bindTo(\r\n\t\t\t'value'\r\n\t\t\t, (v) => {\r\n\t\t\t\tthis.args.valueString = JSON.stringify(v, null, 4);\r\n\t\t\t\tthis.valueString = this.args.valueString;\r\n\t\t\t\tthis.value = v;\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tsubmitHandler(event)\r\n\t{\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\t}\r\n\r\n\tsubmit(event)\r\n\t{\r\n\t\tthis.args.valueString = JSON.stringify(\r\n\t\t\tthis.args.value\r\n\t\t\t, null\r\n\t\t\t, 4\r\n\t\t);\r\n\r\n\t\tfor(let i in this._onSubmit)\r\n\t\t{\r\n\t\t\tthis._onSubmit[i](this, event);\r\n\t\t}\r\n\t}\r\n\tbuttonClick(event)\r\n\t{\r\n\t\t// console.log(event);\r\n\t}\r\n\tonSubmit(callback)\r\n\t{\r\n\t\tthis._onSubmit.push(callback);\r\n\t}\r\n\tstatic renderFields(skeleton, parent = null, customFields = {})\r\n\t{\r\n\t\tlet fields = {};\r\n\t\tfor(let i in skeleton)\r\n\t\t{\r\n\t\t\tif(fields[i])\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(i.substr(0,1) == '_')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet field = null;\r\n\t\t\tlet form  = null;\r\n\r\n\t\t\tif(parent)\r\n\t\t\t{\r\n\t\t\t\tif(parent instanceof Form)\r\n\t\t\t\t{\r\n\t\t\t\t\tform = parent;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tform = parent.form;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(customFields);\r\n\r\n\t\t\tif(customFields && skeleton[i].name in customFields)\r\n\t\t\t{\r\n\t\t\t\tfield = new customFields[ skeleton[i].name ](skeleton[i], form, parent, i)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tswitch(skeleton[i].type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'fieldset':\r\n\t\t\t\t\t\tif(skeleton[i].attrs['data-multi'])\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tfield = new MultiField(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tfield = new FieldSet(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'select':\r\n\t\t\t\t\t\tconsole.log(skeleton[i]);\r\n\t\t\t\t\t\tfield = new SelectField(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'radios':\r\n\t\t\t\t\t\tfield = new RadioField(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'html':\r\n\t\t\t\t\t\tfield = new HtmlField(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'submit':\r\n\t\t\t\t\tcase 'button':\r\n\t\t\t\t\t\tfield = new ButtonField(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'hidden':\r\n\t\t\t\t\t\tfield = new HiddenField(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'textarea':\r\n\t\t\t\t\t\tfield = new TextareaField(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\tfield = new Field(skeleton[i], form, parent, i);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfields[i] = field;\r\n\r\n\t\t\tfield.args.bindTo(\r\n\t\t\t\t'value'\r\n\t\t\t\t, (v, k ,t, d) => {\r\n\t\t\t\t\t// console.log(t,v);\r\n\t\t\t\t\tif(t.type == 'html'\r\n\t\t\t\t\t\t\t&& !t.contentEditable\r\n\t\t\t\t\t\t\t|| t.type == 'fieldset'\r\n\t\t\t\t\t){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// let fieldName = field.args.name;\r\n\t\t\t\t\tlet fieldName = field.getName();\r\n\r\n\t\t\t\t\tif(t.disabled)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdelete form.args.flatValue[ fieldName ];\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tform.args.flatValue[ fieldName ] = v;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn fields;\r\n\t}\r\n\tformData(append = null, field = null, chain = [])\r\n\t{\r\n\t\tif(!append)\r\n\t\t{\r\n\t\t\tappend = new FormData();\r\n\t\t}\r\n\r\n\t\tif(!field)\r\n\t\t{\r\n\t\t\tfield = this;\r\n\t\t}\r\n\r\n\t\tlet parts = [];\r\n\t\t\r\n\t\tfor(let i in field.args.fields)\r\n\t\t{\r\n\r\n\t\t\tif(field.args.fields[i]\r\n\t\t\t\t&& field.args.fields[i].disabled\r\n\t\t\t){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet subchain = chain.slice(0);\r\n\r\n\t\t\tsubchain.push(i);\r\n\r\n\t\t\tif(field.args.fields[i]\r\n\t\t\t\t&& field.args.fields[i].hasChildren()\r\n\t\t\t){\r\n\t\t\t\tthis.formData(\r\n\t\t\t\t\tappend\r\n\t\t\t\t\t, field.args.fields[i]\r\n\t\t\t\t\t, subchain\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\telse if(field.args.fields[i])\r\n\t\t\t{\r\n\t\t\t\t// let fieldName = field.args.fields[i].args.name;\r\n\t\t\t\t\r\n\t\t\t\tlet fieldName = field.args.fields[i].getName();\r\n\r\n\t\t\t\tif(field.args.fields[i].args.type == 'file'\r\n\t\t\t\t\t&& field.args.fields[i].tags.input.element.files.length\r\n\t\t\t\t){\r\n\t\t\t\t\tif(field.args.fields[i].args.attrs.multiple)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet files = field.args.fields[i].tags.input.element.files;\r\n\r\n\t\t\t\t\t\tfor(let i = 0; i < files.length; i++)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tappend.append(fieldName + '[]', files[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tappend.append(\r\n\t\t\t\t\t\t\tfieldName\r\n\t\t\t\t\t\t\t, field.args.fields[i].tags.input.element.files[0]\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tappend.append(\r\n\t\t\t\t\t\tfieldName\r\n\t\t\t\t\t\t, field.args.fields[i].args.value === undefined\r\n\t\t\t\t\t\t\t? ''\r\n\t\t\t\t\t\t\t: field.args.fields[i].args.value\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn append;\r\n\t}\r\n\tqueryString(args = {})\r\n\t{\r\n\t\tlet parts = [];\r\n\t\t\r\n\t\tfor(let i in this.args.flatValue)\r\n\t\t{\r\n\t\t\targs[i] = args[i] || this.args.flatValue[i];\r\n\t\t}\r\n\r\n\t\tfor(let i in args)\r\n\t\t{\r\n\t\t\tparts.push(i + '=' + encodeURIComponent(args[i]));\r\n\t\t}\r\n\r\n\t\treturn parts.join('&');\r\n\t}\r\n\tpopulate(values)\r\n\t{\r\n\t\t// console.log(values);\r\n\r\n\t\tfor(let i in values)\r\n\t\t{\r\n\t\t\tthis.args.value[i] = values[i];\r\n\t\t}\r\n\t}\r\n\thasChildren()\r\n\t{\r\n\t\treturn !!Object.keys(this.args.fields).length;\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class HiddenField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.args.attrs.type = this.args.attrs.type || 'hidden';\r\n\t\tthis.template = `\r\n\t\t\t<label\r\n\t\t\t\tfor       = \"${this.args.name}\"\r\n\t\t\t\tdata-type = \"${this.args.attrs.type}\"\r\n\t\t\t\tstyle     = \"display:none\"\r\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\r\n\t\t\t\t<input\r\n\t\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\t\ttype    = \"${this.args.attrs.type}\"\r\n\t\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t\t<span cv-if = \"value\">[[[value]]]</span>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nexport class HtmlField extends View {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.ignore = this.args.attrs['data-cv-ignore'] || false;\r\n\t\tthis.args.contentEditable = this.args.attrs.contenteditable || false;\r\n\t\tthis.template = `<div\r\n\t\t\tname            = \"${this.args.name}\"\r\n\t\t\tcv-ref          = \"input:curvature/base/Tag\"\r\n\t\t\tcontenteditable = \"[[contentEditable]]\"\r\n\t\t>[[$value]]</div>`;\r\n\t}\r\n\thasChildren()\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\tdisable()\r\n\t{\r\n\t\tthis.args.disabled = 'disabled';\r\n\t}\r\n\tgetName()\r\n\t{\r\n\t\tif(this.tags.input)\r\n\t\t{\r\n\t\t\treturn this.tags.input.element.getAttribute('name');\r\n\t\t}\r\n\r\n\t\treturn this.args.name;\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class RadioField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label\r\n\t\t\t\tfor       = \"${this.args.name}\"\r\n\t\t\t\tdata-type = \"${this.args.attrs.type}\"\r\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\r\n\t\t\t\t<span cv-if = \"title\">\r\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<span\r\n\t\t\t\t\tcv-each  = \"options:option:optionText\"\r\n\t\t\t\t\tcv-carry = \"value\"\r\n\t\t\t\t\t--cv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t\t\t<label>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\t\t\ttype    = \"radio\"\r\n\t\t\t\t\t\t\tvalue   = \"[[option]]\"\r\n\t\t\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t\t[[optionText]]\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</span>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n\tgetLabel()\r\n\t{\r\n\t\tfor(let i in this.args.options)\r\n\t\t{\r\n\t\t\tif(this.args.options[i] == this.args.value)\r\n\t\t\t{\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class SelectField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label\r\n\t\t\t\tfor       = \"${this.args.name}\"\r\n\t\t\t\tdata-type = \"${this.args.attrs.type}\"\r\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\r\n\t\t\t\t<span cv-if = \"title\">\r\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<select\r\n\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\tcv-each = \"options:option:optionText\"\r\n\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t\t\t<option value = \"[[option]]\">[[optionText]]</option>\r\n\t\t\t\t</select>\r\n\t\t\t</label>\r\n\t\t`;\r\n\r\n\t\tthis.args.bindTo('value', (v,k,t,d,p)=>{\r\n\t\t\tconsole.log(this.args.name,v,p);\r\n\t\t});\r\n\t}\r\n\r\n\tpostRender(parentNode)\r\n\t{\r\n\t\tthis.onTimeout(0,()=>{\r\n\t\t\tlet tag = this.tags.input.element;\r\n\r\n\t\t\tfor(let i in tag.options)\r\n\t\t\t{\r\n\t\t\t\tlet option = tag.options[i];\r\n\r\n\t\t\t\tif(option.value == this.args.value)\r\n\t\t\t\t{\r\n\t\t\t\t\ttag.selectedIndex = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetLabel()\r\n\t{\r\n\t\tfor(let i in this.args.options)\r\n\t\t{\r\n\t\t\tif(this.args.options[i] == this.args.value)\r\n\t\t\t{\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class TextareaField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.args.attrs.type = this.args.attrs.type || 'hidden';\r\n\t\tthis.template = `\r\n\t\t\t<label\r\n\t\t\t\tfor       = \"${this.args.name}\"\r\n\t\t\t\tdata-type = \"${this.args.attrs.type}\"\r\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\r\n\t\t\t\t<span cv-if = \"title\">\r\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t></textarea>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { FormWrapper } from './FormWrapper';\nimport { HiddenField } from '../../form/HiddenField';\n\nexport class CreateForm extends FormWrapper\n{\n\tconstructor(args, path, method = 'GET', customFields = {})\n\t{\n\t\tsuper(\n\t\t\targs\n\t\t\t, path\n\t\t\t, 'POST'\n\t\t\t, customFields || {\n\t\t\t\t// title: HiddenField\n\t\t\t}\n\t\t);\n\n\t\tthis.creating = !!args.publicId;\n\t}\n\n\tonLoad(form)\n\t{\n\t\tfor(let i in form.args.fields)\n\t\t{\n\t\t\tif(!form.args.fields[i].tags.input)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(form.args.fields[i].args.attrs.type == 'hidden')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet element = form.args.fields[i].tags.input.element;\n\n\t\t\telement.focus();\n\n\t\t\tbreak;\n\t\t}\n\n\t\tsuper.onLoad(form);\n\t}\n\n\tonRequest()\n\t{\n\t\tthis.args.view.args.loading = true;\n\t\tthis.args.view.args.classes += ' loading';\n\n\t\treturn super.onRequest();\n\t}\n\n\tonResponse(response)\n\t{\n\t\tthis.args.view.args.loading = false;\n\t\tthis.args.view.args.classes = '';\n\n\t\tif(!this.args.wrapper)\n\t\t{\n\t\t\tthis.args.view.addRecord(response.body);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.args.wrapper.refresh(response.body);\n\t\t}\n\n\t\tthis.args.view.addButtonClicked();\n\n\t\tsuper.onResponse(response);\n\t}\n}\n","// import { BaseForm } from '../Ui/BaseForm';\n// import { HiddenField } from 'curvature/form/HiddenField';\n\n// export class Form extends BaseForm\n// {\n// \tconstructor(args, path, method = 'GET', customFields = {})\n// \t{\n// \t\tsuper(args, path, 'POST', customFields);\n\n// \t\tthis.creating = !!args.publicId;\n// \t}\n\n// \tonLoad(form)\n// \t{\n// \t\tfor(let i in form.args.fields)\n// \t\t{\n// \t\t\tif(!form.args.fields[i].tags.input)\n// \t\t\t{\n// \t\t\t\tcontinue;\n// \t\t\t}\n\n// \t\t\tif(form.args.fields[i].args.attrs.type == 'hidden')\n// \t\t\t{\n// \t\t\t\tcontinue;\n// \t\t\t}\n\n// \t\t\tlet element = form.args.fields[i].tags.input.element;\n\n// \t\t\telement.focus();\n\n// \t\t\tbreak;\n// \t\t}\n\n// \t\tsuper.onLoad(form);\n// \t}\n\n// \tonRequest()\n// \t{\n// \t\tthis.args.view.args.loading = true;\n// \t\tthis.args.view.args.classes += ' loading';\n\n// \t\treturn super.onRequest();\n// \t}\n\n// \tonResponse(response)\n// \t{\n// \t\tthis.args.view.args.loading = false;\n// \t\tthis.args.view.args.classes = '';\n\n// \t\tif(!this.args.wrapper)\n// \t\t{\n// \t\t\tthis.args.view.addRecord(response.body);\n// \t\t}\n// \t\telse\n// \t\t{\n// \t\t\tthis.args.wrapper.refresh(response.body);\n// \t\t}\n\n// \t\tthis.args.view.addButtonClicked();\n\n// \t\tsuper.onResponse(response);\n// \t}\n// }\n","import { Config     } from 'Config';\n\nimport { Repository } from '../../base/Repository';\nimport { Form       } from '../../form/Form';\nimport { Toast      } from '../../toast/Toast';\nimport { ToastAlert } from '../../toast/ToastAlert';\nimport { View       } from '../../base/View';\nimport { Router     } from '../../base/Router';\n\nexport class FormWrapper extends View\n{\n\tconstructor(args, path, method = 'GET', customFields = {})\n\t{\n\t\tsuper(args);\n\n\t\tthis.path         = path;\n\t\tthis.args.method  = method;\n\t\tthis.args.action  = this.args.action || null;\n\t\tthis.args.form    = null;\n\t\tthis.args.title   = null;\n\t\tthis.args.class   = '';\n\t\tthis.template     = `\n\t\t\t<div class = \"form constrict [[class]]\">\n\t\t\t\t<div cv-if = \"title\"><label>[[title]]</label></div>\n\t\t\t\t[[form]]\n\t\t\t</div>\n\t\t`;\n\n\t\tthis._onLoad     = [];\n\t\tthis._onSubmit   = [];\n\t\tthis._onRender   = [];\n\t\tthis._onRequest  = [];\n\t\tthis._onResponse = [];\n\n\t\tif(path instanceof Form)\n\t\t{\n\t\t\tthis.loadForm(form, customFields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tRepository.request(path).then(resp=>{\n\t\t\t\tif(!resp\n\t\t\t\t\t|| !resp.meta\n\t\t\t\t\t|| !resp.meta.form\n\t\t\t\t\t|| !(resp.meta.form instanceof Object)\n\t\t\t\t){\n\t\t\t\t\tconsole.log('Cannot render form with ', resp);\n\t\t\t\t\t// Router.go('/');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.loadForm(new Form(resp.meta.form, customFields));\n\n\t\t\t\tthis.onLoad(this.args.form, resp.body);\n\t\t\t});\n\t\t}\n\n\t}\n\n\tloadForm(form)\n\t{\n\t\tthis.args.form = form;\n\n\t\tthis.args.form.onSubmit((form, event)=>{\n\t\t\tif(this.onSubmit(form, event) === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(event)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\n\t\t\tlet formElement = form.tags.formTag.element;\n\t\t\tlet uri         = formElement.getAttribute('action') || this.args.action || this.path;\n\t\t\tlet method      = formElement.getAttribute('method') || this.args.method;\n\t\t\tlet query       = form.args.flatValue;\n\n\t\t\tmethod = method.toUpperCase();\n\n\t\t\t// console.log(method, uri);\n\n\t\t\tif(method == 'GET')\n\t\t\t{\n\t\t\t\tlet _query = {};\n\n\t\t\t\tif(this.args.content && this.args.content.args)\n\t\t\t\t{\n\t\t\t\t\tthis.args.content.args.page = 0;\n\t\t\t\t}\n\n\t\t\t\t_query.page = 0;\n\n\t\t\t\tfor(let i in query)\n\t\t\t\t{\n\t\t\t\t\tif(i === 'api')\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t_query[i] = query[i];\n\t\t\t\t}\n\n\t\t\t\tlet promises = this.onRequest(_query);\n\n\t\t\t\tpromises.then(()=>{\n\t\t\t\t\tthis.onResponse({});\n\n\t\t\t\t\tRouter.go(uri + '?' + Router.queryToString(_query));\n\n\t\t\t\t\tthis.update(_query);\n\t\t\t\t}).catch((error) => {\n\t\t\t\t\tthis.onRequestError(error);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if(method == 'POST')\n\t\t\t{\n\t\t\t\tlet formData = form.formData();\n\n\t\t\t\tfor (var pair of formData.entries())\n\t\t\t\t{\n\t\t\t\t\t// console.log(pair[0]+ ', ' + pair[1]);\n\t\t\t\t}\n\n\t\t\t\tlet promises = this.onRequest(formData);\n\n\t\t\t\tif(promises)\n\t\t\t\t{\n\t\t\t\t\tpromises.then(()=>{\n\t\t\t\t\t\tRepository.request(\n\t\t\t\t\t\t\turi\n\t\t\t\t\t\t\t, {api: 'json'}\n\t\t\t\t\t\t\t, formData\n\t\t\t\t\t\t).then((response) => {\n\t\t\t\t\t\t\tthis.onResponse(response);\n\t\t\t\t\t\t}).catch((error) => {\n\t\t\t\t\t\t\tthis.onRequestError(error);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonRequest(requestData)\n\t{\n\t\tlet promises = [];\n\n\t\tfor(let i in this._onRequest)\n\t\t{\n\t\t\tlet onReq = this._onRequest[i](requestData, this);\n\n\t\t\tif(onReq)\n\t\t\t{\n\t\t\t\tpromises.push(onReq);\n\t\t\t}\n\t\t}\n\n\t\tif(promises.length == 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tonRequestError(error)\n\t{\n\n\t}\n\n\tonResponse(response)\n\t{\n\t\tfor(let i in this._onResponse)\n\t\t{\n\t\t\tthis._onResponse[i](response, this);\n\t\t}\n\n\t\tif(response.messages)\n\t\t{\n\t\t\tfor(let i in response.messages)\n\t\t\t{\n\t\t\t\tToast.instance().alert(\n\t\t\t\t\tresponse.body && response.body.id\n\t\t\t\t\t\t? 'Success!'\n\t\t\t\t\t\t: 'Error!'\n\t\t\t\t\t, response.messages[i]\n\t\t\t\t\t, 3500\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tonLoad(form, model)\n\t{\n\t\tfor(let i in this._onLoad)\n\t\t{\n\t\t\tthis._onLoad[i](this, form, model);\n\t\t}\n\t}\n\n\tonSubmit(form, event)\n\t{\n\t\tfor(let i in this._onSubmit)\n\t\t{\n\t\t\tthis._onSubmit[i](this, event);\n\t\t}\n\t}\n\n\tpostRender()\n\t{\n\t\tfor(let i in this._onRender)\n\t\t{\n\t\t\tthis._onRender[i](this.args.form);\n\t\t}\n\t}\n\n\tcustomFields()\n\t{\n\t\treturn {};\n\t}\n\n\tsubmit()\n\t{\n\t\t// console.log(this);\n\t}\n}\n","import { Config      } from 'Config';\nimport { FormWrapper } from './FormWrapper';\nimport { HiddenField } from '../../form/HiddenField';\nimport { Repository  } from '../../base/Repository';\n\nexport class SearchForm extends FormWrapper\n{\n\tconstructor(args, path, method = 'GET', customFields = {})\n\t{\n\t\tsuper(\n\t\t\targs\n\t\t\t, path\n\t\t\t, 'POST'\n\t\t\t, {search: HiddenField}\n\t\t);\n\n\t\tthis.superTemplate = this.template;\n\n\t\tthis.args.records = [];\n\t\tthis.selected     = null;\n\n\t\tthis.template = `\n\t\t\t${this.superTemplate}\n\t\t\t<div cv-each = \"records:record:r\" class = \"dropdown-results\">\n\t\t\t\t<div\n\t\t\t\t\tcv-on         = \"click:select(event)\"\n\t\t\t\t\tdata-index    = \"[[r]]\"\n\t\t\t\t\tdata-publicId = \"[[record.publicId]]\"\n\t\t\t\t\tclass         = \"[[record.classes]]\"\n\t\t\t\t>\n\t\t\t\t\t[[record.title]]\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tonLoad(form)\n\t{\n\t\tfor(let i in form.args.fields)\n\t\t{\n\t\t\tif(!form.args.fields[i].tags.input)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(form.args.fields[i].args.attrs.type == 'hidden')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet element = form.args.fields[i].tags.input.element;\n\n\t\t\telement.focus();\n\n\t\t\tbreak;\n\t\t}\n\n\t\tform.args.flatValue.bindTo('keyword', (v)=>{\n\t\t\tthis.args.records = [];\n\t\t\tthis.selected     = null;\n\n\t\t\tif(!v)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.log(this.path, v);\n\n\t\t\tRepository.request(\n\t\t\t\tConfig.backend + this.path\n\t\t\t\t, {keyword: v}\n\t\t\t).then((response)=>{\n\t\t\t\tconsole.log(response.body);\n\t\t\t\tif(!response.body)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.args.records = response.body.map((r)=>{\n\t\t\t\t\tr.classes = '';\n\t\t\t\t\tif(r.title == v)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.classes = 'selected';\n\t\t\t\t\t\tthis.selected = r;\n\t\t\t\t\t}\n\t\t\t\t\treturn r;\n\t\t\t\t});\n\t\t\t});\n\t\t})\n\n\n\t\tsuper.onLoad(form);\n\t}\n\n\tonRequest()\n\t{\n\t\t// this.args.view.args.loading = true;\n\t\t// this.args.view.args.classes += ' loading';\n\n\t\treturn super.onRequest();\n\t}\n\n\tonResponse(response)\n\t{\n\t\t// this.args.view.args.loading = false;\n\t\t// this.args.view.args.classes = '';\n\n\t\t// if(!this.args.wrapper)\n\t\t// {\n\t\t// \tthis.args.view.addRecord(response.body);\n\t\t// }\n\t\t// else\n\t\t// {\n\t\t// \tthis.args.wrapper.refresh(response.body);\n\t\t// }\n\n\t\t// this.args.view.addButtonClicked();\n\n\t\tsuper.onResponse(response);\n\t}\n\n\tselect(event)\n\t{\n\t\tlet index    = event.target.getAttribute('data-index');\n\t\tlet publicId = event.target.getAttribute('data-publicId');\n\n\t\tlet record   = this.args.records[index];\n\n\t\tconsole.log(record);\n\n\t\tthis.args.view.addRecord(record);\n\t\tthis.args.view.addButtonClicked();\n\n\t\treturn;\n\n\t\tRepository.request(\n\t\t\tConfig.backend\n\t\t\t\t+ this.path\n\t\t\t\t+ '/'\n\t\t\t\t+ publicId\n\t\t).then((response)=>{\n\t\t\tconsole.log(response.body);\n\t\t\tif(!response.body)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.args.view.addRecord(response.body);\n\t\t\tthis.args.view.addButtonClicked();\n\t\t});\n\t}\n\n\tonSubmit(form, event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tif(this.selected)\n\t\t{\n\t\t\tthis.args.view.addRecord(this.selected);\n\t\t\tthis.args.view.addButtonClicked();\t\n\t\t}\n\t\treturn false;\n\t}\n}\n","import { Form        } from '../../form/Form';\nimport { FieldSet    } from '../../form/FieldSet';\nimport { CreateForm  } from './CreateForm';\nimport { SearchForm  } from './SearchForm';\nimport { FormWrapper } from './FormWrapper';\nimport { Wrapper     } from './Wrapper';\n// import { Loader     } from '../Ui/Loader';\n\nexport class View extends FieldSet\n{\n\tconstructor(values, form, parent, key)\n\t{\n\t\tsuper(values, form, parent, key);\n\n\t\tthis.args._fields = [];\n\n\t\tthis.dragging = false;\n\t\tthis.dropping = false;\n\t\t\n\t\tfor(let i in this.args.fields)\n\t\t{\n\t\t\tthis.args._fields[i] = this.wrapSubfield(this.args.fields[i]);\n\t\t}\n\n\t\tthis.args.fields[-1].disable();\n\n\t\tthis.args.creating  = '';\n\t\tthis.args.fieldType = '';\n\n\t\t// this.args.loader = new Loader;\n\t\t// this.args.loader = 'LOADING!!!';\n\t\tthis.args.loader = null;\n\n\t\tthis.args.createForm = this.args.createForm || '';\n\t\tthis.args.searchForm = this.args.searchForm || '';\n\n\t\tthis.setCreateForm({view: this});\n\n\t\tthis.template = `\n\t\t\t<label\n\t\t\t\tfor        = \"${this.args.name}\"\n\t\t\t\tdata-type  = \"${this.args.attrs.type}\"\n\t\t\t\tdata-multi = \"${this.args.attrs['data-multi'] ? 'true' : 'false'}\"\n\t\t\t>\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\n\t\t\t\t<fieldset\n\t\t\t\t\tname  = \"${this.args.name}\"\n\t\t\t\t\tclass = \"multi-field [[creating]] [[fieldType]]\"\n\t\t\t\t>\n\n\t\t\t\t\t<div class = \"record-list\" cv-each = \"_fields:field:f\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass     = \"single-record\"\n\t\t\t\t\t\t\tdata-for  = \"[[f]]\"\n\t\t\t\t\t\t\tdraggable = \"true\"\n\t\t\t\t\t\t\tcv-on     = \"\n\t\t\t\t\t\t\t\tdrop:drop(event);\n\t\t\t\t\t\t\t\tdragstart:drag(event);\n\t\t\t\t\t\t\t\tdragend:dragStop(event);\n\t\t\t\t\t\t\t\tdragover:dragOver(event);\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t[[field]]\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class = \"overlay create\">\n\t\t\t\t\t\t<div class = \"form constrict\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tcv-on = \"click:addButtonClicked(event)\"\n\t\t\t\t\t\t\t\tclass = \"bubble bottom left-margin close\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t&#215;\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t[[createForm]]\n\t\t\t\t\t\t[[searchForm]]\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class = \"overlay loading\">\n\t\t\t\t\t\t[[loader]]\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div cv-if = \"createFormReady\">\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tcv-on = \"click:addButtonClicked(event)\"\n\t\t\t\t\t\t\tclass = \"bubble bottom left-margin add\"\n\t\t\t\t\t\t>+</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t</fieldset>\n\n\t\t\t</label>\n\t\t`;\n\t}\n\n\tsetCreateForm(args)\n\t{\n\t\tthis.args.createForm = new CreateForm(\n\t\t\tObject.assign({}, args)\n\t\t\t, args.publicId\n\t\t\t\t? `${this.args.attrs['data-endpoint']}/${args.publicId}/edit`\n\t\t\t\t: `${this.args.attrs['data-endpoint']}/create`\n\t\t);\n\n\t\tthis.args.createForm._onLoad.push((wrap, form)=>{\n\t\t\tthis.args.createFormReady = true;\n\t\t});\n\n\t\tthis.args.searchForm = new SearchForm(\n\t\t\tObject.assign({}, args)\n\t\t\t, this.args.attrs['data-endpoint']\n\t\t);\n\t}\n\n\twrapSubfield(field)\n\t{\n\t\treturn new Wrapper({field, parent:this});\n\t}\n\n\taddButtonClicked()\n\t{\n\t\t// this.setCreateForm({view: this});\n\n\t\tthis.args.creating = this.args.creating ? '' : 'creating';\n\t}\n\n\taddRecord(record)\n\t{\n\t\tif(!Array.isArray(record))\n\t\t{\n\t\t\trecord = [record];\n\t\t}\n\n\t\tfor(let i in record)\n\t\t{\n\t\t\tlet fieldClass = this.args.fields[-1].constructor;\n\n\t\t\tlet skeleton   = Object.assign({}, this.args.fields[-1].skeleton);\n\t\t\tlet name       = Object.values(this.args.fields).length - 1;\n\n\t\t\tskeleton = this.cloneSkeleton(skeleton);\n\n\t\t\tskeleton = this.correctNames(skeleton, name);\n\n\t\t\tlet superSkeleton = {};\n\n\t\t\tsuperSkeleton[name + 1] = skeleton;\n\n\t\t\tlet newField = Form.renderFields(superSkeleton, this)[name + 1];\n\n\t\t\tthis.args.fields[name] = newField;\n\n\t\t\tlet newWrap = this.wrapSubfield(newField);\n\n\t\t\tnewField.args.value.id    = record[i].id    || '';\n\t\t\tnewField.args.value.class = record[i].class || '';\n\t\t\tnewField.args.value.title = record[i].title || '';\n\n\t\t\tthis.args._fields.push(newWrap);\n\n\t\t\tnewWrap.refresh(record[i]);\n\t\t}\n\n\t}\n\n\teditRecord(record, wrapper)\n\t{\n\t\tthis.setCreateForm({\n\t\t\tview: this\n\t\t\t, publicId: record.publicId\n\t\t\t, wrapper\n\t\t});\n\n\t\tthis.args.creating = this.args.creating ? '' : 'creating';\n\t}\n\n\tdeleteImage(index)\n\t{\n\t\tthis.args.fields[index].disable();\n\t\tthis.args._fields[index].args.classes = 'deleted';\n\t}\n\n\tundeleteImage(index)\n\t{\n\t\tthis.args.fields[index].enable();\n\t\t// console.log(this.args.fields[index]);\n\t\t// console.log(this.args._fields[index]);\n\t\t// console.log('===============');\n\n\t\tthis.args._fields[index].args.classes = '';\n\t}\n\n\tcloneSkeleton(object, level = 0)\n\t{\n\t\tlet _object = {};\n\n\t\tif(Array.isArray(object))\n\t\t{\n\t\t\t_object = [];\n\t\t}\n\n\t\tfor(let i in object)\n\t\t{\n\t\t\tif(i == 'fields')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(!object[i] || typeof object[i] !== 'object')\n\t\t\t{\n\t\t\t\t_object[i] = object[i];\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t_object[i] = Object.assign({}, this.cloneSkeleton(\n\t\t\t\tobject[i]\n\t\t\t\t, level+1\n\t\t\t));\n\t\t}\n\n\t\treturn _object;\n\t}\n\n\tcorrectNames(skeleton, id)\n\t{\n\t\tskeleton.name = skeleton.name.replace(\n\t\t\t/\\[-1\\]/\n\t\t\t, `[${id}]`\n\t\t);\n\n\t\tskeleton.attrs.name = skeleton.name;\n\n\t\tif('children' in skeleton)\n\t\t{\n\t\t\tfor(let i in skeleton.children)\n\t\t\t{\n\t\t\t\tskeleton.children[i] = this.correctNames(\n\t\t\t\t\tskeleton.children[i]\n\t\t\t\t\t, id\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn skeleton;\n\t}\n\n\tdrag(event)\n\t{\n\t\tthis.dragging = event.target;\n\t}\n\n\tdragOver(event)\n\t{\n\t\tif(!this.dragging)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet dropping = event.target;\n\n\t\twhile(dropping && !dropping.matches('[draggable=\"true\"]'))\n\t\t{\n\t\t\tdropping = dropping.parentNode;\n\t\t}\n\n\t\tif(dropping)\n\t\t{\n\t\t\tthis.dropping = dropping;\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tdrop(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tlet dragLabel = this.dragging.querySelector('label');\n\t\tlet dropLabel = this.dropping.querySelector('label');\n\n\t\tlet dragName = dragLabel.getAttribute('for');\n\t\tlet dropName = dropLabel.getAttribute('for');\n\n\t\tlet dragIndex = this.extractIndex(dragName);\n\t\tlet dropIndex = this.extractIndex(dropName);\n\n\t\tif(dragIndex == dropIndex || dragIndex == dropIndex - 1)\n\t\t{\n\t\t\tthis.dragging = false;\n\t\t\tthis.dropping = false;\n\t\t\treturn;\n\t\t}\n\n\t\tlet dragFields = dragLabel.querySelectorAll(\n\t\t\t'[name^=\"' + dragName + '\"]'\n\t\t);\n\t\tlet dragLabels = dragLabel.querySelectorAll(\n\t\t\t'[for^=\"' + dragName + '\"]'\n\t\t);\n\n\t\tlet dropFields = dropLabel.querySelectorAll(\n\t\t\t'[name^=\"' + dropName + '\"]'\n\t\t);\n\t\tlet dropLabels = dropLabel.querySelectorAll(\n\t\t\t'[for^=\"' + dropName + '\"]'\n\t\t);\n\n\t\tlet dropBefore = this.dropping;\n\n\t\tlet offset = 0;\n\n\t\tlet dragField, dropField;\n\n\t\tfor(let i in this.args.fields)\n\t\t{\n\t\t\tlet currentFieldSet = this.args.fields[i].tags.input.element;\n\t\t\tlet currentLabel    = this.args.fields[i].tags.label.element;\n\t\t\tlet currentName     = currentFieldSet.getAttribute('name');\n\n\t\t\tif(dragLabel == currentLabel)\n\t\t\t{\n\t\t\t\tdragField = this.args.fields[i];\n\t\t\t}\n\n\t\t\tif(dropLabel == currentLabel)\n\t\t\t{\n\t\t\t\tdropField = this.args.fields[i];\n\t\t\t}\n\n\t\t\tlet currentIndex    = this.extractIndex(currentName);\n\t\t\tlet newName         = false;\n\n\t\t\tif(currentIndex < 0)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(dragIndex > dropIndex\n\t\t\t\t&& currentIndex >= dropIndex\n\t\t\t\t&& currentIndex <= dragIndex\n\t\t\t){\n\t\t\t\tnewName = this.changeIndex(currentName, currentIndex + 1);\n\t\t\t\toffset = -1;\n\t\t\t}\n\t\t\telse if(\n\t\t\t\tdragIndex < dropIndex\n\t\t\t\t&& currentIndex <= dropIndex\n\t\t\t\t&& currentIndex >= dragIndex\n\t\t\t){\n\t\t\t\tnewName = this.changeIndex(currentName, currentIndex - 1);\n\t\t\t\toffset = 0;\n\t\t\t}\n\n\t\t\tif(newName !== false)\n\t\t\t{\n\t\t\t\tthis.changeAttributePrefix(\n\t\t\t\t\tcurrentLabel\n\t\t\t\t\t, 'for'\n\t\t\t\t\t, currentName\n\t\t\t\t\t, newName\n\t\t\t\t);\n\n\t\t\t\tthis.args.fields[i].args.fieldName = newName;\n\n\t\t\t\tthis.changeAttributePrefix(\n\t\t\t\t\tcurrentFieldSet\n\t\t\t\t\t, 'name'\n\t\t\t\t\t, currentName\n\t\t\t\t\t, newName\n\t\t\t\t);\n\n\t\t\t\tlet currentFields = currentFieldSet.parentNode.querySelectorAll(\n\t\t\t\t\t'[name^=\"' + currentName + '\"]'\n\t\t\t\t);\n\n\t\t\t\tfor(let i = 0; i < currentFields.length; i++)\n\t\t\t\t{\n\t\t\t\t\tthis.changeAttributePrefix(\n\t\t\t\t\t\tcurrentFields[i]\n\t\t\t\t\t\t, 'name'\n\t\t\t\t\t\t, currentName\n\t\t\t\t\t\t, newName\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tlet currentLabels = currentFieldSet.parentNode.querySelectorAll(\n\t\t\t\t\t'[for^=\"' + currentName + '\"]'\n\t\t\t\t);\n\n\t\t\t\tfor(let i = 0; i < currentLabels.length; i++)\n\t\t\t\t{\n\t\t\t\t\tthis.changeAttributePrefix(\n\t\t\t\t\t\tcurrentLabels[i]\n\t\t\t\t\t\t, 'for'\n\t\t\t\t\t\t, currentName\n\t\t\t\t\t\t, newName\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdragName = dragLabel.getAttribute('for');\n\t\tdropName = dropLabel.getAttribute('for');\n\n\t\tdragIndex = this.extractIndex(dragName);\n\t\tdropIndex = this.extractIndex(dropName);\n\n\t\tthis.changeAttributePrefix(\n\t\t\tdragLabel\n\t\t\t, 'for'\n\t\t\t, dragName\n\t\t\t, this.changeIndex(dragName, dropIndex + offset)\n\t\t);\n\n\t\tfor(let i =0; i < dragFields.length; i++)\n\t\t{\n\t\t\tthis.changeAttributePrefix(\n\t\t\t\tdragFields[i]\n\t\t\t\t, 'name'\n\t\t\t\t, dragName\n\t\t\t\t, this.changeIndex(dragName, dropIndex + offset)\n\t\t\t);\n\t\t}\n\n\t\tfor(let i =0; i < dragLabels.length; i++)\n\t\t{\n\t\t\tthis.changeAttributePrefix(\n\t\t\t\tdragLabels[i]\n\t\t\t\t, 'for'\n\t\t\t\t, dragName\n\t\t\t\t, this.changeIndex(dragName, dropIndex + offset)\n\t\t\t);\n\t\t}\n\n\t\tdragField.args.fieldName = dragLabel.getAttribute('for');\n\n\t\tthis.changeAttributePrefix(\n\t\t\tdropLabel\n\t\t\t, 'for'\n\t\t\t, dropName\n\t\t\t, this.changeIndex(dropName, (dropIndex + offset) + 1)\n\t\t);\n\n\t\tfor(let i =0; i < dropFields.length; i++)\n\t\t{\n\t\t\tthis.changeAttributePrefix(\n\t\t\t\tdropFields[i]\n\t\t\t\t, 'name'\n\t\t\t\t, dropName\n\t\t\t\t, this.changeIndex(dropName, (dropIndex + offset) + 1)\n\t\t\t);\n\t\t}\n\n\t\tfor(let i =0; i < dropLabels.length; i++)\n\t\t{\n\t\t\tthis.changeAttributePrefix(\n\t\t\t\tdropLabels[i]\n\t\t\t\t, 'for'\n\t\t\t\t, dropName\n\t\t\t\t, this.changeIndex(dropName, (dropIndex + offset) + 1)\n\t\t\t);\n\t\t}\n\n\t\tdropField.args.fieldName = dropLabel.getAttribute('for');\n\n\t\tthis.dragging.parentNode.insertBefore(\n\t\t\tthis.dragging, dropBefore\n\t\t);\n\n\t\tthis.dragging = false;\n\t\tthis.dropping = false;\n\t}\n\n\tdragStop()\n\t{\n\t\tthis.dragging = false;\n\t\tthis.dropping = false;\n\t}\n\n\tchangeAttributePrefix(node, attribute, oldPrefix, newPrefix)\n\t{\n\t\tlet oldName = node.getAttribute(attribute);\n\n\t\tlet newName = newPrefix\n\t\t\t+ node.getAttribute(attribute).substring(\n\t\t\t\toldPrefix.length\n\t\t\t);\n\n\t\tnode.setAttribute(attribute, newName);\n\t}\n\n\textractIndex(name)\n\t{\n\t\tlet groups;\n\n\t\tif(groups = /\\[(-?\\d+)\\]$/.exec(name))\n\t\t{\n\t\t\treturn parseInt(groups[1]);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tchangeIndex(name, index)\n\t{\n\t\tlet newName = name.replace(/\\[(-?\\d+)\\]$/, '[' + index + ']');\n\n\t\treturn newName;\n\t}\n\n\tcancel(event)\n\t{\n\t\tevent.stopPropagation();\n\t}\n}\n","import { Config     } from 'Config';\nimport { View       } from '../../base/View';\nimport { Repository } from '../../base/Repository';\n\nexport class Wrapper extends View\n{\n\tconstructor(args)\n\t{\n\t\tsuper(args);\n\n\t\tthis.template = `\n\t\t\t<div\n\t\t\t\tclass = \"wrapped-field [[classes]]\"\n\t\t\t\tcv-on = \"click:editRecord(event, key)\"\n\t\t\t\ttitle = \"[[fieldName]]: [[id]]\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tcv-on = \"click:deleteImage(event, key)\"\n\t\t\t\t\tstyle = \"display: inline; cursor:pointer;\"\n\t\t\t\t>\n\t\t\t\t\t[[icon]]\n\t\t\t\t</div>\n\t\t\t\t<div class = \"field-content\">\n\t\t\t\t\t[[title]]\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div style = \"display:none\">[[field]]</div>\n\t\t`;\n\n\t\tthis.args.field     = this.args.field || '!';\n\t\tthis.args.keyword   = '';\n\t\tthis.args.title     = '';\n\t\tthis.args.record    = {};\n\t\tthis.args.key       = this.args.field.key;\n\t\tthis.args.classes   = '';\n\t\tthis.args.icon      = '×';\n\t\tthis.deleted        = false;\n\t\t\n\n\t\tthis.args.field.args.bindTo('fieldName', (v)=>{\n\t\t\tthis.args.fieldName = v;\n\t\t});\n\n\t\tthis.args.fieldName = this.args.field.args.name;\n\n\t\tthis.args.id = this.args.field.args.value.id;\n\n\t\tthis.args.bindTo('id', (v)=>{\n\t\t\tthis.args.field.args.value.id = v;\n\t\t});\n\n\t\tthis.args.field.args.value.bindTo('id', (v)=>{\n\t\t\tif(!v)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tRepository.request(\n\t\t\t\tthis.backendPath()\n\t\t\t\t, {id: v}\n\t\t\t).then(response=>{\n\t\t\t\tthis.args.id = v;\n\n\t\t\t\tlet record = response.body[0];\n\n\t\t\t\tif(!record)\n\t\t\t\t{\n\t\t\t\t\tthis.args.publicId = null;\n\t\t\t\t\tthis.args.title    = null;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.refresh(record);\n\t\t\t});\n\t\t}, {wait: 0});\n\n\t\tthis.args.field.args.value.bindTo('keyword', (v)=>{\n\t\t\tthis.args.keyword = v;\n\t\t});\n\t}\n\n\teditRecord()\n\t{\n\t\tthis.args.parent.editRecord(\n\t\t\tthis.args.record\n\t\t\t, this\n\t\t);\n\t}\n\n\tdeleteImage(event, index)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif(!this.deleted)\n\t\t{\n\t\t\tthis.args.icon = '↺';\n\t\t\tthis.args.parent.deleteImage(index);\n\t\t\tthis.deleted = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.args.icon = '×';\n\t\t\tthis.args.parent.undeleteImage(index);\n\t\t\tthis.deleted = false;\n\t\t}\n\t}\n\n\tbackendPath()\n\t{\n\t\treturn Config.backend + this.args.parent.args.attrs['data-endpoint'];\n\t}\n\n\tgetRecordTitle(record)\n\t{\n\t\tif(record._titleField)\n\t\t{\n\t\t\treturn record[ record._titleField ];\n\t\t}\n\n\t\treturn record.title\n\t\t\t|| record.publicId\n\t\t\t|| record.id;\n\t}\n\n\trefresh(model)\n\t{\n\t\tfor(let i in model)\n\t\t{\n\t\t\tthis.args[i] = model[i];\n\t\t}\n\n\t\tthis.args.record = model;\n\n\t\tthis.args.title = this.getRecordTitle(model);\n\t}\n}\n","import { Bindable } from '../base/Bindable';\n\nexport class Keyboard\n{\n\tconstructor()\n\t{\n\t\tthis.maxDecay = 120;\n\n\t\tthis.listening = true;\n\n\t\tthis.keys  = Bindable.makeBindable({});\n\t\tthis.codes = Bindable.makeBindable({});\n\n\t\tdocument.addEventListener('keyup', (event) => {\n\t\t\tthis.keys[ event.key ]   = -1;\n\t\t\tthis.codes[ event.code ] = -1;\n\t\t});\n\n\t\tdocument.addEventListener('keydown', (event) => {\n\t\t\tif(this.keys[ event.key ] > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.keys[ event.key ]   = 1;\n\t\t\tthis.codes[ event.code ] = 1;\n\t\t});\n\n\t\twindow.addEventListener('blur', (event)=>{\n\t\t\tfor(let i in this.keys)\n\t\t\t{\n\t\t\t\tthis.keys[i] = -1;\n\t\t\t}\n\t\t\tfor(let i in this.codes)\n\t\t\t{\n\t\t\t\tthis.codes[i] = -1;\n\t\t\t}\n\t\t});\n\t}\n\n\tgetKey(key)\n\t{\n\t\tif(!this.keys[key])\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn this.keys[key];\n\t}\n\n\tgetKeyCode(code)\n\t{\n\t\tif(!this.codes[code])\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn this.codes[code];\n\t}\n\n\tupdate()\n\t{\n\t\tfor(var i in this.keys)\n\t\t{\n\t\t\tif(this.keys[i] > 0)\n\t\t\t{\n\t\t\t\tthis.keys[i]++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.keys[i]--;\n\n\t\t\t\tif(this.keys[i] < -this.maxDecay)\n\t\t\t\t{\n\t\t\t\t\tdelete this.keys[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(var i in this.codes)\n\t\t{\n\t\t\tif(this.codes[i] > 0)\n\t\t\t{\n\t\t\t\tthis.codes[i]++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.codes[i]--;\n\n\t\t\t\tif(this.codes[i] < -this.maxDecay)\n\t\t\t\t{\n\t\t\t\t\tdelete this.keys[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ScrollTag } from './ScrollTag';\nimport { Dom       } from '../base/Dom';\n\nexport class LazyTag extends ScrollTag\n{\n\tconstructor(element, parent, ref, index, direct)\n\t{\n\t\tsuper(element, parent, ref, index, direct);\n\n\t\tthis.element.classList.remove('cv-visible');\n\t\tthis.element.classList.add('cv-not-visible');\n\n\t\tthis.bindTo('visible', (v)=>{\n\t\t\tif(v)\n\t\t\t{\n\t\t\t\tif(this.afterScroll)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.afterScroll);\n\t\t\t\t}\n\t\t\t\tthis.afterScroll = setTimeout(\n\t\t\t\t\t()=>{\n\t\t\t\t\t\tif(!this.element)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.element.classList.add('cv-visible');\n\t\t\t\t\t\tthis.element.classList.remove('cv-not-visible');\n\n\t\t\t\t\t\tDom.mapTags(this.element, '[cv-lazy-style]', (tag) => {\n\t\t\t\t\t\t\tlet lazyStyle = tag.getAttribute('cv-lazy-style');\n\t\t\t\t\t\t\tlet style     = tag.getAttribute('style');\n\n\t\t\t\t\t\t\ttag.setAttribute('style', style + ';' + lazyStyle);\n\n\t\t\t\t\t\t\ttag.removeAttribute('cv-lazy-style');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t, (\n\t\t\t\t\t\t((this.offsetTop || this.element.offsetTop) * 0.5)\n\t\t\t\t\t\t+ ((this.element.offsetLeft) * 0.5)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n}\n","import { Bindable } from '../base/Bindable';\r\nimport { Dom      } from '../base/Dom';\r\nimport { Tag      } from '../base/Tag';\r\n\r\nexport class PopOutTag extends Tag\r\n{\r\n\tconstructor(element, parent, ref, index, direct)\r\n\t{\r\n\t\tsuper(element, parent, ref, index, direct);\r\n\r\n\t\tthis.poppedOut = false;\r\n\t\tthis.style     = element.getAttribute('style');\r\n\t\tthis.moving    = false;\r\n\r\n\t\tthis.hostSelector = this.element.getAttribute('cv-pop-to');\r\n\r\n\t\tthis.element.removeAttribute('cv-pop-to');\r\n\r\n\t\tthis.leftDuration   = 0;\r\n\t\tthis.topDuration    = 0;\r\n\t\tthis.rightDuration  = 0;\r\n\t\tthis.bottomDuration = 0;\r\n\r\n\t\tthis.verticalDuration   = 0;\r\n\t\tthis.horizontalDuration = 0;\r\n\r\n\t\tthis.unpoppedStyle  = '';\r\n\t\tthis.previousScroll = 0;\r\n\r\n\t\tthis.bodyStyle  = '';\r\n\t\tthis.bodyScroll = 0;\r\n\r\n\t\tthis.element.classList.add('unpopped');\r\n\r\n\t\tthis.scrollStyle;\r\n\r\n\t\tthis.popTimeout = null;\r\n\r\n\t\t// this.element.addEventListener('cvDomDetached', this.detachListener);\r\n\t\tthis.rect;\r\n\r\n\t\tthis.clickListener = (event) => {\r\n\t\t\tthis.rect = this.element.getBoundingClientRect();\r\n\t\t\t\r\n\t\t\tif(!this.poppedOut)\r\n\t\t\t{\r\n\t\t\t\tthis.distance = Math.sqrt(\r\n\t\t\t\t\tthis.rect.top ** 2\r\n\t\t\t\t\t+ this.rect.left ** 2\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst cut = element.getAttribute('data-pop-speed') || 1750;\r\n\r\n\t\t\t\tlet fromRight  = window.innerWidth  - this.rect.right;\r\n\t\t\t\tlet fromBottom = window.innerHeight - this.rect.bottom;\r\n\r\n\t\t\t\tlet horizontalAverage = (this.rect.left + fromRight)  / 2;\r\n\t\t\t\tlet vericalAverage    = (this.rect.top  + fromBottom) / 2;\r\n\r\n\t\t\t\tthis.horizontalDuration = horizontalAverage / cut;\r\n\t\t\t\tthis.verticalDuration   = vericalAverage / cut;\r\n\r\n\t\t\t\tif(this.horizontalDuration < 0.01)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.horizontalDuration = 0.01;\r\n\t\t\t\t}\r\n\t\t\t\tif(this.verticalDuration < 0.01)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.verticalDuration = 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.horizontalDuration > 0.4)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.horizontalDuration = 0.4;\r\n\t\t\t\t}\r\n\t\t\t\tif(this.verticalDuration > 0.4)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.verticalDuration = 0.4;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// console.log(this.horizontalDuration, this.verticalDuration);\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.element.contains(event.target))\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tif(this.moving)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.poppedOut)\r\n\t\t\t{\r\n\t\t\t\tthis.pop();\r\n\t\t\t}\r\n\t\t\telse if(event.target.matches('.closeButton') && this.poppedOut)\r\n\t\t\t{\r\n\t\t\t\tthis.unpop();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\r\n\t\tthis.escapeListener = (event) => {\r\n\t\t\t// console.log(event);\r\n\t\t\tif(event.key !== 'Escape')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.unpop();\r\n\t\t};\r\n\r\n\t\tif(!this.element.___clickListener___)\r\n\t\t{\r\n\t\t\tObject.defineProperty(this.element, '___scrollListeners___', {\r\n\t\t\t\tenumerable: false\r\n\t\t\t\t, writable: true\r\n\t\t\t});\r\n\r\n\t\t\tthis.element.___clickListener___ = this.clickListener;\r\n\t\t\tthis.element.___escapeListener___ = this.escapeListener;\r\n\r\n\t\t\tthis.element.addEventListener('click',  element.___clickListener___);\r\n\t\t\twindow.addEventListener('keyup',  element.___escapeListener___);\r\n\r\n\t\t\tthis.cleanup.push(((element)=>()=>{\r\n\t\t\t\telement.removeEventListener('click',  element.___clickListener___);\r\n\t\t\t\twindow.removeEventListener('keyup',  element.___escapeListener___);\r\n\t\t\t})(element));\r\n\t\t}\r\n\t}\r\n\r\n\tstatic popLevel()\r\n\t{\r\n\t\tif(!this.level)\r\n\t\t{\r\n\t\t\tthis.level = 0;\r\n\t\t}\r\n\r\n\t\tthis.level++;\r\n\r\n\t\treturn this.level;\r\n\t}\r\n\r\n\tstatic unpopLevel()\r\n\t{\r\n\t\tif(!this.level)\r\n\t\t{\r\n\t\t\tthis.level = 0;\r\n\t\t}\r\n\r\n\t\tthis.level--;\r\n\r\n\t\tif(this.level < 0)\r\n\t\t{\r\n\t\t\tthis.level = 0;\r\n\t\t}\r\n\r\n\t\treturn this.level;\r\n\t}\r\n\r\n\tpause(paused = true)\r\n\t{\r\n\t\tsuper.pause(paused);\r\n\r\n\t\tif(paused)\r\n\t\t{\r\n\t\t\tdocument.body.setAttribute('style', this.bodyStyle);\r\n\t\t\tdocument.body.setAttribute('style', '');\r\n\t\t}\r\n\t}\r\n\r\n\tpop()\r\n\t{\r\n\t\tPopOutTag.popLevel();\r\n\r\n\t\tthis.previousScroll = window.scrollY;\r\n\r\n\t\tthis.rect  = this.element.getBoundingClientRect();\r\n\t\tthis.style = this.element.getAttribute('style');\r\n\r\n\t\tlet hostTag = this.element;\r\n\r\n\t\t// console.log(hostTag);\r\n\r\n\t\twhile(hostTag.parentNode && !hostTag.matches(this.hostSelector))\r\n\t\t{\r\n\t\t\tif(hostTag.parentNode == document)\r\n\t\t\t{\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\thostTag = hostTag.parentNode;\r\n\t\t}\r\n\r\n\t\t// console.log(hostTag);\r\n\r\n\t\tlet hostRect = hostTag.getBoundingClientRect();\r\n\r\n\t\twindow.requestAnimationFrame(()=>{\r\n\r\n\t\t\tthis.unpoppedStyle = `\r\n\t\t\t\t;position:  fixed;\r\n\t\t\t\tleft:       ${this.rect.x}px;\r\n\t\t\t\ttop:        ${this.rect.y}px;\r\n\t\t\t\twidth:      ${this.rect.width}px;\r\n\t\t\t\theight:     ${this.rect.height}px;\r\n\t\t\t\tz-index:    99999;\r\n\t\t\t\ttransition: width ${this.horizontalDuration}s  ease-out\r\n\t\t\t\t\t\t\t, top ${this.verticalDuration}s    ease-out\r\n\t\t\t\t\t\t\t, left ${this.horizontalDuration}s ease-out\r\n\t\t\t\t\t\t\t, height ${this.verticalDuration}s ease-out\r\n\t\t\t\t\t\t\t, all ${this.horizontalDuration}s  ease-out;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t`;\r\n\r\n\t\t\tlet style = this.style + this.unpoppedStyle;\r\n\r\n\t\t\tthis.element.setAttribute('style', style);\r\n\r\n\t\t\twindow.requestAnimationFrame(()=>{\r\n\t\t\t\tstyle += `\r\n\t\t\t\t\t;left:      ${hostRect.x}px;\r\n\t\t\t\t\ttop:        ${hostRect.y}px;\r\n\t\t\t\t\twidth:      ${hostRect.width}px;\r\n\t\t\t\t\theight:     ${hostRect.height}px;\r\n\t\t\t\t\toverflow-y: auto;\r\n\t\t\t\t\ttransition: width ${this.horizontalDuration}s ease-out\r\n\t\t\t\t\t\t, top ${this.verticalDuration}s           ease-out\r\n\t\t\t\t\t\t, left ${this.horizontalDuration}s        ease-out\r\n\t\t\t\t\t\t, height ${this.verticalDuration}s        ease-out\r\n\t\t\t\t\t\t, all ${this.horizontalDuration}s         ease-out;\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tthis.moving = true;\r\n\r\n\t\t\t\tthis.element.setAttribute('style', style);\r\n\t\t\t\tthis.element.classList.add('popped');\r\n\t\t\t\tthis.element.classList.remove('unpopped');\r\n\t\t\t\t\r\n\t\t\t\tthis.popTimeout = setTimeout(()=>{\r\n\t\t\t\t\tif(!this.element)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.bodyStyle = document.body.getAttribute('style');\r\n\t\t\t\t\t\r\n\t\t\t\t\tdocument.body.setAttribute('style', 'height:100%;overflow:hidden;');\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.moving = false;\r\n\t\t\t\t\tDom.mapTags(this.element, false, (tag)=>{\r\n\t\t\t\t\t\tlet event = new CustomEvent('cvPopped');\r\n\r\n\t\t\t\t\t\ttag.dispatchEvent(event);\r\n\r\n\t\t\t\t\t\tthis.scrollStyle = this.element.getAttribute('style');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tlet event = new CustomEvent('cvPop', {\r\n\t\t\t\t\t\tbubbles: true\r\n\t\t\t\t\t\t, detail: {\r\n\t\t\t\t\t\t\ttag: this\r\n\t\t\t\t\t\t\t, view: this.parent\r\n\t\t\t\t\t\t\t, publicId: this.parent.args.publicId\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.element.dispatchEvent(event);\r\n\r\n\t\t\t\t}, this.horizontalDuration*1000);\r\n\t\t\t});\r\n\r\n\t\t\tthis.poppedOut = true;\r\n\t\t});\r\n\t}\r\n\r\n\tunpop()\r\n\t{\r\n\t\tthis.element.classList.add('unpopping');\r\n\r\n\t\tif(this.popTimeout)\r\n\t\t{\r\n\t\t\tclearTimeout(this.popTimeout);\r\n\t\t}\r\n\r\n\t\tif(PopOutTag.level == 0)\r\n\t\t{\r\n\t\t\tdocument.body.setAttribute('style', '');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tdocument.body.setAttribute('style', this.bodyStyle || '');\r\n\t\t}\r\n\r\n\t\tPopOutTag.unpopLevel();\r\n\r\n\t\tif(!this.rect)\r\n\t\t{\r\n\t\t\tthis.rect = this.element.getBoundingClientRect();\r\n\t\t}\r\n\r\n\t\twindow.scrollTo(0,this.previousScroll);\r\n\r\n\t\tlet style = this.style\r\n\t\t\t+ this.unpoppedStyle\r\n\t\t\t+ `;transition: width ${this.horizontalDuration}s ease-in\r\n\t\t\t\t\t, height ${this.verticalDuration}s        ease-in\r\n\t\t\t\t\t, all ${this.horizontalDuration}s         ease-in;`;\r\n\r\n\t\tthis.element.setAttribute('style', style);\r\n\r\n\t\tthis.moving = true;\r\n\r\n\t\tsetTimeout(()=>{\r\n\t\t\tif(!this.element)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.element.classList.remove('popped');\r\n\r\n\t\t}, this.horizontalDuration*1000);\r\n\t\tsetTimeout(()=>{\r\n\t\t\tthis.element.classList.add('unpopped');\r\n\t\t\tthis.element.classList.remove('unpopping');\r\n\t\t\tif(!this.element)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.element.setAttribute('style', this.style);\r\n\t\t\tthis.moving = false;\r\n\t\t\tDom.mapTags(this.element, false, (tag)=>{\r\n\t\t\t\tlet event = new CustomEvent('cvUnpopped');\r\n\r\n\t\t\t\ttag.dispatchEvent(event);\r\n\t\t\t});\r\n\t\t\tlet event = new CustomEvent('cvUnpop', {\r\n\t\t\t\tbubbles: true\r\n\t\t\t\t, detail: {\r\n\t\t\t\t\ttag: this\r\n\t\t\t\t\t, view: this.parent\r\n\t\t\t\t\t, publicId: this.parent.args.publicId\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.element.dispatchEvent(event);\r\n\t\t}, this.horizontalDuration*1000);\r\n\r\n\t\tthis.poppedOut = false;\r\n\t}\r\n\r\n\tremove()\r\n\t{\r\n\t\tdocument.body.setAttribute('style', this.bodyStyle);\r\n\t\tsuper.remove();\r\n\t}\r\n}\r\n","import { Tag      } from '../base/Tag';\r\nimport { Dom      } from '../base/Dom';\r\nimport { Bindable } from '../base/Bindable';\r\n\r\nexport class ScrollTag extends Tag\r\n{\r\n\tconstructor(element, parent, ref, index, direct)\r\n\t{\r\n\t\tsuper(element, parent, ref, index, direct);\r\n\r\n\t\tthis.visible         = false;\r\n\t\tthis.offsetTop       = false;\r\n\t\tthis.offsetBottom    = false;\r\n\r\n\t\tthis.attachListener = (e) => {\r\n\t\t\tlet rootNode = e.target;\r\n\r\n\t\t\twhile(rootNode.parentNode)\r\n\t\t\t{\r\n\t\t\t\trootNode = rootNode.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif(rootNode !== window && rootNode !== document)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(e.target !== element)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.addScrollListener(e.target);\r\n\t\t\tthis.addResizeListener(e.target);\r\n\r\n\t\t\tthis.scrolled(e.target);\r\n\r\n\t\t\te.target.removeEventListener(\r\n\t\t\t\t'cvDomAttached'\r\n\t\t\t\t, this.attachListener\r\n\t\t\t);\r\n\t\t};\r\n\r\n\t\tthis.element.addEventListener(\r\n\t\t\t'cvDomAttached'\r\n\t\t\t, this.attachListener\r\n\t\t);\r\n\r\n\t\tthis.cleanup.push(((element) => () => {\r\n\t\t\telement.removeEventListener(\r\n\t\t\t\t'cvDomAttached'\r\n\t\t\t\t, this.attachListener\r\n\t\t\t);\r\n\t\t})(this.element));\r\n\r\n\t\tthis.bindTo('visible', (v) => {\r\n\t\t\tlet scrolledEvent;\r\n\r\n\t\t\tif(v)\r\n\t\t\t{\r\n\t\t\t\tscrolledEvent = new Event('cvScrolledIn');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tscrolledEvent = new Event('cvScrolledOut');\r\n\t\t\t}\r\n\r\n\t\t\tDom.mapTags(this.element, false, (node) => {\r\n\t\t\t\tnode.dispatchEvent(scrolledEvent);\r\n\t\t\t});\r\n\r\n\t\t\tthis.element.dispatchEvent(scrolledEvent);\r\n\t\t});\r\n\r\n\t\tthis.bindTo('offsetTop', (v) => {\r\n\t\t\tlet scrolledEvent = new CustomEvent('cvScrolled', {\r\n\t\t\t\tdetail: {offset: v}\r\n\t\t\t});\r\n\t\t\tDom.mapTags(this.element, false, (node) => {\r\n\t\t\t\tnode.dispatchEvent(scrolledEvent);\r\n\t\t\t});\r\n\r\n\t\t\tthis.element.dispatchEvent(scrolledEvent);\r\n\t\t});\r\n\t}\r\n\r\n\tscrolled(scroller)\r\n\t{\r\n\t\tlet current = this.element;\r\n\r\n\t\tif(!current)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet offsetTop         = 0\r\n\t\t\t, offsetBottom    = 0;\r\n\r\n\t\tlet visible = false;\r\n\r\n\t\tlet rect = current.getBoundingClientRect();\r\n\r\n\t\tif(rect.bottom > 0 && rect.top < window.innerHeight)\r\n\t\t{\r\n\t\t\tvisible = true;\r\n\t\t}\r\n\r\n\t\tthis.proxy.visible      = visible;\r\n\t\tthis.proxy.offsetTop    = rect.top    || 0;\r\n\t\tthis.proxy.offsetBottom = rect.bottom || 0;\r\n\t}\r\n\r\n\taddScrollListener(tag)\r\n\t{\r\n\t\tif(!tag.___scrollListener___)\r\n\t\t{\r\n\t\t\tObject.defineProperty(tag, '___scrollListener___', {\r\n\t\t\t\tenumerable: false\r\n\t\t\t\t, writable: true\r\n\t\t\t});\r\n\r\n\t\t\ttag.___scrollListener___ = (event) => {\r\n\t\t\t\tthis.scrolled(event.target);\r\n\t\t\t};\r\n\r\n\t\t\tlet node = tag;\r\n\t\t\tlet options = {passive: true, capture: true};\r\n\r\n\t\t\twhile(node.parentNode)\r\n\t\t\t{\r\n\t\t\t\tnode = node.parentNode;\r\n\r\n\t\t\t\tnode.addEventListener(\r\n\t\t\t\t\t'scroll'\r\n\t\t\t\t\t, tag.___scrollListener___\r\n\t\t\t\t\t, options\r\n\t\t\t\t);\r\n\r\n\t\t\t\tthis.direct.cleanup.push(((node, tag, options)=>()=>{\r\n\t\t\t\t\tnode.removeEventListener(\r\n\t\t\t\t\t\t'scroll'\r\n\t\t\t\t\t\t, tag.___scrollListener___\r\n\t\t\t\t\t\t, options\r\n\t\t\t\t\t);\r\n\t\t\t\t\ttag = node = null;\r\n\t\t\t\t})(node, tag, options));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\taddResizeListener(tag)\r\n\t{\r\n\t\tif(!tag.___resizeListener___)\r\n\t\t{\r\n\t\t\tObject.defineProperty(tag, '___resizeListener___', {\r\n\t\t\t\tenumerable: false\r\n\t\t\t\t, writable: true\r\n\t\t\t});\r\n\r\n\t\t\ttag.___resizeListener___ = (event)=>{\r\n\t\t\t\tthis.scrolled(event.target);\r\n\t\t\t};\r\n\r\n\t\t\twindow.addEventListener('resize', this.resizeListener);\r\n\r\n\t\t\tthis.direct.cleanup.push(((element)=>()=>{\r\n\t\t\t\twindow.removeEventListener('resize', element.___resizeListener___);\r\n\t\t\t\ttag.___resizeListener___ = null;\r\n\t\t\t\ttag = null;\r\n\t\t\t})(tag));\r\n\t\t}\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nimport { ToastAlert } from './ToastAlert';\r\n\r\nexport class Toast extends View {\r\n\tstatic instance() {\r\n\t\tif(!this.inst) {\r\n\t\t\tthis.inst = new this();\r\n\t\t}\r\n\t\treturn this.inst;\r\n\t}\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.template = `\r\n\t\t\t<div id = \"[[_id]]\" cv-each = \"alerts:alert\" class = \"toast\">\r\n\t\t\t\t[[alert]]\r\n\t\t\t</div>\r\n\t\t`;\r\n\t\t// this.style = {\r\n\t\t// \t'': {\r\n\t\t// \t\tposition:   'fixed'\r\n\t\t// \t\t, top:      '0px'\r\n\t\t// \t\t, right:    '0px'\r\n\t\t// \t\t, padding:  '8px'\r\n\t\t// \t\t, 'z-index':'999999'\r\n\t\t// \t\t, display:  'flex'\r\n\t\t// \t\t, 'flex-direction': 'column-reverse'\r\n\t\t// \t}\r\n\t\t// };\r\n\t\t\r\n\t\tthis.args.alerts = [];\r\n\r\n\t\t// this.args.alerts.bindTo((v) => { console.log(v) });\r\n\t}\r\n\tpop(alert) {\r\n\t\tlet index = this.args.alerts.length;\r\n\r\n\t\tthis.args.alerts.push(alert);\r\n\r\n\t\talert.decay(((alert)=>()=>{\r\n\t\t\tfor(let i in this.args.alerts)\r\n\t\t\t{\r\n\t\t\t\tif(this.args.alerts[i].___ref___ === alert.___ref___)\r\n\t\t\t\t{\r\n\t\t\t\t\talert.remove();\r\n\t\t\t\t\tdelete this.args.alerts[i];\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})(alert));\r\n\t}\r\n\talert(title, body, time) {\r\n\t\treturn this.pop(new ToastAlert({\r\n\t\t\ttitle: title\r\n\t\t\t, body: body\r\n\t\t\t, time: time\r\n\t\t}));\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nexport class ToastAlert extends View {\r\n\tconstructor(args) {\r\n\t\tsuper(args);\r\n\t\tthis.args.time    = this.args.time || 10000;\r\n\t\tthis.init         = this.args.time;\r\n\t\tthis.args.opacity = 1;\r\n\t\tthis.args.title   = this.args.title || 'Standard alert';\r\n\t\tthis.args.body    = this.args.body  || 'This is a standard alert.';\r\n\t\tthis.template     = `\r\n\t\t\t<div id = \"[[_id]]\" style = \"opacity:[[opacity]]\" class = \"alert\">\r\n\t\t\t\t<h3>[[title]]</h3>\r\n\t\t\t\t<p>[[body]]</p>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\tdecay(complete) {\r\n\t\tlet decayInterval = 16;\r\n\t\tlet decay = setInterval(\r\n\t\t\t()=>{\r\n\t\t\t\tif(this.args.time > 0) {\r\n\t\t\t\t\tthis.args.time -= decayInterval;\r\n\t\t\t\t\tthis.args.opacity = this.args.time / this.init;\r\n\r\n\t\t\t\t\tif(this.args.time <= 0) {\r\n\t\t\t\t\t\tif(complete) {\r\n\t\t\t\t\t\t\tcomplete();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tclearInterval(decay);\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t, decayInterval\r\n\t\t);\r\n\t}\r\n}\r\n"]}