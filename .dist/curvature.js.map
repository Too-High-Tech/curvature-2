{"version":3,"sources":["app/Config.js","app/Curvature.js","app/access/LoginView.js","app/access/UserRepository.js","app/base/Bindable.js","app/base/Cache.js","app/base/Cookie.js","app/base/Dom.js","app/base/Repository.js","app/base/Router.js","app/base/Tag.js","app/base/Theme.js","app/base/View.js","app/base/ViewList.js","app/form/ButtonField.js","app/form/Field.js","app/form/FieldSet.js","app/form/FileField.js","app/form/Form.js","app/form/HiddenField.js","app/form/HtmlField.js","app/form/SelectField.js","app/tag/PopOutTag.js","app/tag/ScrollTag.js","app/toast/Toast.js","app/toast/ToastAlert.js"],"names":["Config","base","Bindable","Cache","Cookie","Dom","Repository","Router","Tag","Theme","View","access","LoginView","UserRepository","form","ButtonField","Field","FieldSet","FileField","Form","HiddenField","HtmlField","SelectField","tag","PopOutTag","ScrollTag","toast","Toast","ToastAlert","template","event","console","log","preventDefault","fbWindow","window","open","backend","userCheck","clearInterval","onInterval","getCurrentUser","then","response","user","body","id","clearCache","instance","pop","title","username","publicId","time","logoutWindow","refresh","request","uri","object","isBindable","Node","Object","defineProperty","enumerable","writable","binding","bindingAll","bindTo","property","callback","push","i","stack","stackTime","before","after","setCount","toString","JSON","stringify","makeBindable","set","target","key","value","stop","warnOn","del","undefined","Array","isArray","splice","get","newFunc","executing","unshift","Date","getTime","ret","apply","arguments","execTime","shift","ref","Proxy","deleteProperty","expiry","bucket","expiration","defaultvalue","name","jar","location","href","substr","document","cookie","split","map","c","parse","error","decodeURIComponent","v","k","t","d","cookieString","encodeURIComponent","doc","selector","startNode","endNode","result","started","ended","treeWalker","createTreeWalker","NodeFilter","SHOW_ALL","acceptNode","node","FILTER_SKIP","Element","matches","FILTER_ACCEPT","nextNode","currentNode","dispatchEvent","mapTags","objects","args","content","Promise","resolve","skeleton","post","cache","type","queryString","formData","queryArgs","api","keys","arg","join","fullUri","postString","FormData","append","xhr","XMLHttpRequest","tagCacheSelector","tagCache","querySelector","tagCacheContent","innerText","withCredentials","timeout","xhrId","xhrs","length","reject","onreadystatechange","DONE","OK","readyState","status","responseText","code","prerendering","createElement","appendChild","setAttribute","setRequestHeader","send","abort","xhrList","mainView","addEventListener","match","pathname","go","route","silent","history","pushState","Event","path","view","forceRefresh","current","routes","query","URLSearchParams","search","pair","load","pause","update","L1","L2","j","argName","groups","exec","Error","store","parts","finalArgs","fresh","queryOver","queryToString","element","parent","index","proxy","cleanup","clearBindings","firstChild","removeChild","views","single","list","model","modelClass","_modelClass","class","content_type","_id","uuid","firstNode","lastNode","nodes","frames","timeouts","intervals","attach","detach","eventCleanup","viewList","viewLists","tags","timestamp","requestAnimationFrame","wrappedCallback","fired","setTimeout","created","paused","setInterval","clearTimeout","parentNode","insertPoint","detachEvent","bubbles","attachEvent","insertBefore","subDoc","createRange","createContextualFragment","prerenderAttr","getAttribute","eachAttr","carryAttr","removeAttribute","subTemplate","innerHTML","carryProps","eachProp","asProp","keyProp","remove","ViewList","render","subArgs","withAttr","LinkAttr","linkClick","eventListener","removeEventListener","action","String","a","eventName","replace","callbackName","argList","s","trim","eventMethod","argRefs","outerHTML","bindArg","tagName","toLowerCase","checked","inputListener","regex","nodeType","TEXT_NODE","original","nodeValue","interpolatable","header","bindProperty","unsafeHtml","staticPrefix","substring","staticNode","createTextNode","dynamicNode","staticSuffix","ELEMENT_NODE","attributes","attribute","bindProperties","segments","refAttr","refProp","refClassname","refKey","refClass","stringToClass","refKeyVal","mapIfTags","bind","createComment","newNode","postRender","ifProperty","inverted","ifDoc","moveTag","prepend","str","crypto","getRandomValues","Uint8Array","refClassSplit","refShortClassname","require","subProperty","keyProperty","reRender","finalViews","found","viewArgs","appendOnly","values","attrs","buttonClick","valueString","ignore","setting","fields","renderFields","children","flatValue","method","_method","classes","_classes","_onSubmit","field","contentEditable","contenteditable","options","poppedOut","style","moving","leftDuration","unpoppedStyle","previousScroll","classList","add","scrollStyle","rect","clickListener","getBoundingClientRect","contains","stopPropagation","scrollY","x","y","width","height","overflow","overflowY","popLevel","scrollTo","unpopLevel","level","topEdge","resizeListening","visible","offsetTop","offsetBottom","threshold","subscribedTo","scrollListener","scrollSubTags","scrolled","resizeListenr","resizeTags","attachListener","e","addScrollListener","addResizeListener","scrolledEvent","CustomEvent","detail","offset","scroller","subOffsetTop","subOffsetBottom","scrollTop","clientHeight","offsetParent","bottomEdge","resizeListener","inst","alerts","alert","decay","init","opacity","complete","decayInterval"],"mappings":"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","file":".dist/curvature.js","sourcesContent":["export class Config {}\n","'use strict'\n\nimport { Bindable   } from 'base/Bindable';\nimport { Cache      } from 'base/Cache';\nimport { Cookie     } from 'base/Cookie';\nimport { Dom        } from 'base/Dom';\nimport { Repository } from 'base/Repository';\nimport { Router     } from 'base/Router';\nimport { Tag        } from 'base/Tag';\nimport { Theme      } from 'base/Theme';\nimport { View       } from 'base/View';\n\nimport { LoginView }      from 'access/LoginView';\nimport { UserRepository } from 'access/UserRepository';\n\nimport { ButtonField } from 'form/ButtonField';\nimport { Field       } from 'form/Field';\nimport { FieldSet    } from 'form/FieldSet';\nimport { FileField   } from 'form/FileField';\nimport { Form        } from 'form/Form';\nimport { HiddenField } from 'form/HiddenField';\nimport { HtmlField   } from 'form/HtmlField';\nimport { SelectField } from 'form/SelectField';\n\nimport { PopOutTag } from 'tag/PopOutTag';\nimport { ScrollTag } from 'tag/ScrollTag';\n\nimport { Toast      } from 'toast/Toast';\nimport { ToastAlert } from 'toast/ToastAlert';\n\nlet base = {\n\tBindable\n\t, Cache\n\t, Cookie\n\t, Dom\n\t, Repository\n\t, Router\n\t, Tag\n\t, Theme\n\t, View\n}\n\nlet access = {\n\tLoginView\n\t, UserRepository\n};\n\nlet form = {\n\tButtonField\n\t, Field\n\t, FieldSet\n\t, FileField\n\t, Form\n\t, HiddenField\n\t, HtmlField\n\t, SelectField\n};\n\nlet tag = {\n\tPopOutTag\n\t, ScrollTag\n};\n\nlet toast = {\n\tToast\n\t, ToastAlert\n};\n\nexport { base, access, form, tag, toast };","import { Config         } from 'Config';\r\n\r\nimport { View           } from '../base/View';\r\nimport { Router         } from '../base/Router';\r\nimport { Repository     } from '../base/Repository';\r\n\r\nimport { UserRepository } from './UserRepository';\r\n\r\nimport { Toast      } from '../toast/Toast';\r\nimport { ToastAlert } from '../toast/ToastAlert';\r\n\r\nexport class LoginView extends View{\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.template = `\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t\r\n\t\t\t<a cv-link = \"user\">User</a>\r\n\t\t\t<br />\r\n\t\t\t\r\n\t\t\t<a cv-link = \"user/login\">Login</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<a cv-link = \"user/register\">Register</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<a cv-link = \"user/logout\">Logout</a>\r\n\t\t\t<br />\r\n\r\n\t\t\t<input\r\n\t\t\t\ttype  = \"button\"\r\n\t\t\t\tvalue = \"Login via FaceBook\"\r\n\t\t\t \tcv-on = \"click:facebookLogin(event)\"\r\n\t\t\t />\r\n\t\t\t <input\r\n\t\t\t\ttype  = \"button\"\r\n\t\t\t\tvalue = \"Log Out\"\r\n\t\t\t \tcv-on = \"click:logout(event)\"\r\n\t\t\t />\r\n\t\t`;\r\n\t}\r\n\tfacebookLogin(event) {\r\n\t\tconsole.log('fb!')\r\n\t\tevent.preventDefault();\r\n\t\tlet fbWindow = window.open(\r\n\t\t\tConfig.backend\r\n\t\t\t\t+ '/facebookLogin'\r\n\t\t);\r\n\r\n\t\tif(this.userCheck)\r\n\t\t{\r\n\t\t\tthis.clearInterval(this.userCheck);\r\n\t\t}\r\n\r\n\t\tthis.userCheck = this.onInterval(333, () => {\r\n\t\t\tUserRepository.getCurrentUser(true).then((response) => {\r\n\t\t\t\tlet user = response.body;\r\n\t\t\t\tif(!user.id || !user)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.clearInterval(this.userCheck);\r\n\r\n\t\t\t\tRouter.clearCache();\r\n\t\t\t\tRepository.clearCache();\r\n\r\n\t\t\t\tToast.instance().pop(new ToastAlert({\r\n\t\t\t\t\ttitle: 'Logged in as ' + user.username\r\n\t\t\t\t\t, body: 'ID: '  + user.publicId\r\n\t\t\t\t\t, time: 2400\r\n\t\t\t\t}));\r\n\r\n\t\t\t\t// history.go(-1);\r\n\r\n\t\t\t\t// Router.instance().updateView(this, this.routes, true);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tlogout(event) {\r\n\t\tlet logoutWindow = window.open(\r\n\t\t\tConfig.backend\r\n\t\t\t\t+ '/user/logout?page=app%3Fclose%3D1'\r\n\t\t);\r\n\t}\r\n}\r\n\r\n","import { Config     } from 'Config';\r\nimport { Repository } from '../base/Repository';\r\n\r\nexport class UserRepository extends Repository {\r\n\tstatic get uri() { return Config.backend + '/user/'; }\r\n\tstatic getCurrentUser(refresh) {\r\n\t\treturn this.request(\r\n\t\t\tthis.uri + 'current'\r\n\t\t\t, false, false, false\r\n\t\t).then((user) => {\r\n\t\t\treturn user;\r\n\t\t});\r\n\t}\r\n\tstatic logout() {\r\n\t\treturn this.request(\r\n\t\t\tthis.uri + 'logout'\r\n\t\t\t, false, {}, false\r\n\t\t).then((user) => {\r\n\t\t\treturn user;\r\n\t\t});\r\n\t}\r\n}","export class Bindable {\r\n\tstatic isBindable(object)\r\n\t{\r\n\t\tif(!object.isBindable)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn object.isBindable === Bindable;\r\n\t}\r\n\tstatic makeBindable(object) {\r\n\r\n\t\tif(!object\r\n\t\t\t|| object.isBindable\r\n\t\t\t|| typeof object !== 'object'\r\n\t\t\t|| object instanceof Node\r\n\t\t) {\r\n\t\t\treturn object;\r\n\t\t}\r\n\r\n\t\tObject.defineProperty(object, 'ref', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'bindTo', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'binding', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'bindingAll', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'isBindable', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'executing', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'stack', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'stackTime', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'before', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'after', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'toString', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(object, 'setCount', {\r\n\t\t\tenumerable: false\r\n\t\t\t, writable: true\r\n\t\t});\r\n\r\n\t\tobject.isBindable = Bindable;\r\n\t\tobject.binding    = {};\r\n\t\tobject.bindingAll = [];\r\n\t\tobject.bindTo     = ((object) => (property, callback = null) => {\r\n\t\t\tif(callback == null) {\r\n\t\t\t\tcallback = property;\r\n\t\t\t\tobject.bindingAll.push(callback);\r\n\t\t\t\tfor(let i in object) {\r\n\t\t\t\t\tcallback(object[i], i, object, false);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!object.binding[property]) {\r\n\t\t\t\tobject.binding[property] = [];\r\n\t\t\t}\r\n\r\n\t\t\tobject.binding[property].push(callback);\r\n\r\n\t\t\tcallback(object[property], property, object, false);\r\n\r\n\t\t})(object);\r\n\r\n\t\tobject.stack      = [];\r\n\t\tobject.stackTime  = [];\r\n\t\tobject.before     = [];\r\n\t\tobject.after      = [];\r\n\t\tobject.setCount   = {};\r\n\r\n\t\tobject.toString = ((object) => () => {\r\n\t\t\tif(typeof object == 'object')\r\n\t\t\t{\r\n\t\t\t\treturn JSON.stringify(object);\r\n\t\t\t\treturn '[object]'\r\n\t\t\t}\r\n\r\n\t\t\treturn object;\r\n\t\t})(object);\r\n\r\n\t\tfor(let i in object)\r\n\t\t{\r\n\t\t\tif(object[i]\r\n\t\t\t\t&& typeof object[i] == 'object'\r\n\t\t\t\t&& !object[i] instanceof Node\r\n\t\t\t){\r\n\t\t\t\tobject[i] = Bindable.makeBindable(object[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet set = ((object) => (target, key, value) =>\r\n\t\t{\r\n\t\t\tif(target[key] === value && typeof value !== object)\r\n\t\t\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(`Setting ${key}`, value);\r\n\r\n\t\t\tif(value && typeof value == 'object' && !(value instanceof Node))\r\n\t\t\t{\r\n\t\t\t\tif(value.isBindable !== Bindable)\r\n\t\t\t\t{\r\n\t\t\t\t\tvalue = Bindable.makeBindable(value);\r\n\r\n\t\t\t\t\tfor(let i in value)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(value[i] && typeof value[i] == 'object')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue[i] = Bindable.makeBindable(value[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in object.bindingAll)\r\n\t\t\t{\r\n\t\t\t\tobject.bindingAll[i](value, key, target, false);\r\n\t\t\t}\r\n\r\n\t\t\tlet stop = false;\r\n\r\n\t\t\tif(key in object.binding) {\r\n\t\t\t\tfor(let i in object.binding[key])\r\n\t\t\t\t{\r\n\t\t\t\t\tif(object.binding[key][i](value, key, target, false) === false)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstop = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!stop)\r\n\t\t\t{\r\n\t\t\t\ttarget[key] = value;\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif(!target.setCount[key])\r\n\t\t\t{\r\n\t\t\t\ttarget.setCount[key] = 0;\r\n\t\t\t}\r\n\r\n\t\t\ttarget.setCount[key]++;\r\n\r\n\t\t\tconst warnOn = 10;\r\n\r\n\t\t\tif(target.setCount[key] > warnOn && value instanceof Object)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t'Warning: Resetting bindable reference \"'\r\n\t\t\t\t\t\t+ key\r\n\t\t\t\t\t\t+ '\" to object '\r\n\t\t\t\t\t\t+ target.setCount[key]\r\n\t\t\t\t\t\t+ ' times.'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t})(object);\r\n\r\n\t\tlet del = ((object) => (target, key) => {\r\n\t\t\t// console.log(key, 'DEL');\r\n\r\n\t\t\tif(!(key in target)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in object.bindingAll) {\r\n\t\t\t\tobject.bindingAll[i](undefined, key, target, true);\r\n\t\t\t}\r\n\r\n\t\t\tif(key in object.binding) {\r\n\t\t\t\tfor(let i in object.binding[key]) {\r\n\t\t\t\t\tobject.binding[key][i](undefined, key, target, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(Array.isArray(target)) {\r\n\t\t\t\ttarget.splice(key, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdelete target[key];\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t})(object);\r\n\r\n\t\tlet get = ((object) => (target, key) =>\r\n\t\t{\r\n\t\t\tif(typeof target[key] == 'function')\r\n\t\t\t{\r\n\t\t\t\tlet newFunc = function() {\r\n\t\t\t\t\ttarget.executing = key;\r\n\r\n\t\t\t\t\ttarget.stack.unshift(key);\r\n\t\t\t\t\ttarget.stackTime.unshift((new Date).getTime());\r\n\r\n\t\t\t\t\t// console.log(`Start ${key}()`);\r\n\r\n\t\t\t\t\tfor(let i in target.before)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttarget.before[i](target, key, object);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet ret = target[key].apply(target, arguments);\r\n\r\n\t\t\t\t\tfor(let i in target.after)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttarget.after[i](target, key, object);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttarget.executing = null;\r\n\r\n\t\t\t\t\tlet execTime = (new Date).getTime() - target.stackTime[0];\r\n\r\n\t\t\t\t\tif(execTime > 150)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// console.log(`End ${key}(), took ${execTime} ms`);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttarget.stack.shift();\r\n\t\t\t\t\ttarget.stackTime.shift();\r\n\r\n\t\t\t\t\treturn ret;\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn newFunc;\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(`Getting ${key}`);\r\n\r\n\t\t\treturn target[key];\r\n\t\t})(object);\r\n\r\n\t\tobject.ref = new Proxy(object, {\r\n\t\t\tdeleteProperty: del\r\n\t\t\t, get:          get\r\n\t\t\t, set:          set\r\n\t\t});\r\n\r\n\t\treturn object.ref;\r\n\t}\r\n\tstatic clearBindings(object)\r\n\t{\r\n\t\tobject.binding = {};\r\n\t}\r\n}","export class Cache\r\n{\r\n\tstatic store(key, value, expiry, bucket = 'standard')\r\n\t{\r\n\t\tlet expiration = (expiry * 1000) + (new Date).getTime();\r\n\r\n\t\t// console.log(\r\n\t\t// \t`Caching ${key} until ${expiration} in ${bucket}.`\r\n\t\t// \t, value\r\n\t\t// \t, this.bucket\r\n\t\t// );\r\n\r\n\t\tif(!this.bucket)\r\n\t\t{\r\n\t\t\tthis.bucket = {};\r\n\t\t}\r\n\r\n\t\tif(!this.bucket[bucket])\r\n\t\t{\r\n\t\t\tthis.bucket[bucket]\t= {};\r\n\t\t}\r\n\r\n\t\tthis.bucket[bucket][key] = {expiration, value};\r\n\t}\r\n\r\n\tstatic load(key, defaultvalue = false, bucket = 'standard')\r\n\t{\r\n\t\t// console.log(\r\n\t\t// \t`Checking cache for ${key} in ${bucket}.`\r\n\t\t// \t, this.bucket\r\n\t\t// );\r\n\r\n\t\tif(this.bucket && this.bucket[bucket] && this.bucket[bucket][key])\r\n\t\t{\r\n\t\t\t// console.log(this.bucket[bucket][key].expiration, (new Date).getTime());\r\n\t\t\tif(this.bucket[bucket][key].expiration > (new Date).getTime())\r\n\t\t\t{\r\n\t\t\t\treturn this.bucket[bucket][key].value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn defaultvalue;\r\n\t}\r\n}","import { Bindable } from './Bindable';\n\nexport class Cookie\n{\n\tstatic set(name, value)\n\t{\n\t\tCookie.jar[name] = value;\n\t}\n\n\tstatic get(name)\n\t{\n\t\treturn Cookie.jar[name];\n\t}\n\n\tstatic delete(name)\n\t{\n\t\tdelete Cookie.jar[name];\n\t}\n};\n\nCookie.jar = Cookie.jar || Bindable.makeBindable({});\n\nif(window.location.href.substr(0,4) !== 'data')\n{\n\tdocument.cookie.split(';').map(c => {\n\t\tlet [key, value] = c.split('=');\n\n\t\ttry\n\t\t{\n\t\t\tvalue = JSON.parse(value);\n\t\t}\n\t\tcatch(error)\n\t\t{\n\t\t\tvalue = value;\n\t\t}\n\n\t\tCookie.jar[decodeURIComponent(key)] = value;\n\t});\n\n\tCookie.jar.bindTo((v,k,t,d) => {\n\t\tt[k] = v;\n\n\t\tif(d)\n\t\t{\n\t\t\tt[k] = null;\n\t\t}\n\t\t\n\t\tconst cookieString = `${encodeURIComponent(k)}=${JSON.stringify(t[k])}`;\n\t\tdocument.cookie = cookieString;\n\t});\n}\n","export class Dom\r\n{\r\n\tstatic mapTags(doc, selector, callback, startNode, endNode)\r\n\t{\r\n\t\tlet result = [];\r\n\r\n\t\tlet started = true;\r\n\r\n\t\tif(startNode)\r\n\t\t{\r\n\t\t\tstarted = false;\r\n\t\t}\r\n\r\n\t\tlet ended = false;\r\n\r\n\t\tvar treeWalker = document.createTreeWalker(\r\n\t\t\tdoc,\r\n\t\t\tNodeFilter.SHOW_ALL,\r\n\t\t\t{\r\n\t\t\t\tacceptNode: (node) => {\r\n\t\t\t\t\tif(!started)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(node === startNode)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tstarted = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(endNode && node === endNode)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tended = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(ended)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(selector)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// console.log(selector, node, !!(node instanceof Element));\r\n\t\t\t\t\t\tif(node instanceof Element)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(node.matches(selector))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfalse\r\n\t\t);\r\n\r\n\t\twhile(treeWalker.nextNode())\r\n\t\t{\r\n\t\t\tresult.push(callback(treeWalker.currentNode));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\tstatic dispatchEvent(doc, event)\r\n\t{\r\n\t\tdoc.dispatchEvent(event);\r\n\r\n\t\tDom.mapTags(doc, false, (node) => {\r\n\t\t\tnode.dispatchEvent(event);\r\n\t\t});\r\n\t}\r\n}","import { Cookie } from './Cookie';\r\n\r\nvar objects = {};\r\n\r\nexport class Repository\r\n{\r\n\tstatic get xhrs() { return this.xhrList = this.xhrList || [];   }\r\n\r\n\tstatic loadPage(args = {}, refresh = false) {\r\n\t\treturn this.request(this.uri, args).then((response) => {\r\n\t\t\treturn response;\r\n\t\t\t// return response.map((skeleton) => new Model(skeleton));\r\n\t\t});\r\n\t}\r\n\tstatic domCache(uri, content)\r\n\t{\r\n\t\tconsole.log(uri, content);\r\n\r\n\r\n\t}\r\n\tstatic load(id, refresh = false) {\r\n\t\tthis.objects           = this.objects           || {};\r\n\t\tthis.objects[this.uri] = this.objects[this.uri] || {};\r\n\r\n\t\tif(this.objects[this.uri][id]) {\r\n\t\t\treturn Promise.resolve(this.objects[this.uri][id]);\r\n\t\t}\r\n\r\n\t\treturn this.request(this.uri + '/' + id).then((response) => {\r\n\t\t\t// let model = new Model(response);\r\n\t\t\t// return this.objects[this.uri][id] = model;\r\n\t\t});\r\n\t}\r\n\tstatic form(id = null) {\r\n\t\tlet uri = this.uri + '/' + 'create';\r\n\t\tif(id) {\r\n\t\t\turi = this.uri + '/' + id + '/edit';\r\n\t\t}\r\n\t\treturn this.request(uri).then((skeleton) => {\r\n\t\t\treturn skeleton;\r\n\t\t});\r\n\t}\r\n\tstatic clearCache() {\r\n\t\tif(this.objects && this.objects[this.uri]) {\r\n\t\t\tthis.objects[this.uri] = {};\r\n\t\t}\r\n\t}\r\n\tstatic request(uri, args = null, post = null, cache = true) {\r\n\t\tlet type = 'GET';\r\n\t\tlet queryString = '';\r\n\t\tlet formData = null;\r\n\t\tlet queryArgs   = {};\r\n\r\n\t\tif(args) {\r\n\t\t\tqueryArgs   = args;\r\n\t\t}\r\n\r\n\t\tqueryArgs.api   = queryArgs.api || 'json';\r\n\r\n\t\tqueryString = Object.keys(queryArgs).map((arg) => {\r\n\t\t\treturn encodeURIComponent(arg)\r\n\t\t\t+ '='\r\n\t\t\t+ encodeURIComponent(queryArgs[arg])\r\n\t\t}).join('&');\r\n\r\n\t\tlet fullUri    = uri;\r\n\t\tlet postString = '';\r\n\r\n\t\tif(post) {\r\n\t\t\tcache = false;\r\n\t\t\ttype = 'POST';\r\n\t\t\tformData = new FormData();\r\n\t\t\tfor(let i in post) {\r\n\t\t\t\tformData.append(i, post[i]);\r\n\t\t\t}\r\n\t\t\tpostString = Object.keys(post).map((arg) => {\r\n\t\t\t\treturn encodeURIComponent(arg)\r\n\t\t\t\t+ '='\r\n\t\t\t\t+ encodeURIComponent(post[arg])\r\n\t\t\t}).join('&');\r\n\t\t}\r\n\r\n\t\tfullUri = uri + '?' + queryString;\r\n\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\r\n\t\tif(!post && cache && this.cache && this.cache[fullUri]) {\r\n\t\t\treturn Promise.resolve(this.cache[fullUri]);\r\n\t\t}\r\n\r\n\t\tlet tagCacheSelector = 'script[data-uri=\"'\r\n\t\t\t+ fullUri\r\n\t\t\t+ '\"]';\r\n\r\n\t\tlet tagCache = document.querySelector(tagCacheSelector);\r\n\r\n\t\tif(!post && cache && tagCache) {\r\n\t\t\tlet tagCacheContent = JSON.parse(tagCache.innerText);\r\n\t\t\t\r\n\t\t\treturn Promise.resolve(tagCacheContent);\r\n\t\t}\r\n\r\n\t\txhr.withCredentials = true;\r\n\t\txhr.timeout         = 15000;\r\n\r\n\t\tlet xhrId = this.xhrs.length;\r\n\r\n\t\tif(!post) {\r\n\t\t\tthis.xhrs.push(xhr);\r\n\t\t}\r\n\r\n\t\treturn new Promise(((xhrId) => (resolve, reject) => {\r\n\t\t\txhr.onreadystatechange = () => {\r\n\t\t\t\tlet DONE = 4;\r\n\t\t\t\tlet OK = 200;\r\n\r\n\t\t\t\tlet response;\r\n\r\n\t\t\t\tif (xhr.readyState === DONE) {\r\n\r\n\t\t\t\t\tif(!this.cache) {\r\n\t\t\t\t\t\tthis.cache = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (xhr.status === OK) {\r\n\r\n\t\t\t\t\t\tif(response = JSON.parse(xhr.responseText)) {\r\n\t\t\t\t\t\t\tif(response.code == 0) {\r\n\t\t\t\t\t\t\t\t// Repository.lastResponse = response;\r\n\r\n\t\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\t\tthis.cache[fullUri] = response;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet tagCache = document.querySelector(\r\n\t\t\t\t\t\t\t\t\t'script[data-uri=\"'\r\n\t\t\t\t\t\t\t\t\t+ fullUri\r\n\t\t\t\t\t\t\t\t\t+ '\"]'\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\tlet prerendering  = Cookie.get('prerenderer');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconsole.log(prerendering);\r\n\r\n\t\t\t\t\t\t\t\tif(prerendering)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tif(!tagCache)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttagCache  = document.createElement('script');\r\n\t\t\t\t\t\t\t\t\t\tdocument.querySelector('head').appendChild(tagCache);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\ttagCache.type = 'text/json';\r\n\t\t\t\t\t\t\t\t\ttagCache.setAttribute('data-uri', fullUri);\r\n\t\t\t\t\t\t\t\t\ttagCache.innerText = JSON.stringify(response);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tresolve(response);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\t\tthis.cache[fullUri] = response;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\treject(response);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Repository.lastResponse = xhr.responseText;\r\n\r\n\t\t\t\t\t\t\tif(!post && cache) {\r\n\t\t\t\t\t\t\t\tthis.cache[fullUri] = xhr.responseText;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tresolve(xhr.responseText);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treject('HTTP' + xhr.status);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.xhrs[xhrId] = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(type, fullUri);\r\n\r\n\t\t\tif(post)\r\n\t\t\t{\r\n\t\t\t\txhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n\t\t\t}\r\n\t\t\txhr.send(postString);\r\n\t\t})(xhrId));\r\n\t}\r\n\tstatic cancel() {\r\n\t\tfor(var i in this.xhrs) {\r\n\t\t\tif(!this.xhrs[i]) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.xhrs[i].abort();\r\n\t\t}\r\n\t\tthis.xhrList = [];\r\n\t}\r\n}\r\n\r\n// Repository.lastResponse = null;","import { View  }   from './View';\r\nimport { Cache }   from './Cache';\r\n\r\nexport class Router {\r\n\tstatic listen(mainView)\r\n\t{\r\n\t\twindow.addEventListener(\r\n\t\t\t'popstate'\r\n\t\t\t, (event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\t//this.route(location.pathname);\r\n\t\t\t\t// console.log(location.pathname);\r\n\r\n\t\t\t\tthis.match(location.pathname, mainView);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.go(location.pathname);\r\n\t}\r\n\tstatic go(route, silent)\r\n\t{\r\n\t\tif(location.pathname !== route) {\r\n\t\t\thistory.pushState(null, null, route);\r\n\t\t}\r\n\t\tif(!silent)\r\n\t\t{\r\n\t\t\twindow.dispatchEvent(new Event('popstate'));\t\t\t\r\n\t\t}\r\n\t}\r\n\tstatic match(path, view, forceRefresh = false)\r\n\t{\r\n\t\tlet current = view.args.content;\r\n\t\tlet routes  = view.routes;\r\n\r\n\t\tthis.path   = path;\r\n\t\tthis.query  = {};\r\n\r\n\t\tlet query   = new URLSearchParams(window.location.search);\r\n\r\n\t\tthis.queryString = window.location.search;\r\n\r\n\t\tfor(let pair of query) { \r\n\t\t\tthis.query[ pair[0] ] = pair[1]; \r\n\t\t}\r\n\r\n\t\tforceRefresh = true;\r\n\r\n\t\tlet result;\r\n\r\n\t\tif(!forceRefresh && (result = Cache.load(this.path, false, 'page')))\r\n\t\t{\r\n\t\t\t// console.log('Using cache!');\r\n\r\n\t\t\tview.args.content.pause(true);\r\n\r\n\t\t\tview.args.content = result;\r\n\r\n\t\t\tresult.pause(false);\r\n\r\n\t\t\tresult.update(this.query);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tpath = path.substr(1).split('/');\r\n\r\n\t\t// console.log(path, routes);\r\n\r\n\t\tlet args = {};\r\n\t\tfor(let i in this.query)\r\n\t\t{\r\n\t\t\targs[i] = this.query[i];\r\n\t\t}\r\n\r\n\t\tL1: for(let i in routes) {\r\n\t\t\tlet route = i.split('/');\r\n\t\t\tif(route.length < path.length)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tL2: for(let j in route)\r\n\t\t\t{\r\n\t\t\t\tif(route[j].substr(0, 1) == '%') {\r\n\t\t\t\t\tlet argName = null;\r\n\t\t\t\t\tlet groups  = /^%(\\w+)\\??/.exec(route[j]);\r\n\t\t\t\t\tif(groups && groups[1]) {\r\n\t\t\t\t\t\targName = groups[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!argName) {\r\n\t\t\t\t\t\tthrow new Error(`${route[j]} is not a valid argument segment in route \"${i}\"`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!path[j]) {\r\n\t\t\t\t\t\tif(route[j].substr(route[j].length - 1, 1) == '?') {\r\n\t\t\t\t\t\t\targs[ argName ] = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tcontinue L1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\targs[ argName ] = path[j];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if(path[j] !== route[j]) {\r\n\t\t\t\t\tcontinue L1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof routes[i] !== 'function') {\r\n\t\t\t\treturn routes[i];\r\n\t\t\t}\r\n\r\n\t\t\tif(!forceRefresh\r\n\t\t\t\t&& current\r\n\t\t\t\t&& current instanceof routes[i]\r\n\t\t\t\t&& current.update(args)\r\n\t\t\t) {\r\n\t\t\t\tview.args.content = current;\r\n\t\t\t}\r\n\r\n\t\t\tlet result = routes[i];\r\n\r\n\t\t\tif(routes[i] instanceof Object)\r\n\t\t\t{\r\n\t\t\t\tresult = new routes[i](args);\r\n\t\t\t}\r\n\r\n\t\t\tif(result instanceof View)\r\n\t\t\t{\r\n\t\t\t\tresult.pause(false);\r\n\t\t\t}\r\n\r\n\t\t\tresult.update(args, forceRefresh);\r\n\r\n\t\t\tif(view.args.content instanceof View)\r\n\t\t\t{\r\n\t\t\t\tview.args.content.pause(true);\r\n\t\t\t}\t\t\t\r\n\r\n\t\t\tCache.store(this.path, result, 3600, 'page');\r\n\r\n\t\t\tview.args.content = result;\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif(routes && routes[false])\r\n\t\t{\r\n\t\t\tif(!forceRefresh\r\n\t\t\t\t&& current\r\n\t\t\t\t&& current instanceof routes[false]\r\n\t\t\t\t// && current.update(args)\r\n\t\t\t) {\r\n\t\t\t\tview.args.content = current;\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof routes[false] !== 'function') {\r\n\t\t\t\tview.args.content = routes[false];\r\n\t\t\t}\r\n\r\n\t\t\tlet result = routes[false];\r\n\r\n\t\t\tif(routes[false] instanceof Object)\r\n\t\t\t{\r\n\t\t\t\tresult = new routes[false](args);\r\n\t\t\t}\r\n\r\n\t\t\t// result.update(args, forceRefresh);\r\n\r\n\t\t\tif(view.args.content instanceof View)\r\n\t\t\t{\r\n\t\t\t\tview.args.content.pause(true);\r\n\r\n\t\t\t\tview.args.content = result;\r\n\r\n\t\t\t\tview.args.content.pause(false);\r\n\t\t\t}\r\n\r\n\t\t\tCache.store(this.path, result, 3600, 'page');\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\tstatic clearCache() {\r\n\t\t// this.cache = {};\r\n\t}\r\n\tstatic queryOver(args = {})\r\n\t{\r\n\t\tlet parts = [], finalArgs = {};\r\n\r\n\t\tfor(let i in this.query)\r\n\t\t{\r\n\t\t\tfinalArgs[i] = this.query[i];\r\n\t\t}\r\n\r\n\t\tfor(let i in args)\r\n\t\t{\r\n\t\t\tfinalArgs[i] = args[i];\r\n\t\t}\r\n\r\n\t\tdelete finalArgs['api'];\r\n\r\n\t\treturn finalArgs;\r\n\t}\r\n\tstatic queryToString(args = {}, fresh = false)\r\n\t{\r\n\t\tlet parts = [], finalArgs = args;\r\n\r\n\t\tif(!fresh)\r\n\t\t{\r\n\t\t\tfinalArgs = this.queryOver(args);\r\n\t\t}\r\n\t\t\r\n\t\tfor(let i in finalArgs)\r\n\t\t{\r\n\t\t\tif(finalArgs[i] === '')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tparts.push(i + '=' + encodeURIComponent(finalArgs[i]));\r\n\t\t}\r\n\r\n\t\treturn parts.join('&');\r\n\t}\r\n\tstatic setQuery(name, value, silent)\r\n\t{\r\n\t\tlet args = {};\r\n\r\n\t\targs[name] = value;\r\n\t\t\r\n\t\tthis.go(\r\n\t\t\tthis.path\r\n\t\t\t\t+ '?'\r\n\t\t\t\t+ this.queryToString(args)\r\n\t\t\t, silent\r\n\t\t);\r\n\t}\r\n}\r\n","import { Bindable } from './Bindable';\r\nexport class Tag\r\n{\r\n\tconstructor(element, parent, ref, index)\r\n\t{\r\n\t\tthis.element = Bindable.makeBindable(element);\r\n\t\tthis.parent  = parent;\r\n\t\tthis.ref     = ref;\r\n\t\tthis.index   = index;\r\n\r\n\t\tthis.proxy   = Bindable.makeBindable(this)\r\n\t\tthis.cleanup = [];\r\n\r\n\t\treturn this.proxy;\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tlet cleanup;\r\n\r\n\t\twhile(cleanup = this.cleanup.shift())\r\n\t\t{\r\n\t\t\tcleanup();\r\n\t\t}\r\n\r\n\t\tBindable.clearBindings(this);\r\n\t}\r\n\tclear()\r\n\t{\r\n\t\twhile(this.element.firstChild)\r\n\t\t{\r\n\t\t\tthis.element.removeChild(this.element.firstChild);\r\n\t\t}\r\n\t}\r\n}","export class Theme\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.views = {\r\n\t\t\t'SeanMorris\\\\TheWhtRbt\\\\Location' : {\r\n\t\t\t\tsingle: 'twr9/LocationPreview'\r\n\t\t\t\t, list: 'twr9/LocationList'\r\n\t\t\t}\r\n\t\t\t, 'SeanMorris\\\\TheWhtRbt\\\\Image' : {\r\n\t\t\t\tsingle: 'DetailView'\r\n\t\t\t\t, list: 'DetailListView'\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tresolve(model)\r\n\t{\r\n\t\tlet modelClass;\r\n\r\n\t\tif(Array.isArray(model))\r\n\t\t{\r\n\t\t\tfor(let i in model)\r\n\t\t\t{\r\n\t\t\t\tlet _modelClass = model[i].class || model[i].content_type;\r\n\r\n\t\t\t\tif(modelClass && modelClass !== _modelClass)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Model list mismatch!');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmodelClass = _modelClass;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.views[modelClass])\r\n\t\t\t{\r\n\t\t\t\tif(this.views[modelClass].list)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.views[modelClass].list;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.views[modelClass];\r\n\t\t\t}\r\n\r\n\t\t\treturn 'DetailListView';\r\n\t\t}\r\n\t\telse if(model)\r\n\t\t{\r\n\t\t\tmodelClass = model.class || model.content_type;\r\n\r\n\t\t\tif(this.views[modelClass])\r\n\t\t\t{\r\n\t\t\t\tif(this.views[modelClass].single)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.views[modelClass].single;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.views[modelClass];\r\n\t\t\t}\r\n\r\n\t\t\treturn 'DetailView';\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n","import { Bindable } from './Bindable';\r\nimport { ViewList } from './ViewList';\r\nimport { Router   } from './Router';\r\nimport { Cookie   } from './Cookie';\r\nimport { Dom      } from './Dom';\r\nimport { Tag      } from './Tag';\r\n\r\nexport class View\r\n{\r\n\tconstructor(args = {})\r\n\t{\r\n\t\tthis.args      = Bindable.makeBindable(args);\r\n\t\tthis._id       = this.uuid();\r\n\t\tthis.args._id  = this._id;\r\n\t\tthis.template  = ``;\r\n\t\tthis.parent    = null;\r\n\r\n\t\tthis.firstNode = null;\r\n\t\tthis.lastNode  = null;\r\n\t\tthis.nodes     = null;\r\n\r\n\t\tthis.frames    = [];\r\n\t\tthis.timeouts  = [];\r\n\t\tthis.intervals = [];\r\n\r\n\t\tthis.cleanup   = [];\r\n\r\n\t\tthis.attach    = [];\r\n\t\tthis.detach    = [];\r\n\r\n\t\tthis.eventCleanup = [];\r\n\r\n\t\tthis.parent    = null;\r\n\t\tthis.viewList  = null;\r\n\t\tthis.viewLists = {};\r\n\r\n\t\tthis.tags      = {};\r\n\r\n\t\tthis.intervals = [];\r\n\t\tthis.timeouts  = [];\r\n\t\tthis.frames    = [];\r\n\t}\r\n\r\n\tonFrame(callback) {\r\n\t\tlet c = (timestamp) => {\r\n\t\t\tcallback(timestamp);\r\n\t\t\twindow.requestAnimationFrame(c);\r\n\t\t};\r\n\r\n\t\tc();\r\n\t}\r\n\r\n\tonTimeout(time, callback) {\r\n\t\tlet wrappedCallback = () => {\r\n\t\t\tthis.timeouts[index].fired = true;\r\n\t\t\tcallback();\r\n\t\t};\r\n\t\tlet timeout = setTimeout(wrappedCallback, time)\r\n\t\tlet index   = this.timeouts.length;\r\n\r\n\t\tthis.timeouts.push({\r\n\t\t\ttimeout:    timeout\r\n\t\t\t, callback: wrappedCallback\r\n\t\t\t, time:     time\r\n\t\t\t, fired:    false\r\n\t\t\t, created:  (new Date).getTime()\r\n\t\t\t, paused:   false\r\n\t\t});\r\n\r\n\t\treturn timeout;\r\n\t}\r\n\r\n\tclearTimeout(timeout) {\r\n\t\tfor(var i in this.timeouts) {\r\n\t\t\tif(timeout === this.timeouts[i].timeout) {\r\n\t\t\t\tclearInterval(this.timeouts[i].timeout);\r\n\r\n\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonInterval(time, callback) {\r\n\t\tlet timeout = setInterval(callback, time);\r\n\r\n\t\tthis.intervals.push({\r\n\t\t\ttimeout:    timeout\r\n\t\t\t, callback: callback\r\n\t\t\t, time:     time\r\n\t\t\t, paused:   false\r\n\t\t});\r\n\r\n\t\treturn timeout;\r\n\t}\r\n\r\n\tclearInterval(timeout) {\r\n\t\tfor(var i in this.intervals) {\r\n\t\t\tif(timeout === this.intervals[i].timeout) {\r\n\t\t\t\tclearInterval(this.intervals[i].timeout);\r\n\r\n\t\t\t\tdelete this.intervals[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpause(paused = undefined)\r\n\t{\r\n\t\tif(paused === undefined)\r\n\t\t{\r\n\t\t\tthis.paused = !this.paused;\r\n\t\t}\r\n\r\n\t\tthis.paused = paused;\r\n\r\n\t\tif(this.paused)\r\n\t\t{\r\n\t\t\tfor(let i in this.timeouts)\r\n\t\t\t{\r\n\t\t\t\tif(this.timeouts[i].fired)\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclearTimeout(this.timeouts[i].timeout);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.intervals)\r\n\t\t\t{\r\n\t\t\t\tclearInterval(this.intervals[i].timeout);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor(let i in this.timeouts)\r\n\t\t\t{\r\n\t\t\t\tif(!this.timeouts[i].timeout.paused)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.timeouts[i].fired)\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete this.timeouts[i];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.timeouts[i].timeout = setTimeout(\r\n\t\t\t\t\tthis.timeouts[i].callback\r\n\t\t\t\t\t, this.timeouts[i].time\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.intervals)\r\n\t\t\t{\r\n\t\t\t\tif(!this.intervals[i].timeout.paused)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.intervals[i].timeout.paused = false;\r\n\r\n\t\t\t\tthis.intervals[i].timeout = setInterval(\r\n\t\t\t\t\tthis.intervals[i].callback\r\n\t\t\t\t\t, this.intervals[i].time\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trender(parentNode = null, insertPoint = null)\r\n\t{\r\n\t\tif(this.nodes)\r\n\t\t{\r\n\t\t\tfor(let i in this.detach)\r\n\t\t\t{\r\n\t\t\t\tthis.detach[i]();\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.nodes)\r\n\t\t\t{\r\n\t\t\t\tlet detachEvent = new Event('cvDomDetached', {bubbles: true, target: this.nodes[i]});\r\n\t\t\t\tlet attachEvent = new Event('cvDomAttached', {bubbles: true, target: this.nodes[i]});\r\n\r\n\t\t\t\tthis.nodes[i].dispatchEvent(detachEvent);\r\n\r\n\t\t\t\tDom.mapTags(this.nodes[i], false, (node) => {\r\n\t\t\t\t\tnode.dispatchEvent(detachEvent);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(parentNode)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(insertPoint)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparentNode.insertBefore(this.nodes[i], insertPoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparentNode.appendChild(this.nodes[i]);\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tDom.mapTags(this.nodes[i], false, (node) => {\r\n\t\t\t\t\tnode.dispatchEvent(attachEvent);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.nodes[i].dispatchEvent(attachEvent);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.attach)\r\n\t\t\t{\r\n\t\t\t\tthis.attach[i]();\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet subDoc;\r\n\r\n\t\tif(this.template == document)\r\n\t\t{\r\n\t\t\tsubDoc = this.template;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tsubDoc = document.createRange().createContextualFragment(this.template);\r\n\t\t}\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-prerender]', (tag) => {\r\n\t\t\tlet prerenderAttr = tag.getAttribute('cv-prerender');\r\n\t\t\tlet prerendering  = Cookie.get('prerenderer');\r\n\r\n\t\t\tif(prerenderAttr == 'never' && prerendering\r\n\t\t\t\t|| prerenderAttr == 'only' && !prerendering\r\n\t\t\t){\r\n\t\t\t\ttag.parentNode.removeChild(tag);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-each]', (tag) => {\r\n\t\t\tlet eachAttr = tag.getAttribute('cv-each');\r\n\t\t\tlet carryAttr = tag.getAttribute('cv-carry');\r\n\t\t\ttag.removeAttribute('cv-each');\r\n\t\t\ttag.removeAttribute('cv-carry');\r\n\r\n\t\t\tlet subTemplate = tag.innerHTML;\r\n\r\n\t\t\twhile(tag.firstChild)\r\n\t\t\t{\r\n\t\t\t\ttag.removeChild(tag.firstChild);\r\n\t\t\t}\r\n\r\n\t\t\tlet carryProps = [];\r\n\r\n\t\t\tif(carryAttr)\r\n\t\t\t{\r\n\t\t\t\tcarryProps = carryAttr.split(',');\r\n\t\t\t}\r\n\r\n\t\t\tlet [eachProp, asProp, keyProp] = eachAttr.split(':');\r\n\r\n\t\t\t// console.log(this, eachProp);\r\n\r\n\t\t\tlet viewList;\r\n\r\n\t\t\tthis.args.bindTo(eachProp, (v, k, t)=>{\r\n\t\t\t\tif(viewList)\r\n\t\t\t\t{\r\n\t\t\t\t\tviewList.remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tviewList = new ViewList(subTemplate, asProp, v, keyProp);\r\n\r\n\t\t\t\tthis.cleanup.push(((viewList)=>()=>{\r\n\t\t\t\t\tviewList.remove();\r\n\t\t\t\t})(viewList));\r\n\r\n\t\t\t\tviewList.parent = this;\r\n\r\n\t\t\t\tviewList.render(tag);\r\n\r\n\t\t\t\tfor(let i in carryProps)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.args.bindTo(carryProps[i], (v, k) => {\r\n\t\t\t\t\t\tviewList.args.subArgs[k] = v;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.viewLists[eachProp] = viewList;\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-with]', (tag) => {\r\n\t\t\tlet withAttr = tag.getAttribute('cv-with');\r\n\t\t\tlet carryAttr = tag.getAttribute('cv-carry');\r\n\t\t\ttag.removeAttribute('cv-with');\r\n\t\t\ttag.removeAttribute('cv-carry');\r\n\r\n\t\t\tlet subTemplate = tag.innerHTML;\r\n\r\n\t\t\tlet carryProps = [];\r\n\r\n\t\t\tif(carryAttr)\r\n\t\t\t{\r\n\t\t\t\tcarryProps = carryAttr.split(',');\r\n\t\t\t}\r\n\r\n\t\t\twhile(tag.firstChild)\r\n\t\t\t{\r\n\t\t\t\ttag.removeChild(tag.firstChild);\r\n\t\t\t}\r\n\r\n\t\t\tlet view = new View();\r\n\r\n\t\t\tthis.cleanup.push(((view)=>()=>{\r\n\t\t\t\t// view.remove();\r\n\t\t\t})(view));\r\n\r\n\t\t\tview.template = subTemplate;\r\n\t\t\tview.parent   = this;\r\n\r\n\t\t\t// console.log(carryProps);\r\n\r\n\t\t\tfor(let i in carryProps)\r\n\t\t\t{\r\n\t\t\t\tthis.args.bindTo(carryProps[i], (v, k) => {\r\n\t\t\t\t\tview.args[k] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in this.args[withAttr])\r\n\t\t\t{\r\n\t\t\t\tthis.args[withAttr].bindTo(i, (v, k) => {\r\n\t\t\t\t\tview.args[k] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(view);\r\n\r\n\t\t\tview.render(tag);\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-link]', (tag) => {\r\n\t\t\tlet LinkAttr = tag.getAttribute('cv-link');\r\n\r\n\t\t\ttag.setAttribute('href', LinkAttr);\r\n\r\n\t\t\tlet linkClick = (event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\tRouter.go(tag.getAttribute('href'));\r\n\t\t\t};\r\n\r\n\t\t\ttag.addEventListener('click', linkClick);\r\n\r\n\t\t\tthis.cleanup.push( ((tag, eventListener) => ()=>{\r\n\t\t\t\ttag.removeEventListener('click', eventListener);\r\n\t\t\t\ttag           = undefined;\r\n\t\t\t\teventListener = undefined;\r\n\t\t\t})(tag, linkClick));\r\n\r\n\t\t\ttag.removeAttribute('cv-link');\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-on]', (tag)=>{\r\n\t\t\tlet action = String(tag.getAttribute('cv-on'))\r\n\t\t\t\t.split(/;/)\r\n\t\t\t\t.map((a) => a.split(':'))\r\n\t\t\t\t.map(((object, tag) => (a) => {\r\n\t\t\t\t\tvar eventName    = a[0].replace(/(^[\\s\\n]+|[\\s\\n]+$)/, '');\r\n\t\t\t\t\tvar callbackName = a[1];\r\n\t\t\t\t\tvar argList      = [];\r\n\t\t\t\t\tvar groups = /(\\w+)(?:\\(([\\w\\s,]+)\\))?/.exec(callbackName);\r\n\t\t\t\t\tif(groups.length) {\r\n\t\t\t\t\t\tcallbackName = groups[1].replace(/(^[\\s\\n]+|[\\s\\n]+$)/, '');\r\n\t\t\t\t\t\tif(groups[2]) {\r\n\t\t\t\t\t\t\targList = groups[2].split(',').map(s => s.trim());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet eventMethod;\r\n\t\t\t\t\tlet parent = this;\r\n\r\n\t\t\t\t\twhile(parent)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(parent[ callbackName ])\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\teventMethod = (...args) => {\r\n\t\t\t\t\t\t\t\tparent[ callbackName ](...args);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(parent.viewList && parent.viewList.parent)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tparent = parent.viewList.parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(parent.parent)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tparent = parent.parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet eventListener = ((object) => (event) => {\r\n\t\t\t\t\t\tlet argRefs = argList.map((arg) => {\r\n\t\t\t\t\t\t\tif(arg === 'event') {\r\n\t\t\t\t\t\t\t\treturn event;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(arg in object.args) {\r\n\t\t\t\t\t\t\t\treturn object.args[arg];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// console.log(argList, argRefs);\r\n\t\t\t\t\t\tif(!(typeof eventMethod == 'function')) {\r\n\t\t\t\t\t\t\t// console.log(object);\r\n\t\t\t\t\t\t\t// console.trace();\r\n\t\t\t\t\t\t\t// console.log(this);\r\n\t\t\t\t\t\t\tthrow new Error(\r\n\t\t\t\t\t\t\t\t`${callbackName} is not defined on View object.\r\n\r\nTag:\r\n\r\n${tag.outerHTML}`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\teventMethod(...argRefs);\r\n\t\t\t\t\t})(object);\r\n\r\n\r\n\t\t\t\t\tswitch(eventName)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase '_init':\r\n\t\t\t\t\t\t\teventListener();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase '_attach':\r\n\t\t\t\t\t\t\tthis.attach.push(eventListener);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase '_detach':\r\n\t\t\t\t\t\t\tthis.detach.push(eventListener);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\ttag.addEventListener(eventName, eventListener);\r\n\r\n\t\t\t\t\t\t\tthis.cleanup.push(\r\n\t\t\t\t\t\t\t\t((tag, eventName, eventListener) => ()=>{\r\n\t\t\t\t\t\t\t\t\ttag.removeEventListener(eventName, eventListener);\r\n\t\t\t\t\t\t\t\t\ttag           = undefined;\r\n\t\t\t\t\t\t\t\t\teventListener = undefined;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t)(tag, eventName, eventListener));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn [eventName, callbackName, argList];\r\n\t\t\t\t})(this, tag));\r\n\r\n\t\t\ttag.removeAttribute('cv-on');\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-bind]', (tag) => {\r\n\t\t\tlet bindArg = tag.getAttribute('cv-bind');\r\n\t\t\tthis.args.bindTo(bindArg, (v,k,t) => {\r\n\t\t\t\tif(t[k] === v)\r\n\t\t\t\t{\r\n\t\t\t\t\t// return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(t[k] instanceof View)\r\n\t\t\t\t{\r\n\t\t\t\t\tt[k].remove();\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif(tag.tagName == 'INPUT' || tag.tagName == 'SELECT') {\r\n\t\t\t\t\tlet type = tag.getAttribute('type');\r\n\t\t\t\t\tif(type && type.toLowerCase() == 'checkbox') {\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\ttag.checked = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\ttag.checked = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(type !== 'file') {\r\n\t\t\t\t\t\ttag.value = v || '';\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(v instanceof View)\r\n\t\t\t\t{\r\n\t\t\t\t\tv.render(tag);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\ttag.innerText = v;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlet inputListener = (event) => {\r\n\t\t\t\tif(event.target.getAttribute('type') !== 'password')\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.log(event.target.value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(event.target !== tag) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// console.log(event.target.value);\r\n\r\n\t\t\t\tthis.args[bindArg] = event.target.value;\r\n\t\t\t};\r\n\r\n\t\t\ttag.addEventListener('input',         inputListener);\r\n\t\t\ttag.addEventListener('change',        inputListener);\r\n\t\t\ttag.addEventListener('value-changed', inputListener);\r\n\r\n\t\t\tthis.cleanup.push( ((tag, eventListener) => ()=>{\r\n\t\t\t\ttag.removeEventListener('input',         inputListener);\r\n\t\t\t\ttag.removeEventListener('change',        inputListener);\r\n\t\t\t\ttag.removeEventListener('value-changed', inputListener);\r\n\t\t\t\ttag           = undefined;\r\n\t\t\t\teventListener = undefined;\r\n\t\t\t})(tag, inputListener));\r\n\r\n\t\t\ttag.removeAttribute('cv-bind');\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, false, (tag) => {\r\n\t\t\tlet regex    = /(\\[\\[(\\$?\\w+)\\]\\])/g;\r\n\r\n\t\t\tif(tag.nodeType == Node.TEXT_NODE)\r\n\t\t\t{\r\n\t\t\t\tlet original = tag.nodeValue;\r\n\r\n\t\t\t\tif(!this.interpolatable(original))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet header   = 0;\r\n\t\t\t\tlet match;\r\n\r\n\t\t\t\twhile(match = regex.exec(original))\r\n\t\t\t\t{\r\n\t\t\t\t\tlet bindProperty = match[2];\r\n\r\n\t\t\t\t\tlet unsafeHtml = false;\r\n\r\n\t\t\t\t\tif(bindProperty.substr(0, 1) === '$')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tunsafeHtml   = true;\r\n\t\t\t\t\t\tbindProperty = bindProperty.substr(1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet staticPrefix = original.substring(header, match.index);\r\n\r\n\t\t\t\t\theader = match.index + match[1].length;\r\n\r\n\t\t\t\t\tlet staticNode = document.createTextNode(staticPrefix);\r\n\r\n\t\t\t\t\ttag.parentNode.insertBefore(staticNode, tag);\r\n\r\n\t\t\t\t\tlet dynamicNode;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(unsafeHtml)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdynamicNode = document.createElement('div');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdynamicNode = document.createTextNode('');\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\ttag.parentNode.insertBefore(dynamicNode, tag);\r\n\r\n\t\t\t\t\tthis.args.bindTo(bindProperty, ((dynamicNode,unsafeHtml) => (v,k,t) => {\r\n\t\t\t\t\t\t// console.log(`Setting ${k} to ${v}`, dynamicNode);\r\n\t\t\t\t\t\tif(t[k] instanceof View)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tt[k].remove();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdynamicNode.nodeValue = '';\r\n\r\n\t\t\t\t\t\tif(v instanceof View)\r\n\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\tv.render(tag.parentNode, dynamicNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// console.log(dynamicNode);\r\n\t\t\t\t\t\t\tif(unsafeHtml)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdynamicNode.innerHTML = v;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdynamicNode.nodeValue = v;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})(dynamicNode,unsafeHtml));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet staticSuffix = original.substring(header)\r\n\r\n\t\t\t\tlet staticNode = document.createTextNode(staticSuffix);\r\n\r\n\t\t\t\ttag.parentNode.insertBefore(staticNode, tag);\r\n\r\n\t\t\t\ttag.nodeValue = '';\r\n\t\t\t}\r\n\r\n\t\t\tif(tag.nodeType == Node.ELEMENT_NODE)\r\n\t\t\t{\r\n\t\t\t\tfor (let i = 0; i < tag.attributes.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(!this.interpolatable(tag.attributes[i].value))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet header    = 0;\r\n\t\t\t\t\tlet match;\r\n\t\t\t\t\tlet original  = tag.attributes[i].value;\r\n\t\t\t\t\tlet attribute = tag.attributes[i];\r\n\r\n\t\t\t\t\tlet bindProperties = {};\r\n\t\t\t\t\tlet segments       = [];\r\n\r\n\t\t\t\t\twhile(match = regex.exec(original))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsegments.push(original.substring(header, match.index));\r\n\r\n\t\t\t\t\t\tif(!bindProperties[match[2]])\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tbindProperties[match[2]] = [];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbindProperties[match[2]].push(segments.length);\r\n\r\n\t\t\t\t\t\tsegments.push(match[1]);\r\n\r\n\t\t\t\t\t\theader = match.index + match[1].length;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsegments.push(original.substring(header));\r\n\r\n\t\t\t\t\tfor(let j in bindProperties)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.args.bindTo(j, (v, k, t, d) => {\r\n\t\t\t\t\t\t\tfor(let i in bindProperties)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfor(let j in bindProperties[i])\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tsegments[ bindProperties[i][j] ] = t[i];\r\n\r\n\t\t\t\t\t\t\t\t\tif(k === i)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tsegments[ bindProperties[i][j] ] = v;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttag.setAttribute(attribute.name, segments.join(''));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// console.log(bindProperties, segments);\r\n\r\n\t\t\t\t\t// console.log(tag.attributes[i].name, tag.attributes[i].value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-ref]', (tag) => {\r\n\t\t\tlet refAttr                         = tag.getAttribute('cv-ref');\r\n\t\t\tlet [refProp, refClassname, refKey] = refAttr.split(':');\r\n\r\n\t\t\tlet refClass = this.stringToClass(refClassname);\r\n\r\n\t\t\ttag.removeAttribute('cv-ref');\r\n\r\n\t\t\tif(this.viewList)\r\n\t\t\t{\r\n\t\t\t\tif(!this.viewList.parent.tags[refProp])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.viewList.parent.tags[refProp] = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet refKeyVal = this.args[refKey];\r\n\r\n\t\t\t\tthis.viewList.parent.tags[refProp][refKeyVal] = new refClass(\r\n\t\t\t\t\ttag, this, refProp, refKeyVal\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.tags[refProp] = new refClass(\r\n\t\t\t\t\ttag, this, refProp\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tDom.mapTags(subDoc, '[cv-if]', this.mapIfTags.bind(this));\r\n\r\n\t\tthis.nodes = [];\r\n\r\n\t\tthis.firstNode = document.createComment(`Template ${this._id} Start`);\r\n\r\n\t\tthis.nodes.push(this.firstNode);\r\n\r\n\t\tif(parentNode)\r\n\t\t{\r\n\t\t\tif(insertPoint)\r\n\t\t\t{\r\n\t\t\t\tparentNode.insertBefore(this.firstNode, insertPoint);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tparentNode.appendChild(this.firstNode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twhile(subDoc.firstChild)\r\n\t\t{\r\n\t\t\tlet newNode = subDoc.firstChild;\r\n\t\t\tlet attachEvent = new Event('cvDomAttached', {bubbles: true, target: newNode});\r\n\r\n\t\t\tthis.nodes.push(subDoc.firstChild);\r\n\r\n\t\t\tif(parentNode)\r\n\t\t\t{\r\n\t\t\t\tif(insertPoint)\r\n\t\t\t\t{\r\n\t\t\t\t\tparentNode.insertBefore(subDoc.firstChild, insertPoint);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tparentNode.appendChild(subDoc.firstChild);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tDom.mapTags(newNode, false, (node) => {\r\n\t\t\t\t// node.dispatchEvent(attachEvent);\r\n\t\t\t});\r\n\r\n\t\t\tnewNode.dispatchEvent(attachEvent);\r\n\t\t}\r\n\r\n\t\tthis.lastNode = document.createComment(`Template ${this._id} End`);\r\n\r\n\t\tthis.nodes.push(this.lastNode);\r\n\r\n\t\tif(parentNode)\r\n\t\t{\r\n\t\t\tif(insertPoint)\r\n\t\t\t{\r\n\t\t\t\tparentNode.insertBefore(this.lastNode, insertPoint);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tparentNode.appendChild(this.lastNode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i in this.attach)\r\n\t\t{\r\n\t\t\tthis.attach[i]();\r\n\t\t}\r\n\r\n\t\tthis.postRender(parentNode);\r\n\r\n\t\t// return this.nodes;\r\n\t}\r\n\t\r\n\tmapIfTags(tag)\r\n\t{\r\n\t\tlet ifProperty = tag.getAttribute('cv-if');\r\n\r\n\t\tlet inverted = false;\r\n\r\n\t\tif(ifProperty.substr(0, 1) === '!')\r\n\t\t{\r\n\t\t\tinverted   = true;\r\n\t\t\tifProperty = ifProperty.substr(1);\r\n\t\t}\r\n\r\n\t\tlet ifDoc = document.createRange().createContextualFragment('');\r\n\r\n\t\tthis.args.bindTo(\r\n\t\t\tifProperty\r\n\t\t\t, ((tag, ifDoc) => (v) => {\r\n\t\t\t\tlet detachEvent = new Event('cvDomDetached');\r\n\t\t\t\tlet attachEvent = new Event('cvDomAttached');\r\n\r\n\t\t\t\tif(inverted)\r\n\t\t\t\t{\r\n\t\t\t\t\tv = !v;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDom.mapTags(tag, '[cv-if]', this.mapIfTags.bind(this));\r\n\r\n\t\t\t\tif(v)\r\n\t\t\t\t{\r\n\t\t\t\t\twhile(ifDoc.firstChild)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet moveTag = ifDoc.firstChild;\r\n\r\n\t\t\t\t\t\ttag.prepend(moveTag);\r\n\r\n\t\t\t\t\t\tmoveTag.dispatchEvent(detachEvent);\r\n\r\n\t\t\t\t\t\tDom.mapTags(moveTag, false, (node) => {\r\n\t\t\t\t\t\t\tnode.dispatchEvent(detachEvent);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\twhile(tag.firstChild)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet moveTag = tag.firstChild;\r\n\r\n\t\t\t\t\t\tifDoc.prepend(moveTag);\r\n\r\n\t\t\t\t\t\tmoveTag.dispatchEvent(attachEvent);\r\n\r\n\t\t\t\t\t\tDom.mapTags(moveTag, false, (node) => {\r\n\t\t\t\t\t\t\tnode.dispatchEvent(attachEvent);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})(tag, ifDoc)\r\n\t\t);\r\n\r\n\t\ttag.removeAttribute('cv-if');\r\n\t}\r\n\r\n\tpostRender(parentNode)\r\n\t{\r\n\r\n\t}\r\n\r\n\tinterpolatable(str)\r\n\t{\r\n\t\treturn !!(String(str).match(/\\[\\[\\$?\\w+\\??\\]\\]/));\r\n\t}\r\n\r\n\tuuid() {\r\n\t\treturn ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(\r\n\t\t\t/[018]/g\r\n\t\t\t, c => (\r\n\t\t\t\tc ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4\r\n\t\t\t).toString(16)\r\n\t\t);\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tfor(let i in this.nodes)\r\n\t\t{\r\n\t\t\tthis.nodes[i].remove();\r\n\t\t}\r\n\r\n\t\tlet cleanup;\r\n\r\n\t\twhile(cleanup = this.cleanup.shift())\r\n\t\t{\r\n\t\t\tcleanup();\r\n\t\t}\r\n\r\n\t\tfor(let i in this.tags)\r\n\t\t{\r\n\t\t\tif(Array.isArray(this.tags[i]))\r\n\t\t\t{\r\n\t\t\t\tfor(var j in this.tags[i])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.tags[i][j].remove();\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.tags[i].remove();\r\n\t\t}\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\r\n\t}\r\n\r\n\tbeforeUpdate(args)\r\n\t{\r\n\r\n\t}\r\n\r\n\tafterUpdate(args)\r\n\t{\r\n\r\n\t}\r\n\r\n\tstringToClass(refClassname)\r\n\t{\r\n\t\tlet refClassSplit           = refClassname.split('/');\r\n\t\tlet refShortClassname       = refClassSplit[ refClassSplit.length - 1 ];\r\n\t\tlet refClass                = require(refClassname);\r\n\r\n\t\treturn refClass[refShortClassname];\r\n\t}\r\n}\r\n","import { Bindable } from './Bindable';\r\nimport { View     } from './View';\r\n\r\nexport class ViewList\r\n{\r\n\tconstructor(template, subProperty, list, keyProperty = null)\r\n\t{\r\n\t\tthis.args         = Bindable.makeBindable({});\r\n\t\tthis.args.value   = Bindable.makeBindable(list || {});\r\n\t\tthis.args.subArgs = Bindable.makeBindable({});\r\n\t\tthis.views        = {};\r\n\t\tthis.template     = template;\r\n\t\tthis.subProperty  = subProperty;\r\n\t\tthis.keyProperty  = keyProperty;\r\n\t\tthis.tag          = null;\r\n\t\tthis.paused       = false;\r\n\r\n\t\tthis.args.value.before.push((t)=>{\r\n\t\t\t// console.log(t.executing);\r\n\t\t\tif(t.executing == 'bindTo')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.paused = true;\r\n\t\t});\r\n\r\n\t\tthis.args.value.after.push((t)=>{\r\n\t\t\tif(this.paused)\r\n\t\t\t{\r\n\t\t\t\t// console.log(t.executing);\r\n\t\t\t\tthis.reRender();\r\n\t\t\t}\r\n\t\t\tthis.paused = false;\r\n\t\t});\r\n\r\n\t\t// console.log(this.args);\r\n\r\n\t\tthis.args.value.bindTo((v, k, t, d) => {\r\n\r\n\t\t\tif(this.paused)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(d)\r\n\t\t\t{\r\n\t\t\t\tthis.views[k].remove();\r\n\r\n\t\t\t\tdelete this.views[k];\r\n\t\t\t\t// console.log(`Deleting ${k}`, v, this.views);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(`Setting ${k}`, v, this.views);\r\n\r\n\t\t\tif(!this.views[k])\r\n\t\t\t{\r\n\t\t\t\tlet view = new View();\r\n\r\n\t\t\t\tthis.views[k] = view;\r\n\t\t\t\t\r\n\t\t\t\tthis.views[k].template = this.template;\r\n\t\t\t\t\r\n\t\t\t\tthis.views[k].parent   = this.parent;\r\n\t\t\t\tthis.views[k].viewList = this;\r\n\r\n\t\t\t\tthis.args.subArgs.bindTo((v, k, t, d) => {\r\n\t\t\t\t\tview.args[k] = v;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.views[k].args[ this.subProperty ] = v;\r\n\r\n\t\t\t\tif(this.keyProperty)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.views[k].args[ this.keyProperty ] = k;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt[k] = v;\r\n\r\n\t\t\t\tthis.reRender();\r\n\t\t\t}\r\n\r\n\t\t\tthis.views[k].args[ this.subProperty ] = v;\r\n\t\t});\r\n\t}\r\n\r\n\trender(tag)\r\n\t{\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tthis.views[i].render(tag);\r\n\t\t}\r\n\r\n\t\tthis.tag = tag;\r\n\r\n\t\t// console.log(tag);\r\n\t}\r\n\r\n\treRender()\r\n\t{\r\n\t\t// console.log('rerender');\r\n\t\tif(!this.tag)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet views = [];\r\n\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tviews[i] = this.views[i];\r\n\t\t}\r\n\r\n\t\tlet finalViews = [];\r\n\r\n\t\tfor(let i in this.args.value)\r\n\t\t{\r\n\t\t\tlet found = false;\r\n\t\t\tfor(let j in views)\r\n\t\t\t{\r\n\t\t\t\tif(views[j] && this.args.value[i] === views[j].args[ this.subProperty ])\r\n\t\t\t\t{\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tfinalViews[i] = views[j];\r\n\t\t\t\t\tdelete views[j];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!found)\r\n\t\t\t{\r\n\t\t\t\tlet viewArgs = {};\r\n\t\t\t\tviewArgs[this.subProperty] = this.args.value[i];\r\n\t\t\t\tfinalViews[i] = new View(viewArgs);\r\n\r\n\t\t\t\tfinalViews[i].template = this.template;\r\n\t\t\t\tfinalViews[i].parent   = this.parent;\r\n\t\t\t\tfinalViews[i].viewList = this;\r\n\r\n\t\t\t\tfinalViews[i].args[ this.keyProperty ] = i;\r\n\r\n\t\t\t\tthis.args.subArgs.bindTo((v, k, t, d) => {\r\n\t\t\t\t\tfinalViews[i].args[k] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet appendOnly = true;\r\n\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tif(this.views[i] !== finalViews[i])\r\n\t\t\t{\r\n\t\t\t\tappendOnly = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!appendOnly)\r\n\t\t{\r\n\t\t\twhile(this.tag.firstChild)\r\n\t\t\t{\r\n\t\t\t\tthis.tag.removeChild(this.tag.firstChild);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i in finalViews)\r\n\t\t\t{\r\n\t\t\t\tfinalViews[i].render(this.tag);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tlet i = this.views.length || 0\r\n\r\n\t\t\twhile(finalViews[i])\r\n\t\t\t{\r\n\t\t\t\tfinalViews[i].render(this.tag);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\r\n\t\tthis.views = finalViews;\r\n\t}\r\n\tremove()\r\n\t{\r\n\t\tfor(let i in this.views)\r\n\t\t{\r\n\t\t\tthis.views[i].remove();\r\n\t\t}\r\n\r\n\t\tthis.views = [];\r\n\r\n\t\twhile(this.tag.firstChild)\r\n\t\t{\r\n\t\t\tthis.tag.removeChild(this.tag.firstChild);\r\n\t\t}\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class ButtonField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.args.title = this.args.title || this.args.value;\r\n\t\tthis.template = `\r\n\t\t\t<label cv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tname  = \"${this.args.name}\"\r\n\t\t\t\t\ttype  = \"${this.args.attrs.type}\"\r\n\t\t\t\t\tvalue = \"[[title]]\"\r\n\t\t\t\t\ton    = \"click:clicked(event)\"\r\n\t\t\t\t/>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n\tclicked(event) {\r\n\t\tthis.form.buttonClick(this.args.name);\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nexport class Field extends View {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values);\r\n\t\tthis.args.title = this.args.title || '';\r\n\t\tthis.args.value = this.args.value || '';\r\n\r\n\t\tthis.args.valueString = '';\r\n\r\n\t\tthis.form   = form;\r\n\t\tthis.parent = parent;\r\n\t\tthis.key    = key;\r\n\r\n\t\tthis.ignore = this.args.attrs['data-cv-ignore'] || false;\r\n\r\n\t\tlet setting = null;\r\n\r\n\t\tthis.args.bindTo(\r\n\t\t\t'value'\r\n\t\t\t, (v, k) => {\r\n\t\t\t\t// console.trace();\r\n\t\t\t\t// console.log(this.args.name, v, k);\r\n\r\n\t\t\t\tif(setting == key)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// console.log(this.args.name, v, k);\r\n\r\n\t\t\t\tthis.args.valueString = JSON.stringify(v||'', null, 4);\r\n\r\n\t\t\t\tsetting = key;\r\n\r\n\t\t\t\tthis.parent.args.value[key] = v;\r\n\t\t\t\tsetting = null;\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.parent.args.value.bindTo(key, (v, k)=>{\r\n\t\t\tif(setting == k)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsetting = k;\r\n\r\n\t\t\tthis.args.value = v;\r\n\r\n\t\t\tsetting = null;\r\n\t\t});\r\n\r\n\t\tthis.template = `\r\n\t\t\t<label cv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<span cv-if = \"title\" cv-ref = \"title:curvature/base/Tag\">[[title]]:</span>\r\n\t\t\t\t<input\r\n\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\ttype    = \"${this.args.attrs.type||'text'}\"\r\n\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t\t//type    = \"${this.args.attrs.type||'text'}\"\r\n\t}\t\r\n}\r\n","import { Field } from './Field';\r\nimport { Form  } from './Form';\r\n\r\nexport class FieldSet extends Field\r\n{\r\n\tconstructor(values, form, parent, key)\r\n\t{\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.args.value  = {};\r\n\t\tthis.args.fields = Form.renderFields(values.children, this);\r\n\t\tthis.template    = `\r\n\t\t\t<label>\r\n\t\t\t\t<span cv-if = \"title\">[[title]]:</span>\r\n\t\t\t\t<fieldset name = \"${this.args.name}\">\r\n\t\t\t\t\t<div cv-each = \"fields:field\">\r\n\t\t\t\t\t\t<div cv-bind = \"field\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</fieldset>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class FileField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label>\r\n\t\t\t\t<input\r\n\t\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\t\ttype    = \"${this.args.attrs.type}\"\r\n\t\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t/>\r\n\t\t\t\t<span style = \"display:none\" cv-if = \"value\">[[[value]]]</span>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nimport { Field       } from './Field';\r\nimport { FieldSet    } from './FieldSet';\r\nimport { SelectField } from './SelectField';\r\nimport { HtmlField   } from './HtmlField';\r\nimport { HiddenField } from './HiddenField';\r\nimport { ButtonField } from './ButtonField';\r\n\r\n// import { Router           } from 'Router';\r\n\r\n// import { Repository       } from '../Repository';\r\n\r\n// import { FieldSet         } from './FieldSet';\r\n\r\n// import { ToastView        } from '../ToastView';\r\n// import { ToastAlertView   } from '../ToastAlertView';\r\n\r\nexport class Form extends View\r\n{\r\n\tconstructor(skeleton)\r\n\t{\r\n\t\tsuper({});\r\n\t\tthis.args.flatValue = this.args.flatValue || {};\r\n\t\tthis.args.value     = this.args.value     || {};\r\n\r\n\t\tthis.args.method    = skeleton._method || 'GET';\r\n\r\n\t\tthis.args.classes   = this.args.classes || [];\r\n\r\n\t\tthis.args.bindTo('classes', (v)=>{\r\n\t\t\tthis.args._classes = v.join(' ');\r\n\t\t});\r\n\r\n\t\tthis._onSubmit  = [];\r\n\t\tthis.action     = '';\r\n\t\tthis.template   = `\r\n\t\t\t<form\r\n\t\t\t\tclass   = \"[[_classes]]\"\r\n\t\t\t\tmethod  = \"[[method]]\"\r\n\t\t\t\tcv-each = \"fields:field\"\r\n\t\t\t\tcv-on   = \"submit:submit(event)\"\r\n\t\t\t\tcv-ref  = \"formTag:curvature/base/Tag\"\r\n\t\t\t>\r\n\t\t\t\t[[field]]\r\n\t\t\t</form>\r\n\t\t`;\r\n\r\n\t\tthis.args.fields    = Form.renderFields(skeleton, this);\r\n\r\n\t\tthis.args.bindTo(\r\n\t\t\t'value'\r\n\t\t\t, (v) => {\r\n\t\t\t\tthis.args.valueString = JSON.stringify(v, null, 4);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\tsubmit(event)\r\n\t{\r\n\t\tevent.preventDefault();\r\n\r\n\t\tthis.args.valueString = JSON.stringify(\r\n\t\t\tthis.args.value\r\n\t\t\t, null\r\n\t\t\t, 4\r\n\t\t);\r\n\r\n\t\tfor(let i in this._onSubmit)\r\n\t\t{\r\n\t\t\tthis._onSubmit[i](this, event);\r\n\t\t}\r\n\t}\r\n\tbuttonClick(event)\r\n\t{\r\n\t\t// console.log(event);\r\n\t}\r\n\tonSubmit(callback)\r\n\t{\r\n\t\tthis._onSubmit.push(callback);\r\n\t}\r\n\tstatic renderFields(skeleton, parent = null)\r\n\t{\r\n\t\tlet fields = {};\r\n\t\tfor(let i in skeleton)\r\n\t\t{\r\n\t\t\tif(fields[i])\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(i.substr(0,1) == '_')\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet field = null;\r\n\t\t\tlet form  = null;\r\n\t\t\tif(parent instanceof Form)\r\n\t\t\t{\r\n\t\t\t\tform = parent;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tform = parent.form;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(skeleton[i].type)\r\n\t\t\t{\r\n\t\t\t\tcase 'fieldset':\r\n\t\t\t\t\tfield = new FieldSet(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\tfield = new SelectField(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'html':\r\n\t\t\t\t\tfield = new HtmlField(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'submit':\r\n\t\t\t\tcase 'button':\r\n\t\t\t\t\tfield = new ButtonField(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'hidden':\r\n\t\t\t\t\tfield = new HiddenField(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault :\r\n\t\t\t\t\tfield = new Field(skeleton[i], form, parent, i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tfields[i] = field;\r\n\r\n\t\t\tfield.args.bindTo(\r\n\t\t\t\t'value'\r\n\t\t\t\t, (v, k ,t, d) => {\r\n\t\t\t\t\t// console.log(t,v);\r\n\t\t\t\t\tif(t.type == 'html' && !t.contentEditable)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tform.args.flatValue[ field.args.name ] = v;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn fields;\r\n\t}\r\n\tqueryString(args = {})\r\n\t{\r\n\t\tlet parts = [];\r\n\t\t\r\n\t\tfor(let i in this.args.flatValue)\r\n\t\t{\r\n\t\t\targs[i] = args[i] || this.args.flatValue[i];\r\n\t\t}\r\n\r\n\t\tfor(let i in args)\r\n\t\t{\r\n\t\t\tparts.push(i + '=' + encodeURIComponent(args[i]));\r\n\t\t}\r\n\r\n\t\treturn parts.join('&');\r\n\t}\r\n\tpopulate(values)\r\n\t{\r\n\t\t// console.log(values);\r\n\r\n\t\tfor(let i in values)\r\n\t\t{\r\n\t\t\tthis.args.value[i] = values[i];\r\n\t\t}\r\n\t}\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class FileField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label cv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<input\r\n\t\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\t\ttype    = \"${this.args.attrs.type}\"\r\n\t\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t\t<span style = \"display:none\" cv-if = \"value\">[[[value]]]</span>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nexport class HtmlField extends View {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.ignore = this.args.attrs['data-cv-ignore'] || false;\r\n\t\tthis.args.contentEditable = this.args.attrs.contenteditable || false;\r\n\t\tthis.template = `<div contenteditable = \"[[contentEditable]]\">[[$value]]</div>`;\r\n\t}\t\r\n}\r\n","import { Field } from './Field';\r\n\r\nexport class SelectField extends Field {\r\n\tconstructor(values, form, parent, key) {\r\n\t\tsuper(values, form, parent, key);\r\n\t\tthis.template = `\r\n\t\t\t<label cv-ref = \"label:curvature/base/Tag\">\r\n\t\t\t\t<span cv-if = \"title\" cv-ref = \"title:curvature/base/Tag\">[[title]]:</span>\r\n\t\t\t\t<select\r\n\t\t\t\t\tname    = \"${this.args.name}\"\r\n\t\t\t\t\tcv-bind = \"value\"\r\n\t\t\t\t\tcv-each = \"options:option:optionText\"\r\n\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\r\n\t\t\t\t/>\r\n\t\t\t\t\t<option value = \"[[option]]\">[[optionText]]</option>\r\n\t\t\t\t</select>\r\n\t\t\t</label>\r\n\t\t`;\r\n\t}\r\n\tgetLabel(value)\r\n\t{\r\n\t\tfor(let i in this.args.options)\r\n\t\t{\r\n\t\t\tif(this.args.options[i] == value)\r\n\t\t\t{\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { Dom } from '../base/Dom';\r\nimport { Tag } from '../base/Tag';\r\n\r\nexport class PopOutTag extends Tag\r\n{\r\n\tconstructor(element, parent, ref, index)\r\n\t{\r\n\t\tsuper(element, parent, ref, index);\r\n\r\n\t\tthis.poppedOut = false;\r\n\t\tthis.style     = element.getAttribute('style');\r\n\t\tthis.moving    = false;\r\n\r\n\t\tthis.leftDuration   = 0;\r\n\t\tthis.unpoppedStyle  = '';\r\n\t\tthis.previousScroll = 0;\r\n\r\n\t\telement.classList.add('unpopped');\r\n\r\n\t\tthis.scrollStyle;\r\n\r\n\t\t//this.ps = new PerfectScrollbar(element, {wheelPropagation: true});\r\n\t\tthis.rect;\r\n\t\tthis.clickListener  = (event) => {\r\n\t\t\tif(!this.poppedOut || ! this.rect)\r\n\t\t\t{\r\n\t\t\t\tthis.rect = element.getBoundingClientRect();\r\n\t\t\t}\t\t\t\r\n\r\n\t\t\tif(!this.element.contains(event.target))\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopPropagation();\r\n\r\n\t\t\tlet leftDuration = 0.333;\r\n\r\n\t\t\tif(this.moving)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.poppedOut)\r\n\t\t\t{\r\n\t\t\t\tthis.previousScroll = window.scrollY;\r\n\r\n\t\t\t\tif(leftDuration)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.leftDuration = leftDuration;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.unpoppedStyle = `\r\n\t\t\t\t\t;position:  fixed;\r\n\t\t\t\t\tleft:       ${this.rect.x}px;\r\n\t\t\t\t\ttop:        ${this.rect.y}px;\r\n\t\t\t\t\twidth:      ${this.rect.width}px;\r\n\t\t\t\t\theight:     ${this.rect.height}px;\r\n\t\t\t\t\tz-index:    99999;\r\n\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tlet style = this.style + this.unpoppedStyle;\r\n\r\n\t\t\t\telement.setAttribute('style', style);\r\n\r\n\t\t\t\tdocument.body.style.overflow = 'hidden';\r\n\t\t\t\tdocument.body.style.overflowY = 'hidden';\r\n\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tstyle += `\r\n\t\t\t\t\t\t;top:   0px;\r\n\t\t\t\t\t\tleft:   0px;\r\n\t\t\t\t\t\twidth:  100%;\r\n\t\t\t\t\t\theight: 100%;\r\n\t\t\t\t\t\toverflow-y: auto;\r\n\t\t\t\t\t`;\r\n\r\n\t\t\t\t\tthis.moving = true;\r\n\r\n\t\t\t\t\telement.classList.add('unpopped');\r\n\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\telement.classList.add('popped');\r\n\t\t\t\t\t\telement.classList.remove('unpopped');\r\n\t\t\t\t\t}, this.leftDuration*333);\r\n\r\n\t\t\t\t\t// element.setAttribute('style', style + ';position:absolute');\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\telement.setAttribute(\r\n\t\t\t\t\t\t\t'style'\r\n\t\t\t\t\t\t\t, style + `;transition: ${this.leftDuration}s;`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\tPopOutTag.popLevel();\r\n\t\t\t\t\t\tdocument.body.setAttribute('style', 'height:0px;overflow:hidden;');\r\n\t\t\t\t\t\twindow.scrollTo(0,0);\r\n\t\t\t\t\t\tthis.moving = false;\r\n\t\t\t\t\t\tDom.mapTags(element, false, (tag)=>{\r\n\t\t\t\t\t\t\tlet event = new Event('cvPopped');\r\n\r\n\t\t\t\t\t\t\ttag.dispatchEvent(event);\r\n\r\n\t\t\t\t\t\t\tthis.scrollStyle = element.getAttribute('style');\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, this.leftDuration*1000);\r\n\t\t\t\t}, 1);\r\n\r\n\t\t\t\tthis.poppedOut = !this.poppedOut;\r\n\t\t\t}\r\n\t\t\telse if(event.target.matches('.closeButton') && this.poppedOut)\r\n\t\t\t{\r\n\t\t\t\twindow.scrollTo(0,this.previousScroll);\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\r\n\t\t\t\t}, 1);\r\n\r\n\t\t\t\tlet style = this.style\r\n\t\t\t\t\t+ this.unpoppedStyle\r\n\t\t\t\t\t+ `;transition: ${this.leftDuration}s;`;\r\n\r\n\t\t\t\tif(0 === PopOutTag.unpopLevel())\r\n\t\t\t\t{\r\n\t\t\t\t\tdocument.body.setAttribute('style', '');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\r\n\t\t\t\telement.classList.add('unpopped');\r\n\t\t\t\t\r\n\t\t\t\telement.setAttribute('style', style);\r\n\r\n\t\t\t\tthis.moving = true;\r\n\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\telement.setAttribute('style', this.style);\r\n\t\t\t\t\telement.classList.remove('popped');\r\n\t\t\t\t}, this.leftDuration*500);\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\telement.setAttribute('style', this.style);\r\n\t\t\t\t\tthis.moving = false;\r\n\t\t\t\t\tDom.mapTags(element, false, (tag)=>{\r\n\t\t\t\t\t\tlet event = new Event('cvUnpopped');\r\n\r\n\t\t\t\t\t\ttag.dispatchEvent(event);\r\n\t\t\t\t\t});\r\n\t\t\t\t}, this.leftDuration*1000);\r\n\r\n\t\t\t\tthis.poppedOut = !this.poppedOut;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\telement.addEventListener('click',  this.clickListener);\r\n\r\n\t\tthis.cleanup.push(((element)=>()=>{\r\n\t\t\telement.removeEventListener('click',  this.clickListener);\r\n\t\t})(element));\r\n\t}\r\n\r\n\r\n\tstatic popLevel()\r\n\t{\r\n\t\tif(!this.level)\r\n\t\t{\r\n\t\t\tthis.level = 0;\r\n\t\t}\r\n\r\n\t\tthis.level++;\r\n\r\n\t\treturn this.level;\r\n\t}\r\n\r\n\tstatic unpopLevel()\r\n\t{\r\n\t\tif(!this.level)\r\n\t\t{\r\n\t\t\tthis.level = 0;\r\n\t\t}\r\n\r\n\t\tthis.level--;\r\n\r\n\t\treturn this.level;\r\n\t}\r\n\r\n\tpause()\r\n\t{\r\n\t\tsuper.pause();\r\n\t\tdocument.body.setAttribute('style', '');\r\n\r\n\t\tconsole.log('!!!');\r\n\t}\r\n}","import { Tag      } from '../base/Tag';\r\nimport { Dom      } from '../base/Dom';\r\nimport { Bindable } from '../base/Bindable';\r\n\r\nexport class ScrollTag extends Tag\r\n{\r\n\tconstructor(element, parent, ref, index)\r\n\t{\r\n\t\tsuper(element, parent, ref, index);\r\n\r\n\t\tthis.topEdge         = false;\r\n\t\tthis.resizeListening = false;\r\n\t\tthis.visible         = false;\r\n\t\tthis.offsetTop       = false;\r\n\t\tthis.offsetBottom    = false;\r\n\r\n\t\tthis.threshold       = 0;\r\n\r\n\t\tthis.subscribedTo    = [];\r\n\r\n\t\tthis.scrollListener = (event) => {\r\n\t\t\tlet tag = event.target;\r\n\t\t\tfor(let i in tag.scrollSubTags)\r\n\t\t\t{\r\n\t\t\t\ttag.scrollSubTags[i].scrolled(tag);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.resizeListenr = (event)=>{\r\n\t\t\tfor(let i in this.resizeTags)\r\n\t\t\t{\r\n\t\t\t\tthis.resizeTags[i].scrolled(event.target);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.attachListener = (e) => {\r\n\t\t\tif(e.path[e.path.length-1]!==window)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet current = e.target;\r\n\t\t\twhile(current)\r\n\t\t\t{\r\n\t\t\t\tcurrent = Bindable.makeBindable(current);\r\n\r\n\t\t\t\tthis.addScrollListener(current);\r\n\r\n\t\t\t\tthis.scrolled(current);\r\n\r\n\t\t\t\tcurrent = current.parentNode;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.element.addEventListener('cvDomAttached', this.attachListener);\r\n\r\n\t\tthis.cleanup.push(((element)=>()=>{\r\n\t\t\telement.removeEventListener('cvDomAttached', this.attachListener);\r\n\t\t})(this.element));\r\n\r\n\t\tScrollTag.addResizeListener(this);\r\n\r\n\t\tthis.bindTo('visible', (v)=>{\r\n\t\t\tlet scrolledEvent;\r\n\t\t\tif(v)\r\n\t\t\t{\r\n\t\t\t\tscrolledEvent = new Event('cvScrolledIn');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tscrolledEvent = new Event('cvScrolledOut');\r\n\t\t\t}\r\n\r\n\t\t\tDom.mapTags(this.element, false, (node) => {\r\n\t\t\t\tnode.dispatchEvent(scrolledEvent);\r\n\t\t\t});\r\n\r\n\t\t\tthis.element.dispatchEvent(scrolledEvent);\r\n\t\t});\r\n\r\n\t\tthis.bindTo('offsetTop', (v) => {\r\n\t\t\tlet scrolledEvent = new CustomEvent('cvScrolled', {\r\n\t\t\t\tdetail: {offset: v}\r\n\t\t\t});\r\n\t\t\tDom.mapTags(this.element, false, (node) => {\r\n\t\t\t\tnode.dispatchEvent(scrolledEvent);\r\n\t\t\t});\r\n\r\n\t\t\tthis.element.dispatchEvent(scrolledEvent);\r\n\t\t});\r\n\t}\r\n\tscrolled(scroller)\r\n\t{\r\n\t\tlet current = this.element;\r\n\r\n\t\tlet offsetTop         = 0\r\n\t\t\t, subOffsetTop    = 0\r\n\t\t\t, offsetBottom    = 0\r\n\t\t\t, subOffsetBottom = 0;\r\n\r\n\t\twhile(current)\r\n\t\t{\r\n\t\t\tif(offsetTop - current.scrollTop < subOffsetTop\r\n\t\t\t){\r\n\t\t\t\tsubOffsetTop = offsetTop - current.scrollTop;\r\n\t\t\t}\r\n\r\n\t\t\tif(current.offsetTop)\r\n\t\t\t{\r\n\t\t\t\toffsetTop += current.offsetTop;\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof current.scrollTop !== 'undefined')\r\n\t\t\t{\r\n\t\t\t\toffsetTop -= current.scrollTop;\r\n\t\t\t\toffsetBottom = offsetTop + this.element.clientHeight - current.clientHeight;\r\n\t\t\t}\r\n\r\n\t\t\tif(current.parentNode\r\n\t\t\t\t&& current.parentNode.offsetTop\r\n\t\t\t\t&& current.parentNode !== current.offsetParent\r\n\t\t\t){\r\n\t\t\t\toffsetTop -= current.parentNode.offsetTop;\r\n\t\t\t}\r\n\r\n\t\t\tif(offsetBottom > subOffsetBottom)\r\n\t\t\t{\r\n\t\t\t\tsubOffsetBottom = offsetBottom;\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = current.parentNode;\r\n\t\t}\r\n\r\n\t\tif(offsetTop < -this.threshold || subOffsetTop < -this.threshold)\r\n\t\t{\r\n\t\t\tthis.topEdge = false;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.topEdge = true;\r\n\r\n\t\t\tif(offsetBottom - this.element.clientHeight > this.threshold)\r\n\t\t\t{\r\n\t\t\t\tthis.topEdge = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.bottomEdge = false;\r\n\r\n\t\tif(offsetBottom <= this.threshold)\r\n\t\t{\r\n\t\t\tthis.bottomEdge = true;\r\n\r\n\t\t\tif(offsetTop + this.element.clientHeight < -this.threshold)\r\n\t\t\t{\r\n\t\t\t\tthis.bottomEdge = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// this.offsetTop    = offsetTop;\r\n\t\t// this.offsetBottom = this.offsetBottom\r\n\r\n\t\tlet visible = false;\r\n\r\n\t\tif(offsetBottom <=this.element.clientHeight && offsetTop > -this.element.clientHeight)\r\n\t\t{\r\n\t\t\tvisible = true;\r\n\t\t}\r\n\r\n\t\tthis.proxy.visible      = visible;\r\n\t\tthis.proxy.offsetTop    = offsetTop;\r\n\t\tthis.proxy.offsetBottom = offsetBottom;\r\n\t}\r\n\taddScrollListener(tag)\r\n\t{\r\n\t\tif(!tag.scrollListener)\r\n\t\t{\r\n\t\t\tObject.defineProperty(tag, 'scrollListener', {\r\n\t\t\t\tenumerable: false\r\n\t\t\t\t, writable: true\r\n\t\t\t});\r\n\r\n\t\t\tObject.defineProperty(tag, 'scrollSubTags', {\r\n\t\t\t\tenumerable: false\r\n\t\t\t\t, writable: true\r\n\t\t\t});\r\n\r\n\t\t\ttag.scrollListener = true;\r\n\t\t\ttag.scrollSubTags  = [];\r\n\r\n\t\t\ttag.addEventListener('scroll', this.scrollListener);\r\n\r\n\t\t\tthis.cleanup.push(((element)=>()=>{\r\n\t\t\t\telement.removeEventListener('scroll', this.scrollListener);\r\n\t\t\t\telement.scrollSubTags = undefined;\r\n\t\t\t})(tag));\r\n\t\t}\r\n\r\n\t\tfor(let i in this.subscribedTo)\r\n\t\t{\r\n\t\t\tif(this.subscribedTo[i] === tag)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(tag.scrollSubTags)\r\n\t\t{\r\n\t\t\ttag.scrollSubTags.push(this);\r\n\t\t}\r\n\t}\r\n\tstatic addResizeListener(tag)\r\n\t{\r\n\t\tthis.resizeTags = [];\r\n\r\n\t\tif(!this.resizeListener)\r\n\t\t{\r\n\t\t\t// window.addEventListener('resize', this.resizeListener);\r\n\r\n\t\t\t// this.cleanup.push(()=>{\r\n\t\t\t// \twindow.removeEventListener('resize', this.resizeListener);\r\n\t\t\t// });\r\n\t\t}\r\n\r\n\t\tthis.resizeListener = true;\r\n\r\n\t\tthis.resizeTags.push(tag);\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nimport { ToastAlert } from './ToastAlert';\r\n\r\nexport class Toast extends View {\r\n\tstatic instance() {\r\n\t\tif(!this.inst) {\r\n\t\t\tthis.inst = new this();\r\n\t\t}\r\n\t\treturn this.inst;\r\n\t}\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.template = `\r\n\t\t\t<div id = \"[[_id]]\" cv-each = \"alerts:alert\" class = \"toast\">\r\n\t\t\t\t[[alert]]\r\n\t\t\t</div>\r\n\t\t`;\r\n\t\t// this.style = {\r\n\t\t// \t'': {\r\n\t\t// \t\tposition:   'fixed'\r\n\t\t// \t\t, top:      '0px'\r\n\t\t// \t\t, right:    '0px'\r\n\t\t// \t\t, padding:  '8px'\r\n\t\t// \t\t, 'z-index':'999999'\r\n\t\t// \t\t, display:  'flex'\r\n\t\t// \t\t, 'flex-direction': 'column-reverse'\r\n\t\t// \t}\r\n\t\t// };\r\n\t\t\r\n\t\tthis.args.alerts = [];\r\n\r\n\t\tthis.args.alerts.bindTo((v) => { console.log(v) });\r\n\t}\r\n\tpop(alert) {\r\n\t\tlet index = this.args.alerts.length;\r\n\r\n\t\tthis.args.alerts.push(alert);\r\n\r\n\t\talert.decay(((alert)=>()=>{\r\n\t\t\tfor(let i in this.args.alerts)\r\n\t\t\t{\r\n\t\t\t\tif(this.args.alerts)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.args.alerts[i] === alert;\r\n\r\n\t\t\t\t\tthis.args.alerts.splice(i, 1);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})(alert));\r\n\t}\r\n}\r\n","import { View } from '../base/View';\r\n\r\nexport class ToastAlert extends View {\r\n\tconstructor(args) {\r\n\t\tsuper(args);\r\n\t\tthis.args.time    = this.args.time || 10000;\r\n\t\tthis.init         = this.args.time;\r\n\t\tthis.args.opacity = 1;\r\n\t\tthis.args.title   = this.args.title || 'Standard alert';\r\n\t\tthis.args.body    = this.args.body  || 'This is a standard alert.';\r\n\t\tthis.template     = `\r\n\t\t\t<div id = \"[[_id]]\" style = \"opacity:[[opacity]]\" class = \"alert\">\r\n\t\t\t\t<h3>[[title]]</h3>\r\n\t\t\t\t<p>[[body]]</p>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\tdecay(complete) {\r\n\t\tlet decayInterval = 16;\r\n\t\tlet decay = setInterval(\r\n\t\t\t()=>{\r\n\t\t\t\tif(this.args.time > 0) {\r\n\t\t\t\t\tthis.args.time -= decayInterval;\r\n\t\t\t\t\tthis.args.opacity = this.args.time / this.init;\r\n\r\n\t\t\t\t\tif(this.args.time <= 0) {\r\n\t\t\t\t\t\tif(complete) {\r\n\t\t\t\t\t\t\tcomplete();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tclearInterval(decay);\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t, decayInterval\r\n\t\t);\r\n\t}\r\n}\r\n"]}